<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1200">
    <title>ìƒˆí¬ë¼ë©˜í†  ì˜ê´‘êµíšŒ - Sacramento Glory Church</title>
    
    <!-- PWA ì„¤ì • -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GKC">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Apple SD Gothic Neo', 'ë§‘ì€ ê³ ë”•', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        /* í—¤ë” - ì€í˜œë¡œìš´ ê·¸ë¼ë°ì´ì…˜ */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #9f7aea 100%);
            color: white;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo {
            font-size: 2em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .language-switch {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .language-switch:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ - ë¶€ë“œëŸ¬ìš´ ìŠ¤íƒ€ì¼ */
        .nav {
            background: white;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
        }
        
        .nav-item {
            padding: 18px 25px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            font-weight: 500;
        }
        
        .nav-item:hover {
            background: #f8f9ff;
        }
        
        .nav-item.active {
            background: #f0f4ff;
            color: #667eea;
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #9f7aea);
        }
        
        /* ì„¹ì…˜ë³„ ê³ ìœ  ìƒ‰ìƒ */
        .section-home { --section-color: #667eea; }
        .section-about { --section-color: #48bb78; }
        .section-worship { --section-color: #ed8936; }
        .section-news { --section-color: #38b2ac; }
        .section-dashboard { --section-color: #9f7aea; }
        .section-members { --section-color: #4299e1; }
        .section-attendance { --section-color: #48bb78; }
        .section-offering { --section-color: #f56565; }
        .section-cell { --section-color: #d69e2e; }
        .section-department { --section-color: #805ad5; }
        .section-mentor { --section-color: #319795; }
        .section-users { --section-color: #e53e3e; }
        
        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0;
                transform: translateY(10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ì¹´ë“œ - ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ìì™€ ëª¨ì„œë¦¬ */
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }
        
        .card:hover {
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }
        
        .card h2 {
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid;
            border-image: linear-gradient(90deg, var(--section-color, #667eea), transparent) 1;
        }
        
        .card h3 {
            color: #4a5568;
            margin: 20px 0 15px;
        }
        
        /* ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ¯ ì¹´ë“œ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--stat-color-1, #667eea), var(--stat-color-2, #9f7aea));
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        
        .stat-value {
            font-size: 2.8em;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .stat-label {
            opacity: 0.95;
            font-size: 1.1em;
            font-weight: 500;
        }
        
        /* í¼ ìŠ¤íƒ€ì¼ - ë¶€ë“œëŸ¬ìš´ ì…ë ¥ í•„ë“œ */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
            font-size: 0.95em;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--section-color, #667eea);
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }
        
        /* ë²„íŠ¼ - ì€í˜œë¡œìš´ ìŠ¤íƒ€ì¼ */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #9f7aea);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #718096, #4a5568);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
        }
        
        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        /* í…Œì´ë¸” - ê¹”ë”í•œ ìŠ¤íƒ€ì¼ */
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th {
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #4a5568;
            border-bottom: 2px solid #e2e8f0;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        tr:hover {
            background: #f8f9ff;
        }
        
        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .modal.active {
            display: flex;
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background: white;
            padding: 35px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            margin-bottom: 25px;
            text-align: center;
        }
        
        .modal-header h2 {
            color: #2d3748;
            font-size: 1.8em;
        }
        
        /* íˆì–´ë¡œ ì„¹ì…˜ */
        .hero {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(159, 122, 234, 0.9)),
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 400"><rect fill="%23667eea" width="1200" height="400"/></svg>');
            background-size: cover;
            color: white;
            padding: 60px 30px;
            text-align: center;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        }
        
        .hero h1 {
            font-size: 2.8em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .service-times {
            background: rgba(255,255,255,0.15);
            padding: 25px;
            border-radius: 15px;
            display: inline-block;
            backdrop-filter: blur(10px);
        }
        
        /* ì˜ˆì‚° ê·¸ë˜í”„ */
        .budget-chart {
            background: #f7fafc;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .budget-bar {
            position: relative;
            height: 40px;
            background: #e2e8f0;
            border-radius: 20px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .budget-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            border-radius: 20px;
            transition: width 1s ease-out;
            display: flex;
            align-items: center;
            padding: 0 15px;
            color: white;
            font-weight: 600;
        }
        
        .budget-over {
            background: linear-gradient(90deg, #f56565, #e53e3e);
        }
        
        /* ë°°ì§€ */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .badge-success {
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
            color: #22543d;
        }
        
        .badge-warning {
            background: linear-gradient(135deg, #fed7aa, #fdba74);
            color: #7c2d12;
        }
        
        .badge-danger {
            background: linear-gradient(135deg, #feb2b2, #fc8181);
            color: #742a2a;
        }
        
        .badge-info {
            background: linear-gradient(135deg, #bee3f8, #90cdf4);
            color: #2a4e7c;
        }
        
        /* ì•Œë¦¼ ë©”ì‹œì§€ */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            animation: slideDown 0.3s;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .alert-success {
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
            color: #22543d;
            border-left: 4px solid #48bb78;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #fed7aa, #fdba74);
            color: #7c2d12;
            border-left: 4px solid #ed8936;
        }
        
        .alert-danger {
            background: linear-gradient(135deg, #feb2b2, #fc8181);
            color: #742a2a;
            border-left: 4px solid #f56565;
        }
        
        /* ========== ëª¨ë°”ì¼ í–„ë²„ê±° ë©”ë‰´ ========== */
        .mobile-menu-btn {
            display: none;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 1.5em;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .mobile-nav-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        
        .mobile-nav-overlay.active {
            display: block;
        }
        
        .mobile-nav-menu {
            position: fixed;
            top: 0;
            right: -280px;
            width: 280px;
            height: 100%;
            background: white;
            z-index: 1000;
            transition: right 0.3s ease;
            overflow-y: auto;
            box-shadow: -5px 0 20px rgba(0,0,0,0.2);
        }
        
        .mobile-nav-menu.active {
            right: 0;
        }
        
        .mobile-nav-header {
            background: linear-gradient(135deg, #667eea 0%, #9f7aea 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mobile-nav-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 1.5em;
            padding: 5px 12px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .mobile-nav-items {
            padding: 10px 0;
        }
        
        .mobile-nav-item {
            display: block;
            padding: 15px 20px;
            color: #333;
            text-decoration: none;
            border-bottom: 1px solid #eee;
            font-weight: 500;
            cursor: pointer;
        }
        
        .mobile-nav-item:hover, .mobile-nav-item.active {
            background: #f0f4ff;
            color: #667eea;
        }
        
        /* ========== ëª¨ë°”ì¼ ë°˜ì‘í˜• (768px ì´í•˜) ========== */
        @media (max-width: 768px) {
            /* í—¤ë” */
            .header {
                padding: 15px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 10px;
            }
            
            .logo {
                font-size: 1.3em !important;
                text-align: center;
            }
            
            .logo img {
                width: 40px !important;
                height: 40px !important;
            }
            
            .logo > div > div {
                font-size: 0.6em !important;
            }
            
            /* ì‚¬ìš©ì ì •ë³´ ì˜ì—­ */
            .user-info {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .language-switch {
                padding: 6px 12px;
                font-size: 0.85em;
            }
            
            #authButtons {
                gap: 5px !important;
            }
            
            #authButtons .btn {
                padding: 8px 12px !important;
                font-size: 0.85em !important;
            }
            
            /* í–„ë²„ê±° ë©”ë‰´ í‘œì‹œ */
            .mobile-menu-btn {
                display: block;
                position: absolute;
                right: 15px;
                top: 15px;
            }
            
            /* ê¸°ì¡´ ë„¤ë¹„ê²Œì´ì…˜ ìˆ¨ê¸°ê¸° */
            .nav {
                display: none;
            }
            
            /* ë©”ì¸ ì»¨í…ì¸  */
            .main-content {
                padding: 0 10px;
                margin: 15px auto;
            }
            
            /* ì¹´ë“œ */
            .card {
                padding: 15px;
                margin-bottom: 15px;
                border-radius: 10px;
            }
            
            .card h2 {
                font-size: 1.2em;
            }
            
            /* ìŠ¬ë¼ì´ë“œ/ë°°ë„ˆ */
            .hero-slide h2 {
                font-size: 1.3em !important;
            }
            
            .hero-slide h3 {
                font-size: 1em !important;
            }
            
            .hero-slide p {
                font-size: 0.85em !important;
            }
            
            /* ëŒ€ì‹œë³´ë“œ ê·¸ë¦¬ë“œ */
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .stat-card {
                padding: 15px 10px;
            }
            
            .stat-value {
                font-size: 1.8em;
            }
            
            .stat-label {
                font-size: 0.85em;
            }
            
            /* í¼ */
            .form-row {
                grid-template-columns: 1fr !important;
            }
            
            /* ë²„íŠ¼ ê·¸ë£¹ */
            .btn-group {
                flex-direction: column;
            }
            
            .btn-group .btn {
                width: 100%;
            }
            
            /* í…Œì´ë¸” ìŠ¤í¬ë¡¤ */
            .table-responsive {
                overflow-x: auto;
            }
            
            table {
                min-width: 600px;
            }
            
            /* ëª¨ë‹¬ */
            .modal-content {
                width: 95% !important;
                max-width: none !important;
                margin: 10px;
                max-height: 90vh;
                overflow-y: auto;
            }
        }
        
        /* ========== ë” ì‘ì€ í™”ë©´ (480px ì´í•˜) ========== */
        @media (max-width: 480px) {
            .header {
                padding: 12px 10px;
            }
            
            .logo {
                font-size: 1.1em !important;
            }
            
            .logo img {
                width: 35px !important;
                height: 35px !important;
            }
            
            .user-info {
                gap: 5px;
            }
            
            #authButtons .btn {
                padding: 6px 10px !important;
                font-size: 0.8em !important;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-value {
                font-size: 1.5em;
            }
            
            .card {
                padding: 12px;
            }
            
            .card h2 {
                font-size: 1.1em;
            }
        }
    </style>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyAG6_0snbn9BfY0N94EsZiG7GbiSA31zNY",
            authDomain: "gkc-web-project-c87c9.firebaseapp.com",
            projectId: "gkc-web-project-c87c9",
            storageBucket: "gkc-web-project-c87c9.firebasestorage.app",
            messagingSenderId: "482708865916",
            appId: "1:482708865916:web:55ace8c18c023278dddaf9"
        };
        
        // Firebase ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // ===================== ì•± ë²„ì „ ê´€ë¦¬ =====================
        const APP_VERSION = '2024.12.01.001'; // ë²„ì „ ì—…ë°ì´íŠ¸ ì‹œ ì´ ê°’ì„ ë³€ê²½
        let isVersionCheckActive = false;
        
        // ë²„ì „ ì²´í¬ ë° ì‹¤ì‹œê°„ ê°ì§€ ì‹œì‘
        function startVersionCheck() {
            if (isVersionCheckActive) return;
            isVersionCheckActive = true;
            
            // ì‹¤ì‹œê°„ ë²„ì „ ê°ì§€ ë¦¬ìŠ¤ë„ˆ
            db.collection('appConfig').doc('version').onSnapshot((doc) => {
                if (doc.exists) {
                    const serverVersion = doc.data().current;
                    const lastUpdate = doc.data().updatedAt;
                    
                    // í˜„ì¬ ë²„ì „ê³¼ ì„œë²„ ë²„ì „ì´ ë‹¤ë¥´ë©´ ì—…ë°ì´íŠ¸ ì•Œë¦¼
                    if (serverVersion && serverVersion !== APP_VERSION) {
                        showUpdateNotification(serverVersion);
                    }
                }
            }, (error) => {
                console.log('ë²„ì „ ì²´í¬ ì˜¤ë¥˜:', error);
            });
        }
        
        // ì—…ë°ì´íŠ¸ ì•Œë¦¼ í‘œì‹œ
        function showUpdateNotification(newVersion) {
            // ì´ë¯¸ ì•Œë¦¼ì´ ìˆìœ¼ë©´ ë¬´ì‹œ
            if (document.getElementById('updateNotification')) return;
            
            const notification = document.createElement('div');
            notification.id = 'updateNotification';
            notification.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 15px 20px; z-index: 10000; box-shadow: 0 4px 20px rgba(0,0,0,0.3); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.5em;">ğŸ”„</span>
                        <div>
                            <div style="font-weight: 600;">ìƒˆ ë²„ì „ì´ ìˆìŠµë‹ˆë‹¤!</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">ë²„ì „ ${newVersion} - ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ìµœì‹  ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì„¸ìš”.</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="location.reload()" style="background: white; color: #667eea; border: none; padding: 10px 25px; border-radius: 25px; font-weight: 600; cursor: pointer;">
                            ì§€ê¸ˆ ìƒˆë¡œê³ ì¹¨
                        </button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 10px 15px; border-radius: 25px; cursor: pointer;">
                            ë‚˜ì¤‘ì—
                        </button>
                    </div>
                </div>
            `;
            document.body.prepend(notification);
        }
        
        // ê´€ë¦¬ììš©: ìƒˆ ë²„ì „ ë°œí–‰
        async function publishNewVersion() {
            if (!currentUser || currentUser.role !== 'ê´€ë¦¬ì') {
                alert('ê´€ë¦¬ìë§Œ ë²„ì „ì„ ë°œí–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            const newVersion = prompt('ìƒˆ ë²„ì „ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:', APP_VERSION);
            if (!newVersion) return;
            
            try {
                await db.collection('appConfig').doc('version').set({
                    current: newVersion,
                    updatedAt: new Date().toISOString(),
                    updatedBy: currentUser.username
                });
                alert(`ë²„ì „ ${newVersion}ì´ ë°œí–‰ë˜ì—ˆìŠµë‹ˆë‹¤.\në‹¤ë¥¸ ì‚¬ìš©ìë“¤ì—ê²Œ ì—…ë°ì´íŠ¸ ì•Œë¦¼ì´ í‘œì‹œë©ë‹ˆë‹¤.`);
            } catch (error) {
                console.error('ë²„ì „ ë°œí–‰ ì˜¤ë¥˜:', error);
                alert('ë²„ì „ ë°œí–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë²„ì „ ì²´í¬ ì‹œì‘
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(startVersionCheck, 2000); // 2ì´ˆ í›„ ë²„ì „ ì²´í¬ ì‹œì‘
        });
        
        // Firestore ë°ì´í„° ì €ì¥ í•¨ìˆ˜
        async function saveToFirestore(collection, data) {
            try {
                await db.collection(collection).doc('main').set(data);
                console.log(collection + ' ì €ì¥ ì™„ë£Œ');
            } catch (error) {
                console.error('Firestore ì €ì¥ ì˜¤ë¥˜:', error);
            }
        }
        
        // Firestore ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
        async function loadFromFirestore(collection) {
            try {
                const doc = await db.collection(collection).doc('main').get();
                if (doc.exists) {
                    return doc.data();
                }
                return null;
            } catch (error) {
                console.error('Firestore ë¡œë“œ ì˜¤ë¥˜:', error);
                return null;
            }
        }
        
        // ì „ì—­ ë°ì´í„° ë³€ìˆ˜
        let firebaseReady = false;
    </script>
</head>
<body>
    <!-- í—¤ë” -->
    <div class="header">
        <div class="header-content" style="position: relative;">
            <div class="logo" style="display: flex; align-items: center; gap: 12px;">
                <img src="icons/logo.png" alt="GKC ë¡œê³ " style="width: 50px; height: 50px; border-radius: 8px; background: white; padding: 3px;">
                <div>
                    ìƒˆí¬ë¼ë©˜í†  ì˜ê´‘êµíšŒ
                    <div style="font-size: 0.5em; opacity: 0.9;">Sacramento Glory Church</div>
                </div>
            </div>
            <!-- ëª¨ë°”ì¼ í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ -->
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">â˜°</button>
            <div class="user-info">
                <div class="language-switch" onclick="toggleLanguage()">
                    ğŸŒ <span id="langText">í•œêµ­ì–´</span>
                </div>
                <div id="userDisplay" style="display:none;">
                    <span id="userName" style="margin-right: 10px;"></span>
                    <span id="userRole" class="badge badge-info"></span>
                    <button class="btn btn-secondary" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
                <div id="authButtons" style="display: flex; gap: 10px;">
                    <button id="loginBtn" class="btn btn-primary" onclick="showLogin()">ë¡œê·¸ì¸</button>
                    <button id="signupBtn" class="btn btn-secondary" onclick="showSignupRequest()">ê°€ì…ì‹ ì²­</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ëª¨ë°”ì¼ ë„¤ë¹„ê²Œì´ì…˜ ì˜¤ë²„ë ˆì´ -->
    <div class="mobile-nav-overlay" id="mobileNavOverlay" onclick="closeMobileMenu()"></div>
    
    <!-- ëª¨ë°”ì¼ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ -->
    <div class="mobile-nav-menu" id="mobileNavMenu">
        <div class="mobile-nav-header">
            <span style="font-weight: bold;">ë©”ë‰´</span>
            <button class="mobile-nav-close" onclick="closeMobileMenu()">âœ•</button>
        </div>
        <div class="mobile-nav-items" id="mobileNavItems">
            <div class="mobile-nav-item active" onclick="showSectionMobile('home')">ğŸ  í™ˆ</div>
            <div class="mobile-nav-item" onclick="showSectionMobile('about')">â›ª êµíšŒì†Œê°œ</div>
            <div class="mobile-nav-item" onclick="showSectionMobile('worship')">ğŸ™ ì˜ˆë°°ì•ˆë‚´</div>
            <div class="mobile-nav-item" onclick="showSectionMobile('news')">ğŸ“° êµíšŒì†Œì‹</div>
            <div class="mobile-nav-item" onclick="showSectionMobile('sundayschool')">ğŸ“– Sunday School</div>
            <div class="mobile-nav-item" onclick="showSectionMobile('gallery')">ğŸ“· ê°¤ëŸ¬ë¦¬</div>
            <div class="mobile-nav-item member-only pastor-also" style="display:none;" onclick="showSectionMobile('my')">ğŸ‘¤ ë‚´ì •ë³´</div>
            <div class="mobile-nav-item perm-dashboard" style="display:none;" onclick="showSectionMobile('dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</div>
            <div class="mobile-nav-item perm-attendance" style="display:none;" onclick="showSectionMobile('attendance')">âœ… ì¶œì„ê´€ë¦¬</div>
            <div class="mobile-nav-item perm-cell" style="display:none;" onclick="showSectionMobile('cell')">ğŸ‘¥ êµ¬ì—­ê´€ë¦¬</div>
            <div class="mobile-nav-item perm-department" style="display:none;" onclick="showSectionMobile('department')">ğŸ›ï¸ ë¶€ì„œê´€ë¦¬</div>
            <div class="mobile-nav-item perm-mentor" style="display:none;" onclick="showSectionMobile('mentor')">ğŸ¤ ë©˜í† ë§</div>
            <div class="mobile-nav-item perm-offering" style="display:none;" onclick="showSectionMobile('offering')">ğŸ’° ì¬ì •ê´€ë¦¬</div>
            <div class="mobile-nav-item perm-members" style="display:none;" onclick="showSectionMobile('members')">ğŸ“‹ êµì ê´€ë¦¬</div>
            <div class="mobile-nav-item perm-users" style="display:none;" onclick="showSectionMobile('users')">âš™ï¸ ì‚¬ìš©ìê´€ë¦¬</div>
        </div>
    </div>
    
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="nav">
        <div class="nav-content" id="navMenu">
            <div class="nav-item active" onclick="showSection('home')">í™ˆ</div>
            <div class="nav-item" onclick="showSection('about')">êµíšŒì†Œê°œ</div>
            <div class="nav-item" onclick="showSection('worship')">ì˜ˆë°°ì•ˆë‚´</div>
            <div class="nav-item" onclick="showSection('news')">êµíšŒì†Œì‹</div>
            <div class="nav-item" onclick="showSection('sundayschool')">Sunday School</div>
            <div class="nav-item" onclick="showSection('gallery')">ê°¤ëŸ¬ë¦¬</div>
            <div class="nav-item member-only pastor-also" style="display:none;" onclick="showSection('my')">ë‚´ì •ë³´</div>
            <div class="nav-item perm-dashboard" style="display:none;" onclick="showSection('dashboard')">ëŒ€ì‹œë³´ë“œ</div>
            <div class="nav-item perm-attendance" style="display:none;" onclick="showSection('attendance')">ì¶œì„ê´€ë¦¬</div>
            <div class="nav-item perm-cell" style="display:none;" onclick="showSection('cell')">êµ¬ì—­ê´€ë¦¬</div>
            <div class="nav-item perm-department" style="display:none;" onclick="showSection('department')">ë¶€ì„œê´€ë¦¬</div>
            <div class="nav-item perm-mentor" style="display:none;" onclick="showSection('mentor')">ë©˜í† ë§</div>
            <div class="nav-item perm-offering" style="display:none;" onclick="showSection('offering')">ì¬ì •ê´€ë¦¬</div>
            <div class="nav-item perm-members" style="display:none;" onclick="showSection('members')">êµì ê´€ë¦¬</div>
            <div class="nav-item perm-users" style="display:none;" onclick="showSection('users')">ì‚¬ìš©ìê´€ë¦¬</div>
        </div>
    </div>
    
    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="main-content">
        <!-- í™ˆ ì„¹ì…˜ -->
        <div id="home" class="section section-home active" style="background: linear-gradient(180deg, #f5f0e8 0%, #ebe4d8 100%); padding: 25px; margin: -25px; margin-bottom: 0;">
            <!-- ë©”ì¸ íˆì–´ë¡œ ìŠ¬ë¼ì´ë“œì‡¼ -->
            <div id="heroSlideshow" style="position: relative; border-radius: 16px; margin-bottom: 25px; overflow: hidden; height: 320px;">
                <!-- ìŠ¬ë¼ì´ë“œ ì»¨í…Œì´ë„ˆ -->
                <div id="slidesContainer" style="position: relative; width: 100%; height: 100%;">
                    <!-- ìŠ¬ë¼ì´ë“œê°€ JavaScriptë¡œ ë™ì  ìƒì„±ë¨ -->
                </div>
                
                <!-- ìŠ¬ë¼ì´ë“œ ì¸ë””ì¼€ì´í„° -->
                <div id="slideIndicators" style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; z-index: 10;"></div>
                
                <!-- ì´ì „/ë‹¤ìŒ ë²„íŠ¼ -->
                <button onclick="prevSlide()" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.3); border: none; color: white; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 1.3em; z-index: 10; transition: background 0.3s;" onmouseover="this.style.background='rgba(0,0,0,0.5)'" onmouseout="this.style.background='rgba(0,0,0,0.3)'">â®</button>
                <button onclick="nextSlide()" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.3); border: none; color: white; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 1.3em; z-index: 10; transition: background 0.3s;" onmouseover="this.style.background='rgba(0,0,0,0.5)'" onmouseout="this.style.background='rgba(0,0,0,0.3)'">â¯</button>
                
                <!-- ê´€ë¦¬ì í¸ì§‘ ë²„íŠ¼ -->
                <button class="pastor-only" style="display: none; position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.95); border: none; color: #1e3a5f; padding: 10px 18px; border-radius: 25px; cursor: pointer; font-size: 0.85em; font-weight: 600; z-index: 10; box-shadow: 0 2px 10px rgba(0,0,0,0.2);" onclick="openSlideEditModal()">
                    ìŠ¬ë¼ì´ë“œ ê´€ë¦¬
                </button>
                
                <!-- ìë™ ì¬ìƒ ì»¨íŠ¸ë¡¤ -->
                <button id="slidePlayPause" onclick="toggleSlideAutoPlay()" style="position: absolute; bottom: 20px; right: 20px; background: rgba(0,0,0,0.4); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 0.9em; z-index: 10;" title="ìë™ ì¬ìƒ">â¸</button>
            </div>
            
            <!-- í™˜ì˜ ë©”ì‹œì§€ -->
            <div style="background: white; border-radius: 12px; padding: 35px; margin-bottom: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border-left: 4px solid #1e3a5f;">
                <h2 style="margin: 0 0 15px 0; color: #1e3a5f; font-size: 1.4em; font-weight: 600;">í™˜ì˜í•©ë‹ˆë‹¤</h2>
                <p style="margin: 0; color: #4a5568; font-size: 1.05em; line-height: 1.9;">
                    ìƒˆí¬ë¼ë©˜í†  ì˜ê´‘êµíšŒëŠ” ë³€í•˜ì§€ ì•ŠëŠ” í•˜ë‚˜ë‹˜ì˜ ë§ì”€ ìœ„ì— êµ³ê²Œ ì„œì„œ, ê°œí˜ì£¼ì˜ ì‹ ì•™ì˜ ì „í†µì„ ë”°ë¼ 
                    ì˜¤ì§ ì„±ê²½ì´ ê°€ë¥´ì¹˜ëŠ” ë³µìŒì„ ì „í•˜ëŠ” êµíšŒì…ë‹ˆë‹¤. ì§„ë¦¬ë¥¼ ì‚¬ëª¨í•˜ëŠ” ëª¨ë“  ë¶„ë“¤ì„ ì£¼ë‹˜ì˜ ì´ë¦„ìœ¼ë¡œ í™˜ì˜í•©ë‹ˆë‹¤.
                </p>
            </div>
            
            <!-- ì •ë³´ ì¹´ë“œ ê·¸ë¦¬ë“œ -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 25px;">
                
                <!-- ìµœì‹  ì˜ˆë°° ì˜ìƒ -->
                <div style="background: white; border-radius: 12px; padding: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <h3 style="margin: 0 0 20px 0; color: #1e3a5f; font-size: 1.15em; font-weight: 600; padding-bottom: 12px; border-bottom: 2px solid #e2e8f0;">ìµœì‹  ì˜ˆë°° ì˜ìƒ</h3>
                    <div id="homeLatestVideos">
                        <p style="color: #999; text-align: center; padding: 20px 0;">ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                </div>
                
                <!-- ì˜ˆë°° ì‹œê°„ -->
                <div style="background: white; border-radius: 12px; padding: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <h3 style="margin: 0 0 20px 0; color: #1e3a5f; font-size: 1.15em; font-weight: 600; padding-bottom: 12px; border-bottom: 2px solid #e2e8f0;">ì˜ˆë°° ì‹œê°„</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                        <div style="background: linear-gradient(135deg, #1e3a5f, #2d5a87); padding: 15px; border-radius: 10px; text-align: center; color: white;">
                            <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">ì£¼ì¼ì˜ˆë°°</div>
                            <div style="font-size: 1.2em; font-weight: 700;">ì˜¤ì „ 11:00</div>
                            <div style="font-size: 0.75em; opacity: 0.8; margin-top: 3px;">ë§¤ì£¼ ì£¼ì¼</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #2d5a87, #3d7ab5); padding: 15px; border-radius: 10px; text-align: center; color: white;">
                            <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 5px;">ìˆ˜ìš”ê²½ë°°ì™€ì°¬ì–‘</div>
                            <div style="font-size: 1.2em; font-weight: 700;">ì˜¤í›„ 6:30</div>
                            <div style="font-size: 0.75em; opacity: 0.8; margin-top: 3px;">ë§¤ì£¼ ìˆ˜ìš”ì¼</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #3d7ab5, #4a90c2); padding: 15px; border-radius: 10px; text-align: center; color: white;">
                            <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">ìƒˆë²½ì˜ˆë°°</div>
                            <div style="font-size: 1.2em; font-weight: 700;">ì˜¤ì „ 6:30</div>
                            <div style="font-size: 0.75em; opacity: 0.8; margin-top: 3px;">í™” ~ í† </div>
                        </div>
                        <div style="background: linear-gradient(135deg, #4a90c2, #5a9fd4); padding: 15px; border-radius: 10px; text-align: center; color: white;">
                            <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">ì„±ê²½ëª¨ì„</div>
                            <div style="font-size: 1.2em; font-weight: 700;">ì˜¤í›„ 2:00</div>
                            <div style="font-size: 0.75em; opacity: 0.8; margin-top: 3px;">ë§¤ì£¼ í™”ìš”ì¼</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #ed8936, #dd6b20); padding: 15px; border-radius: 10px; text-align: center; color: white; grid-column: span 2;">
                            <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">Sunday School</div>
                            <div style="font-size: 1.2em; font-weight: 700;">ì˜¤ì „ 11:00</div>
                            <div style="font-size: 0.75em; opacity: 0.8; margin-top: 3px;">ë§¤ì£¼ ì£¼ì¼</div>
                        </div>
                    </div>
                </div>
                
                <!-- êµíšŒ ìœ„ì¹˜ -->
                <div style="background: white; border-radius: 12px; padding: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <h3 style="margin: 0 0 20px 0; color: #1e3a5f; font-size: 1.15em; font-weight: 600; padding-bottom: 12px; border-bottom: 2px solid #e2e8f0;">ì˜¤ì‹œëŠ” ê¸¸</h3>
                    <a href="https://maps.google.com/?q=1820+Bell+St,+Sacramento,+CA+95825" target="_blank" style="text-decoration: none; color: inherit; display: block;">
                        <div style="color: #4a5568; line-height: 1.8; padding: 15px; background: #f8fafc; border-radius: 8px; transition: background 0.2s; cursor: pointer;" onmouseover="this.style.background='#edf2f7'" onmouseout="this.style.background='#f8fafc'">
                            <p style="margin: 0 0 5px 0; font-weight: 500;">1820 Bell St</p>
                            <p style="margin: 0 0 15px 0;">Sacramento, CA 95825</p>
                            <p style="margin: 0; color: #1e3a5f; font-size: 0.9em; font-weight: 500;">ì§€ë„ ë³´ê¸° â†’</p>
                        </div>
                    </a>
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e2e8f0; color: #4a5568;">
                        <p style="margin: 0 0 8px 0;"><span style="font-weight: 500;">ì „í™”:</span> (916) 969-8141</p>
                        <p style="margin: 0;"><span style="font-weight: 500;">ì´ë©”ì¼:</span> <a href="/cdn-cgi/l/email-protection#1566747672797a676c767d6067767d557d7a6178747c793b767a78" style="color: #2d5a87;"><span class="__cf_email__" data-cfemail="33405250545f5c414a505b4641505b735b5c475e525a5f1d505c5e">[email&#160;protected]</span></a></p>
                    </div>
                </div>
                
                <!-- ì˜¤ëŠ˜ì˜ ë§ì”€ -->
                <div style="background: white; border-radius: 12px; padding: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <h3 style="margin: 0 0 20px 0; color: #1e3a5f; font-size: 1.15em; font-weight: 600; padding-bottom: 12px; border-bottom: 2px solid #e2e8f0;">ì˜¤ëŠ˜ì˜ ë§ì”€</h3>
                    <a href="https://www.verseoftheday.com/ko/?bilingual=1" target="_blank" style="text-decoration: none; display: block;">
                        <div style="background: linear-gradient(135deg, #f8fafc, #eef2f7); padding: 25px; border-radius: 10px; border: 1px solid #e2e8f0; text-align: center; transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <div style="font-size: 2em; margin-bottom: 10px;">ğŸ“–</div>
                            <div style="color: #1e3a5f; font-weight: 600; font-size: 1.1em; margin-bottom: 5px;">ì˜¤ëŠ˜ì˜ ë§ì”€ ë³´ê¸°</div>
                            <div style="color: #64748b; font-size: 0.85em;">í•œì˜ ì„±ê²½ ë§ì”€</div>
                        </div>
                    </a>
                </div>
                
            </div>
            
            <!-- í•˜ë‹¨ ì•ˆë‚´ -->
            <div style="background: white; border-radius: 12px; padding: 30px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                <p style="margin: 0; color: #4a5568; font-size: 1.05em; line-height: 1.8;">
                    ì§„ë¦¬ë¥¼ ì‚¬ëª¨í•˜ëŠ” ëª¨ë“  ë¶„ë“¤ê³¼ í•¨ê»˜ ì˜ˆë°°ë“œë¦¬ê¸°ë¥¼ ì†Œë§í•©ë‹ˆë‹¤.
                </p>
            </div>
        </div>
        
        <!-- êµíšŒì†Œê°œ -->
        <div id="about" class="section section-about">
            <!-- ë©”ì¸ í—¤ë” ë°°ë„ˆ -->
            <div class="card" style="background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 50%, #3d7ab5 100%); color: white; margin-bottom: 25px; text-align: center; padding: 60px 30px; position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.05; background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âœ</text></svg>'); background-size: 100px; background-repeat: repeat;"></div>
                <div style="position: relative; z-index: 1;">
                    <p style="margin: 0 0 10px 0; font-size: 0.9em; letter-spacing: 4px; opacity: 0.9; text-transform: uppercase;">Sacramento Glory Church</p>
                    <h1 style="margin: 0; color: white; font-size: 2.8em; font-weight: 700;">ìƒˆí¬ë¼ë©˜í†  ì˜ê´‘êµíšŒ</h1>
                    <div style="width: 80px; height: 3px; background: rgba(255,255,255,0.8); margin: 25px auto;"></div>
                    <p style="margin: 0; font-size: 1.3em; font-style: italic; opacity: 0.95; line-height: 1.6;">
                        "ì˜¤ì§ ì„±ê²½, ì˜¤ì§ ê·¸ë¦¬ìŠ¤ë„, ì˜¤ì§ ë¯¿ìŒ, ì˜¤ì§ ì€í˜œ, ì˜¤ì§ í•˜ë‚˜ë‹˜ê»˜ ì˜ê´‘"
                    </p>
                    <p style="margin: 20px 0 0 0; opacity: 0.7; font-size: 0.95em; letter-spacing: 2px;">
                        Sola Scriptura Â· Solus Christus Â· Sola Fide Â· Sola Gratia Â· Soli Deo Gloria
                    </p>
                    <div style="margin-top: 30px; display: inline-block; background: rgba(255,255,255,0.15); padding: 12px 30px; border-radius: 30px; backdrop-filter: blur(5px);">
                        <span style="font-size: 1.1em;">2008ë…„ ì„¤ë¦½ Â· ê°œí˜ì£¼ì˜ ì‹ ì•™ Â· ë§ì”€ ì¤‘ì‹¬ êµíšŒ</span>
                    </div>
                </div>
            </div>
            
            <!-- í™˜ì˜ ë©”ì‹œì§€ -->
            <div class="card" style="margin-bottom: 25px; background: linear-gradient(135deg, #f8fafc, #edf2f7); border-left: 5px solid #1e3a5f;">
                <div style="text-align: center; padding: 10px 0;">
                    <h2 style="margin: 0 0 15px 0; color: #1e3a5f; font-size: 1.6em;">í™˜ì˜í•©ë‹ˆë‹¤</h2>
                    <p style="margin: 0; color: #4a5568; font-size: 1.1em; line-height: 1.9; max-width: 800px; margin: 0 auto;">
                        ìƒˆí¬ë¼ë©˜í†  ì˜ê´‘êµíšŒëŠ” <strong>ë³€í•˜ì§€ ì•ŠëŠ” í•˜ë‚˜ë‹˜ì˜ ë§ì”€</strong> ìœ„ì— êµ³ê²Œ ì„œì„œ,<br>
                        <strong>ê°œí˜ì£¼ì˜ ì‹ ì•™</strong>ì˜ ì „í†µì„ ë”°ë¼ ì˜¤ì§ ì„±ê²½ì´ ê°€ë¥´ì¹˜ëŠ” ë³µìŒì„ ì „í•˜ëŠ” êµíšŒì…ë‹ˆë‹¤.<br>
                        ì§„ë¦¬ë¥¼ ì‚¬ëª¨í•˜ëŠ” ëª¨ë“  ë¶„ë“¤ì„ ì£¼ë‹˜ì˜ ì´ë¦„ìœ¼ë¡œ í™˜ì˜í•©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
            
            <!-- ìš°ë¦¬ êµíšŒëŠ” -->
            <div class="card" style="margin-bottom: 25px;">
                <h2 style="color: #1e3a5f; border-bottom: 3px solid #1e3a5f; padding-bottom: 12px; margin-bottom: 25px; font-size: 1.5em;">ìš°ë¦¬ êµíšŒëŠ”</h2>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #f8fafc; padding: 25px; border-radius: 12px; border-top: 4px solid #1e3a5f;">
                        <h4 style="margin: 0 0 15px 0; color: #1e3a5f; font-size: 1.1em;">ì„±ê²½ì˜ ë¬´ì˜¤ì„±ì„ ë¯¿ìŠµë‹ˆë‹¤</h4>
                        <p style="margin: 0; color: #4a5568; line-height: 1.8; font-size: 0.95em;">
                            ì„±ê²½ 66ê¶Œì€ í•˜ë‚˜ë‹˜ì˜ ì˜ê°ìœ¼ë¡œ ê¸°ë¡ëœ ì˜¤ë¥˜ ì—†ëŠ” ë§ì”€ì…ë‹ˆë‹¤. 
                            ì„±ê²½ì„ ì‹ ì•™ê³¼ ìƒí™œì˜ ìœ ì¼í•œ ê·œë²”ìœ¼ë¡œ ì‚¼ìŠµë‹ˆë‹¤.
                        </p>
                    </div>
                    <div style="background: #f8fafc; padding: 25px; border-radius: 12px; border-top: 4px solid #2d5a87;">
                        <h4 style="margin: 0 0 15px 0; color: #1e3a5f; font-size: 1.1em;">ê°œí˜ì£¼ì˜ ì‹ ì•™ì„ ë”°ë¦…ë‹ˆë‹¤</h4>
                        <p style="margin: 0; color: #4a5568; line-height: 1.8; font-size: 0.95em;">
                            16ì„¸ê¸° ì¢…êµê°œí˜ìë“¤ì´ íšŒë³µí•œ ë³µìŒì˜ ì§„ë¦¬ë¥¼ ë”°ë¦…ë‹ˆë‹¤. 
                            "ì˜¤ì§" (Sola)ì˜ ì›ë¦¬ ìœ„ì—ì„œ ì˜ˆë°°í•˜ê³  ìƒí™œí•©ë‹ˆë‹¤.
                        </p>
                    </div>
                    <div style="background: #f8fafc; padding: 25px; border-radius: 12px; border-top: 4px solid #3d7ab5;">
                        <h4 style="margin: 0 0 15px 0; color: #1e3a5f; font-size: 1.1em;">ê°•í•´ ì„¤êµë¥¼ ì¤‘ì‹¬í•©ë‹ˆë‹¤</h4>
                        <p style="margin: 0; color: #4a5568; line-height: 1.8; font-size: 0.95em;">
                            í•˜ë‚˜ë‹˜ì˜ ë§ì”€ì„ í•œ êµ¬ì ˆ í•œ êµ¬ì ˆ ê¹Šì´ ìˆê²Œ ê°•í•´í•©ë‹ˆë‹¤. 
                            ì‚¶ì— ì ìš©ë˜ëŠ” ì‚´ì•„ìˆëŠ” ì„¤êµë¥¼ ì¶”êµ¬í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                    <div style="background: #f8fafc; padding: 25px; border-radius: 12px; border-top: 4px solid #4a90c2;">
                        <h4 style="margin: 0 0 15px 0; color: #1e3a5f; font-size: 1.1em;">ì„¸ìƒê³¼ íƒ€í˜‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</h4>
                        <p style="margin: 0; color: #4a5568; line-height: 1.8; font-size: 0.95em;">
                            ì‹œëŒ€ì˜ íë¦„ì— í¸ìŠ¹í•˜ì§€ ì•Šê³ , 2ì²œ ë…„ ì „ ì‚¬ë„ë“¤ì´ ì „í•œ 
                            ê·¸ ë³µìŒì„ ë³€í•¨ì—†ì´ ì„ í¬í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                    <div style="background: #f8fafc; padding: 25px; border-radius: 12px; border-top: 4px solid #5a9fd4;">
                        <h4 style="margin: 0 0 15px 0; color: #1e3a5f; font-size: 1.1em;">ëœ¨ê±°ìš´ ì°¬ì–‘ì´ ìˆìŠµë‹ˆë‹¤</h4>
                        <p style="margin: 0; color: #4a5568; line-height: 1.8; font-size: 0.95em;">
                            ì˜¨ ë§ˆìŒì„ ë‹¤í•œ ëœ¨ê±°ìš´ ì°¬ì–‘ìœ¼ë¡œ ì˜ˆë°°í•©ë‹ˆë‹¤. 
                            ì°¬ì–‘ ê°€ìš´ë° ì„ì¬í•˜ì‹œëŠ” í•˜ë‚˜ë‹˜ì„ ë§Œë‚©ë‹ˆë‹¤.
                        </p>
                    </div>
                    <div style="background: #f8fafc; padding: 25px; border-radius: 12px; border-top: 4px solid #6bb0e0;">
                        <h4 style="margin: 0 0 15px 0; color: #1e3a5f; font-size: 1.1em;">ë‹¤ìŒ ì„¸ëŒ€ë¥¼ ì–‘ìœ¡í•©ë‹ˆë‹¤</h4>
                        <p style="margin: 0; color: #4a5568; line-height: 1.8; font-size: 0.95em;">
                            ìë…€ë“¤ì—ê²Œ ë¯¿ìŒì˜ ìœ ì‚°ì„ ì „ìˆ˜í•©ë‹ˆë‹¤. 
                            Sunday Schoolì„ í†µí•´ ë‹¤ìŒ ì„¸ëŒ€ë¥¼ ë§ì”€ ì•ˆì—ì„œ ì–‘ìœ¡í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
                
                <style>
                    @media (max-width: 900px) {
                        .church-features-grid { grid-template-columns: repeat(2, 1fr) !important; }
                    }
                    @media (max-width: 600px) {
                        .church-features-grid { grid-template-columns: 1fr !important; }
                    }
                </style>
                
                <div style="background: linear-gradient(135deg, #1e3a5f, #2d5a87); padding: 30px; border-radius: 12px; color: white; text-align: center;">
                    <p style="margin: 0; font-size: 1.2em; line-height: 1.8; font-style: italic;">
                        "ë‚´ê°€ ë³µìŒì„ ë¶€ë„ëŸ¬ì›Œí•˜ì§€ ì•„ë‹ˆí•˜ë…¸ë‹ˆ ì´ ë³µìŒì€ ëª¨ë“  ë¯¿ëŠ” ìì—ê²Œ<br>
                        êµ¬ì›ì„ ì£¼ì‹œëŠ” í•˜ë‚˜ë‹˜ì˜ ëŠ¥ë ¥ì´ ë¨ì´ë¼"
                    </p>
                    <p style="margin: 15px 0 0 0; opacity: 0.8;">- ë¡œë§ˆì„œ 1:16 -</p>
                </div>
            </div>
            
            <!-- êµíšŒ ì—­ì‚¬ -->
            <div class="card" style="margin-bottom: 25px;">
                <h2 style="color: #1e3a5f; border-bottom: 3px solid #1e3a5f; padding-bottom: 12px; margin-bottom: 25px; font-size: 1.5em;">êµíšŒ ì—­ì‚¬</h2>
                
                <div style="position: relative; padding-left: 30px; border-left: 3px solid #e2e8f0;">
                    <div style="margin-bottom: 30px; position: relative;">
                        <div style="position: absolute; left: -41px; top: 0; width: 20px; height: 20px; background: #1e3a5f; border-radius: 50%; border: 4px solid white; box-shadow: 0 0 0 3px #1e3a5f;"></div>
                        <h4 style="margin: 0 0 10px 0; color: #1e3a5f;">2008ë…„ - êµíšŒ ì„¤ë¦½</h4>
                        <p style="margin: 0; color: #4a5568; line-height: 1.7;">
                            ìƒˆí¬ë¼ë©˜í†  ì§€ì—­ì— ê°œí˜ì£¼ì˜ ì‹ ì•™ì„ ë°”íƒ•ìœ¼ë¡œ í•œ í•œì¸êµíšŒì˜ í•„ìš”ì„±ì„ ëŠë‚€ 
                            ëª‡ëª‡ ì„±ë„ë“¤ì˜ ê¸°ë„ì™€ í—Œì‹ ìœ¼ë¡œ ì˜ê´‘êµíšŒê°€ ì„¤ë¦½ë˜ì—ˆìŠµë‹ˆë‹¤. 
                            ì‘ì€ ê°€ì •ì—ì„œ ì‹œì‘ëœ ì˜ˆë°°ëŠ” ì˜¤ì§ ë§ì”€ê³¼ ê¸°ë„ë¡œ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.
                        </p>
                    </div>
                    <div style="margin-bottom: 30px; position: relative;">
                        <div style="position: absolute; left: -41px; top: 0; width: 20px; height: 20px; background: #2d5a87; border-radius: 50%; border: 4px solid white; box-shadow: 0 0 0 3px #2d5a87;"></div>
                        <h4 style="margin: 0 0 10px 0; color: #1e3a5f;">2008-2015ë…„ - ë¿Œë¦¬ë‚´ë¦¼ì˜ ì‹œê¸°</h4>
                        <p style="margin: 0; color: #4a5568; line-height: 1.7;">
                            ë§ì”€ ì¤‘ì‹¬ì˜ ì˜ˆë°°ì™€ ì„±ê²½ê³µë¶€ë¥¼ í†µí•´ êµíšŒì˜ ì‹ ì•™ì  ì •ì²´ì„±ì„ í™•ë¦½í–ˆìŠµë‹ˆë‹¤. 
                            ì†Œìˆ˜ì´ì§€ë§Œ ì§„ë¦¬ë¥¼ ì‚¬ëª¨í•˜ëŠ” ì„±ë„ë“¤ì´ í•˜ë‚˜ì”© ëª¨ì—¬ë“¤ì—ˆê³ , 
                            ê°œí˜ì£¼ì˜ ì‹ ì•™ì˜ í† ëŒ€ ìœ„ì— êµíšŒ ê³µë™ì²´ê°€ í˜•ì„±ë˜ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤.
                        </p>
                    </div>
                    <div style="margin-bottom: 30px; position: relative;">
                        <div style="position: absolute; left: -41px; top: 0; width: 20px; height: 20px; background: #3d7ab5; border-radius: 50%; border: 4px solid white; box-shadow: 0 0 0 3px #3d7ab5;"></div>
                        <h4 style="margin: 0 0 10px 0; color: #1e3a5f;">2015-2020ë…„ - ì„±ì¥ê³¼ í™•ì¥</h4>
                        <p style="margin: 0; color: #4a5568; line-height: 1.7;">
                            ì²­ë…„ë¶€ì™€ êµìœ¡ë¶€ê°€ ì„¸ì›Œì§€ê³ , ë‹¤ìŒ ì„¸ëŒ€ë¥¼ í–¥í•œ ì‚¬ì—­ì´ ë³¸ê²©í™”ë˜ì—ˆìŠµë‹ˆë‹¤. 
                            ë§ì”€ì„ í†µí•´ ë³€í™”ëœ ì‚¶ì˜ ê°„ì¦ë“¤ì´ ì´ì–´ì¡Œê³ , 
                            êµíšŒëŠ” ì–‘ì ìœ¼ë¡œë‚˜ ì§ˆì ìœ¼ë¡œ ê±´ê°•í•˜ê²Œ ì„±ì¥í•´ ë‚˜ê°”ìŠµë‹ˆë‹¤.
                        </p>
                    </div>
                    <div style="position: relative;">
                        <div style="position: absolute; left: -41px; top: 0; width: 20px; height: 20px; background: #4a90c2; border-radius: 50%; border: 4px solid white; box-shadow: 0 0 0 3px #4a90c2;"></div>
                        <h4 style="margin: 0 0 10px 0; color: #1e3a5f;">2020ë…„-í˜„ì¬ - ìƒˆë¡œìš´ ë„ì•½</h4>
                        <p style="margin: 0; color: #4a5568; line-height: 1.7;">
                            íŒ¬ë°ë¯¹ì˜ ì–´ë ¤ì›€ ì†ì—ì„œë„ ì˜¨ë¼ì¸ ì˜ˆë°°ë¥¼ í†µí•´ ë§ì”€ ì‚¬ì—­ì„ ì´ì–´ê°”ìŠµë‹ˆë‹¤. 
                            ìœ„ê¸°ë¥¼ í†µí•´ ë”ìš± ë‹¨ë‹¨í•´ì§„ ê³µë™ì²´ëŠ” ì§€ì—­ì‚¬íšŒë¥¼ í–¥í•œ ì„ êµì™€ ì„¬ê¹€ìœ¼ë¡œ 
                            ë‚˜ì•„ê°€ë©°, ë‹¤ìŒ ì„¸ëŒ€ì— ì‹ ì•™ì˜ ìœ ì‚°ì„ ì „í•˜ê¸° ìœ„í•´ í˜ì“°ê³  ìˆìŠµë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- ë‹´ì„ëª©ì‚¬ ì¸ì‚¬ë§ -->
            <div class="card" style="margin-bottom: 25px;">
                <h2 style="color: #1e3a5f; border-bottom: 3px solid #1e3a5f; padding-bottom: 12px; margin-bottom: 25px; font-size: 1.5em;">ë‹´ì„ëª©ì‚¬ ì¸ì‚¬ë§</h2>
                <div style="display: flex; gap: 30px; flex-wrap: wrap; align-items: flex-start;">
                    <!-- ëª©ì‚¬ë‹˜ ì‚¬ì§„ -->
                    <div style="flex-shrink: 0; text-align: center;">
                        <div style="width: 150px; height: 180px; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.2); border: 3px solid #1e3a5f;">
                            <img src="data:image/webp;base64,UklGRlQWAABXRUJQVlA4WAoAAAAgAAAAJAEA1AAASUNDUMgBAAAAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADZWUDggZhQAABB4AJ0BKiUB1QA+USSORKOiIRYKzMw4BQSztzudlcDqnxlj/6iWpg5woEtj67ToKBe0Ug412Xisoa+ANFI4tpqt9m8jqZ6mcy9hp5eRgR20XuSN4Ua2AEBEjWW4JVXtCnapSXFp32ret9aEVoIGQmDJsfQEU/BNczKgQ5kYPJjkjm2UDqgJ+OO4nAlAMGV1Z+9Rfi0ALIgVwqOdxs550dy4QV+wn/c5t/BqqERuDf6gOdGt2GcwKUQy+bxmz8XbGMg9UMYEixO+Kpp3CPDbh520X5c74/Ceoust2qKC6wT8cq1vtf2sTArdJ4FBXPtCHyiUyedgBhlPl4kjHvYUx/OxmmLlhX3U+2RB7wccXpXn9aRgHVyxrIdLnqdZQsyjUcHW5+lxYR928e0G0dGgSHq70gUgj18vApm5SMDgRDebKXCBgXQQU3oAlYryW7z67TRuYppRHpI0qBQPEOixD43wZwYPeyF7E+KT8lQW2WRlE7Vaq5QLmxhRUj+GMcculFxMtYE9JqK/9vOfGnHgLiC6D30emVape27YWJNawUtyl6I6fXew18TRWfPw5yfKlJARYZ6GSnpOKNBcOTD5RVfRXGEXG9NV6ZuK2Q//hcelIZjKzn7KGrPWd9bhftQaHo/oQAU0A72/kflxktlrLK1MFMl13jk2z6CEGNhyQkh2FHSkpCbAGKb3H4qjqgY0H5jZmaDEfkroI4AWNAVAdG6pHRvOTKknC5aaj/3bZk55ke6e/xNxynJLpp219HSabwZZr8ZmGqmcvF5XnoorfkD/nUlD6I56d87zQ3CLMlxNrLKoHzgyI7p7Bk6dOfgMSMoucgEDWg3Xw5+A7fgVRWZSVZCFwXwL8d5Kg9At3XJMNAuhGkZWiCDF7+Mwd07CDqfhzonJjnbGHpDC4VLZWyyqOTu7hfywJG0I9B2usHr/pA0MjGN4jB/evrUzp5Hk4Mj64qKOqxJhQf8qGqENw0Gbfy9QTAGQACAeAB+4Jnl+GCKG8+0OnTYOc5iQF/qdAPgQ8FpMnDPh9pWWludHpFqHryiRqHD1rdzRwjV97IRSysw3guuVSfpjJUu73o5ll06Tux8V2isYNE0k1vSIfVYZbz1lZHeWSIKZqSwRjRMoj0ufTOqepE47T0X0H77iZl6Zr+DX0+G9tT9lzvG3B28OWniZY3YTLNrRjqTzEDttaQrru2EzADrJM+br9+1mT+2WsSvf+iA7cgsvLZjdpdvnAJi0VwNaUUNUMKeFHjgjdAuCi8n9cQItdwUrQLJGDm/WIGpRVKpfGAD+8O0KQGbb+nXZa7wcltHlHLl5KShpFeZXW/2+U6WKdAvKSpap3N08Km7jmO98IOldBU914ugzhO9VqcpllA/YE3IJvAMWTJ4svty1aXssxjr12L6PqGyVsme68eurU09/DmVL6JsXCG5YuwReTMG8NkJAAR3tSpjjyJTo2WkitlO5elENLCdlomGzh/fEWknR0bEsUECwcanm9DgkZIT/pB9AJID1nz5Qzln2a7/GO5wxEQ9+mmKf7BnnvrzNnahH5U6V5CU1CvNxvuS/ITWfzIEFR51n+RzHWL9CLW9t986EwjoJyDS/4C4MsLH4doP3zoXcELv4uEniwEPIqGT+bMnilxOkJ+9wPFQBvgQb0s98Ro8+8KNASkbp565L5xVm+0HV9VPF4hIUV7IRkuXWR19uXnLGxNs0t4AXIvfEX9QobUevTSW4seiJaqcsMdeYIFZZ55U92Ztm8WlE+WRFsQKn46BvG0O0mDq6eFd5REEdm4QrbzW8nITnlt09HhZxJ6HjtXyTiLboghTYJtm6dhmfkOU4/AxXRYi7Y6ZKWlqGQuV9irJKlRUivd+hbt7YBp9nhrWQ3d7CqLpHMvjk/NuZnxsMq7sYd1pOcG0IH99yciDnGLXnulUWtIa8c3hPOijKNNS+LwWCNt0YwFyR9quG2OulPhrOsaF6nIlGPA9TDIMkdbodf1DxW2LjCHxCtAkAa2qCo6dyQz3TQHWFUkRRTV2CsfVZRG/vqKiXtHjlM9GthPaldBC9KNsf6UEONhyPWAqyLSsXWC/ZOen3wLk0MslqMza6mZctUlcFAXE8IlMTBBvLy4kujdCVZ/1S6NHLai2m8gH+SR70Wbp06+R5/pTC/7UHVFP9Vdxn9LbJ4OLszMTuXnz1jw2xQRJ8BnJetkmJbsHraWHynt1uHOrGJhrgkGvRymtOgKDJ+xkEC36fAWCAJ9pqg1IS9bs7KCT4OfKyiVIqGkjUvo+Tdu3nrLopw76ByEwvHMZ7n4GqbfWxt+JDjkOGqbtc+yZFeRi5mtFA+1Lyb0PCU020DptOlMmiopix0lRKQLSrvMr86MsYwqHE5/RSDt4renKaPVNTpbci6KOnAa92hMeB7yazXiTAUlh3X93Yok3TZsoj6VnvskhRJNYP89WoHqVX6tSb3mmVN7hINZJDR4eHB4p1bq6f2x2LJwr399yFmltKqf6I2HDchTIhNRVYPyJM7XaLSSazaqCiCUUzoAC5vKGQ1WGYUdI5y8R6MRRhn51X739WwWOhCz1vY+uiAzuzsWLnNiQLC/tsu/F3BseOV52Ur0PMW3sak56azHf5/38ftMWaZv47amoDbIJl8x9SMq54sX6XPRCAu0pHfe2VVW7liYo9Eb/dK7fR55/s38xmkGv0Kw2yWKTaSds43m3Pk+Pua/0uiD2wtNHH7QI8AE09SqaaK1G4iaAEYF5ytFAQssjf6etA9YTq4oPSe8yL/yhfR4fAfPC8WnmmDPgZrFE/KxiHae/lFvmaam7WffH/SD9jrpmM4ZqSAAzArcPiraGOHHWAGj42oBjTVCfBviql1OsSjx2bdwNPx7+D4Rnze1fE20XSEyZYc/z/Vf3zOdc7BQLCDXlduxiCUyZA98MyCMhb2K4FMl5UOgRhHqVep4rEeEFbN/OXAOE5/LFkg7/dU3DARURCXoZIrZCysmzQWnA4xsjn7O23KB2HrSJ8QUro6RilCSsajCCJwXeIHEgQVRTfBuJas3zzzrh5LTPUDEWisj08HQ7Bx21vTUROMbL1fF+3zN05tDeX/tLrpn4muSqziBOtsL+JdLVI5+Ez7b35mqLfpMfPDWR8S0YVCD4P/+/jccTLjAlSWa8sBK0k8q1ShFBGchFnpMsODgm+oKC+YUFjlKJRJ2ek9hpHG+Jrq5P/EbxX33En6/Q2T+I95ToKdjuMp1it06MdNGZtRAAhPWKqzJLICQ9ZSRlbMgSy2B1eWJlhupK3NLq/G8rT6FIc8CoicY40koprOoQF3N64gPR5E3fIe/BD84lpk+VgfMjMbvQ2HHgYAbI7TEW2YeRDhLDWNOcDKxb+yNbQZrgAWBisTb309PwhTjOgX3xjSI/t05lXiygEZOHwOvrOungv1nYt+74UTj68NiCsXaWBLUquDzfXGFNONcRHmeRM70fgwwlbDlR6aTBL7LlFK3kWPcF+tqz3EjbHZcbVd6Zjc8pkLEbpwX9OKSUCLshMe9UruYppfVo/u3nb5mqVH2aeZ4/Ca7TDgHOYiGuiDnctHreuy2/mcKPxSQWev6izU9KpPOF+NhEPxi6E9FQcXpRg8m0THpZ6sw+J+xs9/46JjLUACc7Ot+zDDPM2Uhl577di32afvJ9bkrAOs+aRxA4XP1Dt7YGyHhzWrNQz+TEakTkfMxBYXySO2i1mHa4KYlwb3YHpzopkv7XQEU3v4SzYk5M/LTmQ/SU9rKEra0kwJYF5ESkdqEeTA4f/g9x1lsMxUO9Xohd8OlOLuPBC8idVhzkfzwEzZvCz+zvTMzt7vr0oAreFI9MNPKqJVGOA4Mz1KuYhOYmhEoSmf6llSgmiHldQlfoPce94a47KjnoAGDYC0vL2PFn/TgrnPh6hnWMjiKD0IOFGjGgPYxlE0mi9oDlk2vk+vEgy3PSRfl3m6qkkptn38V1D7Kn5vEqT80s53BaQO7FWK8h28ebiJRo5iXwaIM2vbohL2d+m9QxaWjNGxldZwPsyRewA+LCxkFcrTlkDlIL03/HZNBE2CesuhU30uvFM/nd5+kulPQv8iKMaWvu1TJACrej1Nf7k2R1cewfN6/mdtNbdJ60ww11VBEOGxzl86iEdflGo9hgElttocLt1KkU5kE9+L/Prw5myVdV6EVV+euZy3D5L5ty9QOLqwc/eG9XT1MATY8JTJPrJBgspjObXtHZeojzkHbntjcis5mHA8jDqhOPvpwnawtZDc4Llly0OkuroRMxi2vaq61TmLL7qOaVXFtoDF95IefviuQjo0Ri3lB/j9xEafassZ9QLfxt9ebqj0/Rg0fmKqvEDS7C24x2Y8lu3s+I7WbatLv4MjugGy4wl5293Wp/bi0xC8WvTnG2Vg1lvNZEJJrqffMkTB+NB+FeEr9yl3RRxz3yJGlRFJVfjPZsI5vAA/yoBnSyMNZ6kIyYP3/pViDDL5MLBHrx9yc21bP2Za8nCokWTuPQg7rOKb80qNhKBcVAmmB4dqBMfiwvQh5fzEzlw1eByubds0CgYqR4Jfrw4VfGKaXp4DQeCt0Szkofjbbd5Y/x5G6+0y3HS3hmeBZC3j8sTgj/KLu1wmFKWvv9KQp3KYPlVrmOJdV4nHSReYi2eMhpR1lLVkq/1XPR2Uz8pqJ+4nvmfhuFS5Q6zjsC3b2hILDl+d3aneup4kWq73H1rc+wkxo9ghewB5RRbzXFzbqehApjFIeFQPMKBk9XX5ZX2qtPZ+3CcNvjiK32BDGN5dUfszlfmTaNzdix+eFW95MlqOcu40FWninq4Bwsvnrwi9RtL4UWGNE+M74/a66ARnRxNM4z6AYqiV3Vg/Lg/3PDemR/FogNVQ9z60DL94cB5heYJR30DDK8Auo8oGoEWBIaRhrR1hxthiIZwFbHycr0vcgRil7tfbO7L8uxT3oGrkR3RH0b86FeaCUX8o/YGDjhZn08BeWXjndolf8T/vBIE8ZCs0Gi7dAcuQlPFO8hy7OmyV2MwBBeHeg+FS6sCAo96TgljYNjlNEUAc9jspskz0eAFWyyxzD5+OiLMgOymE7D2UgNxy84o6Ss2XnB8lUVn7EhL3l4FuDKjOXcmqyCu2WV50qxRaA2fTSswpMnxEBDfhxv3MparuKarTm5EecHzqe9WUmBDQGRnLc4HbTUN/HdacSvrt59WTOJ0vO0LS8Rsof3EC+X/XrADaaY87yFe6TUBLGfthnuHcxm7bmsgFhZw9VL5ggOe8kMiZwAf8BFQiCVlTDH1x6naAtZubUNzHhRhJC2DxMU2lNAxNCr20WMROA9RB5qacuZY/7PUWepjFKHlotlW+TU6CsIp3PXPXs10xCvIBuzX8d+5lXTwrVpAG+Cq7hBAhHE2NFkUiw44pdTau26OX0rsESfwVLeJAhzYDVp0P/pNJeGD6COV0SI1SKqTxsW/d3bDLV/h0/ABqtcoZhcepDS44ms3QMR87pFSVOzjhd34TGF4yHjHz8c09/fJdpd8U+pQ6OTYr39b2E3r7keb7BtkiJzHieP7+RCeO+l4z5J0a1rwv08uc98CxB6tdJ8TC8AhD/bTFBWiqRb1XuAfB4CqTtRDUWLxR/ajlVVOqhNjKaKZWoKPUXZ+0YgyJHFlCm1vO/tbE3vglwjAsOQl5lIFWJUz26S/reDRzjfWVKRFmHVE16ituUNdT09Guy5Un21kD0k/agca7tHDWk5ozFh8L9o/YF77lB7FTAxtTOYQq0O0XnqVQI4H4WPOX9iZ+VvyGbqfpQ6ganAbzDnL8N6PtqtGO5ZTuxAcT18Oy4TTZ75+9IV7p2C5zUD0WJMoKBQkCEqDzTsy+TggM+PGop8P71EWDKGyKEGDb45cPoweF2wZOcYvwQXwlTiK3u6g3invVSYx1nSdp9HFIacwWbTJdHJWDaIogn6nkXKlclvPzjCVSKJsf5ZPHitmtJTXuOXlvwg4BzIJp+pO7q3FRjavlhmpDrSwJgIoYNZWjGyJ93RCIOTiooAWyGfpHv0T27gbuLZ9wT0tPZXihcNRzyy2XWbUFJNjfH/fdNDFYihQ5pobkXujsCCG11ZcpZW35ayjEogmr6TtssLwnH8x9E0LWtCPW890MANvQ6arSS6mAY1B7Urzof/ZAFBcdI2HK6O87poO3+oBSMyObUtN8ibtso27oO4T+d4L+DL01Jbax/wkASNUYgohDmAnDCKkHPvkNweFDxv5zXSv8U7TjtGPJZPGlYVYgUI8ga9TeXJu/Xbq6z1laBO4vswqkxTXHOUAcb968Ls7WUAgSQEc06UCJIwjOlvmHtVcUwXYu1KBibG9Ar0h05CdN8jSiWX4LtOrzIw1ggcuyvEQJ6/RH5n9MCBzNuQhCThbIYOBCppDt44+EKDw8QJWqB8nbJSND4K9NL2EdVsCGQRWIeVq42DS/C9nbiY18sW5OCJHZApD3hIPYYSK6dOimLO+Eb01fkqAq20UmZbRASLREDa6bgt8xH8pVWRnFn4GLSXhO2rd3oDcW8ujT97toTOzEYqEMYLcwypUHOdMpE9qlDMy0Mi8xHku40vgYjVeHNlUOrh9noK3KNxsNK7ROT592qvrpYbE7gkU16YFEqX6zJO2gaxDZPnXq1OVyFcY77d9v1XEVzzO4E2B1JG76DUTQT21Eh9GMvzVw6U8JEchKDOBUSGsDFsJ7Tb8jxTZcY9obsIYq9mBRpSK9Am1C3vBbFYBFwFRAMRzK4xGgH2B3rOjrzHdfTRYrp8ry1xiSKgrFvroQEnlNjpMcmeXMf2DvSL99QW1i/EZD0Koc8NWxoZXvY7FeepNq1WXwySH6FToow/eUbluy8Gxs0O6BorjLCD/JoZjszjJR1a+Ior8dMq4iHiMA+HMglc0MX6URVbpjUazD56I315XRMFx7ap/B/982H18i1eI/IcZp0XJ4j44wgMc7efTyhT/R3yhBNTx1KGNgaAA" style="width: 100%; height: 100%; object-fit: cover; image-rendering: -webkit-optimize-contrast;">
                        </div>
                        <p style="margin: 12px 0 0 0; color: #1e3a5f; font-weight: 700; font-size: 1em;">ì •ì¤€ì—° ëª©ì‚¬</p>
                        <p style="margin: 3px 0 0 0; color: #718096; font-size: 0.85em;">ë‹´ì„ëª©ì‚¬</p>
                    </div>
                    
                    <!-- ì¸ì‚¬ë§ -->
                    <div style="flex: 1; min-width: 300px;">
                        <p style="line-height: 2; color: #4a5568; font-size: 1.05em; text-align: justify; margin: 0;">
                            ì‚¬ë‘í•˜ëŠ” ì„±ë„ ì—¬ëŸ¬ë¶„, ê·¸ë¦¬ê³  ì´ í˜ì´ì§€ë¥¼ ë°©ë¬¸í•´ ì£¼ì‹  ëª¨ë“  ë¶„ë“¤ê»˜<br>
                            ìš°ë¦¬ ì£¼ ì˜ˆìˆ˜ ê·¸ë¦¬ìŠ¤ë„ì˜ ì´ë¦„ìœ¼ë¡œ ë¬¸ì•ˆë“œë¦½ë‹ˆë‹¤.
                        </p>
                        <p style="line-height: 2; color: #4a5568; font-size: 1.05em; text-align: justify; margin-top: 18px;">
                            ìš°ë¦¬ê°€ ì‚´ê³  ìˆëŠ” ì´ ì‹œëŒ€ëŠ” ì°¸ìœ¼ë¡œ í˜¼ë€ìŠ¤ëŸ½ìŠµë‹ˆë‹¤. 
                            ë¬´ì—‡ì´ ì˜³ê³  ê·¸ë¥¸ì§€, ë¬´ì—‡ì´ ì§„ë¦¬ì¸ì§€ ë¶„ë³„í•˜ê¸° ì–´ë ¤ìš´ ì‹œëŒ€ì…ë‹ˆë‹¤. 
                            ìˆ˜ë§ì€ êµíšŒë“¤ì´ ì„¸ìƒì˜ íë¦„ì— ë§ì¶”ì–´ ë³µìŒì„ í¬ì„ì‹œí‚¤ê³ , 
                            ì‚¬ëŒë“¤ì´ ë“£ê³  ì‹¶ì–´í•˜ëŠ” ë§ë§Œ ì „í•˜ëŠ” ì´ ë•Œì—, 
                            <strong>í•˜ë‚˜ë‹˜ì˜ ë§ì”€ì€ ì–´ì œë‚˜ ì˜¤ëŠ˜ì´ë‚˜ ì˜ì›íˆ ë³€í•¨ì´ ì—†ìŠµë‹ˆë‹¤.</strong>
                        </p>
                        <p style="line-height: 2; color: #4a5568; font-size: 1.05em; text-align: justify; margin-top: 18px;">
                            ì˜ê´‘êµíšŒëŠ” ê·¸ ë³€ì¹˜ ì•ŠëŠ” ì§„ë¦¬ì˜ ë§ì”€ ìœ„ì— êµ³ê²Œ ì„œì„œ, 
                            <strong>ì˜¤ì§ ê·¸ë¦¬ìŠ¤ë„ë§Œì´ êµ¬ì›ì˜ ìœ ì¼í•œ ê¸¸</strong>ì´ì‹¬ì„ ë‹´ëŒ€íˆ ì„ í¬í•©ë‹ˆë‹¤. 
                            ì„¸ìƒì´ ë“£ê³  ì‹¶ì–´í•˜ëŠ” ì´ì•¼ê¸°ê°€ ì•„ë‹ˆë¼, 
                            ì„¸ìƒì´ ë“¤ì–´ì•¼ í•  ë³µìŒì„ ì „í•˜ëŠ” ê²ƒì´ ìš°ë¦¬ì˜ ì‚¬ëª…ì…ë‹ˆë‹¤.
                            ë¶ˆí¸í•˜ë”ë¼ë„ ì§„ë¦¬ë¥¼ ë§í•˜ê³ , ì–´ë µë”ë¼ë„ ì‹­ìê°€ì˜ ë„ë¥¼ ì „í•˜ëŠ” ê²ƒì´ 
                            ìš°ë¦¬ê°€ ë°›ì€ ë¶€ë¥´ì‹¬ì…ë‹ˆë‹¤.
                        </p>
                        <p style="line-height: 2; color: #4a5568; font-size: 1.05em; text-align: justify; margin-top: 18px;">
                            ìš°ë¦¬ êµíšŒì˜ ì˜ˆë°°ëŠ” <strong>ëœ¨ê±°ìš´ ì°¬ì–‘</strong>ìœ¼ë¡œ ì‹œì‘ë©ë‹ˆë‹¤. 
                            ì„±ë ¹ ì•ˆì—ì„œ ì˜¨ ë§ˆìŒì„ ë‹¤í•´ í•˜ë‚˜ë‹˜ì„ ì°¬ì–‘í•˜ë©°, 
                            ê·¸ ì°¬ì–‘ ê°€ìš´ë° ì„ì¬í•˜ì‹œëŠ” í•˜ë‚˜ë‹˜ì„ ê²½í—˜í•©ë‹ˆë‹¤. 
                            ì°¬ì–‘ì€ ë‹¨ìˆœí•œ ì˜ì‹ì´ ì•„ë‹ˆë¼, ìš°ë¦¬ì˜ ì‚¶ì„ ë“œë¦¬ëŠ” ì˜ˆë°° ê·¸ ìì²´ì…ë‹ˆë‹¤.
                        </p>
                        <p style="line-height: 2; color: #4a5568; font-size: 1.05em; text-align: justify; margin-top: 18px;">
                            ê·¸ë¦¬ê³  ìš°ë¦¬ëŠ” <strong>ë§ì”€ì„ ê¹Šì´ ì—°êµ¬</strong>í•©ë‹ˆë‹¤. 
                            ì„±ê²½ í•œ êµ¬ì ˆ í•œ êµ¬ì ˆì„ ê¼¼ê¼¼íˆ ê°•í•´í•˜ë©°, 
                            ê·¸ ë§ì”€ì´ ì˜¤ëŠ˜ ìš°ë¦¬ì˜ ì‚¶ì— ì–´ë–»ê²Œ ì ìš©ë˜ëŠ”ì§€ë¥¼ í•¨ê»˜ ë‚˜ëˆ•ë‹ˆë‹¤. 
                            ì‚´ì•„ìˆëŠ” ë§ì”€ì´ ìš°ë¦¬ì˜ ì‚¶ì„ ë³€í™”ì‹œí‚¤ê³ , 
                            ê·¸ë¦¬ìŠ¤ë„ë¥¼ ë‹®ì•„ê°€ê²Œ í•˜ëŠ” ê²ƒì„ ë‚ ë§ˆë‹¤ ê²½í—˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.
                        </p>
                        <p style="line-height: 2; color: #4a5568; font-size: 1.05em; text-align: justify; margin-top: 18px;">
                            í•¨ê»˜ ì˜ˆë°°í•˜ë©°, í•¨ê»˜ ë§ì”€ì„ ë°°ìš°ë©°, í•¨ê»˜ ê¸°ë„í•˜ëŠ” ê°€ìš´ë° 
                            ì£¼ë‹˜ê»˜ì„œ ìš°ë¦¬ ê°ìì˜ ì‚¶ì„ ë³€í™”ì‹œì¼œ ê°€ì‹œëŠ” ì€í˜œë¥¼ ê²½í—˜í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤. 
                            ì§„ë¦¬ë¥¼ ì‚¬ëª¨í•˜ëŠ” ì—¬ëŸ¬ë¶„ì„ ì–¸ì œë“ ì§€ ì—´ë¦° ë§ˆìŒìœ¼ë¡œ í™˜ì˜í•©ë‹ˆë‹¤.
                            <strong>ì˜ê´‘êµíšŒì˜ ë¬¸ì€ ì–¸ì œë‚˜ ì—´ë ¤ ìˆìŠµë‹ˆë‹¤.</strong>
                        </p>
                        
                        <div style="margin-top: 25px; padding-top: 18px; border-top: 1px solid #e2e8f0;">
                            <p style="margin: 0; color: #1e3a5f; font-weight: 600; font-size: 1.05em; font-style: italic;">
                                "ì˜¤ì§ ë§ì”€ìœ¼ë¡œ, ì˜¤ì§ ì€í˜œë¡œ, ì˜¤ì§ í•˜ë‚˜ë‹˜ê»˜ ì˜ê´‘ì„"
                            </p>
                            <p style="margin: 12px 0 0 0; color: #4a5568;">
                                ìƒˆí¬ë¼ë©˜í†  ì˜ê´‘êµíšŒ ë‹´ì„ëª©ì‚¬ <strong>ì •ì¤€ì—°</strong> ë“œë¦¼
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ê°œí˜ì£¼ì˜ 5ëŒ€ ì†”ë¼ -->
            <div class="card" style="margin-bottom: 25px;">
                <h2 style="color: #1e3a5f; border-bottom: 3px solid #1e3a5f; padding-bottom: 12px; margin-bottom: 25px; font-size: 1.5em;">ìš°ë¦¬ì˜ ì‹ ì•™ ê³ ë°± - ë‹¤ì„¯ ê°€ì§€ ì†”ë¼ (Five Solas)</h2>
                <p style="color: #4a5568; line-height: 1.8; margin-bottom: 25px;">
                    16ì„¸ê¸° ì¢…êµê°œí˜ì˜ í•µì‹¬ ì›ë¦¬ì¸ "ë‹¤ì„¯ ê°€ì§€ ì†”ë¼"ëŠ” ìš°ë¦¬ êµíšŒì˜ ì‹ ì•™ ê³ ë°±ì˜ ê·¼ê°„ì…ë‹ˆë‹¤. 
                    ì´ ì›ë¦¬ë“¤ì€ ì„±ê²½ì˜ ê°€ë¥´ì¹¨ì„ ìš”ì•½í•œ ê²ƒìœ¼ë¡œ, ìš°ë¦¬ê°€ ë¬´ì—‡ì„ ë¯¿ê³  ì–´ë–»ê²Œ ì‚´ì•„ì•¼ í•˜ëŠ”ì§€ë¥¼ ëª…í™•íˆ ë³´ì—¬ì¤ë‹ˆë‹¤.
                </p>
                
                <div style="display: grid; gap: 20px;">
                    <div style="display: flex; gap: 20px; align-items: flex-start; background: linear-gradient(135deg, #f8fafc, #edf2f7); padding: 25px; border-radius: 12px; border-left: 5px solid #1e3a5f;">
                        <div style="flex-shrink: 0; width: 60px; height: 60px; background: #1e3a5f; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5em; font-weight: bold;">1</div>
                        <div>
                            <h4 style="margin: 0 0 10px 0; color: #1e3a5f; font-size: 1.15em;">ì˜¤ì§ ì„±ê²½ (Sola Scriptura)</h4>
                            <p style="margin: 0; color: #4a5568; line-height: 1.8;">
                                ì„±ê²½ 66ê¶Œì€ í•˜ë‚˜ë‹˜ì˜ ì˜ê°ìœ¼ë¡œ ê¸°ë¡ëœ ì˜¤ë¥˜ ì—†ëŠ” ë§ì”€ì´ë©°, ì‹ ì•™ê³¼ ì‚¶ì˜ ìœ ì¼í•œ ê·œë²”ì…ë‹ˆë‹¤. 
                                ì–´ë–¤ ì¸ê°„ì˜ ì „í†µì´ë‚˜ êµíšŒì˜ ê¶Œìœ„ë„ ì„±ê²½ì˜ ê¶Œìœ„ ìœ„ì— ì„¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                                <span style="display: block; margin-top: 8px; font-style: italic; color: #718096;">
                                    "ëª¨ë“  ì„±ê²½ì€ í•˜ë‚˜ë‹˜ì˜ ê°ë™ìœ¼ë¡œ ëœ ê²ƒìœ¼ë¡œ..." (ë”¤í›„ 3:16)
                                </span>
                            </p>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 20px; align-items: flex-start; background: linear-gradient(135deg, #f8fafc, #edf2f7); padding: 25px; border-radius: 12px; border-left: 5px solid #2d5a87;">
                        <div style="flex-shrink: 0; width: 60px; height: 60px; background: #2d5a87; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5em; font-weight: bold;">2</div>
                        <div>
                            <h4 style="margin: 0 0 10px 0; color: #1e3a5f; font-size: 1.15em;">ì˜¤ì§ ê·¸ë¦¬ìŠ¤ë„ (Solus Christus)</h4>
                            <p style="margin: 0; color: #4a5568; line-height: 1.8;">
                                ì˜ˆìˆ˜ ê·¸ë¦¬ìŠ¤ë„ë§Œì´ í•˜ë‚˜ë‹˜ê³¼ ì¸ê°„ ì‚¬ì´ì˜ ìœ ì¼í•œ ì¤‘ë³´ìì´ì‹œë©°, êµ¬ì›ì˜ ìœ ì¼í•œ ê¸¸ì…ë‹ˆë‹¤. 
                                ì„±ì¸ì´ë‚˜ ë§ˆë¦¬ì•„ë‚˜ ê·¸ ì–´ë–¤ í”¼ì¡°ë¬¼ë„ ìš°ë¦¬ë¥¼ êµ¬ì›í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                                <span style="display: block; margin-top: 8px; font-style: italic; color: #718096;">
                                    "ê¸¸ì´ìš” ì§„ë¦¬ìš” ìƒëª…ì´ë‹ˆ ë‚˜ë¡œ ë§ë¯¸ì•”ì§€ ì•Šê³ ëŠ” ì•„ë²„ì§€ê»˜ë¡œ ì˜¬ ìê°€ ì—†ëŠë‹ˆë¼" (ìš” 14:6)
                                </span>
                            </p>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 20px; align-items: flex-start; background: linear-gradient(135deg, #f8fafc, #edf2f7); padding: 25px; border-radius: 12px; border-left: 5px solid #3d7ab5;">
                        <div style="flex-shrink: 0; width: 60px; height: 60px; background: #3d7ab5; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5em; font-weight: bold;">3</div>
                        <div>
                            <h4 style="margin: 0 0 10px 0; color: #1e3a5f; font-size: 1.15em;">ì˜¤ì§ ë¯¿ìŒ (Sola Fide)</h4>
                            <p style="margin: 0; color: #4a5568; line-height: 1.8;">
                                êµ¬ì›ì€ í–‰ìœ„ê°€ ì•„ë‹Œ ì˜¤ì§ ë¯¿ìŒìœ¼ë¡œë§Œ ë°›ëŠ” í•˜ë‚˜ë‹˜ì˜ ì„ ë¬¼ì…ë‹ˆë‹¤. 
                                ìš°ë¦¬ì˜ ì„ í–‰ì€ êµ¬ì›ì˜ ì¡°ê±´ì´ ì•„ë‹ˆë¼, êµ¬ì›ë°›ì€ ìì˜ ê°ì‚¬ì˜ ì—´ë§¤ì…ë‹ˆë‹¤.
                                <span style="display: block; margin-top: 8px; font-style: italic; color: #718096;">
                                    "ë„ˆí¬ëŠ” ê·¸ ì€í˜œì— ì˜í•˜ì—¬ ë¯¿ìŒìœ¼ë¡œ ë§ë¯¸ì•”ì•„ êµ¬ì›ì„ ë°›ì•˜ìœ¼ë‹ˆ..." (ì—¡ 2:8)
                                </span>
                            </p>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 20px; align-items: flex-start; background: linear-gradient(135deg, #f8fafc, #edf2f7); padding: 25px; border-radius: 12px; border-left: 5px solid #4a90c2;">
                        <div style="flex-shrink: 0; width: 60px; height: 60px; background: #4a90c2; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5em; font-weight: bold;">4</div>
                        <div>
                            <h4 style="margin: 0 0 10px 0; color: #1e3a5f; font-size: 1.15em;">ì˜¤ì§ ì€í˜œ (Sola Gratia)</h4>
                            <p style="margin: 0; color: #4a5568; line-height: 1.8;">
                                êµ¬ì›ì€ ì „ì ìœ¼ë¡œ í•˜ë‚˜ë‹˜ì˜ ì€í˜œë¡œ ë§ë¯¸ì•”ìœ¼ë©°, ì¸ê°„ì˜ ê³µë¡œë¡œ ì–»ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. 
                                ìš°ë¦¬ëŠ” ìŠ¤ìŠ¤ë¡œë¥¼ êµ¬ì›í•  ìˆ˜ ì—†ëŠ” ì£„ì¸ì´ë©°, ì˜¤ì§ í•˜ë‚˜ë‹˜ì˜ ìë¹„í•˜ì‹¬ìœ¼ë¡œ êµ¬ì›ë°›ìŠµë‹ˆë‹¤.
                                <span style="display: block; margin-top: 8px; font-style: italic; color: #718096;">
                                    "ì´ê²ƒì€ ë„ˆí¬ì—ê²Œì„œ ë‚œ ê²ƒì´ ì•„ë‹ˆìš” í•˜ë‚˜ë‹˜ì˜ ì„ ë¬¼ì´ë¼" (ì—¡ 2:8)
                                </span>
                            </p>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 20px; align-items: flex-start; background: linear-gradient(135deg, #f8fafc, #edf2f7); padding: 25px; border-radius: 12px; border-left: 5px solid #5a9fd4;">
                        <div style="flex-shrink: 0; width: 60px; height: 60px; background: #5a9fd4; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5em; font-weight: bold;">5</div>
                        <div>
                            <h4 style="margin: 0 0 10px 0; color: #1e3a5f; font-size: 1.15em;">ì˜¤ì§ í•˜ë‚˜ë‹˜ê»˜ ì˜ê´‘ (Soli Deo Gloria)</h4>
                            <p style="margin: 0; color: #4a5568; line-height: 1.8;">
                                ìš°ë¦¬ì˜ êµ¬ì›ê³¼ ì‚¶ì˜ ëª¨ë“  ì˜ì—­ì—ì„œ ì˜¤ì§ í•˜ë‚˜ë‹˜ê»˜ë§Œ ì˜ê´‘ì„ ëŒë¦½ë‹ˆë‹¤. 
                                ì´ê²ƒì´ ìš°ë¦¬ ì¡´ì¬ì˜ ê¶ê·¹ì  ëª©ì ì´ë©°, ìš°ë¦¬ê°€ ìˆ¨ ì‰¬ê³  ì‚´ì•„ê°€ëŠ” ì´ìœ ì…ë‹ˆë‹¤.
                                <span style="display: block; margin-top: 8px; font-style: italic; color: #718096;">
                                    "ê·¸ëŸ°ì¦‰ ë„ˆí¬ê°€ ë¨¹ë“ ì§€ ë§ˆì‹œë“ ì§€ ë¬´ì—‡ì„ í•˜ë“ ì§€ ë‹¤ í•˜ë‚˜ë‹˜ì˜ ì˜ê´‘ì„ ìœ„í•˜ì—¬ í•˜ë¼" (ê³ ì „ 10:31)
                                </span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- êµíšŒ ë¹„ì „ -->
            <div class="card" style="margin-bottom: 25px;">
                <h2 style="color: #1e3a5f; border-bottom: 3px solid #1e3a5f; padding-bottom: 12px; margin-bottom: 25px; font-size: 1.5em;">êµíšŒ ë¹„ì „</h2>
                <div style="text-align: center; margin-bottom: 30px;">
                    <p style="font-size: 1.4em; color: #1e3a5f; font-weight: 600; margin: 0; line-height: 1.6;">
                        "ë§ì”€ìœ¼ë¡œ ì„¸ì›Œì§€ê³ , ê¸°ë„ë¡œ í•˜ë‚˜ ë˜ë©°,<br>
                        ì‚¬ë‘ìœ¼ë¡œ ì„¬ê¸°ê³ , ë³µìŒìœ¼ë¡œ ë‚˜ì•„ê°€ëŠ” êµíšŒ"
                    </p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 30px 20px; background: linear-gradient(180deg, #1e3a5f 0%, #2d5a87 100%); border-radius: 12px; color: white;">
                        <div style="width: 70px; height: 70px; background: rgba(255,255,255,0.2); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 2em;">ğŸ“–</div>
                        <h4 style="margin: 0 0 10px 0; font-size: 1.2em;">ë§ì”€</h4>
                        <p style="margin: 0; opacity: 0.9; font-size: 0.95em; line-height: 1.6;">
                            ì„±ê²½ì˜ ì§„ë¦¬ë¡œ ë³€í™”ë˜ì–´<br>ê·¸ë¦¬ìŠ¤ë„ë¥¼ ë‹®ì•„ê°€ëŠ” êµíšŒ
                        </p>
                    </div>
                    <div style="text-align: center; padding: 30px 20px; background: linear-gradient(180deg, #2d5a87 0%, #3d7ab5 100%); border-radius: 12px; color: white;">
                        <div style="width: 70px; height: 70px; background: rgba(255,255,255,0.2); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 2em;">ğŸ™</div>
                        <h4 style="margin: 0 0 10px 0; font-size: 1.2em;">ê¸°ë„</h4>
                        <p style="margin: 0; opacity: 0.9; font-size: 0.95em; line-height: 1.6;">
                            í•˜ë‚˜ë‹˜ê³¼ êµí†µí•˜ë©°<br>ì„±ë ¹ì˜ ì¸ë„í•˜ì‹¬ì„ êµ¬í•˜ëŠ” êµíšŒ
                        </p>
                    </div>
                    <div style="text-align: center; padding: 30px 20px; background: linear-gradient(180deg, #3d7ab5 0%, #4a90c2 100%); border-radius: 12px; color: white;">
                        <div style="width: 70px; height: 70px; background: rgba(255,255,255,0.2); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 2em;">â¤ï¸</div>
                        <h4 style="margin: 0 0 10px 0; font-size: 1.2em;">ì„¬ê¹€</h4>
                        <p style="margin: 0; opacity: 0.9; font-size: 0.95em; line-height: 1.6;">
                            ê·¸ë¦¬ìŠ¤ë„ì˜ ì‚¬ë‘ìœ¼ë¡œ<br>ì„œë¡œ ì„¬ê¸°ëŠ” ê³µë™ì²´
                        </p>
                    </div>
                    <div style="text-align: center; padding: 30px 20px; background: linear-gradient(180deg, #4a90c2 0%, #5a9fd4 100%); border-radius: 12px; color: white;">
                        <div style="width: 70px; height: 70px; background: rgba(255,255,255,0.2); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 2em;">ğŸŒ</div>
                        <h4 style="margin: 0 0 10px 0; font-size: 1.2em;">ì„ êµ</h4>
                        <p style="margin: 0; opacity: 0.9; font-size: 0.95em; line-height: 1.6;">
                            ë³µìŒì„ í’ˆê³ <br>ì„¸ìƒìœ¼ë¡œ ë‚˜ì•„ê°€ëŠ” êµíšŒ
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- ì˜¤ì‹œëŠ” ê¸¸ / ì—°ë½ì²˜ -->
            <div class="card">
                <h2 style="color: #1e3a5f; border-bottom: 3px solid #1e3a5f; padding-bottom: 12px; margin-bottom: 25px; font-size: 1.5em;">ì˜¤ì‹œëŠ” ê¸¸</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px;">
                    <div style="background: #f8fafc; padding: 25px; border-radius: 12px; border-left: 4px solid #1e3a5f;">
                        <h4 style="margin: 0 0 15px 0; color: #1e3a5f; font-size: 1.1em;">ğŸ“ ì˜ˆë°° ì¥ì†Œ</h4>
                        <p style="margin: 0; color: #4a5568; line-height: 2;">
                            <strong>ìƒˆí¬ë¼ë©˜í†  ì˜ê´‘êµíšŒ</strong><br>
                            Sacramento Glory Church<br>
                            1820 Bell St, Sacramento, CA 95825
                        </p>
                    </div>
                    <div style="background: #f8fafc; padding: 25px; border-radius: 12px; border-left: 4px solid #2d5a87;">
                        <h4 style="margin: 0 0 15px 0; color: #1e3a5f; font-size: 1.1em;">ğŸ“ ì—°ë½ì²˜</h4>
                        <p style="margin: 0; color: #4a5568; line-height: 2;">
                            <strong>ì „í™”:</strong> (916) 969-8141<br>
                            <strong>ì´ë©”ì¼:</strong> <a href="/cdn-cgi/l/email-protection#a6d5c7c5c1cac9d4dfc5ced3d4c5cee6cec9d2cbc7cfca88c5c9cb" style="color: #2d5a87;"><span class="__cf_email__" data-cfemail="afdcceccc8c3c0ddd6ccc7daddccc7efc7c0dbc2cec6c381ccc0c2">[email&#160;protected]</span></a>
                        </p>
                    </div>
                    <div style="background: #f8fafc; padding: 25px; border-radius: 12px; border-left: 4px solid #3d7ab5;">
                        <h4 style="margin: 0 0 15px 0; color: #1e3a5f; font-size: 1.1em;">â° ì˜ˆë°° ì‹œê°„</h4>
                        <p style="margin: 0; color: #4a5568; line-height: 2;">
                            <strong>ì£¼ì¼ì˜ˆë°°:</strong> ì˜¤ì „ 11:00<br>
                            <strong>ìˆ˜ìš” ê²½ë°°ì™€ ì°¬ì–‘:</strong> ì˜¤í›„ 6:30<br>
                            <strong>ìƒˆë²½ì˜ˆë°°:</strong> ì˜¤ì „ 6:30 (í™”-í† )<br>
                            <strong>ì„±ê²½ëª¨ì„:</strong> ì˜¤í›„ 2:00 (í™”)<br>
                            <strong>Sunday School:</strong> ì˜¤ì „ 11:00 (ì£¼ì¼)
                        </p>
                    </div>
                </div>
                
                <div style="margin-top: 25px; background: linear-gradient(135deg, #1e3a5f, #2d5a87); padding: 25px; border-radius: 12px; color: white; text-align: center;">
                    <p style="margin: 0; font-size: 1.1em; line-height: 1.8;">
                        ì²˜ìŒ ì˜¤ì‹œëŠ” ë¶„ë“¤ì„ ì–¸ì œë‚˜ í™˜ì˜í•©ë‹ˆë‹¤.<br>
                        <strong>ì§„ë¦¬ë¥¼ ì‚¬ëª¨í•˜ëŠ” ëª¨ë“  ë¶„ë“¤ê³¼ í•¨ê»˜ ì˜ˆë°°ë“œë¦¬ê¸°ë¥¼ ì†Œë§í•©ë‹ˆë‹¤.</strong>
                    </p>
                </div>
            </div>
        </div>
        
        <!-- ì˜ˆë°°ì•ˆë‚´ ì„¹ì…˜ -->
        <div id="worship" class="section section-worship">
            <!-- í—¤ë” -->
            <div class="card" style="background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%); color: white; margin-bottom: 20px;">
                <h1 style="margin: 0; color: white; font-size: 1.8em;">ì˜ˆë°°ì•ˆë‚´</h1>
                <p style="margin: 8px 0 0 0; opacity: 0.9;">í•˜ë‚˜ë‹˜ê»˜ ë“œë¦¬ëŠ” ì˜ˆë°°ì— í•¨ê»˜ í•˜ì„¸ìš”</p>
            </div>
            
            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div style="display: flex; background: white; border-radius: 15px 15px 0 0; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <div class="worship-tab active" onclick="showWorshipTab('time')" id="worshipTabTime" style="flex: 1; padding: 15px 20px; text-align: center; cursor: pointer; font-weight: 600; background: #1e3a5f; color: white;">
                    ì˜ˆë°°ì‹œê°„
                </div>
                <div class="worship-tab" onclick="showWorshipTab('sunday')" id="worshipTabSunday" style="flex: 1; padding: 15px 20px; text-align: center; cursor: pointer; font-weight: 600; background: #f8f9fa; color: #666; border-left: 1px solid #e2e8f0;">
                    ì£¼ì¼ì˜ˆë°°ì˜ìƒ
                </div>
                <div class="worship-tab" onclick="showWorshipTab('wednesday')" id="worshipTabWednesday" style="flex: 1; padding: 15px 20px; text-align: center; cursor: pointer; font-weight: 600; background: #f8f9fa; color: #666; border-left: 1px solid #e2e8f0;">
                    ìˆ˜ìš” ê²½ë°°ì™€ ì°¬ì–‘ ì˜ìƒ
                </div>
            </div>
            
            <!-- ì˜ˆë°°ì‹œê°„ íƒ­ -->
            <div id="worshipTimeTab" class="worship-content card" style="border-radius: 0 0 15px 15px; margin-top: 0;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px;">
                    <!-- ì£¼ì¼ì˜ˆë°° -->
                    <div style="background: #f8fafc; padding: 25px; border-radius: 12px; text-align: center; border: 1px solid #e2e8f0;">
                        <h3 style="margin: 0 0 15px 0; color: #1e3a5f; font-size: 1.2em;">ì£¼ì¼ì˜ˆë°°</h3>
                        <div style="font-size: 2em; font-weight: bold; color: #1e3a5f;">ì˜¤ì „ 11:00</div>
                        <p style="margin: 15px 0 0 0; color: #64748b; font-size: 0.9em;">ë§¤ì£¼ ì£¼ì¼</p>
                    </div>
                    <!-- ìˆ˜ìš” ê²½ë°°ì™€ ì°¬ì–‘ -->
                    <div style="background: #f8fafc; padding: 25px; border-radius: 12px; text-align: center; border: 1px solid #e2e8f0;">
                        <h3 style="margin: 0 0 15px 0; color: #2d5a87; font-size: 1.1em;">ìˆ˜ìš” ê²½ë°°ì™€ ì°¬ì–‘</h3>
                        <div style="font-size: 2em; font-weight: bold; color: #2d5a87;">ì˜¤í›„ 6:30</div>
                        <p style="margin: 15px 0 0 0; color: #64748b; font-size: 0.9em;">ë§¤ì£¼ ìˆ˜ìš”ì¼</p>
                    </div>
                    <!-- ìƒˆë²½ì˜ˆë°° -->
                    <div style="background: #f8fafc; padding: 25px; border-radius: 12px; text-align: center; border: 1px solid #e2e8f0;">
                        <h3 style="margin: 0 0 15px 0; color: #3d7ab5; font-size: 1.2em;">ìƒˆë²½ì˜ˆë°°</h3>
                        <div style="font-size: 2em; font-weight: bold; color: #3d7ab5;">ì˜¤ì „ 6:30</div>
                        <p style="margin: 15px 0 0 0; color: #64748b; font-size: 0.9em;">í™”ìš”ì¼ ~ í† ìš”ì¼</p>
                    </div>
                    <!-- ì»¤í”¼ë¸Œë ˆì´í¬ ì„±ê²½ëª¨ì„ -->
                    <div style="background: #f8fafc; padding: 25px; border-radius: 12px; text-align: center; border: 1px solid #e2e8f0;">
                        <h3 style="margin: 0 0 15px 0; color: #4a90c2; font-size: 1.1em;">ì»¤í”¼ë¸Œë ˆì´í¬<br>ì„±ê²½ëª¨ì„</h3>
                        <div style="font-size: 2em; font-weight: bold; color: #4a90c2;">ì˜¤í›„ 2:00</div>
                        <p style="margin: 15px 0 0 0; color: #64748b; font-size: 0.9em;">ë§¤ì£¼ í™”ìš”ì¼</p>
                    </div>
                    <!-- Sunday School -->
                    <div style="background: #f8fafc; padding: 25px; border-radius: 12px; text-align: center; border: 1px solid #e2e8f0;">
                        <h3 style="margin: 0 0 15px 0; color: #ed8936; font-size: 1.2em;">Sunday School</h3>
                        <div style="font-size: 2em; font-weight: bold; color: #ed8936;">ì˜¤ì „ 11:00</div>
                        <p style="margin: 15px 0 0 0; color: #64748b; font-size: 0.9em;">ë§¤ì£¼ ì£¼ì¼</p>
                    </div>
                </div>
                
                <!-- ìœ íŠœë¸Œ ì±„ë„ ì•ˆë‚´ -->
                <div style="margin-top: 25px; background: #f8fafc; padding: 20px; border-radius: 12px; text-align: center; border: 1px solid #e2e8f0;">
                    <h4 style="margin: 0 0 10px 0; color: #1e3a5f;">ì˜¨ë¼ì¸ìœ¼ë¡œ ì˜ˆë°°ì— ì°¸ì—¬í•˜ì„¸ìš”</h4>
                    <p style="margin: 0 0 15px 0; color: #64748b; font-size: 0.9em;">êµíšŒì— ì˜¤ì‹¤ ìˆ˜ ì—†ì„ ë•Œë„ ìœ íŠœë¸Œë¡œ í•¨ê»˜ ì˜ˆë°°ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                    <a href="#" onclick="event.preventDefault(); showWorshipTab('sunday');" style="display: inline-block; background: linear-gradient(135deg, #ff0000, #cc0000); color: white; padding: 12px 25px; border-radius: 8px; text-decoration: none; font-weight: 600; box-shadow: 0 4px 15px rgba(255,0,0,0.3); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(255,0,0,0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255,0,0,0.3)';">
                        â–¶ ì˜ˆë°° ì˜ìƒ ë³´ê¸°
                    </a>
                </div>
            </div>
            
            <!-- ì£¼ì¼ì˜ˆë°° íƒ­ -->
            <div id="worshipSundayTab" class="worship-content card" style="border-radius: 0 0 15px 15px; margin-top: 0; display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <h2 style="margin: 0 0 5px 0; color: #2d3748;">ì£¼ì¼ì˜ˆë°° ì˜ìƒ</h2>
                        <p style="color: #718096; margin: 0;">ë§¤ì£¼ ì£¼ì¼ ì˜¤ì „ 11ì‹œ</p>
                    </div>
                </div>
                
                <!-- ìœ íŠœë¸Œ ì˜ìƒ ì¶”ê°€ (ê´€ë¦¬ì ì „ìš©) -->
                <div class="pastor-only" style="background: #f8fafc; padding: 15px; border-radius: 10px; margin-bottom: 20px; display: none;">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                        <input type="text" id="sundayYoutubeUrl" placeholder="ìœ íŠœë¸Œ ì˜ìƒ URL ì…ë ¥" class="form-control" style="flex: 1; min-width: 250px;">
                        <button onclick="setSundayYoutube()" class="btn btn-primary">ì¶”ê°€</button>
                    </div>
                </div>
                
                <!-- ì˜ìƒ ëª©ë¡ -->
                <div id="sundayVideoList">
                    <p style="color: #999; text-align: center; padding: 30px;">ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤</p>
                </div>
            </div>
            
            <!-- ìˆ˜ìš” ê²½ë°°ì™€ ì°¬ì–‘ íƒ­ -->
            <div id="worshipWednesdayTab" class="worship-content card" style="border-radius: 0 0 15px 15px; margin-top: 0; display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <h2 style="margin: 0 0 5px 0; color: #2d3748;">ìˆ˜ìš” ê²½ë°°ì™€ ì°¬ì–‘ ì˜ìƒ</h2>
                        <p style="color: #718096; margin: 0;">ë§¤ì£¼ ìˆ˜ìš”ì¼ ì˜¤í›„ 6ì‹œ 30ë¶„</p>
                    </div>
                </div>
                
                <!-- ìœ íŠœë¸Œ ì˜ìƒ ì¶”ê°€ (ê´€ë¦¬ì ì „ìš©) -->
                <div class="pastor-only" style="background: #f8fafc; padding: 15px; border-radius: 10px; margin-bottom: 20px; display: none;">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                        <input type="text" id="wednesdayYoutubeUrl" placeholder="ìœ íŠœë¸Œ ì˜ìƒ URL ì…ë ¥" class="form-control" style="flex: 1; min-width: 250px;">
                        <button onclick="setWednesdayYoutube()" class="btn btn-primary">ì¶”ê°€</button>
                    </div>
                </div>
                
                <!-- ì˜ìƒ ëª©ë¡ -->
                <div id="wednesdayVideoList">
                    <p style="color: #999; text-align: center; padding: 30px;">ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤</p>
                </div>
            </div>
        </div>
        
        <!-- êµíšŒì†Œì‹ ì„¹ì…˜ -->
        <div id="news" class="section section-news">
            <!-- í—¤ë” -->
            <div class="card" style="background: linear-gradient(135deg, #38b2ac 0%, #319795 100%); color: white; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <h1 style="margin: 0; color: white; font-size: 1.8em;">ğŸ“° êµíšŒì†Œì‹</h1>
                        <p style="margin: 8px 0 0 0; opacity: 0.9;">ì£¼ë³´ ë° êµíšŒ ì†Œì‹ì„ í™•ì¸í•˜ì„¸ìš”</p>
                    </div>
                    <button onclick="document.getElementById('bulletinUploadModal').style.display='flex'" class="btn" style="background: white; color: #319795; font-weight: 600;">
                        ğŸ“¤ ì£¼ë³´ ì—…ë¡œë“œ
                    </button>
                </div>
            </div>
            
            <!-- ìµœì‹  ì£¼ë³´ -->
            <div class="card" style="margin-bottom: 20px;">
                <h2 style="margin: 0 0 20px 0;">ğŸ“‹ ìµœì‹  ì£¼ë³´</h2>
                <div id="latestBulletin" style="display: flex; gap: 20px; flex-wrap: wrap; align-items: center;">
                    <div style="flex: 1; min-width: 300px;">
                        <div id="bulletinPreview" style="background: #f8fafc; border-radius: 12px; padding: 40px; text-align: center; border: 2px dashed #cbd5e0;">
                            <div style="font-size: 4em; margin-bottom: 10px;">ğŸ“„</div>
                            <p style="color: #718096;">ë“±ë¡ëœ ì£¼ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        </div>
                    </div>
                    <div style="flex: 1; min-width: 250px;" id="bulletinInfo">
                        <p style="color: #718096; text-align: center;">ì£¼ë³´ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</p>
                    </div>
                </div>
            </div>
            
            <!-- ì£¼ë³´ ëª©ë¡ -->
            <div class="card">
                <h2 style="margin: 0 0 20px 0;">ğŸ“š ì£¼ë³´ ëª©ë¡</h2>
                <div id="bulletinList" style="max-height: 400px; overflow-y: auto;">
                    <p style="color: #718096; text-align: center; padding: 30px;">ë“±ë¡ëœ ì£¼ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                </div>
            </div>
        </div>
        
        <!-- Sunday School ì„¹ì…˜ -->
        <div id="sundayschool" class="section section-sundayschool">
            <!-- í—¤ë” -->
            <div class="card" style="background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%); color: white; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <h1 style="margin: 0; color: white; font-size: 1.8em;">Sunday School</h1>
                        <p style="margin: 8px 0 0 0; opacity: 0.9;">ë‹¤ìŒ ì„¸ëŒ€ë¥¼ ìœ„í•œ ì‹ ì•™ êµìœ¡</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 8px;">
                        <span style="font-size: 0.9em;">ë§¤ì£¼ ì£¼ì¼ ì˜¤ì „ 11:00</span>
                    </div>
                </div>
            </div>
            
            <!-- Sunday School ì†Œê°œ -->
            <div class="card" style="margin-bottom: 20px;">
                <div style="text-align: center; padding: 20px 0;">
                    <h2 style="margin: 0 0 15px 0; color: #1e3a5f;">êµìœ¡ ëª©í‘œ</h2>
                    <p style="margin: 0; color: #4a5568; line-height: 1.8; max-width: 600px; margin: 0 auto;">
                        í•˜ë‚˜ë‹˜ì˜ ë§ì”€ì„ í†µí•´ ì˜ˆìˆ˜ ê·¸ë¦¬ìŠ¤ë„ë¥¼ ì•Œê³ ,<br>
                        ì„±ë ¹ì˜ ì¸ë„í•˜ì‹¬ ë”°ë¼ ë¯¿ìŒ ì•ˆì—ì„œ ì„±ì¥í•˜ë©°,<br>
                        í•˜ë‚˜ë‹˜ê³¼ ì´ì›ƒì„ ì‚¬ë‘í•˜ëŠ” ê·¸ë¦¬ìŠ¤ë„ì¸ìœ¼ë¡œ ì–‘ìœ¡í•©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
            
            <!-- êµìœ¡ í”„ë¡œê·¸ë¨ -->
            <div class="card" style="margin-bottom: 20px;">
                <h2 style="margin: 0 0 25px 0; color: #1e3a5f; border-bottom: 2px solid #e2e8f0; padding-bottom: 15px;">êµìœ¡ í”„ë¡œê·¸ë¨</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2em; margin-bottom: 10px;">ğŸ“–</div>
                        <h4 style="margin: 0 0 8px 0; color: #1e3a5f;">ì„±ê²½ê³µë¶€</h4>
                        <p style="margin: 0; color: #64748b; font-size: 0.9em;">ì—°ë ¹ì— ë§ëŠ” ì„±ê²½ ë§ì”€ êµìœ¡</p>
                    </div>
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2em; margin-bottom: 10px;">ğŸµ</div>
                        <h4 style="margin: 0 0 8px 0; color: #1e3a5f;">ì°¬ì–‘</h4>
                        <p style="margin: 0; color: #64748b; font-size: 0.9em;">í•˜ë‚˜ë‹˜ì„ ì°¬ì–‘í•˜ëŠ” ì‹œê°„</p>
                    </div>
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2em; margin-bottom: 10px;">ğŸ¨</div>
                        <h4 style="margin: 0 0 8px 0; color: #1e3a5f;">í™œë™</h4>
                        <p style="margin: 0; color: #64748b; font-size: 0.9em;">ë§Œë“¤ê¸°, ê²Œì„ ë“± ë‹¤ì–‘í•œ í™œë™</p>
                    </div>
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2em; margin-bottom: 10px;">ğŸ•ï¸</div>
                        <h4 style="margin: 0 0 8px 0; color: #1e3a5f;">íŠ¹ë³„í™œë™</h4>
                        <p style="margin: 0; color: #64748b; font-size: 0.9em;">ì—¬ë¦„ì„±ê²½í•™êµ, ìˆ˜ë ¨íšŒ</p>
                    </div>
                </div>
            </div>
            
            <!-- Staff -->
            <div class="card" style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0; color: #1e3a5f; border-bottom: 2px solid #e2e8f0; padding-bottom: 15px; flex: 1;">Staff</h2>
                    <button onclick="showAddStaffModal()" class="btn pastor-only" style="background: #ed8936; color: white; display: none;">Staff ì¶”ê°€</button>
                </div>
                
                <div id="ssStaffGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 40px 20px; color: #94a3b8; grid-column: 1 / -1;">
                        <p>ë“±ë¡ëœ Staffê°€ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                </div>
            </div>
            
            <!-- Sunday School í–‰ì‚¬ ì‚¬ì§„ -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0; color: #1e3a5f; border-bottom: 2px solid #e2e8f0; padding-bottom: 15px; flex: 1;">í–‰ì‚¬ ì‚¬ì§„</h2>
                    <button onclick="showAddSSPhotoModal()" class="btn pastor-only" style="background: #ed8936; color: white; display: none;">ì‚¬ì§„ ì¶”ê°€</button>
                </div>
                
                <div id="ssPhotoGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 40px 20px; color: #94a3b8; grid-column: 1 / -1;">
                        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“·</div>
                        <p>ë“±ë¡ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ìŠ¬ë¼ì´ë“œ ê´€ë¦¬ ëª¨ë‹¬ -->
        <div id="slideEditModal" class="modal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header" style="background: linear-gradient(135deg, #1e3a5f, #2d5a87);">
                    <h2>ìŠ¬ë¼ì´ë“œ ê´€ë¦¬</h2>
                    <button class="close-btn" onclick="closeSlideEditModal()">&times;</button>
                </div>
                <div class="modal-body" style="padding: 25px;">
                    <!-- ìŠ¬ë¼ì´ë“œ ì„¤ì • -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <label style="font-weight: 600;">ìë™ ì „í™˜ ì‹œê°„:</label>
                            <select id="slideInterval" class="form-control" style="width: auto;" onchange="updateSlideInterval()">
                                <option value="3000">3ì´ˆ</option>
                                <option value="5000" selected>5ì´ˆ</option>
                                <option value="7000">7ì´ˆ</option>
                                <option value="10000">10ì´ˆ</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="addNewSlide()">+ ìƒˆ ìŠ¬ë¼ì´ë“œ ì¶”ê°€</button>
                    </div>
                    
                    <!-- ìŠ¬ë¼ì´ë“œ ëª©ë¡ -->
                    <div id="slideEditList" style="display: grid; gap: 15px; max-height: 400px; overflow-y: auto;">
                        <!-- ìŠ¬ë¼ì´ë“œê°€ ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                    </div>
                    
                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="saveSlides()">ì €ì¥</button>
                        <button class="btn btn-secondary" onclick="closeSlideEditModal()">ë‹«ê¸°</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Staff ì¶”ê°€ ëª¨ë‹¬ -->
        <div id="addStaffModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
            <div style="background: white; border-radius: 16px; padding: 30px; max-width: 400px; width: 90%; max-height: 90vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0; color: #ed8936;">Staff ì¶”ê°€</h2>
                    <button onclick="closeAddStaffModal()" style="background: none; border: none; font-size: 1.5em; cursor: pointer;">âœ•</button>
                </div>
                
                <div class="form-group">
                    <label>ì‚¬ì§„</label>
                    <div id="staffPhotoDropZone" style="border: 2px dashed #cbd5e0; border-radius: 12px; padding: 30px; text-align: center; cursor: pointer;" onclick="document.getElementById('staffPhotoInput').click()">
                        <div id="staffPhotoPreview" style="margin-bottom: 10px;">
                            <div style="width: 100px; height: 100px; background: #f1f5f9; border-radius: 50%; margin: 0 auto; display: flex; align-items: center; justify-content: center; font-size: 2.5em;">ğŸ‘¤</div>
                        </div>
                        <p style="margin: 0; color: #718096; font-size: 0.9em;">í´ë¦­í•˜ì—¬ ì‚¬ì§„ ì„ íƒ</p>
                    </div>
                    <input type="file" id="staffPhotoInput" accept="image/*" style="display: none;" onchange="handleStaffPhoto(this)">
                </div>
                
                <div class="form-group">
                    <label>ì§ìœ„</label>
                    <input type="text" id="staffPosition" class="form-control" placeholder="ì˜ˆ: êµì¥, êµì‚¬, ë¶€ì¥">
                </div>
                
                <div class="form-group">
                    <label>ì´ë¦„</label>
                    <input type="text" id="staffName" class="form-control" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button onclick="closeAddStaffModal()" class="btn btn-secondary" style="flex: 1;">ì·¨ì†Œ</button>
                    <button onclick="saveStaff()" class="btn" style="flex: 1; background: #ed8936; color: white;">ì €ì¥</button>
                </div>
            </div>
        </div>
        
        <!-- Sunday School ì‚¬ì§„ ì¶”ê°€ ëª¨ë‹¬ -->
        <div id="addSSPhotoModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
            <div style="background: white; border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0; color: #ed8936;">Sunday School ì‚¬ì§„ ì¶”ê°€</h2>
                    <button onclick="closeAddSSPhotoModal()" style="background: none; border: none; font-size: 1.5em; cursor: pointer;">âœ•</button>
                </div>
                
                <div class="form-group">
                    <label>ì œëª©</label>
                    <input type="text" id="ssPhotoTitle" class="form-control" placeholder="ì˜ˆ: 2025ë…„ ì—¬ë¦„ì„±ê²½í•™êµ">
                </div>
                
                <div class="form-group">
                    <label>ë‚ ì§œ</label>
                    <input type="date" id="ssPhotoDate" class="form-control">
                </div>
                
                <div class="form-group">
                    <label>ì‚¬ì§„ ì„ íƒ</label>
                    <div id="ssPhotoDropZone" style="border: 2px dashed #cbd5e0; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer;" onclick="document.getElementById('ssPhotoFileInput').click()">
                        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ–¼ï¸</div>
                        <p style="margin: 0; color: #718096;">í´ë¦­í•˜ì—¬ ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”</p>
                        <div id="ssPhotoPreviewContainer" style="margin-top: 15px;"></div>
                    </div>
                    <input type="file" id="ssPhotoFileInput" accept="image/*" style="display: none;" onchange="handleSSPhotoFile(this)">
                </div>
                
                <div class="form-group">
                    <label>ì„¤ëª… (ì„ íƒ)</label>
                    <textarea id="ssPhotoDescription" class="form-control" rows="2" placeholder="ì‚¬ì§„ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…"></textarea>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button onclick="closeAddSSPhotoModal()" class="btn btn-secondary" style="flex: 1;">ì·¨ì†Œ</button>
                    <button onclick="saveSSPhoto()" class="btn" style="flex: 1; background: #ed8936; color: white;">ì €ì¥</button>
                </div>
            </div>
        </div>
        
        <!-- ê°¤ëŸ¬ë¦¬ ì„¹ì…˜ -->
        <div id="gallery" class="section section-gallery">
            <!-- í—¤ë” -->
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <h1 style="margin: 0; color: white; font-size: 1.8em;">ê°¤ëŸ¬ë¦¬</h1>
                        <p style="margin: 8px 0 0 0; opacity: 0.9;">êµíšŒ í–‰ì‚¬ ì‚¬ì§„ ëª¨ìŒ</p>
                    </div>
                    <button onclick="showAddPhotoModal()" class="btn pastor-only" style="background: white; color: #667eea; font-weight: 600; display: none;">
                        ì‚¬ì§„ ì¶”ê°€
                    </button>
                </div>
            </div>
            
            <!-- ì‚¬ì§„ í•„í„° -->
            <div class="card" style="margin-bottom: 20px; padding: 15px;">
                <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                    <span style="color: #4a5568; font-weight: 500;">ì¹´í…Œê³ ë¦¬:</span>
                    <button onclick="filterGallery('all')" class="gallery-filter-btn active" data-filter="all" style="padding: 8px 16px; border-radius: 20px; border: 1px solid #e2e8f0; background: #667eea; color: white; cursor: pointer;">ì „ì²´</button>
                    <button onclick="filterGallery('worship')" class="gallery-filter-btn" data-filter="worship" style="padding: 8px 16px; border-radius: 20px; border: 1px solid #e2e8f0; background: white; color: #4a5568; cursor: pointer;">ì˜ˆë°°</button>
                    <button onclick="filterGallery('event')" class="gallery-filter-btn" data-filter="event" style="padding: 8px 16px; border-radius: 20px; border: 1px solid #e2e8f0; background: white; color: #4a5568; cursor: pointer;">í–‰ì‚¬</button>
                    <button onclick="filterGallery('fellowship')" class="gallery-filter-btn" data-filter="fellowship" style="padding: 8px 16px; border-radius: 20px; border: 1px solid #e2e8f0; background: white; color: #4a5568; cursor: pointer;">ì¹œêµ</button>
                    <button onclick="filterGallery('sundayschool')" class="gallery-filter-btn" data-filter="sundayschool" style="padding: 8px 16px; border-radius: 20px; border: 1px solid #e2e8f0; background: white; color: #4a5568; cursor: pointer;">Sunday School</button>
                </div>
            </div>
            
            <!-- ì‚¬ì§„ ê·¸ë¦¬ë“œ -->
            <div class="card">
                <div id="galleryGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 60px 20px; color: #94a3b8; grid-column: 1 / -1;">
                        <div style="font-size: 4em; margin-bottom: 15px;">ğŸ“·</div>
                        <p>ë“±ë¡ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤</p>
                        <p style="font-size: 0.9em;">ê´€ë¦¬ì ë¡œê·¸ì¸ í›„ ì‚¬ì§„ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ì‚¬ì§„ ì¶”ê°€ ëª¨ë‹¬ -->
        <div id="addPhotoModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
            <div style="background: white; border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0; color: #667eea;">ì‚¬ì§„ ì¶”ê°€</h2>
                    <button onclick="closeAddPhotoModal()" style="background: none; border: none; font-size: 1.5em; cursor: pointer;">âœ•</button>
                </div>
                
                <div class="form-group">
                    <label>ì œëª©</label>
                    <input type="text" id="photoTitle" class="form-control" placeholder="ì˜ˆ: 2025ë…„ ë¶€í™œì ˆ ì˜ˆë°°">
                </div>
                
                <div class="form-group">
                    <label>ë‚ ì§œ</label>
                    <input type="date" id="photoDate" class="form-control">
                </div>
                
                <div class="form-group">
                    <label>ì¹´í…Œê³ ë¦¬</label>
                    <select id="photoCategory" class="form-control">
                        <option value="worship">ì˜ˆë°°</option>
                        <option value="event">í–‰ì‚¬</option>
                        <option value="fellowship">ì¹œêµ</option>
                        <option value="sundayschool">Sunday School</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ì´ë¯¸ì§€ URL (Imgur ë“±)</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="photoImageUrl" class="form-control" placeholder="https://i.imgur.com/abc123.jpg" style="flex: 1;">
                        <button onclick="previewPhotoUrl()" class="btn" style="background: #38a169; color: white; white-space: nowrap;">ë¯¸ë¦¬ë³´ê¸°</button>
                    </div>
                    <p style="margin: 5px 0 0 0; font-size: 0.8em; color: #718096;">ğŸ’¡ Imgurì— ì´ë¯¸ì§€ ì—…ë¡œë“œ í›„ URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš” (PC/í° ë™ê¸°í™”ë¨)</p>
                </div>
                
                <div class="form-group">
                    <label>ë˜ëŠ” íŒŒì¼ ì„ íƒ (PCì—ì„œë§Œ ë³´ì„)</label>
                    <div id="photoDropZone" style="border: 2px dashed #cbd5e0; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s;" onclick="document.getElementById('photoFileInput').click()">
                        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ–¼ï¸</div>
                        <p style="margin: 0; color: #718096;">í´ë¦­í•˜ì—¬ ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”</p>
                        <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #a0aec0;">JPG, PNG íŒŒì¼ (ìµœëŒ€ 5MB)</p>
                        <div id="photoPreviewContainer" style="margin-top: 15px;"></div>
                    </div>
                    <input type="file" id="photoFileInput" accept="image/*" style="display: none;" onchange="handlePhotoFile(this)">
                </div>
                
                <div class="form-group">
                    <label>ì„¤ëª… (ì„ íƒ)</label>
                    <textarea id="photoDescription" class="form-control" rows="2" placeholder="ì‚¬ì§„ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…"></textarea>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button onclick="closeAddPhotoModal()" class="btn btn-secondary" style="flex: 1;">ì·¨ì†Œ</button>
                    <button onclick="savePhoto()" class="btn" style="flex: 1; background: #667eea; color: white;">ì €ì¥</button>
                </div>
            </div>
        </div>
        
        <!-- ì‚¬ì§„ í™•ëŒ€ ë³´ê¸° ëª¨ë‹¬ -->
        <div id="photoViewModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 1001; align-items: center; justify-content: center;" onclick="closePhotoViewModal()">
            <button onclick="closePhotoViewModal()" style="position: absolute; top: 20px; right: 20px; background: none; border: none; color: white; font-size: 2em; cursor: pointer;">âœ•</button>
            <img id="photoViewImage" src="" style="max-width: 90%; max-height: 90%; border-radius: 8px;">
        </div>
        
        <div id="bulletinUploadModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
            <div style="background: white; border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">ğŸ“¤ ì£¼ë³´ ì—…ë¡œë“œ</h2>
                    <button onclick="document.getElementById('bulletinUploadModal').style.display='none'" style="background: none; border: none; font-size: 1.5em; cursor: pointer;">âœ•</button>
                </div>
                
                <div class="form-group">
                    <label>ğŸ“… ì£¼ë³´ ë‚ ì§œ</label>
                    <input type="date" id="bulletinDate" class="form-control">
                </div>
                
                <div class="form-group">
                    <label>ğŸ“ ì œëª©</label>
                    <input type="text" id="bulletinTitle" class="form-control" placeholder="ì˜ˆ: 2025ë…„ 11ì›” ë„·ì§¸ì£¼ ì£¼ë³´">
                </div>
                
                <div class="form-group">
                    <label>ğŸ“„ PDF íŒŒì¼</label>
                    <div id="bulletinDropZone" style="border: 2px dashed #cbd5e0; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s;" onclick="document.getElementById('bulletinFileInput').click()">
                        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“</div>
                        <p style="margin: 0; color: #718096;">í´ë¦­í•˜ê±°ë‚˜ PDF íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
                        <p id="bulletinFileName" style="margin: 10px 0 0 0; color: #38b2ac; font-weight: 600;"></p>
                    </div>
                    <input type="file" id="bulletinFileInput" accept=".pdf" style="display: none;" onchange="handleBulletinFile(this)">
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button onclick="document.getElementById('bulletinUploadModal').style.display='none'" class="btn btn-secondary" style="flex: 1;">ì·¨ì†Œ</button>
                    <button onclick="uploadBulletin()" class="btn btn-primary" style="flex: 1;">ì—…ë¡œë“œ</button>
                </div>
            </div>
        </div>
        
        <!-- ë‚´ ì •ë³´ ì„¹ì…˜ -->
        <div id="my" class="section section-my">
            <!-- í—¤ë” -->
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                    <div>
                        <h1 style="margin: 0; color: white; font-size: 1.8em;">ğŸ‘¤ ë‚´ ì •ë³´</h1>
                        <p style="margin: 8px 0 0 0; opacity: 0.9;">ë‚˜ì˜ ì¶œì„ í˜„í™©ê³¼ í—Œê¸ˆ ë‚´ì—­ì„ í™•ì¸í•˜ì„¸ìš”</p>
                    </div>
                    <div id="myInfoSelectArea" style="display: none; align-items: center; gap: 10px;">
                        <label style="font-weight: 600; color: white;">êµì¸ ì„ íƒ:</label>
                        <select id="myInfoMemberSelect" onchange="loadMyInfoForMember(this.value)" class="form-control" style="width: auto; min-width: 180px; padding: 10px 15px; border-radius: 10px; border: none; font-size: 1em;">
                            <option value="">-- êµì¸ ì„ íƒ --</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- êµì  ë¯¸ì—°ê²° ì•ˆë‚´ -->
            <div id="myInfoNotLinked" class="card" style="display: none; text-align: center; padding: 40px; background: linear-gradient(135deg, #fef3c7, #fde68a);">
                <div style="font-size: 3em; margin-bottom: 15px;">ğŸ“‹</div>
                <h3 style="color: #92400e; margin: 0 0 10px 0;">êµì  ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤</h3>
                <p style="color: #a16207; margin: 0;">ê´€ë¦¬ìë‹˜ê»˜ êµì  ì—°ê²°ì„ ìš”ì²­í•´ì£¼ì„¸ìš”.<br>ì—°ê²° í›„ ì¶œì„/í—Œê¸ˆ ë‚´ì—­ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
            
            <!-- ì„ íƒëœ êµì¸ í”„ë¡œí•„ -->
            <div id="myProfileCard" class="card" style="display: none; margin-bottom: 20px; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);">
                <div style="display: flex; align-items: center; gap: 25px; flex-wrap: wrap;">
                    <div id="myProfilePhoto" style="width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; display: flex; align-items: center; justify-content: center; font-size: 2.5em; font-weight: bold; flex-shrink: 0; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);"></div>
                    <div style="flex: 1;">
                        <div style="font-size: 1.8em; font-weight: 700; color: #2d3748;" id="myProfileName">-</div>
                        <div style="display: flex; gap: 12px; margin-top: 10px; flex-wrap: wrap;">
                            <span id="myProfilePosition" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 6px 16px; border-radius: 25px; font-size: 0.9em; font-weight: 500;"></span>
                            <span id="myProfileCell" style="background: linear-gradient(135deg, #38a169, #48bb78); color: white; padding: 6px 16px; border-radius: 25px; font-size: 0.9em; font-weight: 500;"></span>
                        </div>
                        <div style="margin-top: 12px; color: #718096; font-size: 1em;" id="myProfileContact"></div>
                    </div>
                </div>
            </div>
            
            <!-- ì¶œì„ & í—Œê¸ˆ ì¹´ë“œ -->
            <div id="myInfoCards" style="display: none; grid-template-columns: 1fr 1fr; gap: 20px;">
                <!-- ë‚´ ì¶œì„ í˜„í™© -->
                <div class="card" style="background: white; border-top: 4px solid #38a169;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                        <span style="background: linear-gradient(135deg, #38a169, #48bb78); color: white; padding: 12px 16px; border-radius: 12px; font-size: 1.3em;">âœ…</span>
                        <h2 style="margin: 0; color: #2d3748;">ì¶œì„ í˜„í™©</h2>
                    </div>
                    <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                        <div style="flex: 1; background: linear-gradient(135deg, #dcfce7, #bbf7d0); padding: 20px; border-radius: 16px; text-align: center; box-shadow: 0 4px 15px rgba(56, 161, 105, 0.15);">
                            <div style="font-size: 2.5em; font-weight: bold; color: #16a34a;" id="myAttendCount">0</div>
                            <div style="font-size: 0.9em; color: #15803d; font-weight: 600; margin-top: 5px;">ì¶œì„</div>
                        </div>
                        <div style="flex: 1; background: linear-gradient(135deg, #fee2e2, #fecaca); padding: 20px; border-radius: 16px; text-align: center; box-shadow: 0 4px 15px rgba(220, 38, 38, 0.15);">
                            <div style="font-size: 2.5em; font-weight: bold; color: #dc2626;" id="myAbsentCount">0</div>
                            <div style="font-size: 0.9em; color: #b91c1c; font-weight: 600; margin-top: 5px;">ê²°ì„</div>
                        </div>
                        <div style="flex: 1; background: linear-gradient(135deg, #e0e7ff, #c7d2fe); padding: 20px; border-radius: 16px; text-align: center; box-shadow: 0 4px 15px rgba(79, 70, 229, 0.15);">
                            <div style="font-size: 2.5em; font-weight: bold; color: #4f46e5;" id="myAttendRate">0%</div>
                            <div style="font-size: 0.9em; color: #4338ca; font-weight: 600; margin-top: 5px;">ì¶œì„ë¥ </div>
                        </div>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 12px;">
                        <div style="font-size: 0.85em; color: #64748b; margin-bottom: 10px; font-weight: 700;">ğŸ“… ìµœê·¼ ì¶œì„ ê¸°ë¡</div>
                        <div id="myRecentAttendance" style="display: flex; gap: 8px; flex-wrap: wrap;"></div>
                    </div>
                </div>
                
                <!-- ë‚´ í—Œê¸ˆ ë‚´ì—­ -->
                <div class="card" style="background: white; border-top: 4px solid #ed8936;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                        <span style="background: linear-gradient(135deg, #ed8936, #f6ad55); color: white; padding: 12px 16px; border-radius: 12px; font-size: 1.3em;">ğŸ’°</span>
                        <h2 style="margin: 0; color: #2d3748;">í—Œê¸ˆ ë‚´ì—­</h2>
                    </div>
                    <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                        <div style="flex: 1; background: linear-gradient(135deg, #fef3c7, #fde68a); padding: 20px; border-radius: 16px; text-align: center; box-shadow: 0 4px 15px rgba(217, 119, 6, 0.15);">
                            <div style="font-size: 1.8em; font-weight: bold; color: #d97706;" id="myTotalOffering">$0</div>
                            <div style="font-size: 0.9em; color: #b45309; font-weight: 600; margin-top: 5px;">ì˜¬í•´ ì´ í—Œê¸ˆ</div>
                        </div>
                        <div style="flex: 1; background: linear-gradient(135deg, #fed7aa, #fdba74); padding: 20px; border-radius: 16px; text-align: center; box-shadow: 0 4px 15px rgba(234, 88, 12, 0.15);">
                            <div style="font-size: 1.8em; font-weight: bold; color: #ea580c;" id="myMonthOffering">$0</div>
                            <div style="font-size: 0.9em; color: #c2410c; font-weight: 600; margin-top: 5px;">ì´ë²ˆë‹¬ í—Œê¸ˆ</div>
                        </div>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 12px; max-height: 200px; overflow-y: auto;">
                        <div style="font-size: 0.85em; color: #64748b; margin-bottom: 10px; font-weight: 700;">ğŸ“‹ ìµœê·¼ í—Œê¸ˆ ê¸°ë¡</div>
                        <div id="myRecentOfferings"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (êµì¸ í†µê³„ ìš”ì•½ ì¹´ë“œ ì‚­ì œë¨) -->
        <div id="dashboard" class="section section-dashboard">
            <!-- ëŒ€ì‹œë³´ë“œ í—¤ë” -->
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                    <div>
                        <h1 style="margin: 0; color: white; font-size: 1.8em;">Sacramento Glory Church</h1>
                        <p style="margin: 8px 0 0 0; opacity: 0.9;">êµíšŒ ì¢…í•© ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</p>
                    </div>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px;">
                            <div style="font-size: 1.8em; font-weight: bold;" id="dashTotal">0</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">ì´ êµì¸</div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px;">
                            <div style="font-size: 1.8em; font-weight: bold;" id="dashThisSunday">0</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">ê¸ˆì£¼ ì¶œì„</div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px;">
                            <div style="font-size: 1.8em; font-weight: bold;" id="dashMonthIncome">$0</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">ì´ë²ˆë‹¬ ìˆ˜ì…</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ìš”ì•½ ì¹´ë“œ ê·¸ë¦¬ë“œ -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
                
                <!-- ì¶œì„ í˜„í™© -->
                <div class="card" style="border-left: 4px solid #38a169;">
                    <h3 style="margin: 0 0 15px 0; color: #38a169; font-weight: 600;">ì¶œì„ í˜„í™©</h3>
                    <div id="dashAttendanceSummary">
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                            <span>ê¸ˆì£¼ ì¶œì„</span>
                            <span style="font-weight: 600; color: #38a169;" id="dashWeekAttend">0ëª…</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                            <span>ê¸ˆì£¼ ê²°ì„</span>
                            <span style="font-weight: 600; color: #dc2626;" id="dashWeekAbsent">0ëª…</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                            <span>ê¸ˆì£¼ ì¶œì„ë¥ </span>
                            <span style="font-weight: 600; color: #4f46e5;" id="dashAvgRate">0%</span>
                        </div>
                    </div>
                </div>
                
                <!-- êµ¬ì—­ í˜„í™© -->
                <div class="card" style="border-left: 4px solid #3182ce;">
                    <h3 style="margin: 0 0 15px 0; color: #3182ce; font-weight: 600;">êµ¬ì—­ í˜„í™©</h3>
                    <div id="dashCellSummary"></div>
                </div>
                
                <!-- ë¶€ì„œ í˜„í™© -->
                <div class="card" style="border-left: 4px solid #805ad5;">
                    <h3 style="margin: 0 0 15px 0; color: #805ad5; font-weight: 600;">ë¶€ì„œ í˜„í™©</h3>
                    <div id="dashDeptSummary"></div>
                </div>
                
                <!-- ë©˜í† ë§ í˜„í™© -->
                <div class="card" style="border-left: 4px solid #d69e2e;">
                    <h3 style="margin: 0 0 15px 0; color: #d69e2e; font-weight: 600;">ë©˜í† ë§ í˜„í™©</h3>
                    <div id="dashMentorSummary"></div>
                </div>
                
                <!-- ì¬ì • í˜„í™© -->
                <div class="card" style="border-left: 4px solid #ed8936;">
                    <h3 style="margin: 0 0 15px 0; color: #ed8936; font-weight: 600;">ì¬ì • í˜„í™©</h3>
                    <div id="dashFinanceSummary">
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                            <span>ì´ë²ˆë‹¬ ìˆ˜ì…</span>
                            <span style="font-weight: 600; color: #16a34a;" id="dashMonthIncomeVal">$0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                            <span>ì´ë²ˆë‹¬ ì§€ì¶œ</span>
                            <span style="font-weight: 600; color: #dc2626;" id="dashMonthExpenseVal">$0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                            <span>ì”ì•¡</span>
                            <span style="font-weight: 600; color: #4f46e5;" id="dashBalanceVal">$0</span>
                        </div>
                    </div>
                </div>
                
                <!-- ìƒˆê°€ì¡± ëª…ë‹¨ -->
                <div class="card" style="border-left: 4px solid #ed8936;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0; color: #ed8936; font-weight: 600;">ìƒˆê°€ì¡± ëª…ë‹¨</h3>
                        <span style="font-size: 0.8em; color: #888;">ìµœê·¼ 3ê°œì›” (ë“±ë¡ì¼ ê¸°ì¤€)</span>
                    </div>
                    <div id="dashNewFamilySummary"></div>
                </div>
                
                <!-- ì´ë²ˆë‹¬/ë‹¤ìŒë‹¬ ìƒì¼ -->
                <div class="card" style="border-left: 4px solid #ec4899;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0; color: #ec4899; font-weight: 600;">ìƒì¼ ì¶•í•˜</h3>
                        <span style="font-size: 0.8em; color: #888;">ì´ë²ˆë‹¬ Â· ë‹¤ìŒë‹¬</span>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <!-- ì´ë²ˆë‹¬ ìƒì¼ -->
                        <div style="background: #fdf2f8; border-radius: 10px; padding: 12px;">
                            <div style="font-weight: 600; color: #be185d; margin-bottom: 10px; font-size: 0.9em;">ì´ë²ˆë‹¬ ìƒì¼</div>
                            <div id="dashThisMonthBirthday"></div>
                        </div>
                        <!-- ë‹¤ìŒë‹¬ ìƒì¼ -->
                        <div style="background: #fce7f3; border-radius: 10px; padding: 12px;">
                            <div style="font-weight: 600; color: #be185d; margin-bottom: 10px; font-size: 0.9em;">ë‹¤ìŒë‹¬ ìƒì¼</div>
                            <div id="dashNextMonthBirthday"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- êµíšŒ ì¡°ì§ë„ -->
            <div class="card" style="margin-top: 20px; background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h2 style="margin: 0; color: #1e3a5f; font-size: 1.3em;">êµíšŒ ì¡°ì§ë„</h2>
                    <button class="btn btn-primary pastor-only" style="display: none;" onclick="showOrgChartEditModal()">í¸ì§‘</button>
                </div>
                
                <div id="churchOrgChart" style="padding: 10px;">
                    
                    <!-- 1ë‹¨: ë‹´ì„ëª©ì‚¬ -->
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="display: inline-block; background: linear-gradient(135deg, #1e3a5f, #2d5a87); color: white; padding: 18px 50px; border-radius: 50px; box-shadow: 0 4px 15px rgba(30,58,95,0.25);">
                            <div style="font-size: 0.8em; opacity: 0.9; letter-spacing: 1px;">ë‹´ì„ëª©ì‚¬</div>
                            <div style="font-size: 1.5em; font-weight: 700; margin-top: 3px;" id="orgPastor">ì •ì¤€ì—°</div>
                        </div>
                    </div>
                    
                    <!-- 2ë‹¨: ìš´ì˜ìœ„ì›íšŒ -->
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="display: inline-block; background: #2d5a87; color: white; padding: 12px 35px; border-radius: 8px;">
                            <div style="font-size: 0.75em; opacity: 0.9; margin-bottom: 2px;">ìš´ì˜ìœ„ì›íšŒ</div>
                            <div style="font-weight: 600; font-size: 0.9em;" id="orgCommittee">-</div>
                        </div>
                    </div>
                    
                    <!-- 3ë‹¨: ë¶€ì„œ ë° íŒ€ (í…Œì´ë¸” í˜•ì‹) -->
                    <div style="background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <div style="font-weight: 600; color: #1e3a5f; font-size: 0.9em; margin-bottom: 15px; text-align: center;">ë¶€ ì„œ</div>
                        <div id="orgDepartmentsWithTeams" style="overflow-x: auto;">
                            <!-- ë¶€ì„œì™€ íŒ€ë“¤ì´ ë™ì ìœ¼ë¡œ í‘œì‹œë¨ -->
                        </div>
                    </div>
                    
                    <!-- 4ë‹¨: ì¥ë¡œ/ê¶Œì‚¬/ì•ˆìˆ˜ì§‘ì‚¬/ì„œë¦¬ì§‘ì‚¬/ì„±ë„ -->
                    <div style="display: flex; justify-content: center; gap: 25px; flex-wrap: wrap;">
                        <div style="text-align: center; min-width: 80px;">
                            <div style="background: #1e3a5f; color: white; padding: 8px 20px; border-radius: 20px; font-size: 0.8em; font-weight: 500; margin-bottom: 8px;">ì¥ë¡œ</div>
                            <div style="font-size: 0.85em; color: #334155; line-height: 1.6;" id="orgElder">-</div>
                        </div>
                        <div style="text-align: center; min-width: 80px;">
                            <div style="background: #2d5a87; color: white; padding: 8px 20px; border-radius: 20px; font-size: 0.8em; font-weight: 500; margin-bottom: 8px;">ê¶Œì‚¬</div>
                            <div style="font-size: 0.85em; color: #334155; line-height: 1.6;" id="orgKwonsa">-</div>
                        </div>
                        <div style="text-align: center; min-width: 80px;">
                            <div style="background: #3d7ab5; color: white; padding: 8px 20px; border-radius: 20px; font-size: 0.8em; font-weight: 500; margin-bottom: 8px;">ì•ˆìˆ˜ì§‘ì‚¬</div>
                            <div style="font-size: 0.85em; color: #334155; line-height: 1.6;" id="orgOrdainedDeacon">-</div>
                        </div>
                        <div style="text-align: center; min-width: 80px;">
                            <div style="background: #64748b; color: white; padding: 8px 20px; border-radius: 20px; font-size: 0.8em; font-weight: 500; margin-bottom: 8px;">ì„œë¦¬ì§‘ì‚¬</div>
                            <div style="font-size: 0.85em; color: #334155;" id="orgDeacon">-</div>
                        </div>
                        <div style="text-align: center; min-width: 80px;">
                            <div style="background: #94a3b8; color: white; padding: 8px 20px; border-radius: 20px; font-size: 0.8em; font-weight: 500; margin-bottom: 8px;">ì„±ë„</div>
                            <div style="font-size: 0.85em; color: #334155;" id="orgMembers">-</div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        
        <!-- ì¶œì„ê´€ë¦¬ -->
        <div id="attendance" class="section section-attendance">
            <!-- ì¶œì„ í—¤ë” -->
            <div class="card" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); color: white; margin-bottom: 15px; padding: 15px;">
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <h1 style="margin: 0; color: white; font-size: 1.6em;">âœ… ì¶œì„ê´€ë¦¬</h1>
                        <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.95em;">ì£¼ì¼ ì˜ˆë°° ì—°ê°„ ì¶œì„ í˜„í™©</p>
                    </div>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                        <select id="attendanceYear" class="form-control" style="width: auto; padding: 8px;" onchange="loadYearlyAttendanceSheet()">
                            <option value="2025">2025ë…„</option>
                            <option value="2024">2024ë…„</option>
                            <option value="2026">2026ë…„</option>
                        </select>
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 10px 18px; border-radius: 10px;">
                            <div style="font-size: 1.5em; font-weight: bold;" id="totalMemberCount">0</div>
                            <div style="font-size: 0.8em; opacity: 0.9;">ì´ êµì¸</div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 10px 18px; border-radius: 10px;">
                            <div style="font-size: 1.5em; font-weight: bold;" id="yearlyAttendanceRate">0%</div>
                            <div style="font-size: 0.8em; opacity: 0.9;">ê¸ˆì£¼ ì¶œì„ë¥ </div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 10px 18px; border-radius: 10px;">
                            <div style="font-size: 1.5em; font-weight: bold;" id="yearTotalAttendanceRate">0%</div>
                            <div style="font-size: 0.8em; opacity: 0.9;">ë…„ì¤‘ ì¶œì„ë¥ </div>
                        </div>
                        <button onclick="printYearlyAttendance()" class="btn" style="background: white; color: #38a169; font-weight: 600; padding: 10px 18px; font-size: 0.9em;">
                            ğŸ–¨ï¸ ì¸ì‡„
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ì—°ê°„ ì¶œì„í‘œ -->
            <div class="card" style="padding: 0; overflow: hidden;">
                <div style="overflow-x: auto;">
                    <div id="yearlyAttendanceSheet" style="min-width: 100%;">
                        <!-- ì—°ê°„ ì¶œì„í‘œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
            
            <!-- ê¸ˆì£¼ ê²°ì„ì ëª…ë‹¨ -->
            <div class="card" style="margin-top: 15px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; color: #dc2626;">âš ï¸ ê¸ˆì£¼ ê²°ì„ì ëª…ë‹¨</h3>
                    <span id="absentDateLabel" style="font-size: 0.9em; color: #666;"></span>
                </div>
                <div id="weeklyAbsentList">
                    <!-- ê²°ì„ì ëª…ë‹¨ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
        
        <!-- êµ¬ì—­ê´€ë¦¬ -->
        <div id="cell" class="section section-cell">
            <!-- êµ¬ì—­ í—¤ë” -->
            <div class="card" style="background: linear-gradient(135deg, #3182ce 0%, #2c5282 100%); color: white; margin-bottom: 20px;">
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
                    <div>
                        <h1 style="margin: 0; color: white; font-size: 1.8em;">êµ¬ì—­ê´€ë¦¬</h1>
                        <p style="margin: 10px 0 0 0; opacity: 0.9;">ì„œë¡œ ëŒì•„ë³´ì•„ ì‚¬ë‘ê³¼ ì„ í–‰ì„ ê²©ë ¤í•˜ëŠ” ê³µë™ì²´</p>
                    </div>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px;">
                            <div style="font-size: 1.8em; font-weight: bold;" id="totalCells">0</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">ì´ êµ¬ì—­</div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px;">
                            <div style="font-size: 1.8em; font-weight: bold;" id="totalCellMembers">0</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">ì´ êµ¬ì—­ì›</div>
                        </div>
                        <button class="btn pastor-only" style="background: white; color: #3182ce; font-weight: 600; padding: 12px 20px; border: none; display: none;" onclick="showAddCellModal()">
                            + êµ¬ì—­ ì¶”ê°€
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- êµ¬ì—­ ëª©ë¡ -->
            <div id="cellList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                <!-- êµ¬ì—­ ì¹´ë“œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
        
        <!-- êµ¬ì—­ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
        <div id="cellModal" class="modal">
            <div class="modal-content" style="max-width: 450px;">
                <div class="modal-header" style="background: linear-gradient(135deg, #3182ce, #2c5282);">
                    <h2 id="cellModalTitle">ìƒˆ êµ¬ì—­ ì¶”ê°€</h2>
                </div>
                <form id="cellForm">
                    <div class="form-group">
                        <label class="form-label">êµ¬ì—­ëª… *</label>
                        <input type="text" class="form-control" id="cellName" required placeholder="ì˜ˆ: ì„±ë ¹">
                    </div>
                    <div class="form-group">
                        <label class="form-label">êµ¬ì—­ì¥</label>
                        <select class="form-control" id="cellLeader">
                            <option value="">ì„ íƒ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">í…Œë§ˆ ìƒ‰ìƒ</label>
                        <select class="form-control" id="cellColor">
                            <option value="#3182ce">ë¸”ë£¨</option>
                            <option value="#38a169">ê·¸ë¦°</option>
                            <option value="#d69e2e">ê³¨ë“œ</option>
                            <option value="#e53e3e">ë ˆë“œ</option>
                            <option value="#805ad5">í¼í”Œ</option>
                            <option value="#dd6b20">ì˜¤ë Œì§€</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ëª¨ì„ ì‹œê°„</label>
                        <input type="text" class="form-control" id="cellMeeting" placeholder="ì˜ˆ: ë§¤ì£¼ ê¸ˆìš”ì¼ ì €ë… 7ì‹œ">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ëª¨ì„ ì¥ì†Œ</label>
                        <input type="text" class="form-control" id="cellLocation" placeholder="ì˜ˆ: êµ¬ì—­ì¥ ìíƒ">
                    </div>
                    <input type="hidden" id="cellEditIndex" value="-1">
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ì €ì¥</button>
                        <button type="button" class="btn btn-secondary" onclick="closeCellModal()">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- ë¶€ì„œê´€ë¦¬ -->
        <div id="department" class="section section-department">
            <!-- ë¶€ì„œ í—¤ë” -->
            <div class="card" style="background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%); color: white; margin-bottom: 20px;">
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
                    <div>
                        <h1 style="margin: 0; color: white; font-size: 1.8em;">ë¶€ì„œê´€ë¦¬</h1>
                        <p style="margin: 10px 0 0 0; opacity: 0.9;">ì€ì‚¬ë¥¼ ë”°ë¼ ì„¬ê¸°ëŠ” ì•„ë¦„ë‹¤ìš´ ê³µë™ì²´</p>
                    </div>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px;">
                            <div style="font-size: 1.8em; font-weight: bold;" id="totalDepartments">0</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">ì´ ë¶€ì„œ</div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px;">
                            <div style="font-size: 1.8em; font-weight: bold;" id="totalTeams">0</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">ì´ íŒ€</div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px;">
                            <div style="font-size: 1.8em; font-weight: bold;" id="totalDeptMembers">0</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">ë´‰ì‚¬ì</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ë¶€ì„œ ëª©ë¡ -->
            <div class="card" style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">ë¶€ì„œ ëª©ë¡</h2>
                    <button class="btn pastor-only" style="background: #805ad5; color: white; font-weight: 600; padding: 12px 20px; border: none; display: none;" onclick="showAddDepartmentModal()">
                        + ë¶€ì„œ ì¶”ê°€
                    </button>
                </div>
                <div id="departmentFullList">
                    <!-- ë¶€ì„œë³„ ì „ì²´ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <!-- ì—°ê°„ í–‰ì‚¬ ê³„íš -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <h2 style="margin: 0;">ì—°ê°„ í–‰ì‚¬ ê³„íš</h2>
                        <select id="eventYearSelect" onchange="loadYearlyEventCalendar()" class="form-control" style="width: auto; padding: 8px 15px; font-size: 1em; font-weight: 600;">
                            <!-- ë…„ë„ ì˜µì…˜ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </select>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" onclick="printYearlyEventCalendar()" style="background: #6b7280;">ì¸ì‡„</button>
                        <button class="btn btn-primary pastor-only" style="display: none;" onclick="showAddEventModal()">+ í–‰ì‚¬ ì¶”ê°€</button>
                    </div>
                </div>
                <div id="yearlyEventCalendar" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                    <!-- 12ê°œì›” ìº˜ë¦°ë”ê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
            </div>
        </div>
        
        <!-- ë¶€ì„œ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
        <div id="departmentModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header" style="background: linear-gradient(135deg, #1a1a2e, #16213e); color: white;">
                    <h2 id="deptModalTitle">â¬¢ ìƒˆ ë¶€ì„œ ì¶”ê°€</h2>
                </div>
                <form id="departmentForm">
                    <div class="form-group">
                        <label class="form-label">ë¶€ì„œëª… *</label>
                        <input type="text" class="form-control" id="deptName" required placeholder="ì˜ˆ: ì˜ˆë°°ë¶€">
                    </div>
                    <div class="form-group">
                        <label class="form-label">í…Œë§ˆ ìƒ‰ìƒ</label>
                        <select class="form-control" id="deptColor" style="font-size: 0.95em;">
                            <optgroup label="ğŸŒˆ ë°ì€ ìƒ‰ìƒ">
                                <option value="#3b82f6">â–  ìŠ¤ì¹´ì´ë¸”ë£¨</option>
                                <option value="#06b6d4">â–  ì‹œì•ˆ</option>
                                <option value="#10b981">â–  ì—ë©”ë„ë“œ</option>
                                <option value="#22c55e">â–  ê·¸ë¦°</option>
                                <option value="#84cc16">â–  ë¼ì„</option>
                                <option value="#eab308">â–  ì˜ë¡œìš°</option>
                                <option value="#f59e0b">â–  ì•°ë²„</option>
                                <option value="#f97316">â–  ì˜¤ë Œì§€</option>
                                <option value="#ef4444">â–  ë ˆë“œ</option>
                                <option value="#ec4899">â–  í•‘í¬</option>
                                <option value="#d946ef">â–  í‘¸ì‹œì•„</option>
                                <option value="#a855f7">â–  í¼í”Œ</option>
                                <option value="#8b5cf6">â–  ë°”ì´ì˜¬ë ›</option>
                                <option value="#6366f1">â–  ì¸ë””ê³ </option>
                            </optgroup>
                            <optgroup label="ğŸ¨ íŒŒìŠ¤í…” ìƒ‰ìƒ">
                                <option value="#93c5fd">â–  íŒŒìŠ¤í…” ë¸”ë£¨</option>
                                <option value="#a5f3fc">â–  íŒŒìŠ¤í…” ì‹œì•ˆ</option>
                                <option value="#86efac">â–  íŒŒìŠ¤í…” ê·¸ë¦°</option>
                                <option value="#fde047">â–  íŒŒìŠ¤í…” ì˜ë¡œìš°</option>
                                <option value="#fdba74">â–  íŒŒìŠ¤í…” ì˜¤ë Œì§€</option>
                                <option value="#fca5a5">â–  íŒŒìŠ¤í…” ë ˆë“œ</option>
                                <option value="#f9a8d4">â–  íŒŒìŠ¤í…” í•‘í¬</option>
                                <option value="#d8b4fe">â–  íŒŒìŠ¤í…” í¼í”Œ</option>
                            </optgroup>
                            <optgroup label="ğŸŒ™ ì–´ë‘ìš´ ìƒ‰ìƒ">
                                <option value="#1e3a5f">â–  ë„¤ì´ë¹„</option>
                                <option value="#1e40af">â–  ë‹¤í¬ë¸”ë£¨</option>
                                <option value="#7c3aed">â–  ë‹¤í¬í¼í”Œ</option>
                                <option value="#be185d">â–  ë‹¤í¬í•‘í¬</option>
                                <option value="#b91c1c">â–  ë‹¤í¬ë ˆë“œ</option>
                                <option value="#c2410c">â–  ë‹¤í¬ì˜¤ë Œì§€</option>
                                <option value="#15803d">â–  ë‹¤í¬ê·¸ë¦°</option>
                                <option value="#0f766e">â–  ë‹¤í¬ì‹œì•ˆ</option>
                                <option value="#4a5568">â–  ê·¸ë ˆì´</option>
                                <option value="#1f2937">â–  ì°¨ì½œ</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë¶€ì„œì¥</label>
                        <input type="text" class="form-control" id="deptLeader" placeholder="ë¶€ì„œì¥ ì´ë¦„">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë¶€ì„œ ì„¤ëª…</label>
                        <textarea class="form-control" id="deptDescription" rows="2" placeholder="ë¶€ì„œ ì†Œê°œ ë° í™œë™ ë‚´ìš©"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì •ê¸° ëª¨ì„</label>
                        <input type="text" class="form-control" id="deptMeeting" placeholder="ì˜ˆ: ë§¤ì£¼ í† ìš”ì¼ ì˜¤í›„ 3ì‹œ">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì—°ê°„ ì˜ˆì‚° ($)</label>
                        <input type="number" class="form-control" id="deptBudget" placeholder="0" step="100" min="0">
                    </div>
                    <input type="hidden" id="deptEditIndex" value="-1">
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ì €ì¥</button>
                        <button type="button" class="btn btn-secondary" onclick="closeDepartmentModal()">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- íŒ€ ì¶”ê°€ ëª¨ë‹¬ -->
        <div id="teamModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header" style="background: linear-gradient(135deg, #533483, #e94560); color: white;">
                    <h2 id="teamModalTitle">+ ìƒˆ íŒ€ ì¶”ê°€</h2>
                </div>
                <form id="teamForm">
                    <div class="form-group">
                        <label class="form-label">íŒ€ëª… *</label>
                        <input type="text" class="form-control" id="teamName" required placeholder="ì˜ˆ: 1ë¶€ ì°¬ì–‘íŒ€">
                    </div>
                    <div class="form-group">
                        <label class="form-label">íŒ€ì¥</label>
                        <input type="text" class="form-control" id="teamLeader" placeholder="íŒ€ì¥ ì´ë¦„">
                    </div>
                    <input type="hidden" id="teamEditIndex" value="-1">
                    <input type="hidden" id="teamDeptIndex" value="-1">
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ì €ì¥</button>
                        <button type="button" class="btn btn-secondary" onclick="closeTeamModal()">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- ì§€ì¶œ ê²°ì˜ì„œ ì‘ì„± ëª¨ë‹¬ -->
        <div id="expenseRequestModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header" style="background: linear-gradient(135deg, #e94560, #f5576c); color: white;">
                    <h2>ì§€ì¶œ ê²°ì˜ì„œ ì‘ì„±</h2>
                </div>
                <form id="expenseRequestForm">
                    <input type="hidden" id="expReqDeptIndex" value="-1">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ì§€ì¶œì¼ *</label>
                            <input type="date" class="form-control" id="expReqDate" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ê¸ˆì•¡ ($) *</label>
                            <input type="number" class="form-control" id="expReqAmount" required placeholder="0.00" step="0.01" min="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì§€ì¶œ í•­ëª© *</label>
                        <input type="text" class="form-control" id="expReqItem" required placeholder="ì˜ˆ: ì˜ˆë°° ìŒí–¥ì¥ë¹„ êµ¬ì…">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì§€ì¶œ ë¶„ë¥˜</label>
                        <select class="form-control" id="expReqCategory">
                            <option value="ë¬¼í’ˆêµ¬ì…">ë¬¼í’ˆêµ¬ì…</option>
                            <option value="í–‰ì‚¬ë¹„">í–‰ì‚¬ë¹„</option>
                            <option value="ì‹ë¹„">ì‹ë¹„</option>
                            <option value="êµí†µë¹„">êµí†µë¹„</option>
                            <option value="ì¸ì‡„ë¹„">ì¸ì‡„ë¹„</option>
                            <option value="ì‹œì„¤ìœ ì§€">ì‹œì„¤ìœ ì§€</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ê²°ì œ ë°©ë²•</label>
                        <select class="form-control" id="expReqPayment" onchange="handleExpReqPaymentChange()">
                            <option value="í˜„ê¸ˆ">í˜„ê¸ˆ</option>
                            <option value="Check">Check</option>
                            <option value="ì¹´ë“œ">ì¹´ë“œ</option>
                        </select>
                        <input type="text" class="form-control" id="expReqCheckNumber" placeholder="Check # ì…ë ¥" style="display: none; margin-top: 10px;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì˜ìˆ˜ì¦ ì²¨ë¶€</label>
                        <div style="border: 2px dashed #e2e8f0; border-radius: 10px; padding: 20px; text-align: center; cursor: pointer;" 
                             onclick="document.getElementById('receiptFile').click()">
                            <input type="file" id="receiptFile" accept="image/*" style="display: none;" onchange="handleReceiptUpload(event)">
                            <div id="receiptPreview">
                                <p style="color: #666; margin: 0;">í´ë¦­í•˜ì—¬ ì˜ìˆ˜ì¦ ì‚¬ì§„ ì—…ë¡œë“œ</p>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="expReqReceiptData" value="">
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ê²°ì˜ì„œ ì œì¶œ</button>
                        <button type="button" class="btn btn-secondary" onclick="closeExpenseRequestModal()">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- ë©˜í† ë§ -->
        <div id="mentor" class="section section-mentor">
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 30px;">
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
                    <div>
                        <h1 style="margin: 0; color: white; font-size: 2em;">ğŸ¤ ë©˜í† ë§ ì‚¬ì—­</h1>
                        <p style="margin: 10px 0 0 0; opacity: 0.9; font-size: 1.1em;">4ì£¼ ì–‘ìœ¡ í”„ë¡œê·¸ë¨ - ì‹ ì•™ì˜ ì„ ë°°ê°€ í›„ë°°ë¥¼ ì–‘ìœ¡í•˜ëŠ” ì•„ë¦„ë‹¤ìš´ ë™í–‰</p>
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <div style="text-align: center; background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 12px;">
                            <div style="font-size: 2em; font-weight: bold;" id="totalMentors">0</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">ë©˜í† </div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 12px;">
                            <div style="font-size: 2em; font-weight: bold;" id="totalMentees">0</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">ë©˜í‹°</div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 12px;">
                            <div style="font-size: 2em; font-weight: bold;" id="totalPairs">0</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">ë§¤ì¹­</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 4ì£¼ í”„ë¡œê·¸ë¨ ì•ˆë‚´ -->
            <div class="card" style="margin-bottom: 20px; background: linear-gradient(135deg, #f8f9ff, #f0f4ff); border-left: 4px solid #667eea;">
                <h3 style="margin: 0 0 15px 0; color: #667eea;">ğŸ“‹ 4ì£¼ ì–‘ìœ¡ í”„ë¡œê·¸ë¨ ì»¤ë¦¬í˜ëŸ¼</h3>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                    <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold; color: #667eea;">1ì£¼ì°¨</div>
                        <div style="font-size: 0.9em; color: #666; margin-top: 5px;">ì‹ ì•™ ê¸°ì´ˆ</div>
                        <div style="font-size: 0.8em; color: #888;">êµ¬ì›ì˜ í™•ì‹ </div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold; color: #764ba2;">2ì£¼ì°¨</div>
                        <div style="font-size: 0.9em; color: #666; margin-top: 5px;">ë§ì”€ê³¼ ê¸°ë„</div>
                        <div style="font-size: 0.8em; color: #888;">QT ìƒí™œ</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold; color: #9f7aea;">3ì£¼ì°¨</div>
                        <div style="font-size: 0.9em; color: #666; margin-top: 5px;">êµíšŒ ìƒí™œ</div>
                        <div style="font-size: 0.8em; color: #888;">ì˜ˆë°°ì™€ í—Œê¸ˆ</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold; color: #b794f4;">4ì£¼ì°¨</div>
                        <div style="font-size: 0.9em; color: #666; margin-top: 5px;">ì„¬ê¹€ê³¼ ì „ë„</div>
                        <div style="font-size: 0.8em; color: #888;">ë´‰ì‚¬ ì°¸ì—¬</div>
                    </div>
                </div>
            </div>
            
            <!-- ë©˜í† ë§ ê´€ê³„ ë° 4ì£¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">ğŸ“ ë©˜í† ë§ í˜„í™© ë° 4ì£¼ í”„ë¡œê·¸ë¨</h2>
                </div>
                <div id="mentoringProgramList">
                    <p style="text-align: center; color: #666; padding: 40px;">ë“±ë¡ëœ ë©˜í† ë§ ê´€ê³„ê°€ ì—†ìŠµë‹ˆë‹¤.<br>êµì¸ ë“±ë¡ì—ì„œ ë©˜í† /ë©˜í‹°ë¥¼ ì§€ì •í•˜ì„¸ìš”.</p>
                </div>
            </div>
        </div>
        
        <!-- ì¬ì •ê´€ë¦¬ -->
        <div id="offering" class="section section-offering">
            <!-- ì¬ì •ê´€ë¦¬ í—¤ë” -->
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 20px;">
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
                    <div>
                        <h1 style="margin: 0; color: white; font-size: 1.8em;">ì¬ì •ê´€ë¦¬</h1>
                        <p style="margin: 8px 0 0 0; opacity: 0.9;">êµíšŒ ì¬ì •ì„ íˆ¬ëª…í•˜ê²Œ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
                    </div>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px;">
                            <div style="font-size: 1.8em; font-weight: bold;" id="headerTotalIncome">$0</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">ì´ë²ˆë‹¬ ìˆ˜ì…</div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px;">
                            <div style="font-size: 1.8em; font-weight: bold;" id="headerTotalExpense">$0</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">ì´ë²ˆë‹¬ ì§€ì¶œ</div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px;">
                            <div style="font-size: 1.8em; font-weight: bold;" id="headerBalance">$0</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">ì”ì•¡</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ì¬ì •ê´€ë¦¬ ì„œë¸Œ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                <button class="finance-nav-item" onclick="showFinanceTab('dashboard')" id="financeNavDashboard" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 12px 25px; border: none; font-weight: 600; border-radius: 8px; cursor: pointer;">
                    ëŒ€ì‹œë³´ë“œ
                </button>
                <button class="finance-nav-item" onclick="showFinanceTab('income')" id="financeNavIncome" style="background: white; color: #333; padding: 12px 25px; border: 1px solid #e2e8f0; font-weight: 600; border-radius: 8px; cursor: pointer;">
                    ìˆ˜ì…
                </button>
                <button class="finance-nav-item" onclick="showFinanceTab('expense')" id="financeNavExpense" style="background: white; color: #333; padding: 12px 25px; border: 1px solid #e2e8f0; font-weight: 600; border-radius: 8px; cursor: pointer;">
                    ì§€ì¶œ
                </button>
            </div>
            
            <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
            <div id="financeTabDashboard" class="finance-tab active">
                <!-- ê²°ì œìš”ì²­ ì•Œë¦¼ ë°°ë„ˆ -->
                <div id="paymentAlertBanner" style="display: none; background: linear-gradient(135deg, #f6ad55, #ed8936); color: white; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; cursor: pointer;" onclick="showFinanceTab('expense')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span style="font-size: 1.2em; margin-right: 10px;">ğŸ“‹</span>
                            <strong>ê²°ì œìš”ì²­ì´ ìˆìŠµë‹ˆë‹¤!</strong>
                            <span id="dashPaymentCount" style="margin-left: 10px; background: white; color: #ed8936; padding: 3px 12px; border-radius: 15px; font-weight: bold;">0ê±´</span>
                        </div>
                        <span style="font-size: 0.9em;">í´ë¦­í•˜ì—¬ í™•ì¸ â†’</span>
                    </div>
                </div>
                
                <!-- ë³´ê³ ì„œ ë²„íŠ¼ ì˜ì—­ -->
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 20px;">
                    <button class="btn btn-success pastor-only" style="display: none;" onclick="showReportModal('irs')">IRS ì„¸ê¸ˆê³µì œ ì„œë¥˜</button>
                    <button class="btn btn-primary" onclick="showReportModal('council')">ì œì§íšŒ/ê³µë™ì˜íšŒ ë³´ê³ ì„œ</button>
                </div>
                
                <!-- ìˆ˜ì…/ì§€ì¶œ ìš”ì•½ ì¹´ë“œ -->
                <div class="dashboard-grid">
                    <div class="stat-card" style="--stat-color-1: #48bb78; --stat-color-2: #38a169;">
                        <div class="stat-label">ì´ë²ˆë‹¬ ì´ ìˆ˜ì…</div>
                        <div class="stat-value" id="dashTotalIncome">$0</div>
                    </div>
                    <div class="stat-card" style="--stat-color-1: #f56565; --stat-color-2: #e53e3e;">
                        <div class="stat-label">ì´ë²ˆë‹¬ ì´ ì§€ì¶œ</div>
                        <div class="stat-value" id="dashTotalExpense">$0</div>
                    </div>
                    <div class="stat-card" style="--stat-color-1: #4299e1; --stat-color-2: #3182ce;">
                        <div class="stat-label">ì´ë²ˆë‹¬ ì”ì•¡</div>
                        <div class="stat-value" id="dashBalance">$0</div>
                    </div>
                    <div class="stat-card" style="--stat-color-1: #9f7aea; --stat-color-2: #805ad5;">
                        <div class="stat-label">ì˜¬í•´ ëˆ„ì  ì”ì•¡</div>
                        <div class="stat-value" id="dashYearBalance">$0</div>
                    </div>
                </div>
                
                <!-- ì‹œê°í™” ì°¨íŠ¸ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- ìˆ˜ì… êµ¬ì„± (ì¢Œì¸¡) -->
                    <div class="card">
                        <h2>ğŸ¥§ ì´ë²ˆë‹¬ ìˆ˜ì… êµ¬ì„±</h2>
                        <div id="incomeBreakdown" style="padding: 20px;">
                            <!-- ìˆ˜ì… êµ¬ì„± ì°¨íŠ¸ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>
                    
                    <!-- ì§€ì¶œ êµ¬ì„± (ìš°ì¸¡) -->
                    <div class="card">
                        <h2>ğŸ’¸ ì´ë²ˆë‹¬ ì§€ì¶œ êµ¬ì„±</h2>
                        <div id="expenseBreakdown" style="padding: 20px;">
                            <!-- ì§€ì¶œ êµ¬ì„± ì°¨íŠ¸ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>
                </div>
                
                <!-- ì›”ë³„ ìˆ˜ì…/ì§€ì¶œ ë¹„êµ ë°” ì°¨íŠ¸ (ì•„ë˜ë¡œ ì´ë™) -->
                <div class="card" style="margin-top: 20px;">
                    <h2>ğŸ“ˆ ì›”ë³„ ìˆ˜ì…/ì§€ì¶œ í˜„í™©</h2>
                    <div id="monthlyChart" style="padding: 20px;">
                        <div style="display: flex; align-items: flex-end; justify-content: space-around; height: 250px; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px;">
                            <!-- ì°¨íŠ¸ ë°”ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                        <div style="display: flex; justify-content: center; gap: 30px; margin-top: 15px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #48bb78, #38a169); border-radius: 4px;"></div>
                                <span>ìˆ˜ì…</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #f56565, #e53e3e); border-radius: 4px;"></div>
                                <span>ì§€ì¶œ</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ìµœê·¼ ê±°ë˜ ë‚´ì—­ -->
                <div class="card" style="margin-top: 20px;">
                    <h2>ğŸ“‹ ìµœê·¼ ê±°ë˜ ë‚´ì—­</h2>
                    <div id="recentTransactions" style="max-height: 300px; overflow-y: auto;">
                        <p style="text-align: center; color: #666;">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
            
            <!-- ìˆ˜ì… íƒ­ -->
            <div id="financeTabIncome" class="finance-tab" style="display: none;">
                <!-- í—Œê¸ˆ í†µê³„ -->
                <div class="dashboard-grid">
                    <div class="stat-card" style="--stat-color-1: #718096; --stat-color-2: #4a5568;">
                        <div class="stat-label">ì§€ë‚œì£¼ í—Œê¸ˆ</div>
                        <div class="stat-value" id="totalOfferingLastWeek">$0</div>
                    </div>
                    <div class="stat-card" style="--stat-color-1: #ed8936; --stat-color-2: #dd6b20;">
                        <div class="stat-label">ì´ë²ˆì£¼ í—Œê¸ˆ</div>
                        <div class="stat-value" id="totalOfferingWeek">$0</div>
                    </div>
                    <div class="stat-card" style="--stat-color-1: #9f7aea; --stat-color-2: #805ad5;">
                        <div class="stat-label">ì§€ë‚œë‹¬ í—Œê¸ˆ</div>
                        <div class="stat-value" id="totalOfferingLastMonth">$0</div>
                    </div>
                    <div class="stat-card" style="--stat-color-1: #48bb78; --stat-color-2: #38a169;">
                        <div class="stat-label">ì´ë²ˆë‹¬ í—Œê¸ˆ</div>
                        <div class="stat-value" id="totalOfferingMonth">$0</div>
                    </div>
                </div>
                
                <!-- ì¢Œìš° ë ˆì´ì•„ì›ƒ: í—Œê¸ˆ ì…ë ¥(ì¢Œ) / í—Œê¸ˆ ë‚´ì—­(ìš°) -->
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px;">
                    <!-- ì™¼ìª½: í—Œê¸ˆ ì…ë ¥ -->
                    <div class="card">
                        <h2>ğŸ’° í—Œê¸ˆ ì…ë ¥</h2>
                        <form id="offeringForm">
                            <div class="form-group">
                                <label class="form-label">ë‚ ì§œ *</label>
                                <input type="date" class="form-control" id="offeringDate" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">í—Œê¸ˆì ì´ë¦„ *</label>
                                <input type="text" class="form-control" id="offeringName" required placeholder="ì´ë¦„ ì…ë ¥">
                            </div>
                            <div class="form-group">
                                <label class="form-label">í—Œê¸ˆ ì¢…ë¥˜ *</label>
                                <select class="form-control" id="offeringType" required>
                                    <option value="">ì„ íƒ</option>
                                    <option value="ì‹­ì¼ì¡°">ì‹­ì¼ì¡°</option>
                                    <option value="ê°ì‚¬í—Œê¸ˆ">ê°ì‚¬í—Œê¸ˆ</option>
                                    <option value="ì£¼ì¼í—Œê¸ˆ">ì£¼ì¼í—Œê¸ˆ</option>
                                    <option value="ê±´ì¶•í—Œê¸ˆ">ê±´ì¶•í—Œê¸ˆ</option>
                                    <option value="ì„ êµí—Œê¸ˆ">ì„ êµí—Œê¸ˆ</option>
                                    <option value="êµ¬ì œí—Œê¸ˆ">êµ¬ì œí—Œê¸ˆ</option>
                                    <option value="íŠ¹ë³„í—Œê¸ˆ">íŠ¹ë³„í—Œê¸ˆ</option>
                                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ê¸ˆì•¡ ($) *</label>
                                <input type="number" class="form-control" id="offeringAmount" required placeholder="0.00" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ê²°ì œ ë°©ë²•</label>
                                <select class="form-control" id="offeringPayment" onchange="handleOfferingPaymentChange()">
                                    <option value="í˜„ê¸ˆ">í˜„ê¸ˆ</option>
                                    <option value="Check">Check</option>
                                    <option value="ì²´í¬ì¹´ë“œ">ì²´í¬ì¹´ë“œ</option>
                                    <option value="ì‹ ìš©ì¹´ë“œ">ì‹ ìš©ì¹´ë“œ</option>
                                    <option value="ê³„ì¢Œì´ì²´">ê³„ì¢Œì´ì²´</option>
                                    <option value="ì˜¨ë¼ì¸í—Œê¸ˆ">ì˜¨ë¼ì¸í—Œê¸ˆ</option>
                                </select>
                                <input type="text" class="form-control" id="offeringCheckNumber" placeholder="Check # ì…ë ¥" style="display: none; margin-top: 10px;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ë©”ëª¨</label>
                                <input type="text" class="form-control" id="offeringMemo" placeholder="ë©”ëª¨ ì…ë ¥ (ì„ íƒì‚¬í•­)">
                            </div>
                            <div class="btn-group">
                                <button type="submit" class="btn btn-primary">í—Œê¸ˆ ë“±ë¡</button>
                                <button type="reset" class="btn btn-secondary">ì´ˆê¸°í™”</button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- ì˜¤ë¥¸ìª½: í—Œê¸ˆ ë‚´ì—­ -->
                    <div class="card">
                        <h2>ğŸ“‹ í—Œê¸ˆ ë‚´ì—­</h2>
                        <div class="form-row" style="margin-bottom: 20px;">
                            <div class="form-group">
                                <label class="form-label">ì¡°íšŒ ê¸°ê°„</label>
                                <select class="form-control" id="offeringPeriod" onchange="loadOfferingList()">
                                    <option value="week">ì´ë²ˆ ì£¼</option>
                                    <option value="month" selected>ì´ë²ˆ ë‹¬</option>
                                    <option value="quarter">ì´ë²ˆ ë¶„ê¸°</option>
                                    <option value="year">ì˜¬í•´</option>
                                    <option value="all">ì „ì²´</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">í—Œê¸ˆ ì¢…ë¥˜</label>
                                <select class="form-control" id="offeringFilterType" onchange="loadOfferingList()">
                                    <option value="all">ì „ì²´</option>
                                    <option value="ì‹­ì¼ì¡°">ì‹­ì¼ì¡°</option>
                                    <option value="ê°ì‚¬í—Œê¸ˆ">ê°ì‚¬í—Œê¸ˆ</option>
                                    <option value="ì£¼ì¼í—Œê¸ˆ">ì£¼ì¼í—Œê¸ˆ</option>
                                    <option value="ê±´ì¶•í—Œê¸ˆ">ê±´ì¶•í—Œê¸ˆ</option>
                                    <option value="ì„ êµí—Œê¸ˆ">ì„ êµí—Œê¸ˆ</option>
                                    <option value="êµ¬ì œí—Œê¸ˆ">êµ¬ì œí—Œê¸ˆ</option>
                                    <option value="íŠ¹ë³„í—Œê¸ˆ">íŠ¹ë³„í—Œê¸ˆ</option>
                                </select>
                            </div>
                            <div class="form-group" style="align-self: flex-end;">
                                <button type="button" class="btn btn-info" onclick="printOfferingList()">ğŸ–¨ï¸ ìˆ˜ì… ì¸ì‡„</button>
                            </div>
                        </div>
                        <div id="offeringList" style="max-height: 400px; overflow-y: auto;">
                            <p style="text-align: center; color: #666;">ë“±ë¡ëœ í—Œê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
                
                <!-- í—Œê¸ˆ ìˆœìœ„ (ì „ì²´ ë„ˆë¹„) -->
                <div class="card" style="margin-top: 20px;">
                    <h2>ğŸ† í—Œê¸ˆ ìˆœìœ„</h2>
                    <div class="form-group" style="margin-bottom: 15px;">
                        <select class="form-control" id="rankingPeriod" onchange="loadOfferingRanking()" style="width: auto;">
                            <option value="month" selected>ì´ë²ˆ ë‹¬</option>
                            <option value="year">ì˜¬í•´</option>
                            <option value="all">ì „ì²´</option>
                        </select>
                    </div>
                    <div id="offeringRankingList">
                        <p style="text-align: center; color: #666;">í—Œê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
            
            <!-- ì§€ì¶œ íƒ­ -->
            <div id="financeTabExpense" class="finance-tab" style="display: none;">
                <!-- ì§€ì¶œ í†µê³„ -->
                <div class="dashboard-grid">
                    <div class="stat-card" style="--stat-color-1: #f56565; --stat-color-2: #e53e3e;">
                        <div class="stat-label">ì˜¬í•´ ì´ ì˜ˆì‚°</div>
                        <div class="stat-value" id="totalBudgetYear">$0</div>
                    </div>
                    <div class="stat-card" style="--stat-color-1: #ed8936; --stat-color-2: #dd6b20;">
                        <div class="stat-label">ì˜¬í•´ ì´ ì§€ì¶œ</div>
                        <div class="stat-value" id="totalExpenseYear">$0</div>
                    </div>
                    <div class="stat-card" style="--stat-color-1: #48bb78; --stat-color-2: #38a169;">
                        <div class="stat-label">ì˜¬í•´ ì”ì—¬ ì˜ˆì‚°</div>
                        <div class="stat-value" id="remainingBudgetYear">$0</div>
                    </div>
                    <div class="stat-card" style="--stat-color-1: #4299e1; --stat-color-2: #3182ce;">
                        <div class="stat-label">ì˜ˆì‚° ì§‘í–‰ë¥ </div>
                        <div class="stat-value" id="budgetExecutionRate">0%</div>
                    </div>
                </div>
                
                <!-- ë²„íŠ¼ ì˜ì—­ -->
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 20px;">
                    <button class="btn btn-info" onclick="printExpenseList()">ğŸ–¨ï¸ ì§€ì¶œ ì¸ì‡„</button>
                    <button class="btn btn-primary" onclick="showBudgetModal()">ì˜ˆì‚° í¸ì„±</button>
                    <button class="btn btn-info" onclick="showCategoryModal()">ë¶„ë¥˜ ê´€ë¦¬</button>
                </div>
                
                <!-- ê²°ì œìš”ì²­ ëª©ë¡ -->
                <div class="card" style="margin-bottom: 20px; border-left: 4px solid #f6ad55;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h2 style="margin: 0; color: #ed8936;">ğŸ“‹ ê²°ì œìš”ì²­ ëª©ë¡</h2>
                        <span id="pendingPaymentCount" style="background: #f6ad55; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold;">0ê±´</span>
                    </div>
                    <div id="paymentRequestList">
                        <p style="text-align: center; color: #666; padding: 20px;">ëŒ€ê¸° ì¤‘ì¸ ê²°ì œìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
                
                <!-- ì¢Œìš° ë ˆì´ì•„ì›ƒ: ì§€ì¶œ ì…ë ¥(ì¢Œ) / ì§€ì¶œ ë‚´ì—­(ìš°) -->
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-top: 20px;">
                    <!-- ì™¼ìª½: ì§€ì¶œ ì…ë ¥ -->
                    <div class="card">
                        <h2>ğŸ’¸ ì§€ì¶œ ì…ë ¥</h2>
                        <form id="expenseForm">
                            <div class="form-group">
                                <label class="form-label">ë‚ ì§œ *</label>
                                <input type="date" class="form-control" id="expenseDate" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ë¶€ì„œ (ì˜ˆì‚° í•­ëª©) *</label>
                                <select class="form-control" id="expenseDepartment" required onchange="updateExpenseCategories()">
                                    <option value="">ì„ íƒ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ì§€ì¶œ ë¶„ë¥˜ *</label>
                                <select class="form-control" id="expenseCategory" required onchange="updateExpenseItems()">
                                    <option value="">ë¶€ì„œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ì§€ì¶œ í•­ëª© *</label>
                                <select class="form-control" id="expenseItemSelect" onchange="handleExpenseItemChange()">
                                    <option value="">ë¶„ë¥˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                                </select>
                                <input type="text" class="form-control" id="expenseItemCustom" placeholder="í•­ëª©ëª… ì§ì ‘ ì…ë ¥" style="display: none; margin-top: 10px;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ê¸ˆì•¡ ($) *</label>
                                <input type="number" class="form-control" id="expenseAmount" required placeholder="0.00" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ê²°ì œ ë°©ë²•</label>
                                <select class="form-control" id="expensePayment" onchange="handleExpensePaymentChange()">
                                    <option value="í˜„ê¸ˆ">í˜„ê¸ˆ</option>
                                    <option value="Check">Check</option>
                                    <option value="ì²´í¬ì¹´ë“œ">ì²´í¬ì¹´ë“œ</option>
                                    <option value="ì‹ ìš©ì¹´ë“œ">ì‹ ìš©ì¹´ë“œ</option>
                                    <option value="ê³„ì¢Œì´ì²´">ê³„ì¢Œì´ì²´</option>
                                    <option value="ìë™ì´ì²´">ìë™ì´ì²´</option>
                                </select>
                                <input type="text" class="form-control" id="expenseCheckNumber" placeholder="Check # ì…ë ¥" style="display: none; margin-top: 10px;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ë©”ëª¨</label>
                                <input type="text" class="form-control" id="expenseMemo" placeholder="ë©”ëª¨ ì…ë ¥ (ì„ íƒì‚¬í•­)">
                            </div>
                            <div class="btn-group">
                                <button type="submit" class="btn btn-danger">ì§€ì¶œ ë“±ë¡</button>
                                <button type="reset" class="btn btn-secondary">ì´ˆê¸°í™”</button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- ì˜¤ë¥¸ìª½: ì§€ì¶œ ë‚´ì—­ -->
                    <div class="card">
                        <h2>ğŸ“‹ ì§€ì¶œ ë‚´ì—­</h2>
                        <div class="form-row" style="margin-bottom: 20px;">
                            <div class="form-group">
                                <label class="form-label">ì¡°íšŒ ê¸°ê°„</label>
                                <select class="form-control" id="expensePeriod" onchange="loadExpenseList()">
                                    <option value="week">ì´ë²ˆ ì£¼</option>
                                    <option value="month" selected>ì´ë²ˆ ë‹¬</option>
                                    <option value="quarter">ì´ë²ˆ ë¶„ê¸°</option>
                                    <option value="year">ì˜¬í•´</option>
                                    <option value="all">ì „ì²´</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ë¶€ì„œ</label>
                                <select class="form-control" id="expenseFilterDepartment" onchange="loadExpenseList()">
                                    <option value="all">ì „ì²´</option>
                                </select>
                            </div>
                        </div>
                        <div id="expenseList" style="max-height: 400px; overflow-y: auto;">
                            <p style="text-align: center; color: #666;">ë“±ë¡ëœ ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
                
                <!-- ì§€ì¶œ ë¶„ë¥˜ë³„ í˜„í™© -->
                <div class="card" style="margin-top: 20px;">
                    <h2>ğŸ“Š ë¶€ì„œë³„ ì§€ì¶œ í˜„í™©</h2>
                    <div class="form-group" style="margin-bottom: 15px;">
                        <select class="form-control" id="expenseBreakdownPeriod" onchange="loadExpenseBreakdown()" style="width: auto;">
                            <option value="month" selected>ì´ë²ˆ ë‹¬</option>
                            <option value="year">ì˜¬í•´</option>
                            <option value="all">ì „ì²´</option>
                        </select>
                    </div>
                    <div id="expenseBreakdownList">
                        <p style="text-align: center; color: #666;">ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
                
                <!-- ë¶€ì„œë³„ ì˜ˆì‚° í˜„í™© ì‹œê°í™” (ë§¨ ì•„ë˜) -->
                <div class="card" style="margin-top: 20px;">
                    <h2>ğŸ“Š ë¶€ì„œë³„ ì˜ˆì‚° í˜„í™© (${new Date().getFullYear()}ë…„)</h2>
                    <div id="budgetVisualization">
                        <p style="text-align: center; color: #666;">ì˜ˆì‚°ì´ í¸ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. [ì˜ˆì‚° í¸ì„±] ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ì˜ˆì‚° í¸ì„± ëª¨ë‹¬ -->
        <div id="budgetModal" class="modal">
            <div class="modal-content" style="max-width: 700px;">
                <div class="modal-header">
                    <h2>ğŸ’° ${new Date().getFullYear()}ë…„ ì˜ˆì‚° í¸ì„±</h2>
                </div>
                <div id="budgetFormContainer">
                    <!-- ì˜ˆì‚° í¸ì„± í¼ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
                <div class="btn-group" style="justify-content: center;">
                    <button class="btn btn-success" onclick="addBudgetDepartment()">+ ë¶€ì„œ ì¶”ê°€</button>
                    <button class="btn btn-primary" onclick="saveBudget()">ì €ì¥</button>
                    <button class="btn btn-secondary" onclick="closeBudgetModal()">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
        
        <!-- ë¶„ë¥˜ ê´€ë¦¬ ëª¨ë‹¬ -->
        <div id="categoryModal" class="modal">
            <div class="modal-content" style="max-width: 700px;">
                <div class="modal-header">
                    <h2>ì§€ì¶œ ë¶„ë¥˜/í•­ëª© ê´€ë¦¬</h2>
                </div>
                
                <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <button id="catTabCategory" class="cat-tab" onclick="showCatTab('category')" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 12px 25px; border: none; font-weight: 600; border-radius: 8px; cursor: pointer;">
                        ë¶„ë¥˜ ê´€ë¦¬
                    </button>
                    <button id="catTabItem" class="cat-tab" onclick="showCatTab('item')" style="background: white; color: #333; padding: 12px 25px; border: 1px solid #e2e8f0; font-weight: 600; border-radius: 8px; cursor: pointer;">
                        í•­ëª© ê´€ë¦¬
                    </button>
                </div>
                
                <!-- ë¶„ë¥˜ ê´€ë¦¬ íƒ­ -->
                <div id="catTabContentCategory">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <!-- ë¶€ì„œ ì„ íƒ -->
                        <div>
                            <label class="form-label">ë¶€ì„œ ì„ íƒ</label>
                            <select class="form-control" id="categoryDeptSelect" onchange="loadDepartmentCategories()">
                                <option value="">ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <!-- ìƒˆ ë¶„ë¥˜ ì¶”ê°€ -->
                        <div>
                            <label class="form-label">ìƒˆ ë¶„ë¥˜ ì¶”ê°€</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" class="form-control" id="newCategoryName" placeholder="ë¶„ë¥˜ëª… ì…ë ¥">
                                <button class="btn btn-success" onclick="addCategory()">ì¶”ê°€</button>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h3 style="margin-bottom: 15px;">í˜„ì¬ ë¶„ë¥˜ ëª©ë¡</h3>
                        <div id="categoryList" style="max-height: 250px; overflow-y: auto;">
                            <p style="text-align: center; color: #666;">ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
                
                <!-- í•­ëª© ê´€ë¦¬ íƒ­ -->
                <div id="catTabContentItem" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <!-- ë¶€ì„œ ì„ íƒ -->
                        <div>
                            <label class="form-label">ë¶€ì„œ ì„ íƒ</label>
                            <select class="form-control" id="itemDeptSelect" onchange="loadDepartmentCategoriesForItem()">
                                <option value="">ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <!-- ë¶„ë¥˜ ì„ íƒ -->
                        <div>
                            <label class="form-label">ë¶„ë¥˜ ì„ íƒ</label>
                            <select class="form-control" id="itemCategorySelect" onchange="loadCategoryItems()">
                                <option value="">ë¶€ì„œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <label class="form-label">ìƒˆ í•­ëª© ì¶”ê°€</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" class="form-control" id="newItemName" placeholder="í•­ëª©ëª… ì…ë ¥">
                            <button class="btn btn-success" onclick="addItem()">ì¶”ê°€</button>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h3 style="margin-bottom: 15px;">ğŸ“‹ í˜„ì¬ í•­ëª© ëª©ë¡</h3>
                        <div id="itemList" style="max-height: 200px; overflow-y: auto;">
                            <p style="text-align: center; color: #666;">ë¶€ì„œì™€ ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
                
                <div class="btn-group" style="justify-content: center; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="closeCategoryModal()">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
        
        <!-- ì—°ê°„ í–‰ì‚¬ ì¶”ê°€ ëª¨ë‹¬ -->
        <div id="yearEventModal" class="modal">
            <div class="modal-content" style="max-width: 550px;">
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                    <h2>ğŸ“… ì—°ê°„ í–‰ì‚¬ ì¶”ê°€</h2>
                </div>
                <form id="yearEventForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ì›” *</label>
                            <select class="form-control" id="yearEventMonth" required onchange="syncDateFromMonth(this.value)">
                                <option value="1">1ì›”</option>
                                <option value="2">2ì›”</option>
                                <option value="3">3ì›”</option>
                                <option value="4">4ì›”</option>
                                <option value="5">5ì›”</option>
                                <option value="6">6ì›”</option>
                                <option value="7">7ì›”</option>
                                <option value="8">8ì›”</option>
                                <option value="9">9ì›”</option>
                                <option value="10">10ì›”</option>
                                <option value="11">11ì›”</option>
                                <option value="12">12ì›”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì‹œì‘ì¼</label>
                            <input type="date" class="form-control" id="yearEventDate" onchange="syncEventMonthFromDate(this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì¢…ë£Œì¼</label>
                            <input type="date" class="form-control" id="yearEventEndDate">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ì‹œì‘ ì‹œê°„</label>
                            <input type="time" class="form-control" id="yearEventStartTime">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì¢…ë£Œ ì‹œê°„</label>
                            <input type="time" class="form-control" id="yearEventEndTime">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">í–‰ì‚¬ëª… *</label>
                        <input type="text" class="form-control" id="yearEventName" required placeholder="ì˜ˆ: ë¶€í™œì ˆ ì˜ˆë°°">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ë‹´ë‹¹ ë¶€ì„œ</label>
                            <select class="form-control" id="yearEventDept">
                                <option value="">ì„ íƒ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ë‹´ë‹¹ì</label>
                            <input type="text" class="form-control" id="yearEventManager" placeholder="ë‹´ë‹¹ì ì´ë¦„">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ì˜ˆì‚° ($)</label>
                            <input type="number" class="form-control" id="yearEventBudget" placeholder="0" min="0" step="100">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ìƒíƒœ</label>
                            <select class="form-control" id="yearEventStatus">
                                <option value="ì˜ˆì •">ì˜ˆì •</option>
                                <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
                                <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë©”ëª¨</label>
                        <textarea class="form-control" id="yearEventMemo" rows="2" placeholder="í–‰ì‚¬ ê´€ë ¨ ë©”ëª¨"></textarea>
                    </div>
                    <input type="hidden" id="yearEventEditIndex" value="-1">
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ì €ì¥</button>
                        <button type="button" class="btn btn-secondary" onclick="closeYearEventModal()">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- ë³´ê³ ì„œ ëª¨ë‹¬ -->
        <div id="reportModal" class="modal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h2 id="reportModalTitle">ğŸ“„ ë³´ê³ ì„œ</h2>
                </div>
                
                <!-- IRS ì„¸ê¸ˆê³µì œ ì„œë¥˜ -->
                <div id="reportIRS" style="display: none;">
                    <div style="background: #f7fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">IRS Tax Deduction Contribution Statement</h3>
                        <p style="color: #666; margin-bottom: 15px;">Generate annual contribution statements for each member. Export to CSV for Google Sheets or print directly.</p>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Year</label>
                                <select class="form-control" id="irsYear">
                                    <option value="2025">2025</option>
                                    <option value="2024">2024</option>
                                    <option value="2023">2023</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Member</label>
                                <select class="form-control" id="irsMember">
                                    <option value="all">All Members</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div id="irsPreview" style="background: white; border: 1px solid #e2e8f0; border-radius: 10px; padding: 20px; max-height: 400px; overflow-y: auto;">
                        <p style="text-align: center; color: #666;">Select year and member, then click Preview.</p>
                    </div>
                    <div class="btn-group" style="justify-content: center; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="generateIRSReport()">ğŸ“‹ Preview</button>
                        <button class="btn btn-success" onclick="printIRSReport()">ğŸ–¨ï¸ Print</button>
                        <button class="btn btn-secondary" onclick="closeReportModal()">Close</button>
                    </div>
                </div>
                
                <!-- ì œì§íšŒ/ê³µë™ì˜íšŒ ë³´ê³ ì„œ -->
                <div id="reportCouncil" style="display: none;">
                    <div style="background: #f7fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">ì œì§íšŒ/ê³µë™ì˜íšŒ ì¬ì • ë³´ê³ ì„œ</h3>
                        <p style="color: #666; margin-bottom: 15px;">ê¸°ê°„ì„ ì„ íƒí•˜ì—¬ ìˆ˜ì…/ì§€ì¶œ ë³´ê³ ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (ìˆ˜ì…ì€ ìµëª… ì²˜ë¦¬)</p>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">ì‹œì‘ ë‚ ì§œ</label>
                                <input type="date" class="form-control" id="councilStartDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ì¢…ë£Œ ë‚ ì§œ</label>
                                <input type="date" class="form-control" id="councilEndDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ë³´ê³ ì„œ ì¢…ë¥˜</label>
                                <select class="form-control" id="councilReportType">
                                    <option value="both">ìˆ˜ì…/ì§€ì¶œ ì „ì²´</option>
                                    <option value="income">ìˆ˜ì…ë§Œ</option>
                                    <option value="expense">ì§€ì¶œë§Œ</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div id="councilPreview" style="background: white; border: 1px solid #e2e8f0; border-radius: 10px; padding: 20px; max-height: 500px; overflow-y: auto;">
                        <p style="text-align: center; color: #666;">ê¸°ê°„ì„ ì„ íƒí•˜ê³  ë¯¸ë¦¬ë³´ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”.</p>
                    </div>
                    <div class="btn-group" style="justify-content: center; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="generateCouncilReport()">ğŸ“‹ ë¯¸ë¦¬ë³´ê¸°</button>
                        <button class="btn btn-success" onclick="printCouncilReport()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
                        <button class="btn btn-secondary" onclick="closeReportModal()">ë‹«ê¸°</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- êµì  ê´€ë¦¬ -->
        <div id="members" class="section section-members">
            <!-- êµì ê´€ë¦¬ í—¤ë” -->
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 20px;">
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
                    <div>
                        <h1 style="margin: 0; color: white; font-size: 1.8em;">ğŸ‘¥ êµì ê´€ë¦¬</h1>
                        <p style="margin: 8px 0 0 0; opacity: 0.9;">Sacramento Glory Church êµì¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
                    </div>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px;">
                            <div style="font-size: 1.8em; font-weight: bold;" id="memberTotalCount">0</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">ì´ êµì¸</div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px;">
                            <div style="font-size: 1.8em; font-weight: bold;" id="memberNewCount">0</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">ì´ë²ˆë‹¬ ë“±ë¡</div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px;">
                            <div style="font-size: 1.8em; font-weight: bold;" id="memberCellCount">0</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">êµ¬ì—­ ë°°ì •</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                <button id="memberTabDashboard" onclick="showMemberTab('dashboard')" class="btn" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 12px 25px; border: none; font-weight: 600;">
                    ëŒ€ì‹œë³´ë“œ
                </button>
                <button id="memberTabRegister" onclick="showMemberTab('register')" class="btn" style="background: white; color: #333; padding: 12px 25px; border: 1px solid #e2e8f0; font-weight: 600;">
                    êµì¸ë“±ë¡
                </button>
                <button id="memberTabList" onclick="showMemberTab('list')" class="btn" style="background: white; color: #333; padding: 12px 25px; border: 1px solid #e2e8f0; font-weight: 600;">
                    êµì¸ëª©ë¡
                </button>
                <button id="memberTabStats" onclick="showMemberTab('stats')" class="btn" style="background: white; color: #333; padding: 12px 25px; border: 1px solid #e2e8f0; font-weight: 600;">
                    êµì¸í†µê³„
                </button>
            </div>
            
            <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
            <div id="memberDashboardTab">
                <!-- ìš”ì•½ ì¹´ë“œë“¤ -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div class="card" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; text-align: center; padding: 20px;">
                        <div style="font-size: 2.5em; margin-bottom: 5px;" id="dashTotalMembers">0</div>
                        <div style="opacity: 0.9;">ì´ êµì¸</div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white; text-align: center; padding: 20px;">
                        <div style="font-size: 2.5em; margin-bottom: 5px;" id="dashMaleCount">0</div>
                        <div style="opacity: 0.9;">ë‚¨ì„±</div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; text-align: center; padding: 20px;">
                        <div style="font-size: 2.5em; margin-bottom: 5px;" id="dashFemaleCount">0</div>
                        <div style="opacity: 0.9;">ì—¬ì„±</div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #f6ad55, #ed8936); color: white; text-align: center; padding: 20px;">
                        <div style="font-size: 2.5em; margin-bottom: 5px;" id="dashNewFamilyCount">0</div>
                        <div style="opacity: 0.9;">ìƒˆê°€ì¡± (3ê°œì›”)</div>
                    </div>
                </div>
                
                <!-- ìƒˆê°€ì¡± ëª…ë‹¨ (3ê°œì›” ì´ë‚´ ë“±ë¡) -->
                <div class="card" style="margin-bottom: 20px; border-left: 4px solid #ed8936;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0; color: #ed8936;">ìƒˆê°€ì¡± ëª…ë‹¨</h3>
                        <span style="font-size: 0.85em; color: #888;">ìµœê·¼ 3ê°œì›” ë‚´ ë“±ë¡</span>
                    </div>
                    <div id="dashNewFamilyList"></div>
                </div>
                
                <!-- ë¹ ë¥¸ í†µê³„ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="card">
                        <h3 style="margin: 0 0 15px 0;">ì§ë¶„ë³„ í˜„í™©</h3>
                        <div id="dashPositionStats"></div>
                    </div>
                    <div class="card">
                        <h3 style="margin: 0 0 15px 0;">êµ¬ì—­ë³„ í˜„í™©</h3>
                        <div id="dashCellStats"></div>
                    </div>
                </div>
                
                <!-- ìµœê·¼ ë“±ë¡ êµì¸ -->
                <div class="card" style="margin-top: 20px;">
                    <h3 style="margin: 0 0 15px 0;">ìµœê·¼ ë“±ë¡ êµì¸</h3>
                    <div id="dashRecentMembers"></div>
                </div>
            </div>
            
            <!-- êµì¸ë“±ë¡ íƒ­ -->
            <div id="memberRegisterTab" style="display: none;">
                <div class="card">
                    <h2>ğŸ“ êµì¸ ë“±ë¡</h2>
                <!-- êµì¸ ë“±ë¡ í¼ ê°œì„  ë²„ì „ -->
                <form id="memberForm">
                    <!-- ì‚¬ì§„ ì—…ë¡œë“œ ì„¹ì…˜ -->
                    <div style="display: flex; gap: 30px; margin-bottom: 25px; align-items: flex-start;">
                        <div style="flex-shrink: 0;">
                            <div id="memberPhotoPreview" style="width: 120px; height: 150px; border: 2px dashed #e2e8f0; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; background: #f8f9fa; overflow: hidden;" onclick="document.getElementById('memberPhoto').click()">
                                <div style="text-align: center; color: #999;">
                                    <div style="font-size: 2em;">ğŸ“·</div>
                                    <div style="font-size: 0.8em;">ì‚¬ì§„ ì¶”ê°€</div>
                                </div>
                            </div>
                            <input type="file" id="memberPhoto" accept="image/*" style="display: none;" onchange="handleMemberPhotoUpload(event)">
                            <input type="hidden" id="memberPhotoData" value="">
                        </div>
                        <div style="flex: 1;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">êµì¸ë²ˆí˜¸</label>
                                    <div style="display: flex; gap: 8px;">
                                        <input type="text" class="form-control" id="memberNumber" placeholder="ì˜ˆ: SGC-25-001" onblur="checkDuplicateMemberNumber(this.value)" style="flex: 1;">
                                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('memberNumber').value = generateMemberNumber()" style="padding: 8px 12px; font-size: 0.85em; white-space: nowrap;">ìë™ìƒì„±</button>
                                    </div>
                                    <small id="memberNumberStatus" style="font-size: 0.8em; margin-top: 3px; display: block;"></small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">í•œê¸€ ì´ë¦„ *</label>
                                    <input type="text" class="form-control" id="memberNameKr" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ì˜ë¬¸ ì´ë¦„</label>
                                    <input type="text" class="form-control" id="memberNameEn" inputmode="latin" autocapitalize="off" lang="en" style="ime-mode: disabled;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ì„±ë³„</label>
                                    <select class="form-control" id="memberGender">
                                        <option value="">ì„ íƒ</option>
                                        <option value="ë‚¨">ë‚¨</option>
                                        <option value="ì—¬">ì—¬</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ìƒë…„ì›”ì¼</label>
                            <input type="date" class="form-control" id="memberBirth" 
                                   placeholder="YYYY-MM-DD ë˜ëŠ” ë‹¬ë ¥ì—ì„œ ì„ íƒ"
                                   onchange="this.style.color='black'"
                                   style="color: #999;">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì „í™”ë²ˆí˜¸</label>
                            <input type="tel" class="form-control" id="memberPhone" placeholder="(916) 123-4567" oninput="formatPhoneNumber(this)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì´ë©”ì¼</label>
                            <input type="email" class="form-control" id="memberEmail" 
                                   inputmode="latin" autocapitalize="off" lang="en" style="ime-mode: disabled;"
                                   placeholder="email@example.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì§ë¶„</label>
                            <select class="form-control" id="memberPosition">
                                <option value="">ì„ íƒ</option>
                                <option value="ë‹´ì„ëª©ì‚¬">ë‹´ì„ëª©ì‚¬</option>
                                <option value="ì‹œë¬´ì¥ë¡œ">ì‹œë¬´ì¥ë¡œ</option>
                                <option value="ì•ˆìˆ˜ì§‘ì‚¬">ì•ˆìˆ˜ì§‘ì‚¬</option>
                                <option value="ê¶Œì‚¬">ê¶Œì‚¬</option>
                                <option value="ì§‘ì‚¬">ì§‘ì‚¬</option>
                                <option value="ì¸ë„ì">ì¸ë„ì</option>
                                <option value="ì„±ë„">ì„±ë„</option>
                                <option value="ì²­ë…„">ì²­ë…„</option>
                                <option value="í•™ìƒ">í•™ìƒ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì§ì—…</label>
                            <select class="form-control" id="memberJob">
                                <option value="">ì„ íƒ</option>
                                <option value="íšŒì‚¬ì›">íšŒì‚¬ì›</option>
                                <option value="ìì˜ì—…">ìì˜ì—…</option>
                                <option value="ì „ë¬¸ì§">ì „ë¬¸ì§ (ì˜ì‚¬/ë³€í˜¸ì‚¬/íšŒê³„ì‚¬ ë“±)</option>
                                <option value="êµìœ¡ì§">êµìœ¡ì§ (êµì‚¬/êµìˆ˜)</option>
                                <option value="ê³µë¬´ì›">ê³µë¬´ì›</option>
                                <option value="IT/ê¸°ìˆ ì§">IT/ê¸°ìˆ ì§</option>
                                <option value="ì˜ë£Œ/ë³´ê±´">ì˜ë£Œ/ë³´ê±´</option>
                                <option value="ì„œë¹„ìŠ¤ì—…">ì„œë¹„ìŠ¤ì—…</option>
                                <option value="ì£¼ë¶€">ì£¼ë¶€</option>
                                <option value="í•™ìƒ">í•™ìƒ</option>
                                <option value="ì€í‡´">ì€í‡´</option>
                                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ì£¼ì†Œ</label>
                            <input type="text" class="form-control" id="memberAddress" 
                                   inputmode="latin" autocapitalize="off" lang="en" style="ime-mode: disabled;"
                                   placeholder="1234 Main St">
                        </div>
                        <div class="form-group">
                            <label class="form-label">City</label>
                            <input type="text" class="form-control" id="memberCity" 
                                   inputmode="latin" autocapitalize="off" lang="en" style="ime-mode: disabled;"
                                   placeholder="Sacramento">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Zip</label>
                            <input type="text" class="form-control" id="memberZip" 
                                   inputmode="latin" autocapitalize="off" lang="en" style="ime-mode: disabled;"
                                   placeholder="95825" maxlength="10">
                        </div>
                        <div class="form-group">
                            <label class="form-label">êµ¬ì—­</label>
                            <select class="form-control" id="memberCell">
                                <option value="">ì„ íƒ</option>
                                <!-- êµ¬ì—­ ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ì„¸ëŒ€ì£¼ ê´€ê³„</label>
                            <select class="form-control" id="memberFamilyRole">
                                <option value="">ì„ íƒ</option>
                                <option value="ì„¸ëŒ€ì£¼">ì„¸ëŒ€ì£¼</option>
                                <option value="ë°°ìš°ì">ë°°ìš°ì</option>
                                <option value="ìë…€">ìë…€</option>
                                <option value="ë¶€ëª¨">ë¶€ëª¨</option>
                                <option value="ì¡°ë¶€ëª¨">ì¡°ë¶€ëª¨</option>
                                <option value="í˜•ì œìë§¤">í˜•ì œìë§¤</option>
                                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì„¸ëŒ€ì£¼ ì´ë¦„</label>
                            <input type="text" class="form-control" id="familyHead" 
                                   placeholder="ì„¸ëŒ€ì£¼ì¸ ê²½ìš° ë³¸ì¸ ì´ë¦„ ì…ë ¥">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì¸ë„ì</label>
                            <input type="text" class="form-control" id="memberReferrer" 
                                   placeholder="ì „ë„í•œ ë¶„ ì´ë¦„ (ìŠ¤ìŠ¤ë¡œ ì™”ìœ¼ë©´ ë¹ˆì¹¸)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ë“±ë¡ì¼</label>
                            <input type="date" class="form-control" id="memberRegDate">
                        </div>
                    </div>
                    
                    <!-- êµìœ¡ ì´ìˆ˜ í˜„í™© (ì¼ë°˜ í¼ í˜•íƒœ) -->
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ìƒˆê°€ì¡± ì„±ê²½ê³µë¶€</label>
                            <select class="form-control" id="eduNewFamily">
                                <option value="">ë¯¸ì´ìˆ˜</option>
                                <option value="completed">ì´ìˆ˜ì™„ë£Œ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì œì§í›ˆë ¨</label>
                            <select class="form-control" id="eduLeadership">
                                <option value="">ë¯¸ì´ìˆ˜</option>
                                <option value="completed">ì´ìˆ˜ì™„ë£Œ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì»¤í”¼ë¸Œë ˆì´í¬</label>
                            <select class="form-control" id="eduCoffeeBreak">
                                <option value="">ë¯¸ì´ìˆ˜</option>
                                <option value="completed">ì´ìˆ˜ì™„ë£Œ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ë©˜í† ë§ ì—­í• </label>
                            <select class="form-control" id="mentoringRole" onchange="handleMentoringRoleChange()">
                                <option value="">ì„ íƒì•ˆí•¨</option>
                                <option value="mentor">ë©˜í† </option>
                                <option value="mentee">ë©˜í‹°</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- ë©˜í† ë§ ìƒì„¸ ì •ë³´ -->
                    <div class="form-row" id="mentoringDetailRow" style="display: none;">
                        <div class="form-group" id="menteeNamesGroup" style="display: none;">
                            <label class="form-label">ë‹´ë‹¹ ë©˜í‹° ì´ë¦„</label>
                            <input type="text" class="form-control" id="menteeNames" placeholder="ë©˜í‹° ì´ë¦„ (ì‰¼í‘œë¡œ êµ¬ë¶„)">
                        </div>
                        <div class="form-group" id="mentorNameGroup" style="display: none;">
                            <label class="form-label">ë‹´ë‹¹ ë©˜í†  ì´ë¦„</label>
                            <input type="text" class="form-control" id="mentorName" placeholder="ë©˜í†  ì´ë¦„ ì…ë ¥">
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">êµì¸ ë“±ë¡</button>
                        <button type="reset" class="btn btn-secondary" onclick="resetMemberForm()">ì´ˆê¸°í™”</button>
                    </div>
                </form>
                </div>
            </div>
            
            <!-- êµì¸ëª©ë¡ íƒ­ -->
            <div id="memberListTab" style="display: none;">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h2 style="margin: 0;">ğŸ‘¥ êµì¸ ëª©ë¡</h2>
                        <button class="btn btn-success" onclick="printMembersList()">ğŸ–¨ï¸ êµì¸ ëª©ë¡ ì¸ì‡„</button>
                    </div>
                    <!-- êµìœ¡ í˜„í™© í•„í„° -->
                    <div style="display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; align-items: center;">
                        <span style="font-weight: 600; color: #4a5568;">ğŸ“š êµìœ¡ í•„í„°:</span>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" id="filterNewFamily" onchange="loadMembersList()">
                            <span>ìƒˆê°€ì¡± ì„±ê²½ê³µë¶€</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" id="filterLeadership" onchange="loadMembersList()">
                            <span>ì œì§í›ˆë ¨</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" id="filterCoffeeBreak" onchange="loadMembersList()">
                            <span>ì»¤í”¼ë¸Œë ˆì´í¬</span>
                        </label>
                        <select class="form-control" id="filterEduStatus" onchange="loadMembersList()" style="width: auto;">
                        <option value="all">ì „ì²´</option>
                        <option value="completed">ì´ìˆ˜ì™„ë£Œ</option>
                        <option value="notCompleted">ë¯¸ì´ìˆ˜</option>
                    </select>
                </div>
                <div id="membersList">
                    <!-- êµì¸ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                </div>
            </div>
            
            <!-- êµì¸í†µê³„ íƒ­ -->
            <div id="memberStatsTab" style="display: none;">
                <div class="card">
                    <h2 style="margin: 0 0 15px 0;">ğŸ“ˆ êµì¸ í†µê³„ ë¶„ì„</h2>
                    <!-- í†µê³„ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
                    <div style="display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button id="statTabAge" onclick="showMemberStats('age')" class="btn" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 10px 18px; border: none; font-weight: 600; font-size: 0.9em;">
                            ğŸ‘¶ ì—°ë ¹ë³„
                        </button>
                        <button id="statTabRegion" onclick="showMemberStats('region')" class="btn" style="background: white; color: #333; padding: 10px 18px; border: 1px solid #e2e8f0; font-weight: 600; font-size: 0.9em;">
                            ğŸ“ ì§€ì—­ë³„
                        </button>
                        <button id="statTabJob" onclick="showMemberStats('job')" class="btn" style="background: white; color: #333; padding: 10px 18px; border: 1px solid #e2e8f0; font-weight: 600; font-size: 0.9em;">
                            ğŸ’¼ ì§ì—…ë³„
                        </button>
                        <button id="statTabYear" onclick="showMemberStats('year')" class="btn" style="background: white; color: #333; padding: 10px 18px; border: 1px solid #e2e8f0; font-weight: 600; font-size: 0.9em;">
                            ğŸ“… ë“±ë¡ì—°ë„ë³„
                        </button>
                        <button id="statTabGender" onclick="showMemberStats('gender')" class="btn" style="background: white; color: #333; padding: 10px 18px; border: 1px solid #e2e8f0; font-weight: 600; font-size: 0.9em;">
                            ğŸ‘« ì„±ë³„
                        </button>
                        <button id="statTabPosition" onclick="showMemberStats('position')" class="btn" style="background: white; color: #333; padding: 10px 18px; border: 1px solid #e2e8f0; font-weight: 600; font-size: 0.9em;">
                            â›ª ì§ë¶„ë³„
                        </button>
                    </div>
                    <!-- í†µê³„ ì°¨íŠ¸ ì˜ì—­ -->
                    <div id="memberStatsChart" style="min-height: 300px;">
                        <!-- í†µê³„ ì°¨íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ì‚¬ìš©ìê´€ë¦¬ ì„¹ì…˜ -->
    <div id="users" class="section section-users">
        <div class="card" style="background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%); color: white; margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                <div>
                    <h1 style="margin: 0; color: white; font-size: 1.8em;">ì‚¬ìš©ì ê´€ë¦¬</h1>
                    <p style="margin: 8px 0 0 0; opacity: 0.9;">íšŒì› ê°€ì… ìŠ¹ì¸ ë° ê¶Œí•œ ê´€ë¦¬</p>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="font-size: 0.85em; opacity: 0.8;">í˜„ì¬ ë²„ì „: <span id="currentAppVersion"></span></span>
                    <button onclick="publishNewVersion()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        ğŸš€ ë²„ì „ ë°œí–‰
                    </button>
                </div>
            </div>
        </div>
        
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
            <button class="user-tab" onclick="showUserTab('requests')" id="userTabRequests" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 12px 25px; border: none; font-weight: 600; border-radius: 8px; cursor: pointer;">
                ê°€ì…ì‹ ì²­ <span id="pendingCount" style="background: #ef4444; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; margin-left: 5px;">0</span>
            </button>
            <button class="user-tab" onclick="showUserTab('list')" id="userTabList" style="background: white; color: #333; padding: 12px 25px; border: 1px solid #e2e8f0; font-weight: 600; border-radius: 8px; cursor: pointer;">
                íšŒì› ëª©ë¡
            </button>
        </div>
        
        <!-- ê°€ì…ì‹ ì²­ íƒ­ -->
        <div id="userRequestsTab" class="card">
            <h3 style="margin: 0 0 20px 0; color: #667eea;">ê°€ì… ëŒ€ê¸° ëª©ë¡</h3>
            <div id="signupRequestList">
                <p style="text-align: center; color: #718096; padding: 40px;">ê°€ì… ëŒ€ê¸°ì¤‘ì¸ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
        
        <!-- íšŒì›ëª©ë¡ íƒ­ -->
        <div id="userListTab" class="card" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; color: #667eea;">ë“±ë¡ëœ íšŒì›</h3>
                <div style="font-size: 0.85em; color: #666;">
                    ì²´í¬ë°•ìŠ¤ë¥¼ í´ë¦­í•˜ë©´ ê¶Œí•œì´ ì¦‰ì‹œ ì ìš©ë©ë‹ˆë‹¤
                </div>
            </div>
            <div style="overflow-x: auto;">
                <table id="userListTable" style="width: 100%; border-collapse: collapse; min-width: 900px;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                            <th style="padding: 12px 10px; text-align: left; font-weight: 600; white-space: nowrap;">ì´ë¦„</th>
                            <th style="padding: 12px 10px; text-align: left; font-weight: 600; white-space: nowrap;">ì•„ì´ë””</th>
                            <th style="padding: 12px 10px; text-align: center; font-weight: 600; white-space: nowrap;">ì—­í• </th>
                            <th style="padding: 12px 8px; text-align: center; font-weight: 600; font-size: 0.85em;">ëŒ€ì‹œë³´ë“œ</th>
                            <th style="padding: 12px 8px; text-align: center; font-weight: 600; font-size: 0.85em;">ì¶œì„ê´€ë¦¬</th>
                            <th style="padding: 12px 8px; text-align: center; font-weight: 600; font-size: 0.85em;">êµ¬ì—­ê´€ë¦¬</th>
                            <th style="padding: 12px 8px; text-align: center; font-weight: 600; font-size: 0.85em;">ë¶€ì„œê´€ë¦¬</th>
                            <th style="padding: 12px 8px; text-align: center; font-weight: 600; font-size: 0.85em;">ë©˜í† ë§</th>
                            <th style="padding: 12px 8px; text-align: center; font-weight: 600; font-size: 0.85em;">ì¬ì •ê´€ë¦¬</th>
                            <th style="padding: 12px 8px; text-align: center; font-weight: 600; font-size: 0.85em;">êµì ê´€ë¦¬</th>
                            <th style="padding: 12px 8px; text-align: center; font-weight: 600; font-size: 0.85em;">ì‚¬ìš©ìê´€ë¦¬</th>
                            <th style="padding: 12px 10px; text-align: center; font-weight: 600;">ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody id="userListTableBody">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </tbody>
                </table>
            </div>
            <div id="userListEmpty" style="text-align: center; color: #718096; padding: 40px; display: none;">
                ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.
            </div>
        </div>
    </div>
    
    <!-- ê°€ì…ì‹ ì²­ ëª¨ë‹¬ -->
    <div id="signupRequestModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #7c3aed, #5b21b6); color: white;">
                <h2>ê°€ì… ì‹ ì²­</h2>
                <button class="close-btn" onclick="closeSignupRequest()" style="color: white;">&times;</button>
            </div>
            <div class="modal-body" style="padding: 25px;">
                <div class="alert alert-info" style="margin-bottom: 20px;">
                    ê°€ì… ì‹ ì²­ í›„ ê´€ë¦¬ìë‹˜ì˜ ìŠ¹ì¸ì„ ë°›ìœ¼ì‹œë©´ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                </div>
                <div class="form-group">
                    <label class="form-label">ì´ë¦„ (ì‹¤ëª…) *</label>
                    <input type="text" class="form-control" id="reqName" required placeholder="í™ê¸¸ë™">
                </div>
                <div class="form-group">
                    <label class="form-label">ì‚¬ìš©ìëª… (ì˜ë¬¸) *</label>
                    <input type="text" class="form-control" id="reqUsername" required placeholder="ì˜ˆ: hong123">
                    <small style="color: #718096;">ë¡œê·¸ì¸ì‹œ ì‚¬ìš©í•  ì•„ì´ë””ì…ë‹ˆë‹¤</small>
                </div>
                <div class="form-group">
                    <label class="form-label">ë¹„ë°€ë²ˆí˜¸ *</label>
                    <input type="password" class="form-control" id="reqPassword" required placeholder="6ì ì´ìƒ">
                </div>
                <div class="form-group">
                    <label class="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸ *</label>
                    <input type="password" class="form-control" id="reqPasswordConfirm" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ì—°ë½ì²˜</label>
                    <input type="tel" class="form-control" id="reqPhone" placeholder="(000) 000-0000" oninput="formatPhoneNumber(this)">
                </div>
                <div class="form-group">
                    <label class="form-label">ì´ë©”ì¼</label>
                    <input type="email" class="form-control" id="reqEmail" placeholder="example@email.com">
                </div>
                <div class="form-group">
                    <label class="form-label">ì‹ ì²­ ë©”ëª¨</label>
                    <textarea class="form-control" id="reqMemo" rows="2" placeholder="ê°„ë‹¨í•œ ìê¸°ì†Œê°œ ë˜ëŠ” ë©”ëª¨"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSignupRequest()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="submitSignupRequest()">ì‹ ì²­í•˜ê¸°</button>
            </div>
        </div>
    </div>
    
    <!-- ê¶Œí•œ ì„¤ì • ëª¨ë‹¬ -->
    <div id="permissionModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #7c3aed, #5b21b6); color: white;">
                <h2>ê¶Œí•œ ì„¤ì •</h2>
                <button class="close-btn" onclick="closePermissionModal()" style="color: white;">&times;</button>
            </div>
            <div class="modal-body" style="padding: 25px;">
                <div style="margin-bottom: 20px; padding: 15px; background: #f8fafc; border-radius: 8px;">
                    <strong id="permUserName">ì‚¬ìš©ìëª…</strong>
                    <span id="permUserRole" style="margin-left: 10px; color: #718096;"></span>
                </div>
                <input type="hidden" id="permUserId">
                
                <!-- êµì  ì—°ê²° -->
                <h4 style="margin: 0 0 15px 0; color: #38a169;">êµì  ì—°ê²°</h4>
                <div style="margin-bottom: 20px; padding: 15px; background: #f0fdf4; border-radius: 8px; border: 1px solid #86efac;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #166534;">êµì  íšŒì› ì„ íƒ</label>
                    <select id="permMemberLink" class="form-control" style="width: 100%;">
                        <option value="">-- ì—°ê²° ì•ˆí•¨ --</option>
                    </select>
                    <small style="color: #166534; margin-top: 8px; display: block;">êµì ì— ë“±ë¡ëœ íšŒì›ê³¼ ì—°ê²°í•˜ë©´ "ë‚´ ì •ë³´"ì—ì„œ ì¶œì„/í—Œê¸ˆ ë‚´ì—­ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</small>
                </div>
                
                <h4 style="margin: 0 0 15px 0; color: #5b21b6;">ë©”ë‰´ ì ‘ê·¼ ê¶Œí•œ</h4>
                <div style="display: grid; gap: 12px;">
                    <label style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="permDashboard" style="width: 20px; height: 20px;">
                        <span>ëŒ€ì‹œë³´ë“œ</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="permAttendance" style="width: 20px; height: 20px;">
                        <span>ì¶œì„ê´€ë¦¬</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="permCell" style="width: 20px; height: 20px;">
                        <span>êµ¬ì—­ê´€ë¦¬</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="permDepartment" style="width: 20px; height: 20px;">
                        <span>ë¶€ì„œê´€ë¦¬</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="permMentor" style="width: 20px; height: 20px;">
                        <span>ë©˜í† ë§</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="permOffering" style="width: 20px; height: 20px;">
                        <span>ì¬ì •ê´€ë¦¬</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="permMembers" style="width: 20px; height: 20px;">
                        <span>êµì ê´€ë¦¬</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #fef2f2; border-radius: 8px; cursor: pointer; border: 1px solid #fecaca;">
                        <input type="checkbox" id="permUsers" style="width: 20px; height: 20px;">
                        <span style="color: #dc2626; font-weight: 600;">ì‚¬ìš©ìê´€ë¦¬ (ê´€ë¦¬ì)</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePermissionModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="savePermissions()">ì €ì¥</button>
            </div>
        </div>
    </div>
    
    <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ” ë¡œê·¸ì¸</h2>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">ì‚¬ìš©ìëª…</label>
                    <input type="text" class="form-control" id="username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">ë¡œê·¸ì¸</button>
                    <button type="button" class="btn btn-secondary" onclick="closeLogin()">ì·¨ì†Œ</button>
                </div>
            </form>
            <div class="alert alert-info" style="margin-top: 20px;">
                <small style="color: #666;">ì¼ë°˜ ì‚¬ìš©ìëŠ” ê°€ì…ì‹ ì²­ í›„ ìŠ¹ì¸ì„ ë°›ìœ¼ì„¸ìš”.</small>
            </div>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // ì „ì—­ ë³€ìˆ˜
        let currentUser = null;
        let members = [];
        let registeredUsers = [];
        let signupRequests = [];
        
        // Firebaseì—ì„œ ëª¨ë“  ë°ì´í„° ë¡œë“œ
        async function loadAllDataFromFirebase() {
            try {
                // êµì¸ ë°ì´í„° ë¡œë“œ
                const membersData = await loadFromFirestore('churchMembers');
                if (membersData && membersData.list) {
                    members = membersData.list;
                } else {
                    // localStorageì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜
                    members = JSON.parse(localStorage.getItem('churchMembers') || '[]');
                    if (members.length > 0) {
                        await saveToFirestore('churchMembers', { list: members });
                    }
                }
                
                // ë“±ë¡ëœ ì‚¬ìš©ì ë¡œë“œ
                const usersData = await loadFromFirestore('registeredUsers');
                if (usersData && usersData.list) {
                    registeredUsers = usersData.list;
                    localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                } else {
                    registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                    if (registeredUsers.length > 0) {
                        await saveToFirestore('registeredUsers', { list: registeredUsers });
                    }
                }
                
                // ê°€ì… ì‹ ì²­ ë¡œë“œ
                const requestsData = await loadFromFirestore('signupRequests');
                if (requestsData && requestsData.list) {
                    signupRequests = requestsData.list;
                    localStorage.setItem('signupRequests', JSON.stringify(signupRequests));
                } else {
                    signupRequests = JSON.parse(localStorage.getItem('signupRequests') || '[]');
                    if (signupRequests.length > 0) {
                        await saveToFirestore('signupRequests', { list: signupRequests });
                    }
                }
                
                // ì¶œì„ ë°ì´í„° ë¡œë“œ
                const attendanceData = await loadFromFirestore('attendanceRecords');
                if (attendanceData && attendanceData.list) {
                    localStorage.setItem('attendanceRecords', JSON.stringify(attendanceData.list));
                } else {
                    const localAttendance = JSON.parse(localStorage.getItem('attendanceRecords') || '[]');
                    if (localAttendance.length > 0) {
                        await saveToFirestore('attendanceRecords', { list: localAttendance });
                    }
                }
                
                // í—Œê¸ˆ ë°ì´í„° ë¡œë“œ
                const offeringsData = await loadFromFirestore('offerings');
                if (offeringsData && offeringsData.list) {
                    localStorage.setItem('offerings', JSON.stringify(offeringsData.list));
                } else {
                    const localOfferings = JSON.parse(localStorage.getItem('offerings') || '[]');
                    if (localOfferings.length > 0) {
                        await saveToFirestore('offerings', { list: localOfferings });
                    }
                }
                
                // êµ¬ì—­ ë°ì´í„° ë¡œë“œ
                const cellsData = await loadFromFirestore('cells');
                if (cellsData && cellsData.list) {
                    localStorage.setItem('cells', JSON.stringify(cellsData.list));
                } else {
                    const localCells = JSON.parse(localStorage.getItem('cells') || '[]');
                    if (localCells.length > 0) {
                        await saveToFirestore('cells', { list: localCells });
                    }
                }
                
                // ë¶€ì„œ ë°ì´í„° ë¡œë“œ
                const departmentsData = await loadFromFirestore('departments');
                if (departmentsData && departmentsData.list) {
                    localStorage.setItem('departments', JSON.stringify(departmentsData.list));
                    departments = departmentsData.list; // ì „ì—­ ë³€ìˆ˜ë„ ì—…ë°ì´íŠ¸!
                    console.log('Firebaseì—ì„œ ë¶€ì„œ ë°ì´í„° ë¡œë“œ:', departments.length + 'ê°œ');
                } else {
                    const localDepartments = JSON.parse(localStorage.getItem('departments') || '[]');
                    if (localDepartments.length > 0) {
                        await saveToFirestore('departments', { list: localDepartments });
                    }
                }
                
                // êµíšŒ êµ¬ì—­ ë°ì´í„° ë¡œë“œ
                const churchCellsData = await loadFromFirestore('churchCells');
                if (churchCellsData && churchCellsData.list) {
                    localStorage.setItem('churchCells', JSON.stringify(churchCellsData.list));
                } else {
                    const localChurchCells = JSON.parse(localStorage.getItem('churchCells') || '[]');
                    if (localChurchCells.length > 0) {
                        await saveToFirestore('churchCells', { list: localChurchCells });
                    }
                }
                
                // êµ¬ì—­ ì¶œì„ ë°ì´í„° ë¡œë“œ
                const cellAttendanceData = await loadFromFirestore('cellAttendance');
                if (cellAttendanceData && cellAttendanceData.data) {
                    localStorage.setItem('cellAttendance', JSON.stringify(cellAttendanceData.data));
                } else {
                    const localCellAttendance = JSON.parse(localStorage.getItem('cellAttendance') || '{}');
                    if (Object.keys(localCellAttendance).length > 0) {
                        await saveToFirestore('cellAttendance', { data: localCellAttendance });
                    }
                }
                
                // Sunday School ë°ì´í„° ë¡œë“œ
                const sundaySchoolData = await loadFromFirestore('sundaySchool');
                if (sundaySchoolData) {
                    if (sundaySchoolData.staff) {
                        localStorage.setItem('ssStaff', JSON.stringify(sundaySchoolData.staff));
                        console.log('Firebaseì—ì„œ Sunday School Staff ë¡œë“œ:', sundaySchoolData.staff.length + 'ëª…');
                    }
                    if (sundaySchoolData.videos) {
                        localStorage.setItem('sundayVideos', JSON.stringify(sundaySchoolData.videos));
                        console.log('Firebaseì—ì„œ Sunday School ì˜ìƒ ë¡œë“œ:', sundaySchoolData.videos.length + 'ê°œ');
                    }
                }
                
                // ìˆ˜ìš”ì˜ˆë°° ì˜ìƒ ë°ì´í„° ë¡œë“œ
                const wednesdayVideosData = await loadFromFirestore('wednesdayVideos');
                if (wednesdayVideosData && wednesdayVideosData.list) {
                    localStorage.setItem('wednesdayVideos', JSON.stringify(wednesdayVideosData.list));
                    console.log('Firebaseì—ì„œ ìˆ˜ìš”ì˜ˆë°° ì˜ìƒ ë¡œë“œ:', wednesdayVideosData.list.length + 'ê°œ');
                }
                
                // ìŠ¬ë¼ì´ë“œì‡¼ ë°ì´í„° ë¡œë“œ
                const heroSlidesData = await loadFromFirestore('heroSlides');
                if (heroSlidesData && heroSlidesData.list) {
                    // Firebase ë°ì´í„°ì™€ localStorage ë°ì´í„° ë³‘í•©
                    const localSlides = JSON.parse(localStorage.getItem('heroSlides') || '[]');
                    const mergedSlides = heroSlidesData.list.map((fbSlide, index) => {
                        // localStorageì— base64 ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ìœ ì§€
                        const localSlide = localSlides[index];
                        if (localSlide && localSlide.imageData && !fbSlide.imageData) {
                            fbSlide.imageData = localSlide.imageData;
                        }
                        return fbSlide;
                    });
                    heroSlides = mergedSlides;
                    localStorage.setItem('heroSlides', JSON.stringify(heroSlides));
                    console.log('Firebaseì—ì„œ ìŠ¬ë¼ì´ë“œ ë¡œë“œ:', heroSlides.length + 'ê°œ');
                }
                
                // ê°¤ëŸ¬ë¦¬ ë°ì´í„° ë¡œë“œ
                const galleryData = await loadFromFirestore('churchGallery');
                if (galleryData && galleryData.list) {
                    // Firebase ë°ì´í„°ì™€ localStorage ë°ì´í„° ë³‘í•©
                    const localGallery = JSON.parse(localStorage.getItem('churchGallery') || '[]');
                    const mergedGallery = galleryData.list.map((fbPhoto, index) => {
                        // localStorageì— base64 ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ìœ ì§€
                        const localPhoto = localGallery.find(p => p.uploadedAt === fbPhoto.uploadedAt);
                        if (localPhoto && localPhoto.image && !fbPhoto.image) {
                            fbPhoto.image = localPhoto.image;
                        }
                        return fbPhoto;
                    });
                    localStorage.setItem('churchGallery', JSON.stringify(mergedGallery));
                    console.log('Firebaseì—ì„œ ê°¤ëŸ¬ë¦¬ ë¡œë“œ:', mergedGallery.length + 'ê°œ');
                }
                
                firebaseReady = true;
                console.log('Firebase ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                
                // UI ì—…ë°ì´íŠ¸
                if (typeof loadMemberList === 'function') loadMemberList();
                if (typeof loadCellList === 'function') loadCellList();
                if (typeof loadDepartmentList === 'function') loadDepartmentList();
                if (typeof loadSSStaff === 'function') loadSSStaff();
                if (typeof loadSundayYoutube === 'function') loadSundayYoutube();
                if (typeof loadWednesdayYoutube === 'function') loadWednesdayYoutube();
                if (typeof initSlideshow === 'function') initSlideshow();
                if (typeof loadGallery === 'function') loadGallery();
                
            } catch (error) {
                console.error('Firebase ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ì‹œ localStorage ì‚¬ìš©
                members = JSON.parse(localStorage.getItem('churchMembers') || '[]');
            }
        }
        
        // êµì¸ ë°ì´í„° ì €ì¥ (Firebase + localStorage ë™ê¸°í™”)
        async function saveMembersToFirebase() {
            localStorage.setItem('churchMembers', JSON.stringify(members));
            if (firebaseReady) {
                await saveToFirestore('churchMembers', { list: members });
            }
        }
        
        // ì‚¬ìš©ì ë°ì´í„° ì €ì¥
        async function saveUsersToFirebase() {
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            if (firebaseReady) {
                await saveToFirestore('registeredUsers', { list: users });
            }
        }
        
        // ê°€ì…ì‹ ì²­ ë°ì´í„° ì €ì¥
        async function saveRequestsToFirebase() {
            const requests = JSON.parse(localStorage.getItem('signupRequests') || '[]');
            if (firebaseReady) {
                await saveToFirestore('signupRequests', { list: requests });
            }
        }
        
        // ì¶œì„ ë°ì´í„° ì €ì¥
        async function saveAttendanceToFirebase() {
            const attendance = JSON.parse(localStorage.getItem('attendanceRecords') || '[]');
            if (firebaseReady) {
                await saveToFirestore('attendanceRecords', { list: attendance });
            }
        }
        
        // í—Œê¸ˆ ë°ì´í„° ì €ì¥
        async function saveOfferingsToFirebase() {
            const offerings = JSON.parse(localStorage.getItem('offerings') || '[]');
            if (firebaseReady) {
                await saveToFirestore('offerings', { list: offerings });
            }
        }
        
        // êµ¬ì—­ ë°ì´í„° ì €ì¥
        async function saveCellsToFirebase() {
            const cells = JSON.parse(localStorage.getItem('cells') || '[]');
            if (firebaseReady) {
                await saveToFirestore('cells', { list: cells });
            }
        }
        
        // ë¶€ì„œ ë°ì´í„° ì €ì¥
        async function saveDepartmentsToFirebase() {
            const departments = JSON.parse(localStorage.getItem('departments') || '[]');
            if (firebaseReady) {
                await saveToFirestore('departments', { list: departments });
            }
        }
        
        // êµ¬ì—­(Cell) ë°ì´í„° ì €ì¥
        async function saveChurchCellsToFirebase() {
            const churchCells = JSON.parse(localStorage.getItem('churchCells') || '[]');
            if (firebaseReady) {
                await saveToFirestore('churchCells', { list: churchCells });
            }
        }
        
        // êµ¬ì—­ ì¶œì„ ë°ì´í„° ì €ì¥
        async function saveCellAttendanceToFirebase() {
            const cellAttendance = JSON.parse(localStorage.getItem('cellAttendance') || '{}');
            if (firebaseReady) {
                await saveToFirestore('cellAttendance', { data: cellAttendance });
            }
        }
        
        // ê°€ì…ì‹ ì²­ ì €ì¥
        async function saveSignupRequestsToFirebase() {
            const requests = JSON.parse(localStorage.getItem('signupRequests') || '[]');
            if (firebaseReady) {
                await saveToFirestore('signupRequests', { list: requests });
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ Firebase ë°ì´í„° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            loadAllDataFromFirebase();
        });

        // ì „í™”ë²ˆí˜¸ ìë™ í¬ë§·íŒ… í•¨ìˆ˜ (000) 000-0000
        function formatPhoneNumber(input) {
            let value = input.value.replace(/\D/g, ''); // ìˆ«ìë§Œ ì¶”ì¶œ
            
            if (value.length > 10) {
                value = value.substring(0, 10);
            }
            
            if (value.length >= 6) {
                input.value = '(' + value.substring(0, 3) + ') ' + value.substring(3, 6) + '-' + value.substring(6);
            } else if (value.length >= 3) {
                input.value = '(' + value.substring(0, 3) + ') ' + value.substring(3);
            } else if (value.length > 0) {
                input.value = '(' + value;
            } else {
                input.value = '';
            }
        }

        // êµì¸ë²ˆí˜¸ ìƒì„± í•¨ìˆ˜ - 1ë²ˆë¶€í„° ì‹œì‘
        function generateMemberNumber() {
            if (members.length === 0) {
                return 1;
            }
            // ê¸°ì¡´ êµì¸ ì¤‘ ê°€ì¥ í° ë²ˆí˜¸ ì°¾ê¸°
            const maxNumber = Math.max(...members.map(m => parseInt(m.number) || 0));
            return maxNumber + 1;
        }
        
        // ========== ìŠ¬ë¼ì´ë“œì‡¼ ==========
        let heroSlides = JSON.parse(localStorage.getItem('heroSlides') || 'null');
        let currentSlideIndex = 0;
        let slideAutoPlay = true;
        let slideTimer = null;
        let slideIntervalTime = 5000;
        
        // ê¸°ë³¸ ìƒ˜í”Œ ìŠ¬ë¼ì´ë“œ (5ì¥)
        const defaultSlides = [
            {
                type: 'gradient',
                background: 'linear-gradient(135deg, #1e3a5f 0%, #2d5a87 50%, #1a365d 100%)',
                title: 'ìƒˆí¬ë¼ë©˜í†  ì˜ê´‘êµíšŒ',
                subtitle: 'Sacramento Glory Church',
                text: 'ì˜¤ì§ ì„±ê²½, ì˜¤ì§ ê·¸ë¦¬ìŠ¤ë„, ì˜¤ì§ ë¯¿ìŒ, ì˜¤ì§ ì€í˜œ, ì˜¤ì§ í•˜ë‚˜ë‹˜ê»˜ ì˜ê´‘',
                subtext: 'Sola Scriptura Â· Solus Christus Â· Sola Fide Â· Sola Gratia Â· Soli Deo Gloria'
            },
            {
                type: 'gradient',
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                title: 'ì£¼ì¼ì˜ˆë°°ì— ì´ˆëŒ€í•©ë‹ˆë‹¤',
                subtitle: 'Sunday Worship Service',
                text: 'ë§¤ì£¼ ì£¼ì¼ ì˜¤ì „ 11ì‹œ',
                subtext: 'ì˜ˆë°°ë¥¼ í†µí•´ í•˜ë‚˜ë‹˜ê»˜ ì˜ê´‘ ëŒë¦¬ëŠ” ì‹œê°„ì— í•¨ê»˜í•˜ì„¸ìš”'
            },
            {
                type: 'gradient',
                background: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                title: 'ìˆ˜ìš” ê²½ë°°ì™€ ì°¬ì–‘',
                subtitle: 'Wednesday Praise & Worship',
                text: 'ë§¤ì£¼ ìˆ˜ìš”ì¼ ì €ë… 6:30',
                subtext: 'ì°¬ì–‘ê³¼ ë§ì”€ìœ¼ë¡œ í•œ ì£¼ì˜ ì¤‘ì‹¬ì„ ì„¸ì›Œê°€ëŠ” ì‹œê°„'
            },
            {
                type: 'gradient',
                background: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                title: 'Sunday School',
                subtitle: 'ì£¼ì¼í•™êµ',
                text: 'ë§¤ì£¼ ì£¼ì¼ ì˜¤ì „ 11ì‹œ',
                subtext: 'ì–´ë¦°ì´ë“¤ì´ ì˜ˆìˆ˜ë‹˜ì„ ë§Œë‚˜ëŠ” ì¦ê±°ìš´ ì‹œê°„'
            },
            {
                type: 'gradient',
                background: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                title: 'ìƒˆê°€ì¡±ì„ í™˜ì˜í•©ë‹ˆë‹¤',
                subtitle: 'Welcome New Family',
                text: 'ì²˜ìŒ ì˜¤ì‹  ë¶„ë“¤ì„ ìœ„í•œ ìƒˆê°€ì¡± í™˜ì˜íšŒ',
                subtext: 'ë”°ëœ»í•œ êµì œì™€ í•¨ê»˜ ì‹ ì•™ìƒí™œì„ ì‹œì‘í•˜ì„¸ìš”'
            }
        ];
        
        // ìŠ¬ë¼ì´ë“œì‡¼ ì´ˆê¸°í™”
        function initSlideshow() {
            if (!heroSlides) {
                heroSlides = defaultSlides;
                localStorage.setItem('heroSlides', JSON.stringify(heroSlides));
            }
            
            renderSlides();
            startSlideTimer();
        }
        
        // ìŠ¬ë¼ì´ë“œ ë Œë”ë§
        function renderSlides() {
            const container = document.getElementById('slidesContainer');
            const indicators = document.getElementById('slideIndicators');
            if (!container || !indicators) return;
            
            container.innerHTML = '';
            indicators.innerHTML = '';
            
            heroSlides.forEach((slide, index) => {
                // ìŠ¬ë¼ì´ë“œ ìƒì„±
                const slideDiv = document.createElement('div');
                slideDiv.className = 'hero-slide';
                slideDiv.style.cssText = `position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: ${index === 0 ? '1' : '0'}; transition: opacity 0.8s ease-in-out; pointer-events: ${index === 0 ? 'auto' : 'none'};`;
                
                // ì´ë¯¸ì§€ URL ë˜ëŠ” base64 ì´ë¯¸ì§€
                const imageSource = slide.imageUrl || slide.imageData;
                
                if (slide.type === 'image' && imageSource) {
                    // ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ
                    slideDiv.innerHTML = `
                        <div style="width: 100%; height: 100%; background: url('${imageSource}') center/cover no-repeat; position: relative;">
                            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.4);"></div>
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: white; width: 90%;">
                                ${slide.subtitle ? `<p style="margin: 0 0 8px 0; font-size: 0.9em; letter-spacing: 3px; opacity: 0.9; text-transform: uppercase;">${slide.subtitle}</p>` : ''}
                                ${slide.title ? `<h1 style="margin: 0; font-size: 2.5em; font-weight: 700; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">${slide.title}</h1>` : ''}
                                ${slide.text ? `<p style="margin: 20px auto 0; font-size: 1.15em; opacity: 0.95; max-width: 600px;">${slide.text}</p>` : ''}
                                ${slide.subtext ? `<p style="margin: 15px 0 0 0; opacity: 0.8; font-size: 0.9em;">${slide.subtext}</p>` : ''}
                            </div>
                        </div>
                    `;
                } else {
                    // ê·¸ë¼ë°ì´ì…˜ ìŠ¬ë¼ì´ë“œ
                    slideDiv.innerHTML = `
                        <div style="width: 100%; height: 100%; background: ${slide.background || 'linear-gradient(135deg, #1e3a5f, #2d5a87)'}; display: flex; align-items: center; justify-content: center; position: relative;">
                            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.05; background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âœ</text></svg>'); background-size: 80px; background-repeat: repeat;"></div>
                            <div style="text-align: center; color: white; padding: 40px; position: relative; z-index: 1;">
                                ${slide.subtitle ? `<p style="margin: 0 0 8px 0; font-size: 0.9em; letter-spacing: 3px; opacity: 0.85; text-transform: uppercase;">${slide.subtitle}</p>` : ''}
                                ${slide.title ? `<h1 style="margin: 0; font-size: 2.5em; font-weight: 700;">${slide.title}</h1>` : ''}
                                <div style="width: 60px; height: 2px; background: rgba(255,255,255,0.6); margin: 25px auto;"></div>
                                ${slide.text ? `<p style="margin: 0; font-size: 1.15em; opacity: 0.95; max-width: 600px;">${slide.text}</p>` : ''}
                                ${slide.subtext ? `<p style="margin: 20px 0 0 0; opacity: 0.7; font-size: 0.85em; letter-spacing: 1px;">${slide.subtext}</p>` : ''}
                            </div>
                        </div>
                    `;
                }
                container.appendChild(slideDiv);
                
                // ì¸ë””ì¼€ì´í„° ìƒì„±
                const dot = document.createElement('span');
                dot.className = 'slide-dot' + (index === 0 ? ' active' : '');
                dot.style.cssText = `width: 12px; height: 12px; border-radius: 50%; background: ${index === 0 ? 'white' : 'rgba(255,255,255,0.5)'}; cursor: pointer; transition: all 0.3s;`;
                dot.onclick = () => goToSlide(index);
                indicators.appendChild(dot);
            });
        }
        
        // ìŠ¬ë¼ì´ë“œ ì´ë™
        function goToSlide(index) {
            const slides = document.querySelectorAll('.hero-slide');
            const dots = document.querySelectorAll('.slide-dot');
            
            if (slides.length === 0) return;
            
            // ì´ì „ ìŠ¬ë¼ì´ë“œ ìˆ¨ê¹€
            slides[currentSlideIndex].style.opacity = '0';
            slides[currentSlideIndex].style.pointerEvents = 'none';
            dots[currentSlideIndex].style.background = 'rgba(255,255,255,0.5)';
            
            // ìƒˆ ì¸ë±ìŠ¤ ì„¤ì •
            currentSlideIndex = index;
            if (currentSlideIndex >= slides.length) currentSlideIndex = 0;
            if (currentSlideIndex < 0) currentSlideIndex = slides.length - 1;
            
            // ìƒˆ ìŠ¬ë¼ì´ë“œ í‘œì‹œ
            slides[currentSlideIndex].style.opacity = '1';
            slides[currentSlideIndex].style.pointerEvents = 'auto';
            dots[currentSlideIndex].style.background = 'white';
            
            // íƒ€ì´ë¨¸ ë¦¬ì…‹
            if (slideAutoPlay) {
                startSlideTimer();
            }
        }
        
        function nextSlide() {
            goToSlide(currentSlideIndex + 1);
        }
        
        function prevSlide() {
            goToSlide(currentSlideIndex - 1);
        }
        
        // ìë™ ì¬ìƒ
        function startSlideTimer() {
            if (slideTimer) clearInterval(slideTimer);
            if (slideAutoPlay && heroSlides.length > 1) {
                slideTimer = setInterval(() => {
                    nextSlide();
                }, slideIntervalTime);
            }
        }
        
        function toggleSlideAutoPlay() {
            slideAutoPlay = !slideAutoPlay;
            const btn = document.getElementById('slidePlayPause');
            if (btn) {
                btn.textContent = slideAutoPlay ? 'â¸' : 'â–¶';
                btn.title = slideAutoPlay ? 'ìë™ ì¬ìƒ ì¤‘' : 'ì¼ì‹œ ì •ì§€';
            }
            if (slideAutoPlay) {
                startSlideTimer();
            } else {
                if (slideTimer) clearInterval(slideTimer);
            }
        }
        
        // ìŠ¬ë¼ì´ë“œ í¸ì§‘ ëª¨ë‹¬
        function openSlideEditModal() {
            document.getElementById('slideEditModal').classList.add('active');
            loadSlideEditList();
        }
        
        function closeSlideEditModal() {
            document.getElementById('slideEditModal').classList.remove('active');
        }
        
        function loadSlideEditList() {
            const container = document.getElementById('slideEditList');
            if (!container) return;
            
            let html = '';
            heroSlides.forEach((slide, index) => {
                const bgStyle = slide.type === 'image' && slide.imageData 
                    ? `background: url('${slide.imageData}') center/cover` 
                    : slide.type === 'image' && slide.imageUrl 
                        ? `background: url('${slide.imageUrl}') center/cover`
                        : `background: ${slide.background || 'linear-gradient(135deg, #1e3a5f, #2d5a87)'}`;
                
                html += `
                    <div style="background: #f8fafc; border-radius: 10px; padding: 15px; border: 1px solid #e2e8f0;">
                        <div style="display: flex; gap: 15px; align-items: flex-start;">
                            <!-- ë¯¸ë¦¬ë³´ê¸° -->
                            <div style="width: 150px; height: 90px; border-radius: 8px; overflow: hidden; flex-shrink: 0; ${bgStyle};">
                            </div>
                            
                            <!-- í¸ì§‘ í¼ -->
                            <div style="flex: 1;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                    <input type="text" class="form-control" value="${slide.title || ''}" placeholder="ì œëª©" onchange="updateSlideField(${index}, 'title', this.value)" style="font-size: 0.9em;">
                                    <input type="text" class="form-control" value="${slide.subtitle || ''}" placeholder="ë¶€ì œëª©" onchange="updateSlideField(${index}, 'subtitle', this.value)" style="font-size: 0.9em;">
                                </div>
                                <input type="text" class="form-control" value="${slide.text || ''}" placeholder="ë³¸ë¬¸" onchange="updateSlideField(${index}, 'text', this.value)" style="font-size: 0.9em; margin-bottom: 10px;">
                                <input type="text" class="form-control" value="${slide.subtext || ''}" placeholder="í•˜ë‹¨ í…ìŠ¤íŠ¸" onchange="updateSlideField(${index}, 'subtext', this.value)" style="font-size: 0.9em; margin-bottom: 10px;">
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <input type="text" class="form-control" id="imageUrl_${index}" value="${slide.imageUrl || ''}" placeholder="ì´ë¯¸ì§€ URL ì…ë ¥ (Google Drive ê³µìœ  ë§í¬)" style="font-size: 0.85em; flex: 1;">
                                    <button onclick="setSlideImageUrl(${index})" class="btn" style="padding: 5px 10px; font-size: 0.8em; background: #38a169; color: white; white-space: nowrap;">URL ì ìš©</button>
                                </div>
                            </div>
                            
                            <!-- ë²„íŠ¼ë“¤ -->
                            <div style="display: flex; flex-direction: column; gap: 5px;">
                                <button onclick="uploadSlideImage(${index})" class="btn" style="padding: 5px 10px; font-size: 0.8em; background: #3182ce; color: white;">íŒŒì¼</button>
                                <button onclick="changeSlideGradient(${index})" class="btn" style="padding: 5px 10px; font-size: 0.8em; background: #805ad5; color: white;">ìƒ‰ìƒ</button>
                                ${index > 0 ? `<button onclick="moveSlide(${index}, -1)" class="btn" style="padding: 5px 10px; font-size: 0.8em;">â†‘</button>` : ''}
                                ${index < heroSlides.length - 1 ? `<button onclick="moveSlide(${index}, 1)" class="btn" style="padding: 5px 10px; font-size: 0.8em;">â†“</button>` : ''}
                                <button onclick="deleteSlide(${index})" class="btn" style="padding: 5px 10px; font-size: 0.8em; background: #e53e3e; color: white;">ì‚­ì œ</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html || '<p style="text-align: center; color: #666;">ìŠ¬ë¼ì´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }
        
        function updateSlideField(index, field, value) {
            if (heroSlides[index]) {
                heroSlides[index][field] = value;
            }
        }
        
        function addNewSlide() {
            heroSlides.push({
                type: 'gradient',
                background: 'linear-gradient(135deg, #667eea, #764ba2)',
                title: 'ìƒˆ ìŠ¬ë¼ì´ë“œ',
                subtitle: '',
                text: 'ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”',
                subtext: ''
            });
            loadSlideEditList();
        }
        
        function deleteSlide(index) {
            if (heroSlides.length <= 1) {
                alert('ìµœì†Œ 1ê°œì˜ ìŠ¬ë¼ì´ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            if (confirm('ì´ ìŠ¬ë¼ì´ë“œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                heroSlides.splice(index, 1);
                loadSlideEditList();
            }
        }
        
        function moveSlide(index, direction) {
            const newIndex = index + direction;
            if (newIndex >= 0 && newIndex < heroSlides.length) {
                const temp = heroSlides[index];
                heroSlides[index] = heroSlides[newIndex];
                heroSlides[newIndex] = temp;
                loadSlideEditList();
            }
        }
        
        function uploadSlideImage(index) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(ev) {
                        heroSlides[index].type = 'image';
                        heroSlides[index].imageData = ev.target.result;
                        heroSlides[index].imageUrl = ''; // íŒŒì¼ ì—…ë¡œë“œ ì‹œ URL ì´ˆê¸°í™”
                        loadSlideEditList();
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }
        
        // ì´ë¯¸ì§€ URL ì„¤ì • (Google Drive ë“±)
        function setSlideImageUrl(index) {
            let url = document.getElementById('imageUrl_' + index).value.trim();
            
            if (!url) {
                alert('ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            // Google Drive ë§í¬ ë³€í™˜
            if (url.includes('drive.google.com')) {
                // https://drive.google.com/file/d/FILE_ID/view í˜•ì‹
                const match = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
                if (match) {
                    url = 'https://drive.google.com/uc?export=view&id=' + match[1];
                }
            }
            
            heroSlides[index].type = 'image';
            heroSlides[index].imageUrl = url;
            heroSlides[index].imageData = ''; // URL ì‚¬ìš© ì‹œ base64 ì´ˆê¸°í™”
            
            loadSlideEditList();
            alert('ì´ë¯¸ì§€ URLì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        function changeSlideGradient(index) {
            const gradients = [
                'linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%)',
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                'linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)',
                'linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%)',
                'linear-gradient(135deg, #cd9cf2 0%, #f6f3ff 100%)'
            ];
            
            const currentIdx = gradients.indexOf(heroSlides[index].background);
            const nextIdx = (currentIdx + 1) % gradients.length;
            
            heroSlides[index].type = 'gradient';
            heroSlides[index].background = gradients[nextIdx];
            heroSlides[index].imageData = null;
            loadSlideEditList();
        }
        
        function saveSlides() {
            localStorage.setItem('heroSlides', JSON.stringify(heroSlides));
            
            // Firebaseì—ë„ ì €ì¥ (base64 ì´ë¯¸ì§€ ë°ì´í„° ì œì™¸)
            if (firebaseReady) {
                const slidesForFirebase = heroSlides.map(slide => {
                    const cleanSlide = {...slide};
                    // base64 ì´ë¯¸ì§€ ë°ì´í„°ëŠ” ì œì™¸ (ìš©ëŸ‰ ë¬¸ì œ)
                    if (cleanSlide.imageData && cleanSlide.imageData.startsWith('data:')) {
                        cleanSlide.imageData = '';
                    }
                    return cleanSlide;
                });
                
                db.collection('heroSlides').doc('main').set({ list: slidesForFirebase })
                    .then(() => console.log('ìŠ¬ë¼ì´ë“œ Firebase ì €ì¥ ì™„ë£Œ'))
                    .catch(e => console.log('ìŠ¬ë¼ì´ë“œ Firebase ì €ì¥ ì‹¤íŒ¨:', e));
            }
            
            renderSlides();
            currentSlideIndex = 0;
            goToSlide(0);
            closeSlideEditModal();
            alert('ìŠ¬ë¼ì´ë“œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        function updateSlideInterval() {
            const select = document.getElementById('slideInterval');
            if (select) {
                slideIntervalTime = parseInt(select.value);
                startSlideTimer();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            // í˜„ì¬ ë²„ì „ í‘œì‹œ
            const versionEl = document.getElementById('currentAppVersion');
            if (versionEl) versionEl.textContent = APP_VERSION;
            
            // ìŠ¬ë¼ì´ë“œì‡¼ ì´ˆê¸°í™”
            initSlideshow();
            
            // êµì¸ë²ˆí˜¸ ìë™ ìƒì„±
            document.getElementById('memberNumber').value = generateMemberNumber();
            
            // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ë“±ë¡ì¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
            document.getElementById('memberRegDate').valueAsDate = new Date();
            
            // êµì¸ ëª©ë¡ ë¡œë“œ
            loadMembersList();
            
            // ì˜ì–´ ì…ë ¥ í•„ë“œì— ìë™ ì˜ì–´ ëª¨ë“œ ì„¤ì •
            const englishFields = ['memberNameEn', 'memberEmail', 'memberAddress', 'memberCity', 'memberZip'];
            englishFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('focus', function() {
                        this.setAttribute('inputmode', 'latin');
                    });
                }
            });
            
            // ì£¼ë³´ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
            const dropZone = document.getElementById('bulletinDropZone');
            if (dropZone) {
                dropZone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#38b2ac';
                    this.style.background = '#e6fffa';
                });
                dropZone.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    if (!bulletinFileData) {
                        this.style.borderColor = '#cbd5e0';
                        this.style.background = '';
                    }
                });
                dropZone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    const file = e.dataTransfer.files[0];
                    if (file) {
                        document.getElementById('bulletinFileInput').files = e.dataTransfer.files;
                        handleBulletinFile(document.getElementById('bulletinFileInput'));
                    }
                });
            }
            
            // ìë™ ë¡œê·¸ì¸ ë¹„í™œì„±í™” (ë°°í¬ìš©)
            // autoLogin();
        });
        
        // ìë™ ë¡œê·¸ì¸ í•¨ìˆ˜ (ê°œë°œìš©)
        function autoLogin() {
            currentUser = { 
                username: 'gkc8127', 
                name: 'ì •ì¤€ì—°', 
                role: 'ê´€ë¦¬ì',
                permissions: ['dashboard', 'attendance', 'cell', 'department', 'mentor', 'offering', 'members', 'users']
            };
            
            document.getElementById('authButtons').style.display = 'none';
            document.getElementById('userDisplay').style.display = 'block';
            document.getElementById('userName').textContent = 'gkc8127';
            document.getElementById('userRole').textContent = 'ê´€ë¦¬ì';
            
            // íšŒì› ë©”ë‰´ í‘œì‹œ
            document.querySelectorAll('.member-only').forEach(el => {
                el.style.display = 'block';
            });
            
            // ëª©ì‚¬ ì „ìš© ë©”ë‰´ í‘œì‹œ (ëŒ€ì‹œë³´ë“œ, ì‚¬ìš©ìê´€ë¦¬)
            document.querySelectorAll('.pastor-only').forEach(el => {
                el.style.display = 'block';
            });
            
            // ëª¨ë“  ê¶Œí•œ ë©”ë‰´ í‘œì‹œ (pastorëŠ” ëª¨ë“  ê¶Œí•œ)
            document.querySelectorAll('.perm-dashboard, .perm-attendance, .perm-cell, .perm-department, .perm-mentor, .perm-offering, .perm-members, .perm-users').forEach(el => {
                el.style.display = 'block';
            });
            
            // ëŒ€ì‹œë³´ë“œ ë¡œë“œ
            setTimeout(() => {
                loadDashboard();
                loadSignupRequests();
                loadHomeLatestVideos();
            }, 100);
        }
        
        // ===================== ì‚¬ìš©ì ê´€ë¦¬ í•¨ìˆ˜ë“¤ =====================
        
        // ê°€ì…ì‹ ì²­ ëª¨ë‹¬ ì—´ê¸°
        function showSignupRequest() {
            document.getElementById('signupRequestModal').classList.add('active');
        }
        
        // ê°€ì…ì‹ ì²­ ëª¨ë‹¬ ë‹«ê¸°
        function closeSignupRequest() {
            document.getElementById('signupRequestModal').classList.remove('active');
            // í¼ ì´ˆê¸°í™”
            document.getElementById('reqName').value = '';
            document.getElementById('reqUsername').value = '';
            document.getElementById('reqPassword').value = '';
            document.getElementById('reqPasswordConfirm').value = '';
            document.getElementById('reqPhone').value = '';
            document.getElementById('reqEmail').value = '';
            document.getElementById('reqMemo').value = '';
        }
        
        // ê°€ì…ì‹ ì²­ ì œì¶œ
        function submitSignupRequest() {
            const name = document.getElementById('reqName').value.trim();
            const username = document.getElementById('reqUsername').value.trim();
            const password = document.getElementById('reqPassword').value;
            const passwordConfirm = document.getElementById('reqPasswordConfirm').value;
            const phone = document.getElementById('reqPhone').value.trim();
            const email = document.getElementById('reqEmail').value.trim();
            const memo = document.getElementById('reqMemo').value.trim();
            
            // ìœ íš¨ì„± ê²€ì‚¬
            if (!name || !username || !password) {
                alert('ì´ë¦„, ì‚¬ìš©ìëª…, ë¹„ë°€ë²ˆí˜¸ëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
                return;
            }
            
            if (password.length < 6) {
                alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (password !== passwordConfirm) {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì‚¬ìš©ìëª… ì¤‘ë³µ ê²€ì‚¬
            const requests = JSON.parse(localStorage.getItem('signupRequests') || '[]');
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            
            if (requests.some(r => r.username === username) || users.some(u => u.username === username) || username === 'pastor') {
                alert('ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤.');
                return;
            }
            
            // ì‹ ì²­ ì €ì¥
            const request = {
                id: Date.now(),
                name,
                username,
                password, // ì‹¤ì œë¡œëŠ” í•´ì‹± í•„ìš”
                phone,
                email,
                memo,
                requestDate: new Date().toISOString(),
                status: 'pending'
            };
            
            requests.push(request);
            localStorage.setItem('signupRequests', JSON.stringify(requests));
            saveSignupRequestsToFirebase(); // Firebase ë™ê¸°í™”
            
            alert('ê°€ì… ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\\nê´€ë¦¬ìë‹˜ì˜ ìŠ¹ì¸ í›„ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            closeSignupRequest();
        }
        
        // ê°€ì…ì‹ ì²­ ëª©ë¡ ë¡œë“œ
        function loadSignupRequests() {
            const requests = JSON.parse(localStorage.getItem('signupRequests') || '[]');
            const pending = requests.filter(r => r.status === 'pending');
            
            // ëŒ€ê¸° ê±´ìˆ˜ ì—…ë°ì´íŠ¸
            document.getElementById('pendingCount').textContent = pending.length;
            
            const container = document.getElementById('signupRequestList');
            
            if (pending.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #718096; padding: 40px;">ê°€ì… ëŒ€ê¸°ì¤‘ì¸ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '<div style="display: grid; gap: 15px;">';
            pending.forEach(req => {
                const date = new Date(req.requestDate).toLocaleDateString('ko-KR');
                html += `
                    <div style="background: #f8fafc; padding: 20px; border-radius: 12px; border-left: 4px solid #7c3aed;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 15px;">
                            <div>
                                <div style="font-size: 1.2em; font-weight: 600; color: #1e3a5f; margin-bottom: 8px;">${req.name}</div>
                                <div style="color: #718096; font-size: 0.9em;">
                                    <div>ì‚¬ìš©ìëª…: <strong>${req.username}</strong></div>
                                    ${req.phone ? `<div>ì—°ë½ì²˜: ${req.phone}</div>` : ''}
                                    ${req.email ? `<div>ì´ë©”ì¼: ${req.email}</div>` : ''}
                                    <div>ì‹ ì²­ì¼: ${date}</div>
                                    ${req.memo ? `<div style="margin-top: 8px; padding: 8px; background: white; border-radius: 6px;">ë©”ëª¨: ${req.memo}</div>` : ''}
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-success" onclick="approveRequest(${req.id})" style="padding: 8px 16px;">ìŠ¹ì¸</button>
                                <button class="btn btn-secondary" onclick="rejectRequest(${req.id})" style="padding: 8px 16px; background: #ef4444; color: white;">ê±°ì ˆ</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }
        
        // ê°€ì… ìŠ¹ì¸
        function approveRequest(requestId) {
            if (!confirm('ì´ ê°€ì… ì‹ ì²­ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const requests = JSON.parse(localStorage.getItem('signupRequests') || '[]');
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            
            const request = requests.find(r => r.id === requestId);
            if (!request) return;
            
            // ì‚¬ìš©ì ë“±ë¡
            const newUser = {
                id: Date.now(),
                username: request.username,
                password: request.password,
                name: request.name,
                phone: request.phone,
                email: request.email,
                role: 'ì„±ë„',
                permissions: [], // ê¸°ë³¸ì ìœ¼ë¡œ ê¶Œí•œ ì—†ìŒ
                registeredDate: new Date().toISOString(),
                approvedBy: 'pastor'
            };
            
            users.push(newUser);
            localStorage.setItem('registeredUsers', JSON.stringify(users));
            saveUsersToFirebase(); // Firebase ë™ê¸°í™”
            
            // ì‹ ì²­ ìƒíƒœ ë³€ê²½
            request.status = 'approved';
            localStorage.setItem('signupRequests', JSON.stringify(requests));
            saveRequestsToFirebase(); // Firebase ë™ê¸°í™”
            
            alert(`${request.name}ë‹˜ì˜ ê°€ì…ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            loadSignupRequests();
            loadRegisteredUsers();
        }
        
        // ê°€ì… ê±°ì ˆ
        function rejectRequest(requestId) {
            if (!confirm('ì´ ê°€ì… ì‹ ì²­ì„ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const requests = JSON.parse(localStorage.getItem('signupRequests') || '[]');
            const request = requests.find(r => r.id === requestId);
            if (!request) return;
            
            request.status = 'rejected';
            localStorage.setItem('signupRequests', JSON.stringify(requests));
            saveSignupRequestsToFirebase(); // Firebase ë™ê¸°í™”
            
            alert('ê°€ì… ì‹ ì²­ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.');
            loadSignupRequests();
        }
        
        // ë“±ë¡ëœ íšŒì› ëª©ë¡ ë¡œë“œ (ì‹œíŠ¸ í˜•íƒœ)
        function loadRegisteredUsers() {
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const tbody = document.getElementById('userListTableBody');
            const emptyMsg = document.getElementById('userListEmpty');
            const table = document.getElementById('userListTable');
            
            if (!tbody) return;
            
            if (users.length === 0) {
                tbody.innerHTML = '';
                if (table) table.style.display = 'none';
                if (emptyMsg) emptyMsg.style.display = 'block';
                return;
            }
            
            if (table) table.style.display = 'table';
            if (emptyMsg) emptyMsg.style.display = 'none';
            
            const permissionKeys = ['dashboard', 'attendance', 'cell', 'department', 'mentor', 'offering', 'members', 'users'];
            
            let html = '';
            users.forEach((user, index) => {
                const isPastor = user.role === 'ê´€ë¦¬ì';
                const rowBg = index % 2 === 0 ? '#ffffff' : '#f8fafc';
                
                html += `
                    <tr style="background: ${rowBg}; border-bottom: 1px solid #e2e8f0;">
                        <td style="padding: 12px 10px; font-weight: 600; color: #1e3a5f;">
                            ${user.name}
                            ${user.memberName ? `<br><small style="color: #16a34a; font-weight: normal;">âœ“ ${user.memberName}</small>` : ''}
                        </td>
                        <td style="padding: 12px 10px; color: #666;">@${user.username}</td>
                        <td style="padding: 12px 10px; text-align: center;">
                            <span style="background: ${isPastor ? '#7c3aed' : '#38b2ac'}; color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.8em;">
                                ${user.role}
                            </span>
                        </td>
                `;
                
                // ê¶Œí•œ ì²´í¬ë°•ìŠ¤ë“¤
                permissionKeys.forEach(perm => {
                    const checked = isPastor || (user.permissions && user.permissions.includes(perm));
                    const disabled = isPastor ? 'disabled' : '';
                    const cursor = isPastor ? 'not-allowed' : 'pointer';
                    
                    html += `
                        <td style="padding: 12px 8px; text-align: center;">
                            <input type="checkbox" 
                                   ${checked ? 'checked' : ''} 
                                   ${disabled}
                                   onchange="toggleUserPermission(${user.id}, '${perm}', this.checked)"
                                   style="width: 18px; height: 18px; cursor: ${cursor}; accent-color: #7c3aed;"
                                   title="${isPastor ? 'ê´€ë¦¬ìëŠ” ëª¨ë“  ê¶Œí•œ' : perm}">
                        </td>
                    `;
                });
                
                html += `
                        <td style="padding: 12px 10px; text-align: center;">
                            <button onclick="openPermissionModal(${user.id})" 
                                    style="background: #16a34a; color: white; border: none; padding: 5px 12px; border-radius: 5px; cursor: pointer; font-size: 0.85em; margin-right: 5px;"
                                    title="êµì  ì—°ê²° ë° ê¶Œí•œ ì„¤ì •">
                                êµì ì—°ê²°
                            </button>
                            ${isPastor ? '' : `<button onclick="deleteUser(${user.id})" 
                                    style="background: #ef4444; color: white; border: none; padding: 5px 12px; border-radius: 5px; cursor: pointer; font-size: 0.85em;">
                                ì‚­ì œ
                            </button>`}
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        // ê¶Œí•œ í† ê¸€ (ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ ì¦‰ì‹œ ì ìš©)
        function toggleUserPermission(userId, permission, isChecked) {
            let users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const userIndex = users.findIndex(u => u.id === userId);
            
            if (userIndex === -1) return;
            
            const user = users[userIndex];
            if (!user.permissions) user.permissions = [];
            
            if (isChecked) {
                // ê¶Œí•œ ì¶”ê°€
                if (!user.permissions.includes(permission)) {
                    user.permissions.push(permission);
                }
            } else {
                // ê¶Œí•œ ì œê±°
                user.permissions = user.permissions.filter(p => p !== permission);
            }
            
            users[userIndex] = user;
            localStorage.setItem('registeredUsers', JSON.stringify(users));
            
            // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ê¶Œí•œì´ ë³€ê²½ë˜ì—ˆìœ¼ë©´ ë©”ë‰´ ì—…ë°ì´íŠ¸
            if (currentUser && currentUser.id === userId) {
                currentUser.permissions = user.permissions;
                applyUserPermissions(currentUser.permissions);
            }
            
            // í”¼ë“œë°± í‘œì‹œ
            showPermissionToast(user.name, permission, isChecked);
        }
        
        // ê¶Œí•œ ë³€ê²½ ì•Œë¦¼ í‘œì‹œ
        function showPermissionToast(userName, permission, isGranted) {
            const permNames = {
                'dashboard': 'ëŒ€ì‹œë³´ë“œ',
                'attendance': 'ì¶œì„ê´€ë¦¬',
                'cell': 'êµ¬ì—­ê´€ë¦¬',
                'department': 'ë¶€ì„œê´€ë¦¬',
                'mentor': 'ë©˜í† ë§',
                'offering': 'ì¬ì •ê´€ë¦¬',
                'members': 'êµì ê´€ë¦¬',
                'users': 'ì‚¬ìš©ìê´€ë¦¬'
            };
            
            const message = `${userName}ë‹˜ì˜ ${permNames[permission] || permission} ê¶Œí•œì´ ${isGranted ? 'ë¶€ì—¬' : 'í•´ì œ'}ë˜ì—ˆìŠµë‹ˆë‹¤.`;
            
            // ê°„ë‹¨í•œ í† ìŠ¤íŠ¸ ë©”ì‹œì§€
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed; bottom: 20px; right: 20px; 
                background: ${isGranted ? '#16a34a' : '#ef4444'}; color: white; 
                padding: 12px 20px; border-radius: 8px; 
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 9999; font-size: 0.9em;
                animation: fadeIn 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }
        
        // ì‚¬ìš©ì íƒ­ ì „í™˜
        function showUserTab(tab) {
            document.getElementById('userRequestsTab').style.display = tab === 'requests' ? 'block' : 'none';
            document.getElementById('userListTab').style.display = tab === 'list' ? 'block' : 'none';
            
            // íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            const reqTab = document.getElementById('userTabRequests');
            const listTab = document.getElementById('userTabList');
            
            if (tab === 'requests') {
                reqTab.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                reqTab.style.color = 'white';
                reqTab.style.border = 'none';
                listTab.style.background = 'white';
                listTab.style.color = '#333';
                listTab.style.border = '1px solid #e2e8f0';
            } else {
                listTab.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                listTab.style.color = 'white';
                listTab.style.border = 'none';
                reqTab.style.background = 'white';
                reqTab.style.color = '#333';
                reqTab.style.border = '1px solid #e2e8f0';
            }
            
            if (tab === 'list') {
                loadRegisteredUsers();
            }
        }
        
        // ê¶Œí•œ ì„¤ì • ëª¨ë‹¬ ì—´ê¸°
        function openPermissionModal(userId) {
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            document.getElementById('permUserId').value = userId;
            document.getElementById('permUserName').textContent = user.name + ' (@' + user.username + ')';
            document.getElementById('permUserRole').textContent = user.role;
            
            // êµì  íšŒì› ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
            const memberSelect = document.getElementById('permMemberLink');
            memberSelect.innerHTML = '<option value="">-- ì—°ê²° ì•ˆí•¨ --</option>';
            members.forEach(m => {
                const selected = (user.memberId === m.id) ? 'selected' : '';
                memberSelect.innerHTML += `<option value="${m.id}" ${selected}>${m.nameKr} (${m.position || 'ì„±ë„'})</option>`;
            });
            
            // ê´€ë¦¬ì ì—¬ë¶€ í™•ì¸
            const isPastor = user.role === 'ê´€ë¦¬ì';
            
            // í˜„ì¬ ê¶Œí•œ ì²´í¬ (ê´€ë¦¬ìëŠ” ëª¨ë“  ê¶Œí•œ ì²´í¬ + ë¹„í™œì„±í™”)
            const permissionCheckboxes = ['permDashboard', 'permAttendance', 'permCell', 'permDepartment', 'permMentor', 'permOffering', 'permMembers', 'permUsers'];
            const permissionKeys = ['dashboard', 'attendance', 'cell', 'department', 'mentor', 'offering', 'members', 'users'];
            
            permissionCheckboxes.forEach((id, index) => {
                const checkbox = document.getElementById(id);
                if (isPastor) {
                    checkbox.checked = true;
                    checkbox.disabled = true;
                } else {
                    checkbox.checked = user.permissions.includes(permissionKeys[index]);
                    checkbox.disabled = false;
                }
            });
            
            document.getElementById('permissionModal').classList.add('active');
        }
        
        // ê¶Œí•œ ì„¤ì • ëª¨ë‹¬ ë‹«ê¸°
        function closePermissionModal() {
            document.getElementById('permissionModal').classList.remove('active');
        }
        
        // ê¶Œí•œ ì €ì¥
        function savePermissions() {
            const userId = parseInt(document.getElementById('permUserId').value);
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const userIndex = users.findIndex(u => u.id === userId);
            if (userIndex === -1) return;
            
            const permissions = [];
            if (document.getElementById('permDashboard').checked) permissions.push('dashboard');
            if (document.getElementById('permAttendance').checked) permissions.push('attendance');
            if (document.getElementById('permCell').checked) permissions.push('cell');
            if (document.getElementById('permDepartment').checked) permissions.push('department');
            if (document.getElementById('permMentor').checked) permissions.push('mentor');
            if (document.getElementById('permOffering').checked) permissions.push('offering');
            if (document.getElementById('permMembers').checked) permissions.push('members');
            if (document.getElementById('permUsers').checked) permissions.push('users');
            
            users[userIndex].permissions = permissions;
            
            // êµì  ì—°ê²° ì €ì¥
            const memberLinkValue = document.getElementById('permMemberLink').value;
            users[userIndex].memberId = memberLinkValue ? parseInt(memberLinkValue) : null;
            
            // ì—°ê²°ëœ êµì  íšŒì› ì´ë¦„ë„ ì €ì¥ (ë‚˜ì¤‘ì— í‘œì‹œìš©)
            if (memberLinkValue) {
                const linkedMember = members.find(m => m.id === parseInt(memberLinkValue));
                if (linkedMember) {
                    users[userIndex].memberName = linkedMember.nameKr;
                }
            } else {
                users[userIndex].memberName = null;
            }
            
            localStorage.setItem('registeredUsers', JSON.stringify(users));
            saveUsersToFirebase(); // Firebase ë™ê¸°í™”
            
            // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ê¶Œí•œì´ ë³€ê²½ëœ ê²½ìš° ì„¸ì…˜ ì—…ë°ì´íŠ¸
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser && currentUser.id === userId) {
                currentUser.permissions = permissions;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateMenuVisibility(); // ë©”ë‰´ ê°€ì‹œì„± ì—…ë°ì´íŠ¸
            }
            
            alert('ê¶Œí•œì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            closePermissionModal();
            loadRegisteredUsers();
        }
        
        // ì‚¬ìš©ì ì‚­ì œ
        function deleteUser(userId) {
            if (!confirm('ì´ ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\nì‚­ì œëœ ì‚¬ìš©ìëŠ” ë‹¤ì‹œ ê°€ì… ì‹ ì²­ì„ í•´ì•¼ í•©ë‹ˆë‹¤.')) return;
            
            let users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            users = users.filter(u => u.id !== userId);
            localStorage.setItem('registeredUsers', JSON.stringify(users));
            saveUsersToFirebase(); // Firebase ë™ê¸°í™”
            
            alert('ì‚¬ìš©ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            loadRegisteredUsers();
        }
        
        // ê¶Œí•œì— ë”°ë¥¸ ë©”ë‰´ í‘œì‹œ í•¨ìˆ˜
        function applyUserPermissions(permissions) {
            // ëª¨ë“  ê¶Œí•œ ë©”ë‰´ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.perm-dashboard, .perm-attendance, .perm-cell, .perm-department, .perm-mentor, .perm-offering, .perm-members, .perm-users').forEach(el => {
                el.style.display = 'none';
            });
            
            // ê¶Œí•œì— ë”°ë¼ ë©”ë‰´ í‘œì‹œ
            permissions.forEach(perm => {
                document.querySelectorAll('.perm-' + perm).forEach(el => {
                    el.style.display = 'block';
                });
            });
        }
        
        // ë©”ë‰´ ê°€ì‹œì„± ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateMenuVisibility() {
            if (!currentUser) {
                // ë¹„ë¡œê·¸ì¸ - ëª¨ë“  ê¶Œí•œ ë©”ë‰´ ìˆ¨ê¸°ê¸°
                document.querySelectorAll('.member-only, .perm-dashboard, .perm-attendance, .perm-cell, .perm-department, .perm-mentor, .perm-offering, .perm-members, .perm-users').forEach(el => {
                    el.style.display = 'none';
                });
                document.querySelectorAll('.pastor-only').forEach(el => {
                    el.style.display = 'none';
                });
            } else if (currentUser.role === 'ê´€ë¦¬ì') {
                // ê´€ë¦¬ì - ëª¨ë“  ë©”ë‰´ í‘œì‹œ
                document.querySelectorAll('.member-only').forEach(el => {
                    el.style.display = 'block';
                });
                document.querySelectorAll('.pastor-only').forEach(el => {
                    el.style.display = 'block';
                });
                document.querySelectorAll('.perm-dashboard, .perm-attendance, .perm-cell, .perm-department, .perm-mentor, .perm-offering, .perm-members, .perm-users').forEach(el => {
                    el.style.display = 'block';
                });
            } else {
                // ì¼ë°˜ ì„±ë„ - ê¶Œí•œì— ë”°ë¼ ë©”ë‰´ í‘œì‹œ
                document.querySelectorAll('.member-only').forEach(el => {
                    el.style.display = 'block';
                });
                document.querySelectorAll('.pastor-only').forEach(el => {
                    el.style.display = 'none';
                });
                applyUserPermissions(currentUser.permissions || []);
            }
        }

        // í¼ ì´ˆê¸°í™” í•¨ìˆ˜
        function resetMemberForm() {
            document.getElementById('memberForm').reset();
            document.getElementById('memberNumber').value = generateMemberNumber();
            document.getElementById('memberRegDate').valueAsDate = new Date();
            // ìˆ˜ì • ëª¨ë“œ í•´ì œ
            delete document.getElementById('memberForm').dataset.editingId;
            // êµì¸ë²ˆí˜¸ ìƒíƒœ ì´ˆê¸°í™”
            document.getElementById('memberNumberStatus').textContent = '';
            // ì§ì—… ì´ˆê¸°í™”
            document.getElementById('memberJob').value = '';
            // ì‚¬ì§„ ì´ˆê¸°í™”
            document.getElementById('memberPhotoData').value = '';
            document.getElementById('memberPhotoPreview').innerHTML = `
                <div style="text-align: center; color: #999;">
                    <div style="font-size: 2em;">ğŸ“·</div>
                    <div style="font-size: 0.8em;">ì‚¬ì§„ ì¶”ê°€</div>
                </div>
            `;
            // êµìœ¡ select ì´ˆê¸°í™”
            document.getElementById('eduNewFamily').value = '';
            document.getElementById('eduLeadership').value = '';
            document.getElementById('eduCoffeeBreak').value = '';
            // ë©˜í† ë§ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('mentoringRole').value = '';
            document.getElementById('menteeNames').value = '';
            document.getElementById('mentorName').value = '';
            document.getElementById('mentoringDetailRow').style.display = 'none';
            document.getElementById('menteeNamesGroup').style.display = 'none';
            document.getElementById('mentorNameGroup').style.display = 'none';
        }
        
        // ë©˜í† ë§ ì—­í•  ë³€ê²½ ì‹œ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
        function handleMentoringRoleChange() {
            const role = document.getElementById('mentoringRole').value;
            const detailRow = document.getElementById('mentoringDetailRow');
            const menteeGroup = document.getElementById('menteeNamesGroup');
            const mentorGroup = document.getElementById('mentorNameGroup');
            
            detailRow.style.display = 'none';
            menteeGroup.style.display = 'none';
            mentorGroup.style.display = 'none';
            
            if (role === 'mentor') {
                detailRow.style.display = 'flex';
                menteeGroup.style.display = 'block';
            } else if (role === 'mentee') {
                detailRow.style.display = 'flex';
                mentorGroup.style.display = 'block';
            }
        }

        // êµì¸ê´€ë¦¬ íƒ­ ì „í™˜
        function showMemberTab(tab) {
            // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
            document.getElementById('memberDashboardTab').style.display = tab === 'dashboard' ? 'block' : 'none';
            document.getElementById('memberRegisterTab').style.display = tab === 'register' ? 'block' : 'none';
            document.getElementById('memberListTab').style.display = tab === 'list' ? 'block' : 'none';
            document.getElementById('memberStatsTab').style.display = tab === 'stats' ? 'block' : 'none';
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            const tabs = ['dashboard', 'register', 'list', 'stats'];
            tabs.forEach(t => {
                const btn = document.getElementById('memberTab' + t.charAt(0).toUpperCase() + t.slice(1));
                if (btn) {
                    if (t === tab) {
                        btn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                        btn.style.color = 'white';
                        btn.style.border = 'none';
                    } else {
                        btn.style.background = 'white';
                        btn.style.color = '#333';
                        btn.style.border = '1px solid #e2e8f0';
                    }
                }
            });
            
            // íƒ­ë³„ ë°ì´í„° ë¡œë“œ
            if (tab === 'dashboard') loadMemberDashboard();
            if (tab === 'list') loadMembersList();
            if (tab === 'stats') showMemberStats('age');
        }
        
        // êµì¸ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ ë¡œë“œ
        function loadMemberDashboard() {
            const total = members.length;
            const male = members.filter(m => m.gender === 'ë‚¨').length;
            const female = members.filter(m => m.gender === 'ì—¬').length;
            const cellAssigned = members.filter(m => m.cell).length;
            
            // ìƒˆê°€ì¡± (3ê°œì›” ì´ë‚´ ë“±ë¡)
            const threeMonthsAgo = new Date();
            threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);
            const newFamilies = members.filter(m => {
                if (m.regDate) {
                    return new Date(m.regDate) >= threeMonthsAgo;
                }
                return false;
            }).sort((a, b) => new Date(b.regDate) - new Date(a.regDate)); // ìµœê·¼ ë“±ë¡ìˆœ ì •ë ¬
            
            // í—¤ë” í†µê³„
            document.getElementById('memberTotalCount').textContent = total;
            
            // ì´ë²ˆë‹¬ ë“±ë¡
            const thisMonth = new Date().toISOString().slice(0, 7);
            const newThisMonth = members.filter(m => {
                if (m.regDate) return m.regDate.startsWith(thisMonth);
                if (m.memberNumber) {
                    const match = m.memberNumber.match(/SGC-(\d{2})-/);
                    if (match) {
                        const yr = '20' + match[1];
                        const currentYear = new Date().getFullYear().toString();
                        return yr === currentYear;
                    }
                }
                return false;
            }).length;
            document.getElementById('memberNewCount').textContent = newThisMonth;
            document.getElementById('memberCellCount').textContent = cellAssigned;
            
            // ëŒ€ì‹œë³´ë“œ ì¹´ë“œ
            document.getElementById('dashTotalMembers').textContent = total;
            document.getElementById('dashMaleCount').textContent = male;
            document.getElementById('dashFemaleCount').textContent = female;
            
            // ìƒˆê°€ì¡± ìˆ˜
            const newFamilyCountEl = document.getElementById('dashNewFamilyCount');
            if (newFamilyCountEl) newFamilyCountEl.textContent = newFamilies.length;
            
            // ìƒˆê°€ì¡± ëª…ë‹¨ (êµì ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ)
            let newFamilyListHtml = '';
            if (newFamilies.length > 0) {
                newFamilyListHtml = '<div style="display: grid; gap: 10px;">';
                newFamilies.forEach(m => {
                    const regDate = m.regDate ? new Date(m.regDate) : null;
                    const daysAgo = regDate ? Math.floor((new Date() - regDate) / (1000 * 60 * 60 * 24)) : 0;
                    let timeLabel = '';
                    if (daysAgo === 0) timeLabel = 'ì˜¤ëŠ˜';
                    else if (daysAgo === 1) timeLabel = 'ì–´ì œ';
                    else if (daysAgo < 7) timeLabel = `${daysAgo}ì¼ ì „`;
                    else if (daysAgo < 30) timeLabel = `${Math.floor(daysAgo / 7)}ì£¼ ì „`;
                    else timeLabel = `${Math.floor(daysAgo / 30)}ê°œì›” ì „`;
                    
                    newFamilyListHtml += `
                        <div style="background: #fff8f0; padding: 12px 15px; border-radius: 10px; border-left: 3px solid #ed8936;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #ed8936, #f6ad55); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1em;">
                                        ${m.nameKr?.charAt(0) || '?'}
                                    </div>
                                    <div>
                                        <div style="font-weight: 600; color: #333;">${m.nameKr}</div>
                                        <div style="font-size: 0.8em; color: #888;">
                                            ${m.regDate || ''} <span style="color: #ed8936; font-weight: 500;">(${timeLabel})</span>
                                        </div>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 0.85em; color: #666;">${m.phone || '-'}</div>
                                    <div style="font-size: 0.75em; color: #999;">${m.position || 'ì„±ë„'}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                newFamilyListHtml += '</div>';
            } else {
                newFamilyListHtml = '<p style="color: #999; text-align: center; padding: 30px;">ìµœê·¼ 3ê°œì›” ë‚´ ìƒˆê°€ì¡±ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            const newFamilyListEl = document.getElementById('dashNewFamilyList');
            if (newFamilyListEl) newFamilyListEl.innerHTML = newFamilyListHtml;
            
            // ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ì˜ ìƒˆê°€ì¡± ëª…ë‹¨ë„ ì—°ë™ (dashNewFamilySummary)
            let newFamilySummaryHtml = '';
            if (newFamilies.length > 0) {
                newFamilies.forEach(m => {
                    newFamilySummaryHtml += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                            <div>
                                <span style="font-weight: 600;">${m.nameKr}</span>
                                <span style="font-size: 0.8em; color: #888; margin-left: 8px;">${m.regDate || ''}</span>
                            </div>
                            <a href="tel:${m.phone}" style="color: #3182ce; text-decoration: none; font-size: 0.85em;">
                                ${m.phone || '-'}
                            </a>
                        </div>
                    `;
                });
            } else {
                newFamilySummaryHtml = '<p style="color: #999; font-size: 0.9em; text-align: center; padding: 15px;">ìµœê·¼ 3ê°œì›” ë‚´ ìƒˆê°€ì¡± ì—†ìŒ</p>';
            }
            const newFamilySummaryEl = document.getElementById('dashNewFamilySummary');
            if (newFamilySummaryEl) newFamilySummaryEl.innerHTML = newFamilySummaryHtml;
            
            // ì§ë¶„ë³„ í˜„í™©
            const positionStats = {};
            members.forEach(m => {
                const pos = m.position || 'ë¯¸ë“±ë¡';
                positionStats[pos] = (positionStats[pos] || 0) + 1;
            });
            
            let posHtml = '';
            Object.entries(positionStats).sort((a, b) => b[1] - a[1]).forEach(([pos, cnt]) => {
                const pct = total > 0 ? Math.round((cnt / total) * 100) : 0;
                posHtml += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                        <span>${pos}</span>
                        <span style="font-weight: 600; color: #667eea;">${cnt}ëª… (${pct}%)</span>
                    </div>
                `;
            });
            document.getElementById('dashPositionStats').innerHTML = posHtml || '<p style="color: #999;">ë°ì´í„° ì—†ìŒ</p>';
            
            // êµ¬ì—­ë³„ í˜„í™©
            const cellsData = JSON.parse(localStorage.getItem('churchCells') || '[]');
            const cellStats = {};
            cellsData.forEach(c => cellStats[c.name] = 0);
            cellStats['ë¯¸ë°°ì •'] = 0;
            
            members.forEach(m => {
                const cellName = m.cell ? m.cell.replace('êµ¬ì—­', '') : 'ë¯¸ë°°ì •';
                if (cellStats.hasOwnProperty(cellName)) {
                    cellStats[cellName]++;
                } else {
                    cellStats['ë¯¸ë°°ì •']++;
                }
            });
            
            let cellHtml = '';
            Object.entries(cellStats).forEach(([cell, cnt]) => {
                const cellData = cellsData.find(c => c.name === cell);
                const color = cellData ? cellData.color : '#999';
                cellHtml += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                        <span style="color: ${color}; font-weight: 500;">${cell === 'ë¯¸ë°°ì •' ? cell : cell + 'êµ¬ì—­'}</span>
                        <span style="font-weight: 600;">${cnt}ëª…</span>
                    </div>
                `;
            });
            document.getElementById('dashCellStats').innerHTML = cellHtml || '<p style="color: #999;">ë°ì´í„° ì—†ìŒ</p>';
            
            // ìµœê·¼ ë“±ë¡ êµì¸ (ìµœê·¼ 5ëª…)
            const recentMembers = [...members].slice(-5).reverse();
            let recentHtml = '';
            if (recentMembers.length > 0) {
                recentHtml = '<div style="display: flex; flex-wrap: wrap; gap: 10px;">';
                recentMembers.forEach(m => {
                    recentHtml += `
                        <div style="background: #f8fafc; padding: 12px 15px; border-radius: 10px; display: flex; align-items: center; gap: 10px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                ${m.nameKr?.charAt(0) || '?'}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${m.nameKr}</div>
                                <div style="font-size: 0.85em; color: #888;">${m.position || 'ì„±ë„'}</div>
                            </div>
                        </div>
                    `;
                });
                recentHtml += '</div>';
            } else {
                recentHtml = '<p style="color: #999;">ë“±ë¡ëœ êµì¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            document.getElementById('dashRecentMembers').innerHTML = recentHtml;
            
            // ì´ë²ˆë‹¬/ë‹¤ìŒë‹¬ ìƒì¼ ë¡œë“œ
            loadBirthdayList();
        }
        
        // ìƒì¼ ëª©ë¡ ë¡œë“œ í•¨ìˆ˜
        function loadBirthdayList() {
            const now = new Date();
            const thisMonth = now.getMonth() + 1; // 1-12
            const nextMonth = thisMonth === 12 ? 1 : thisMonth + 1;
            
            // ìƒì¼ì´ ìˆëŠ” êµì¸ í•„í„°ë§
            const thisMonthBirthdays = [];
            const nextMonthBirthdays = [];
            
            members.forEach(m => {
                if (m.birth) {
                    const birthParts = m.birth.split('-');
                    if (birthParts.length >= 3) {
                        const birthMonth = parseInt(birthParts[1]);
                        const birthDay = parseInt(birthParts[2]);
                        
                        if (birthMonth === thisMonth) {
                            thisMonthBirthdays.push({ ...m, day: birthDay });
                        } else if (birthMonth === nextMonth) {
                            nextMonthBirthdays.push({ ...m, day: birthDay });
                        }
                    }
                }
            });
            
            // ë‚ ì§œìˆœ ì •ë ¬
            thisMonthBirthdays.sort((a, b) => a.day - b.day);
            nextMonthBirthdays.sort((a, b) => a.day - b.day);
            
            // ì´ë²ˆë‹¬ ìƒì¼ í‘œì‹œ
            let thisMonthHtml = '';
            if (thisMonthBirthdays.length > 0) {
                thisMonthBirthdays.forEach(m => {
                    const isToday = m.day === now.getDate();
                    thisMonthHtml += `
                        <div style="display: flex; align-items: center; gap: 8px; padding: 6px 0; border-bottom: 1px solid rgba(236,72,153,0.1); ${isToday ? 'background: #fff0f7; margin: -6px -8px; padding: 6px 8px; border-radius: 5px;' : ''}">
                            <span style="font-size: 1.1em;">${isToday ? 'ğŸ‚' : 'ğŸˆ'}</span>
                            <div style="flex: 1;">
                                <span style="font-weight: ${isToday ? '700' : '500'}; color: ${isToday ? '#be185d' : '#333'};">${m.nameKr}</span>
                                <span style="font-size: 0.8em; color: #888; margin-left: 5px;">${thisMonth}/${m.day}</span>
                            </div>
                        </div>
                    `;
                });
            } else {
                thisMonthHtml = '<p style="color: #999; font-size: 0.85em; text-align: center; padding: 10px;">ìƒì¼ì ì—†ìŒ</p>';
            }
            
            // ë‹¤ìŒë‹¬ ìƒì¼ í‘œì‹œ
            let nextMonthHtml = '';
            if (nextMonthBirthdays.length > 0) {
                nextMonthBirthdays.forEach(m => {
                    nextMonthHtml += `
                        <div style="display: flex; align-items: center; gap: 8px; padding: 6px 0; border-bottom: 1px solid rgba(236,72,153,0.1);">
                            <span style="font-size: 1.1em;">ğŸˆ</span>
                            <div style="flex: 1;">
                                <span style="font-weight: 500; color: #333;">${m.nameKr}</span>
                                <span style="font-size: 0.8em; color: #888; margin-left: 5px;">${nextMonth}/${m.day}</span>
                            </div>
                        </div>
                    `;
                });
            } else {
                nextMonthHtml = '<p style="color: #999; font-size: 0.85em; text-align: center; padding: 10px;">ìƒì¼ì ì—†ìŒ</p>';
            }
            
            // DOM ì—…ë°ì´íŠ¸
            const thisMonthEl = document.getElementById('dashThisMonthBirthday');
            const nextMonthEl = document.getElementById('dashNextMonthBirthday');
            
            if (thisMonthEl) thisMonthEl.innerHTML = thisMonthHtml;
            if (nextMonthEl) nextMonthEl.innerHTML = nextMonthHtml;
        }

        // êµì¸ í†µê³„ í‘œì‹œ
        function showMemberStats(type) {
            // íƒ­ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            const tabs = ['age', 'region', 'job', 'year', 'gender', 'position'];
            tabs.forEach(t => {
                const btn = document.getElementById('statTab' + t.charAt(0).toUpperCase() + t.slice(1));
                if (btn) {
                    if (t === type) {
                        btn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                        btn.style.color = 'white';
                        btn.style.border = 'none';
                    } else {
                        btn.style.background = 'white';
                        btn.style.color = '#333';
                        btn.style.border = '1px solid #e2e8f0';
                    }
                }
            });
            
            const container = document.getElementById('memberStatsChart');
            if (!container) return;
            
            if (members.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ë“±ë¡ëœ êµì¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let stats = {};
            let colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe', '#43e97b', '#38f9d7', '#ffecd2', '#fcb69f'];
            
            switch(type) {
                case 'age':
                    stats = calculateAgeStats();
                    break;
                case 'region':
                    stats = calculateRegionStats();
                    break;
                case 'job':
                    stats = calculateJobStats();
                    break;
                case 'year':
                    stats = calculateYearStats();
                    break;
                case 'gender':
                    stats = calculateGenderStats();
                    break;
                case 'position':
                    stats = calculatePositionStats();
                    break;
            }
            
            renderStatsChart(container, stats, colors, type);
        }
        
        // ì—°ë ¹ë³„ í†µê³„
        function calculateAgeStats() {
            const stats = { '10ëŒ€ ì´í•˜': 0, '20ëŒ€': 0, '30ëŒ€': 0, '40ëŒ€': 0, '50ëŒ€': 0, '60ëŒ€': 0, '70ëŒ€ ì´ìƒ': 0, 'ë¯¸ë“±ë¡': 0 };
            const currentYear = new Date().getFullYear();
            
            members.forEach(m => {
                if (m.birth) {
                    const birthYear = parseInt(m.birth.split('-')[0]);
                    const age = currentYear - birthYear;
                    if (age < 20) stats['10ëŒ€ ì´í•˜']++;
                    else if (age < 30) stats['20ëŒ€']++;
                    else if (age < 40) stats['30ëŒ€']++;
                    else if (age < 50) stats['40ëŒ€']++;
                    else if (age < 60) stats['50ëŒ€']++;
                    else if (age < 70) stats['60ëŒ€']++;
                    else stats['70ëŒ€ ì´ìƒ']++;
                } else {
                    stats['ë¯¸ë“±ë¡']++;
                }
            });
            return stats;
        }
        
        // ì§€ì—­ë³„ í†µê³„ (City ê¸°ì¤€)
        function calculateRegionStats() {
            const stats = {};
            members.forEach(m => {
                const region = m.city ? m.city.trim() : 'ë¯¸ë“±ë¡';
                stats[region] = (stats[region] || 0) + 1;
            });
            return stats;
        }
        
        // ì§ì—…ë³„ í†µê³„
        function calculateJobStats() {
            const stats = {};
            members.forEach(m => {
                const job = m.job || 'ë¯¸ë“±ë¡';
                stats[job] = (stats[job] || 0) + 1;
            });
            return stats;
        }
        
        // ë“±ë¡ì—°ë„ë³„ í†µê³„
        function calculateYearStats() {
            const stats = {};
            members.forEach(m => {
                let year = 'ë¯¸ë“±ë¡';
                if (m.regDate) {
                    year = m.regDate.split('-')[0] + 'ë…„';
                } else if (m.memberNumber) {
                    // êµì¸ë²ˆí˜¸ì—ì„œ ì—°ë„ ì¶”ì¶œ (ì˜ˆ: SGC-25-001)
                    const match = m.memberNumber.match(/SGC-(\d{2})-/);
                    if (match) {
                        year = '20' + match[1] + 'ë…„';
                    }
                }
                stats[year] = (stats[year] || 0) + 1;
            });
            return stats;
        }
        
        // ì„±ë³„ í†µê³„
        function calculateGenderStats() {
            const stats = { 'ë‚¨': 0, 'ì—¬': 0, 'ë¯¸ë“±ë¡': 0 };
            members.forEach(m => {
                if (m.gender === 'ë‚¨') stats['ë‚¨']++;
                else if (m.gender === 'ì—¬') stats['ì—¬']++;
                else stats['ë¯¸ë“±ë¡']++;
            });
            return stats;
        }
        
        // ì§ë¶„ë³„ í†µê³„
        function calculatePositionStats() {
            const stats = {};
            members.forEach(m => {
                const position = m.position || 'ë¯¸ë“±ë¡';
                stats[position] = (stats[position] || 0) + 1;
            });
            return stats;
        }
        
        // í†µê³„ ì°¨íŠ¸ ë Œë”ë§
        function renderStatsChart(container, stats, colors, type) {
            const total = Object.values(stats).reduce((a, b) => a + b, 0);
            const sortedStats = Object.entries(stats).sort((a, b) => b[1] - a[1]);
            
            const typeNames = {
                'age': 'ì—°ë ¹ë³„',
                'region': 'ì§€ì—­ë³„',
                'job': 'ì§ì—…ë³„',
                'year': 'ë“±ë¡ì—°ë„ë³„',
                'gender': 'ì„±ë³„',
                'position': 'ì§ë¶„ë³„'
            };
            
            let html = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- ë°” ì°¨íŠ¸ -->
                    <div>
                        <h4 style="margin: 0 0 15px 0; color: #4a5568;">${typeNames[type]} ë¶„í¬</h4>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
            `;
            
            sortedStats.forEach(([label, count], idx) => {
                const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
                const color = colors[idx % colors.length];
                
                html += `
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span style="font-size: 0.9em; font-weight: 500;">${label}</span>
                            <span style="font-size: 0.85em; color: #666;">${count}ëª… (${percentage}%)</span>
                        </div>
                        <div style="height: 24px; background: #e2e8f0; border-radius: 12px; overflow: hidden;">
                            <div style="height: 100%; width: ${percentage}%; background: ${color}; border-radius: 12px; transition: width 0.5s;"></div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                        </div>
                    </div>
                    <!-- íŒŒì´ ì°¨íŠ¸ í‘œí˜„ (ê·¸ë¦¬ë“œ ì¹´ë“œ) -->
                    <div>
                        <h4 style="margin: 0 0 15px 0; color: #4a5568;">ìƒì„¸ í˜„í™©</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px;">
            `;
            
            sortedStats.forEach(([label, count], idx) => {
                const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
                const color = colors[idx % colors.length];
                
                html += `
                    <div style="background: ${color}15; border: 2px solid ${color}30; border-radius: 12px; padding: 12px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold; color: ${color};">${count}</div>
                        <div style="font-size: 0.75em; color: #666; margin-top: 2px;">${label}</div>
                        <div style="font-size: 0.7em; color: ${color}; margin-top: 2px;">${percentage}%</div>
                    </div>
                `;
            });
            
            html += `
                        </div>
                        <div style="margin-top: 15px; padding: 12px; background: #f8fafc; border-radius: 10px; text-align: center;">
                            <span style="font-size: 0.9em; color: #666;">ì´ êµì¸: </span>
                            <span style="font-size: 1.2em; font-weight: bold; color: #667eea;">${total}ëª…</span>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // êµì¸ ëª©ë¡ ë¡œë“œ í•¨ìˆ˜
        function loadMembersList() {
            const container = document.getElementById('membersList');
            if (members.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ë“±ë¡ëœ êµì¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // í•„í„° ì ìš©
            let filteredMembers = [...members];
            const filterNewFamily = document.getElementById('filterNewFamily')?.checked;
            const filterLeadership = document.getElementById('filterLeadership')?.checked;
            const filterCoffeeBreak = document.getElementById('filterCoffeeBreak')?.checked;
            const filterStatus = document.getElementById('filterEduStatus')?.value || 'all';
            
            // êµìœ¡ í•„í„° ì ìš©
            if (filterNewFamily || filterLeadership || filterCoffeeBreak) {
                filteredMembers = filteredMembers.filter(m => {
                    const edu = m.education || {};
                    if (filterStatus === 'completed') {
                        return (filterNewFamily ? edu.newFamily : true) &&
                               (filterLeadership ? edu.leadership : true) &&
                               (filterCoffeeBreak ? edu.coffeeBreak : true);
                    } else if (filterStatus === 'notCompleted') {
                        return (filterNewFamily ? !edu.newFamily : true) &&
                               (filterLeadership ? !edu.leadership : true) &&
                               (filterCoffeeBreak ? !edu.coffeeBreak : true);
                    }
                    return true;
                });
            }

            let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 60px;">ì‚¬ì§„</th>
                                <th>êµì¸ë²ˆí˜¸</th>
                                <th>í•œê¸€ì´ë¦„</th>
                                <th>ì˜ë¬¸ì´ë¦„</th>
                                <th>ì „í™”ë²ˆí˜¸</th>
                                <th>ì§ë¶„</th>
                                <th>ğŸ… ì „ë„</th>
                                <th>ğŸ“š êµìœ¡ ì´ìˆ˜ í˜„í™©</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            filteredMembers.forEach((member, idx) => {
                const originalIndex = members.findIndex(m => m.number === member.number);
                const edu = member.education || {};
                
                // ì „ë„ ë©”ë‹¬ ê³„ì‚° (ì´ êµì¸ì´ ì¸ë„í•œ ì‚¬ëŒ ìˆ˜)
                const evangelismCount = members.filter(m => m.referrer === member.nameKr).length;
                
                // ì‚¬ì§„ ë˜ëŠ” ê¸°ë³¸ ì•„ë°”íƒ€
                const photoHtml = member.photo 
                    ? `<img src="${member.photo}" style="width: 45px; height: 55px; object-fit: cover; border-radius: 5px;">`
                    : `<div style="width: 45px; height: 55px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 5px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.2em;">${member.nameKr?.charAt(0) || '?'}</div>`;
                
                // êµìœ¡ í˜„í™© ë°°ì§€ ìƒì„±
                const eduBadges = `
                    <div style="display: flex; gap: 5px; flex-wrap: wrap; justify-content: center;">
                        <span onclick="toggleEducation(${originalIndex}, 'newFamily')" 
                              style="cursor: pointer; padding: 3px 8px; border-radius: 12px; font-size: 0.75em; 
                                     background: ${edu.newFamily ? '#48bb78' : '#e2e8f0'}; 
                                     color: ${edu.newFamily ? 'white' : '#718096'};"
                              title="í´ë¦­í•˜ì—¬ ë³€ê²½">
                            ìƒˆê°€ì¡± ${edu.newFamily ? 'âœ“' : ''}
                        </span>
                        <span onclick="toggleEducation(${originalIndex}, 'leadership')" 
                              style="cursor: pointer; padding: 3px 8px; border-radius: 12px; font-size: 0.75em; 
                                     background: ${edu.leadership ? '#4299e1' : '#e2e8f0'}; 
                                     color: ${edu.leadership ? 'white' : '#718096'};"
                              title="í´ë¦­í•˜ì—¬ ë³€ê²½">
                            ì œì§ ${edu.leadership ? 'âœ“' : ''}
                        </span>
                        <span onclick="toggleEducation(${originalIndex}, 'coffeeBreak')" 
                              style="cursor: pointer; padding: 3px 8px; border-radius: 12px; font-size: 0.75em; 
                                     background: ${edu.coffeeBreak ? '#9f7aea' : '#e2e8f0'}; 
                                     color: ${edu.coffeeBreak ? 'white' : '#718096'};"
                              title="í´ë¦­í•˜ì—¬ ë³€ê²½">
                            ì»¤í”¼ ${edu.coffeeBreak ? 'âœ“' : ''}
                        </span>
                    </div>
                `;
                
                // ì „ë„ ë©”ë‹¬ ìƒì„±
                let medalHtml = '';
                if (evangelismCount > 0) {
                    for (let i = 0; i < evangelismCount; i++) {
                        medalHtml += 'ğŸ…';
                    }
                    medalHtml = `<div style="text-align: center;" title="${member.nameKr}ë‹˜ì´ ì¸ë„í•œ êµì¸: ${evangelismCount}ëª…">${medalHtml}<div style="font-size: 0.7em; color: #888;">${evangelismCount}ëª…</div></div>`;
                } else {
                    medalHtml = '<span style="color: #ccc;">-</span>';
                }
                
                html += `
                    <tr>
                        <td style="text-align: center;">${photoHtml}</td>
                        <td>${member.number || '-'}</td>
                        <td>${member.nameKr}</td>
                        <td>${member.nameEn || '-'}</td>
                        <td>${member.phone || '-'}</td>
                        <td>${member.position || '-'}</td>
                        <td style="text-align: center;">${medalHtml}</td>
                        <td>${eduBadges}</td>
                        <td>
                            <button class="btn btn-info" style="padding: 5px 10px; font-size: 0.85em;" onclick="editMember(${originalIndex})">ìˆ˜ì •</button>
                            <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.85em;" onclick="deleteMember(${originalIndex})">ì‚­ì œ</button>
                        </td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            container.innerHTML = html;
        }

        function showSection(sectionId) {
            // ê¶Œí•œ ì²´í¬ - ì ‘ê·¼ ì œí•œëœ ì„¹ì…˜
            const restrictedSections = {
                'my': 'member',           // ë¡œê·¸ì¸ í•„ìš”
                'dashboard': 'dashboard', // ëŒ€ì‹œë³´ë“œ ê¶Œí•œ
                'attendance': 'attendance', // ì¶œì„ê´€ë¦¬ ê¶Œí•œ
                'cell': 'cell',           // êµ¬ì—­ê´€ë¦¬ ê¶Œí•œ
                'department': 'department', // ë¶€ì„œê´€ë¦¬ ê¶Œí•œ
                'mentor': 'mentor',       // ë©˜í† ë§ ê¶Œí•œ
                'offering': 'offering',   // ì¬ì •ê´€ë¦¬ ê¶Œí•œ
                'members': 'members',     // êµì ê´€ë¦¬ ê¶Œí•œ
                'users': 'users'          // ì‚¬ìš©ìê´€ë¦¬ ê¶Œí•œ
            };
            
            // ê³µê°œ ì„¹ì…˜ (ë¡œê·¸ì¸ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥)
            const publicSections = ['home', 'about', 'worship', 'news', 'sundayschool', 'gallery'];
            
            if (!publicSections.includes(sectionId)) {
                // ë¹„ê³µê°œ ì„¹ì…˜ - ë¡œê·¸ì¸ í•„ìš”
                if (!currentUser) {
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ë©”ë‰´ì…ë‹ˆë‹¤.');
                    return;
                }
                
                // ë‚´ì •ë³´ëŠ” ë¡œê·¸ì¸ë§Œ í•˜ë©´ ì ‘ê·¼ ê°€ëŠ¥
                if (sectionId === 'my') {
                    // ì ‘ê·¼ í—ˆìš©
                } else if (restrictedSections[sectionId]) {
                    // ê´€ë¦¬ìëŠ” ëª¨ë“  ì ‘ê·¼ ê°€ëŠ¥
                    if (currentUser.role !== 'ê´€ë¦¬ì') {
                        const requiredPerm = restrictedSections[sectionId];
                        if (!currentUser.permissions || !currentUser.permissions.includes(requiredPerm)) {
                            alert('ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.\\nê´€ë¦¬ìì—ê²Œ ê¶Œí•œì„ ìš”ì²­í•˜ì„¸ìš”.');
                            return;
                        }
                    }
                }
            }
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.add('active');
            }
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            // êµì ê´€ë¦¬ ì„¹ì…˜ ì„ íƒ ì‹œ ëŒ€ì‹œë³´ë“œ íƒ­ í‘œì‹œ
            if (sectionId === 'members') {
                updateCellSelect();
                showMemberTab('dashboard');
            }
            
            // ì¶œì„ê´€ë¦¬ ì„¹ì…˜ ì„ íƒ ì‹œ ë°ì´í„° ë¡œë“œ
            if (sectionId === 'attendance') {
                loadAttendanceSection();
            }
            
            // ë©˜í† ë§ ì„¹ì…˜ ì„ íƒ ì‹œ ë°ì´í„° ë¡œë“œ
            if (sectionId === 'mentor') {
                loadMentoringData();
            }
            
            // êµ¬ì—­ê´€ë¦¬ ì„¹ì…˜ ì„ íƒ ì‹œ ë°ì´í„° ë¡œë“œ
            if (sectionId === 'cell') {
                loadCellList();
            }
            
            // ë¶€ì„œê´€ë¦¬ ì„¹ì…˜ ì„ íƒ ì‹œ ë°ì´í„° ë¡œë“œ
            if (sectionId === 'department') {
                showDeptMainTab('dashboard');
            }
            
            // ì¬ì •ê´€ë¦¬ ì„¹ì…˜ ì„ íƒ ì‹œ ê²°ì œìš”ì²­ ëª©ë¡ ë¡œë“œ
            if (sectionId === 'finance') {
                loadPaymentRequests();
            }
            
            // ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ ì„ íƒ ì‹œ ë°ì´í„° ë¡œë“œ
            if (sectionId === 'dashboard') {
                loadDashboard();
            }
            
            // ë‚´ ì •ë³´ ì„¹ì…˜ ì„ íƒ ì‹œ ë°ì´í„° ë¡œë“œ
            if (sectionId === 'my') {
                loadMyInfo();
            }
            
            // ì˜ˆë°°ì•ˆë‚´ ì„¹ì…˜ ì„ íƒ ì‹œ
            if (sectionId === 'worship') {
                showWorshipTab('time');
            }
            
            // êµíšŒì†Œì‹ ì„¹ì…˜ ì„ íƒ ì‹œ
            if (sectionId === 'news') {
                loadBulletinList();
            }
            
            // ì£¼ì¼í•™êµ ì„¹ì…˜ ì„ íƒ ì‹œ
            if (sectionId === 'sundayschool') {
                loadSundaySchoolData();
            }
            
            // ê°¤ëŸ¬ë¦¬ ì„¹ì…˜ ì„ íƒ ì‹œ
            if (sectionId === 'gallery') {
                loadGallery();
            }
            
            // ì‚¬ìš©ìê´€ë¦¬ ì„¹ì…˜ ì„ íƒ ì‹œ
            if (sectionId === 'users') {
                loadSignupRequests();
                loadRegisteredUsers();
            }
        }
        
        // ëŒ€ì‹œë³´ë“œ ë¡œë“œ
        function loadDashboard() {
            // ë°ì´í„° ë¡œë“œ
            const offerings = JSON.parse(localStorage.getItem('churchOfferings') || '[]');
            const expenses = JSON.parse(localStorage.getItem('churchExpenses') || '[]');
            
            // ê¸°ë³¸ í†µê³„
            document.getElementById('dashTotal').textContent = members.length;
            
            // ì´ë²ˆ ì£¼ì¼ ì¶œì„
            const thisSunday = getThisSundayForDashboard();
            const attendees = getAttendanceForDate(thisSunday);
            const weekAttend = attendees.length;
            const weekAbsent = members.length - weekAttend;
            
            document.getElementById('dashThisSunday').textContent = weekAttend;
            document.getElementById('dashWeekAttend').textContent = weekAttend + 'ëª…';
            document.getElementById('dashWeekAbsent').textContent = weekAbsent + 'ëª…';
            
            // ê¸ˆì£¼ ì¶œì„ë¥  ê³„ì‚°
            const avgRate = members.length > 0 ? Math.round((weekAttend / members.length) * 100) : 0;
            document.getElementById('dashAvgRate').textContent = avgRate + '%';
            
            // ì´ë²ˆë‹¬ ì¬ì •
            const thisMonth = new Date().toISOString().slice(0, 7);
            const monthIncome = offerings.filter(o => o.date.startsWith(thisMonth))
                .reduce((sum, o) => sum + o.amount, 0);
            const monthExpense = expenses.filter(e => e.date.startsWith(thisMonth))
                .reduce((sum, e) => sum + e.amount, 0);
            
            document.getElementById('dashMonthIncome').textContent = '$' + monthIncome.toLocaleString();
            document.getElementById('dashMonthIncomeVal').textContent = '$' + monthIncome.toLocaleString();
            document.getElementById('dashMonthExpenseVal').textContent = '$' + monthExpense.toLocaleString();
            document.getElementById('dashBalanceVal').textContent = '$' + (monthIncome - monthExpense).toLocaleString();
            
            // êµ¬ì—­ í˜„í™©
            const cellsData = JSON.parse(localStorage.getItem('churchCells') || '[]');
            let cellHtml = '';
            cellsData.forEach(cell => {
                const cellMembers = members.filter(m => m.cell === cell.name || m.cell === cell.name + 'êµ¬ì—­');
                cellHtml += `
                    <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #f0f0f0;">
                        <span style="color: ${cell.color}; font-weight: 500;">${cell.name}êµ¬ì—­</span>
                        <span style="font-weight: 600;">${cellMembers.length}ëª…</span>
                    </div>
                `;
            });
            document.getElementById('dashCellSummary').innerHTML = cellHtml || '<p style="color: #999; font-size: 0.9em;">êµ¬ì—­ ë°ì´í„° ì—†ìŒ</p>';
            
            // ë¶€ì„œ í˜„í™©
            const depts = JSON.parse(localStorage.getItem('departments') || '[]');
            let deptHtml = '';
            depts.slice(0, 4).forEach(dept => {
                const deptMembers = members.filter(m => m.department === dept.name);
                deptHtml += `
                    <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #f0f0f0;">
                        <span>${dept.name}</span>
                        <span style="font-weight: 600;">${deptMembers.length}ëª…</span>
                    </div>
                `;
            });
            if (depts.length > 4) {
                deptHtml += `<div style="padding: 6px 0; color: #666; font-size: 0.85em;">ì™¸ ${depts.length - 4}ê°œ ë¶€ì„œ...</div>`;
            }
            document.getElementById('dashDeptSummary').innerHTML = deptHtml || '<p style="color: #999; font-size: 0.9em;">ë¶€ì„œ ë°ì´í„° ì—†ìŒ</p>';
            
            // ë©˜í† ë§ í˜„í™©
            const mentorPairs = JSON.parse(localStorage.getItem('mentoringPairs') || '[]');
            const activePairs = mentorPairs.filter(p => p.status === 'ì§„í–‰ì¤‘').length;
            const completedPairs = mentorPairs.filter(p => p.status === 'ì™„ë£Œ').length;
            document.getElementById('dashMentorSummary').innerHTML = `
                <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #f0f0f0;">
                    <span>ì§„í–‰ì¤‘</span>
                    <span style="font-weight: 600; color: #38a169;">${activePairs}ìŒ</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #f0f0f0;">
                    <span>ì™„ë£Œ</span>
                    <span style="font-weight: 600; color: #4f46e5;">${completedPairs}ìŒ</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                    <span>ì´ ë©˜í† ë§</span>
                    <span style="font-weight: 600;">${mentorPairs.length}ìŒ</span>
                </div>
            `;
            
            // ìƒˆê°€ì¡± ëª…ë‹¨ ì—°ë™ - loadMemberDashboard()ì—ì„œ dashNewFamilySummaryë„ ì—…ë°ì´íŠ¸
            loadMemberDashboard();
            
            // êµíšŒ ì¡°ì§ë„ ë¡œë“œ
            loadOrgChart();
        }
        
        // êµíšŒ ì¡°ì§ë„ ë¡œë“œ
        function loadOrgChart() {
            // ì¡°ì§ë„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            const orgData = JSON.parse(localStorage.getItem('churchOrgChart') || '{}');
            
            // ê´€ë¦¬ì
            const pastorEl = document.getElementById('orgPastor');
            if (pastorEl) pastorEl.textContent = orgData.pastor || 'ì •ì¤€ì—°';
            
            // ì¥ë¡œ (ì‰¼í‘œë¥¼ ì¤„ë°”ê¿ˆìœ¼ë¡œ)
            const elderEl = document.getElementById('orgElder');
            if (elderEl) {
                const elderNames = orgData.elder || '-';
                elderEl.innerHTML = elderNames.split(',').map(n => n.trim()).join('<br>');
            }
            
            // ê¶Œì‚¬ (ì‰¼í‘œë¥¼ ì¤„ë°”ê¿ˆìœ¼ë¡œ)
            const kwonsaEl = document.getElementById('orgKwonsa');
            if (kwonsaEl) {
                const kwonsaNames = orgData.kwonsa || '-';
                kwonsaEl.innerHTML = kwonsaNames.split(',').map(n => n.trim()).join('<br>');
            }
            
            // ì•ˆìˆ˜ì§‘ì‚¬ (ì‰¼í‘œë¥¼ ì¤„ë°”ê¿ˆìœ¼ë¡œ)
            const ordainedDeaconEl = document.getElementById('orgOrdainedDeacon');
            if (ordainedDeaconEl) {
                const deaconNames = orgData.ordainedDeacon || '-';
                ordainedDeaconEl.innerHTML = deaconNames.split(',').map(n => n.trim()).join('<br>');
            }
            
            // ìš´ì˜ìœ„ì›íšŒ
            const committeeEl = document.getElementById('orgCommittee');
            if (committeeEl) committeeEl.textContent = orgData.committee || '-';
            
            // ì„œë¦¬ì§‘ì‚¬ ìˆ˜
            const deaconCount = members.filter(m => m.position === 'ì„œë¦¬ì§‘ì‚¬' || m.position === 'ì§‘ì‚¬').length;
            const deaconEl = document.getElementById('orgDeacon');
            if (deaconEl) deaconEl.textContent = deaconCount > 0 ? deaconCount + 'ëª…' : '-';
            
            // ì„±ë„ ìˆ˜
            const memberCount = members.filter(m => !m.position || m.position === 'ì„±ë„' || m.position === 'ê¶Œì°°').length;
            const membersEl = document.getElementById('orgMembers');
            if (membersEl) membersEl.textContent = memberCount > 0 ? memberCount + 'ëª…' : members.length + 'ëª…';
            
            // ë¶€ì„œ ë° íŒ€ í‘œì‹œ
            const depts = JSON.parse(localStorage.getItem('departments') || '[]');
            const deptTeams = JSON.parse(localStorage.getItem('churchDeptTeams') || '{}');
            const deptContainer = document.getElementById('orgDepartmentsWithTeams');
            
            if (deptContainer) {
                if (depts.length > 0) {
                    const colWidth = (100 / depts.length).toFixed(2);
                    let tableHtml = `
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.85em; table-layout: fixed;">
                            <thead>
                                <tr style="background: #1e3a5f; color: white;">
                                    ${depts.map(dept => `
                                        <th style="width: ${colWidth}%; padding: 10px 8px; text-align: center; font-weight: 600; border-right: 1px solid #2d5a87;">
                                            ${dept.name}
                                            ${dept.leader ? `<div style="font-size: 0.8em; font-weight: 400; opacity: 0.85; margin-top: 2px;">${dept.leader}</div>` : ''}
                                        </th>
                                    `).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    ${depts.map(dept => {
                                        const teams = deptTeams[dept.name] || [];
                                        return `
                                            <td style="width: ${colWidth}%; padding: 10px 8px; text-align: center; vertical-align: top; border-right: 1px solid #e2e8f0; background: #f8fafc;">
                                                ${teams.length > 0 ? teams.map(team => `
                                                    <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 8px 6px; margin-bottom: 6px;">
                                                        <div style="font-weight: 500; color: #334155;">${team.name}</div>
                                                        ${team.leader ? `<div style="font-size: 0.85em; color: #64748b;">${team.leader}</div>` : ''}
                                                    </div>
                                                `).join('') : '<span style="color: #94a3b8; font-size: 0.9em;">-</span>'}
                                            </td>
                                        `;
                                    }).join('')}
                                </tr>
                            </tbody>
                        </table>
                    `;
                    deptContainer.innerHTML = tableHtml;
                } else {
                    deptContainer.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 30px;">ë¶€ì„œê´€ë¦¬ì—ì„œ ë¶€ì„œë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”</div>';
                }
            }
        }
        
        // ë¶€ì„œ/íŒ€ í¸ì§‘ ëª¨ë‹¬ í‘œì‹œ
        // ë¶€ì„œ íƒ­ ì „í™˜
        function switchDeptTeamTab(deptName) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.dept-team-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.style.background = '#e2e8f0';
                tab.style.color = '#4a5568';
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            const activeTab = document.querySelector(`.dept-team-tab[data-dept="${deptName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
                activeTab.style.background = '#1e3a5f';
                activeTab.style.color = 'white';
            }
            
            // ëª¨ë“  ì»¨í…ì¸  ìˆ¨ê¹€
            document.querySelectorAll('.dept-team-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // ì„ íƒëœ ì»¨í…ì¸  í‘œì‹œ
            const activeContent = document.querySelector(`.dept-team-content[data-dept="${deptName}"]`);
            if (activeContent) {
                activeContent.style.display = 'block';
            }
        }
        
        // íŒ€ ì¶”ê°€
        function addDeptTeam(deptName) {
            const depts = JSON.parse(localStorage.getItem('departments') || '[]');
            const dept = depts.find(d => d.name === deptName);
            const listId = `teamsList_${deptName.replace(/\s/g, '_')}`;
            const listEl = document.getElementById(listId);
            
            if (!listEl) return;
            
            // ë¹ˆ ë©”ì‹œì§€ ì œê±°
            const emptyMsg = listEl.querySelector('p');
            if (emptyMsg) emptyMsg.remove();
            
            const teamCount = listEl.querySelectorAll('[data-team-index]').length;
            
            const newTeamHtml = `
                <div style="display: flex; gap: 10px; align-items: center; padding: 10px; background: #f7fafc; border-radius: 6px; margin-bottom: 8px;" data-team-index="${teamCount}">
                    <input type="text" class="form-control team-name-input" value="" placeholder="íŒ€ ì´ë¦„" style="flex: 1;">
                    <input type="text" class="form-control team-leader-input" value="" placeholder="íŒ€ì¥" style="flex: 1;">
                    <button onclick="this.parentElement.remove()" style="background: #e53e3e; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">ì‚­ì œ</button>
                </div>
            `;
            
            listEl.insertAdjacentHTML('beforeend', newTeamHtml);
        }
        
        // íŒ€ ì‚­ì œ
        function removeDeptTeam(deptName, teamIndex) {
            const listId = `teamsList_${deptName.replace(/\s/g, '_')}`;
            const listEl = document.getElementById(listId);
            const teamEl = listEl.querySelector(`[data-team-index="${teamIndex}"]`);
            if (teamEl) teamEl.remove();
            
            // ë‚¨ì€ íŒ€ì´ ì—†ìœ¼ë©´ ë¹ˆ ë©”ì‹œì§€ í‘œì‹œ
            if (listEl.querySelectorAll('[data-team-index]').length === 0) {
                listEl.innerHTML = '<p style="color: #999; text-align: center; padding: 10px;">ë“±ë¡ëœ íŒ€ì´ ì—†ìŠµë‹ˆë‹¤</p>';
            }
        }
        
        // ë¶€ì„œ ì‚­ì œ (ì¡°ì§ë„ í¸ì§‘ ëª¨ë‹¬ì—ì„œ)
        function deleteOrgDept(deptName) {
            if (!confirm(`"${deptName}" ë¶€ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ë¶€ì„œ ì•„ë˜ì˜ ëª¨ë“  íŒ€ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.`)) return;
            
            // ë¶€ì„œ ëª©ë¡ì—ì„œ ì‚­ì œ
            let depts = JSON.parse(localStorage.getItem('departments') || '[]');
            depts = depts.filter(d => d.name !== deptName);
            localStorage.setItem('departments', JSON.stringify(depts));
            
            // ë¶€ì„œ íŒ€ ë°ì´í„° ì‚­ì œ
            let deptTeams = JSON.parse(localStorage.getItem('churchDeptTeams') || '{}');
            delete deptTeams[deptName];
            localStorage.setItem('churchDeptTeams', JSON.stringify(deptTeams));
            
            // ëª¨ë‹¬ ë‹«ê³  ë‹¤ì‹œ ì—´ê¸°
            closeOrgChartEditModal();
            showOrgChartEditModal();
            
            // ì¡°ì§ë„ ë‹¤ì‹œ ë¡œë“œ
            if (typeof loadOrgChart === 'function') loadOrgChart();
            if (typeof loadDepartmentList === 'function') loadDepartmentList();
            
            alert(`"${deptName}" ë¶€ì„œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // ì¡°ì§ë„ í¸ì§‘ ëª¨ë‹¬ í‘œì‹œ
        function showOrgChartEditModal() {
            const orgData = JSON.parse(localStorage.getItem('churchOrgChart') || '{}');
            const depts = JSON.parse(localStorage.getItem('departments') || '[]');
            const deptTeams = JSON.parse(localStorage.getItem('churchDeptTeams') || '{}');
            
            // ë¶€ì„œë³„ íŒ€ í¸ì§‘ HTML ìƒì„±
            let deptTabsHtml = '';
            let deptContentHtml = '';
            
            if (depts.length > 0) {
                depts.forEach((dept, index) => {
                    const teams = deptTeams[dept.name] || [];
                    const isActive = index === 0;
                    
                    deptTabsHtml += `
                        <div style="display: inline-flex; align-items: center; gap: 2px;">
                            <button class="dept-team-tab ${isActive ? 'active' : ''}" 
                                    onclick="switchDeptTeamTab('${dept.name}')" 
                                    data-dept="${dept.name}"
                                    style="padding: 6px 12px; border: none; background: ${isActive ? '#1e3a5f' : '#e2e8f0'}; 
                                           color: ${isActive ? 'white' : '#4a5568'}; border-radius: 5px 0 0 5px; cursor: pointer; font-size: 0.85em;">
                                ${dept.name}
                            </button>
                            <button onclick="deleteOrgDept('${dept.name}')" 
                                    style="padding: 6px 8px; border: none; background: #e53e3e; color: white; border-radius: 0 5px 5px 0; cursor: pointer; font-size: 0.75em;" 
                                    title="ë¶€ì„œ ì‚­ì œ">âœ•</button>
                        </div>
                    `;
                    
                    let teamsListHtml = '';
                    teams.forEach((team, teamIdx) => {
                        teamsListHtml += `
                            <div style="display: flex; gap: 8px; align-items: center; padding: 8px; background: #f7fafc; border-radius: 5px; margin-bottom: 6px;" data-team-index="${teamIdx}">
                                <input type="text" class="form-control team-name-input" value="${team.name}" placeholder="íŒ€ ì´ë¦„" style="flex: 1; padding: 6px;">
                                <input type="text" class="form-control team-leader-input" value="${team.leader || ''}" placeholder="íŒ€ì¥" style="flex: 1; padding: 6px;">
                                <button onclick="this.parentElement.remove()" style="background: #e53e3e; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer;">ì‚­ì œ</button>
                            </div>
                        `;
                    });
                    
                    deptContentHtml += `
                        <div class="dept-team-content" data-dept="${dept.name}" style="display: ${isActive ? 'block' : 'none'}; padding: 10px; border: 1px solid #e2e8f0; border-radius: 5px; margin-top: 10px;">
                            <div id="teamsList_${dept.name.replace(/\s/g, '_')}">
                                ${teamsListHtml || '<p style="color: #999; text-align: center; padding: 8px; font-size: 0.9em;">ë“±ë¡ëœ íŒ€ì´ ì—†ìŠµë‹ˆë‹¤</p>'}
                            </div>
                            <button onclick="addDeptTeam('${dept.name}')" style="width: 100%; margin-top: 8px; padding: 8px; background: #1e3a5f; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.85em;">
                                + íŒ€ ì¶”ê°€
                            </button>
                        </div>
                    `;
                });
            }
            
            const modalHtml = `
                <div id="orgChartEditModal" class="modal active">
                    <div class="modal-content" style="max-width: 550px; max-height: 90vh; overflow-y: auto;">
                        <div class="modal-header" style="background: linear-gradient(135deg, #1e3a5f, #2d5a87);">
                            <h2 style="color: white; margin: 0;">êµíšŒ ì¡°ì§ë„ í¸ì§‘</h2>
                        </div>
                        <div style="padding: 20px;">
                            <!-- íƒ­ ë²„íŠ¼ -->
                            <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px;">
                                <button id="tabPosition" onclick="switchOrgTab('position')" style="padding: 8px 20px; border: none; background: #1e3a5f; color: white; border-radius: 5px; cursor: pointer; font-weight: 500;">ì§ë¶„</button>
                                <button id="tabDeptTeam" onclick="switchOrgTab('deptTeam')" style="padding: 8px 20px; border: none; background: #e2e8f0; color: #4a5568; border-radius: 5px; cursor: pointer; font-weight: 500;">ë¶€ì„œ/íŒ€</button>
                            </div>
                            
                            <!-- ì§ë¶„ íƒ­ ë‚´ìš© -->
                            <div id="positionContent">
                                <div class="form-group">
                                    <label>ë‹´ì„ëª©ì‚¬</label>
                                    <input type="text" id="editOrgPastor" class="form-control" value="${orgData.pastor || 'ì •ì¤€ì—°'}" placeholder="ë‹´ì„ëª©ì‚¬ ì´ë¦„">
                                </div>
                                <div class="form-group">
                                    <label>ì¥ë¡œ</label>
                                    <input type="text" id="editOrgElder" class="form-control" value="${orgData.elder || ''}" placeholder="ì¥ë¡œ ì´ë¦„ (ì‰¼í‘œë¡œ êµ¬ë¶„)">
                                </div>
                                <div class="form-group">
                                    <label>ê¶Œì‚¬</label>
                                    <input type="text" id="editOrgKwonsa" class="form-control" value="${orgData.kwonsa || ''}" placeholder="ê¶Œì‚¬ ì´ë¦„ (ì‰¼í‘œë¡œ êµ¬ë¶„)">
                                </div>
                                <div class="form-group">
                                    <label>ì•ˆìˆ˜ì§‘ì‚¬</label>
                                    <input type="text" id="editOrgOrdainedDeacon" class="form-control" value="${orgData.ordainedDeacon || ''}" placeholder="ì•ˆìˆ˜ì§‘ì‚¬ ì´ë¦„ (ì‰¼í‘œë¡œ êµ¬ë¶„)">
                                </div>
                                <div class="form-group">
                                    <label>ìš´ì˜ìœ„ì›íšŒ</label>
                                    <input type="text" id="editOrgCommittee" class="form-control" value="${orgData.committee || ''}" placeholder="ìš´ì˜ìœ„ì› ì´ë¦„ (ì‰¼í‘œë¡œ êµ¬ë¶„)">
                                </div>
                                <p style="font-size: 0.8em; color: #666; margin-top: 5px;">* ì„œë¦¬ì§‘ì‚¬ì™€ ì„±ë„ ìˆ˜ëŠ” êµì¸ ë°ì´í„°ì—ì„œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.</p>
                            </div>
                            
                            <!-- ë¶€ì„œ/íŒ€ íƒ­ ë‚´ìš© -->
                            <div id="deptTeamContent" style="display: none;">
                                ${depts.length > 0 ? `
                                    <p style="font-size: 0.85em; color: #666; margin-bottom: 10px;">ê° ë¶€ì„œë¥¼ ì„ íƒí•˜ì—¬ íŒ€ì„ ì¶”ê°€/ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                                    <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                        ${deptTabsHtml}
                                    </div>
                                    ${deptContentHtml}
                                ` : '<p style="color: #999; text-align: center; padding: 20px;">ë¨¼ì € ë¶€ì„œê´€ë¦¬ì—ì„œ ë¶€ì„œë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>'}
                            </div>
                            
                            <div style="display: flex; gap: 10px; margin-top: 20px;">
                                <button onclick="saveOrgChartAll()" class="btn btn-primary" style="flex: 1;">ì €ì¥</button>
                                <button onclick="closeOrgChartEditModal()" class="btn btn-secondary" style="flex: 1;">ì·¨ì†Œ</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        // ì¡°ì§ë„ í¸ì§‘ íƒ­ ì „í™˜
        function switchOrgTab(tab) {
            const positionBtn = document.getElementById('tabPosition');
            const deptTeamBtn = document.getElementById('tabDeptTeam');
            const positionContent = document.getElementById('positionContent');
            const deptTeamContent = document.getElementById('deptTeamContent');
            
            if (tab === 'position') {
                positionBtn.style.background = '#1e3a5f';
                positionBtn.style.color = 'white';
                deptTeamBtn.style.background = '#e2e8f0';
                deptTeamBtn.style.color = '#4a5568';
                positionContent.style.display = 'block';
                deptTeamContent.style.display = 'none';
            } else {
                positionBtn.style.background = '#e2e8f0';
                positionBtn.style.color = '#4a5568';
                deptTeamBtn.style.background = '#1e3a5f';
                deptTeamBtn.style.color = 'white';
                positionContent.style.display = 'none';
                deptTeamContent.style.display = 'block';
            }
        }
        
        // ì¡°ì§ë„ ì „ì²´ ì €ì¥ (ì§ë¶„ + ë¶€ì„œ/íŒ€)
        function saveOrgChartAll() {
            // ì§ë¶„ ì €ì¥
            const orgData = {
                pastor: document.getElementById('editOrgPastor').value.trim(),
                elder: document.getElementById('editOrgElder').value.trim(),
                kwonsa: document.getElementById('editOrgKwonsa').value.trim(),
                ordainedDeacon: document.getElementById('editOrgOrdainedDeacon').value.trim(),
                committee: document.getElementById('editOrgCommittee').value.trim()
            };
            localStorage.setItem('churchOrgChart', JSON.stringify(orgData));
            
            // ë¶€ì„œ/íŒ€ ì €ì¥
            const depts = JSON.parse(localStorage.getItem('departments') || '[]');
            const deptTeams = {};
            
            depts.forEach(dept => {
                const listId = `teamsList_${dept.name.replace(/\s/g, '_')}`;
                const listEl = document.getElementById(listId);
                if (!listEl) return;
                
                const teams = [];
                listEl.querySelectorAll('[data-team-index]').forEach(teamEl => {
                    const nameInput = teamEl.querySelector('.team-name-input');
                    const leaderInput = teamEl.querySelector('.team-leader-input');
                    
                    if (nameInput && nameInput.value.trim()) {
                        teams.push({
                            name: nameInput.value.trim(),
                            leader: leaderInput ? leaderInput.value.trim() : ''
                        });
                    }
                });
                
                if (teams.length > 0) {
                    deptTeams[dept.name] = teams;
                }
            });
            
            localStorage.setItem('churchDeptTeams', JSON.stringify(deptTeams));
            
            closeOrgChartEditModal();
            loadOrgChart();
            alert('ì¡°ì§ë„ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì¡°ì§ë„ ì €ì¥ (ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€)
        function saveOrgChart() {
            saveOrgChartAll();
        }
        
        // ì¡°ì§ë„ í¸ì§‘ ëª¨ë‹¬ ë‹«ê¸°
        function closeOrgChartEditModal() {
            const modal = document.getElementById('orgChartEditModal');
            if (modal) modal.remove();
        }
        
        // ëŒ€ì‹œë³´ë“œìš© ì´ë²ˆ ì£¼ì¼ ê³„ì‚°
        function getThisSundayForDashboard() {
            const today = new Date();
            const day = today.getDay();
            const diff = day === 0 ? 0 : -day;
            const sunday = new Date(today);
            sunday.setDate(today.getDate() + diff);
            const year = sunday.getFullYear();
            const month = String(sunday.getMonth() + 1).padStart(2, '0');
            const date = String(sunday.getDate()).padStart(2, '0');
            return `${year}-${month}-${date}`;
        }
        
        // ë‚´ ì •ë³´ ë¡œë“œ
        function loadMyInfo() {
            const select = document.getElementById('myInfoMemberSelect');
            const selectArea = document.getElementById('myInfoSelectArea');
            const notLinkedMsg = document.getElementById('myInfoNotLinked');
            const profileCard = document.getElementById('myProfileCard');
            
            if (!select) return;
            
            // ê´€ë¦¬ìì¸ ê²½ìš°: ë“œë¡­ë‹¤ìš´ í‘œì‹œ, ëª¨ë“  êµì¸ ì„ íƒ ê°€ëŠ¥
            if (currentUser && currentUser.role === 'ê´€ë¦¬ì') {
                selectArea.style.display = 'flex';
                notLinkedMsg.style.display = 'none';
                
                // êµì¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ìƒì„±
                select.innerHTML = '<option value="">-- êµì¸ ì„ íƒ --</option>';
                members.forEach(m => {
                    select.innerHTML += `<option value="${m.nameKr}">${m.nameKr} (${m.position || 'ì„±ë„'})</option>`;
                });
                
                // ì²« ë²ˆì§¸ êµì¸ ìë™ ì„ íƒ
                if (members.length > 0) {
                    select.value = members[0].nameKr;
                    loadMyInfoForMember(members[0].nameKr);
                }
            } else {
                // ì¼ë°˜ íšŒì›ì¸ ê²½ìš°: ì—°ê²°ëœ êµì  ì •ë³´ í‘œì‹œ
                selectArea.style.display = 'none';
                
                // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ êµì  ì—°ê²° í™•ì¸
                const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                const loggedUser = users.find(u => u.username === currentUser?.username);
                
                if (loggedUser && loggedUser.memberId) {
                    // êµì ì´ ì—°ê²°ë˜ì–´ ìˆìŒ
                    notLinkedMsg.style.display = 'none';
                    const linkedMember = members.find(m => m.id === loggedUser.memberId);
                    if (linkedMember) {
                        loadMyInfoForMember(linkedMember.nameKr);
                    } else {
                        // ì—°ê²°ëœ êµì  íšŒì›ì´ ì‚­ì œëœ ê²½ìš°
                        notLinkedMsg.style.display = 'block';
                        profileCard.style.display = 'none';
                        document.getElementById('myInfoCards').style.display = 'none';
                    }
                } else {
                    // êµì  ë¯¸ì—°ê²°
                    notLinkedMsg.style.display = 'block';
                    profileCard.style.display = 'none';
                    document.getElementById('myInfoCards').style.display = 'none';
                    clearMyInfoDisplay();
                }
            }
        }
        
        // ë‚´ ì •ë³´ í‘œì‹œ ì´ˆê¸°í™”
        function clearMyInfoDisplay() {
            document.getElementById('myAttendCount').textContent = '0';
            document.getElementById('myAbsentCount').textContent = '0';
            document.getElementById('myAttendRate').textContent = '0%';
            document.getElementById('myRecentAttendance').innerHTML = '';
            document.getElementById('myTotalOffering').textContent = '$0';
            document.getElementById('myMonthOffering').textContent = '$0';
            document.getElementById('myRecentOfferings').innerHTML = '';
            document.getElementById('myInfoCards').style.display = 'none';
        }
        
        // ì„ íƒëœ êµì¸ ì •ë³´ ë¡œë“œ
        function loadMyInfoForMember(memberName) {
            const profileCard = document.getElementById('myProfileCard');
            const notLinkedMsg = document.getElementById('myInfoNotLinked');
            const infoCards = document.getElementById('myInfoCards');
            
            if (!memberName) {
                profileCard.style.display = 'none';
                infoCards.style.display = 'none';
                document.getElementById('myAttendCount').textContent = '0';
                document.getElementById('myAbsentCount').textContent = '0';
                document.getElementById('myAttendRate').textContent = '0%';
                document.getElementById('myRecentAttendance').innerHTML = '';
                document.getElementById('myTotalOffering').textContent = '$0';
                document.getElementById('myMonthOffering').textContent = '$0';
                document.getElementById('myRecentOfferings').innerHTML = '';
                return;
            }
            
            const myMember = members.find(m => m.nameKr === memberName);
            if (!myMember) return;
            
            // ë¯¸ì—°ê²° ë©”ì‹œì§€ ìˆ¨ê¸°ê³  í”„ë¡œí•„ ì¹´ë“œ í‘œì‹œ
            if (notLinkedMsg) notLinkedMsg.style.display = 'none';
            profileCard.style.display = 'block';
            infoCards.style.display = 'grid';
            document.getElementById('myProfilePhoto').textContent = myMember.nameKr.charAt(0);
            document.getElementById('myProfileName').textContent = myMember.nameKr + (myMember.nameEn ? ` (${myMember.nameEn})` : '');
            document.getElementById('myProfilePosition').textContent = myMember.position || 'ì„±ë„';
            document.getElementById('myProfileCell').textContent = myMember.cell ? myMember.cell + (myMember.cell.includes('êµ¬ì—­') ? '' : 'êµ¬ì—­') : 'ë¯¸ë°°ì •';
            document.getElementById('myProfileContact').textContent = `ğŸ“ ${myMember.phone || '-'} | ğŸ“§ ${myMember.email || '-'}`;
            
            // ë‚´ ì¶œì„ í˜„í™© ê³„ì‚°
            const year = new Date().getFullYear();
            const sundays = getSundaysOfYear(year);
            let myAttend = 0;
            let myAbsent = 0;
            let recentAttendance = [];
            
            for (let m = 1; m <= 12; m++) {
                sundays[m].forEach(day => {
                    const dateStr = `${year}-${String(m).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    if (new Date(dateStr) <= new Date()) {
                        const attendees = getAttendanceForDate(dateStr);
                        if (attendees.includes(myMember.nameKr)) {
                            myAttend++;
                            recentAttendance.push({ date: dateStr, status: 'ì¶œì„' });
                        } else {
                            myAbsent++;
                            recentAttendance.push({ date: dateStr, status: 'ê²°ì„' });
                        }
                    }
                });
            }
            
            document.getElementById('myAttendCount').textContent = myAttend;
            document.getElementById('myAbsentCount').textContent = myAbsent;
            const myRate = (myAttend + myAbsent) > 0 ? Math.round((myAttend / (myAttend + myAbsent)) * 100) : 0;
            document.getElementById('myAttendRate').textContent = myRate + '%';
            
            // ìµœê·¼ ì¶œì„ 8ê±´
            const recent8 = recentAttendance.slice(-8).reverse();
            let recentHtml = '';
            recent8.forEach(r => {
                const color = r.status === 'ì¶œì„' ? '#16a34a' : '#dc2626';
                const bg = r.status === 'ì¶œì„' ? '#dcfce7' : '#fee2e2';
                const icon = r.status === 'ì¶œì„' ? 'âœ“' : 'âœ—';
                recentHtml += `<span style="background: ${bg}; color: ${color}; padding: 4px 10px; border-radius: 15px; font-size: 0.8em; font-weight: 500;">${r.date.slice(5)} ${icon}</span>`;
            });
            document.getElementById('myRecentAttendance').innerHTML = recentHtml || '<span style="color: #999;">ì¶œì„ ê¸°ë¡ ì—†ìŒ</span>';
            
            // ë‚´ í—Œê¸ˆ ë‚´ì—­
            const offerings = JSON.parse(localStorage.getItem('churchOfferings') || '[]');
            const myOfferings = offerings.filter(o => o.name === myMember.nameKr || o.name === myMember.nameEn);
            const thisYear = new Date().getFullYear().toString();
            const myYearTotal = myOfferings.filter(o => o.date.startsWith(thisYear))
                .reduce((sum, o) => sum + o.amount, 0);
            const thisMonth = new Date().toISOString().slice(0, 7);
            const myMonthTotal = myOfferings.filter(o => o.date.startsWith(thisMonth))
                .reduce((sum, o) => sum + o.amount, 0);
            
            document.getElementById('myTotalOffering').textContent = '$' + myYearTotal.toLocaleString();
            document.getElementById('myMonthOffering').textContent = '$' + myMonthTotal.toLocaleString();
            
            // ìµœê·¼ í—Œê¸ˆ 5ê±´
            const recentOfferings = myOfferings.slice(-5).reverse();
            let offeringHtml = '';
            if (recentOfferings.length > 0) {
                recentOfferings.forEach(o => {
                    offeringHtml += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid #f0f0f0;">
                            <span style="color: #64748b;">${o.date}</span>
                            <span style="background: #fef3c7; color: #92400e; padding: 2px 8px; border-radius: 10px; font-size: 0.8em;">${o.category}</span>
                            <span style="font-weight: 700; color: #d97706;">$${o.amount.toLocaleString()}</span>
                        </div>
                    `;
                });
            } else {
                offeringHtml = '<p style="color: #999; text-align: center; margin: 10px 0;">í—Œê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p>';
            }
            document.getElementById('myRecentOfferings').innerHTML = offeringHtml;
        }
        
        // ===== ì˜ˆë°°ì•ˆë‚´ ê¸°ëŠ¥ =====
        function showWorshipTab(tab) {
            // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
            document.getElementById('worshipTimeTab').style.display = 'none';
            document.getElementById('worshipSundayTab').style.display = 'none';
            document.getElementById('worshipWednesdayTab').style.display = 'none';
            
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.getElementById('worshipTabTime').style.background = '#f8f9fa';
            document.getElementById('worshipTabTime').style.color = '#666';
            document.getElementById('worshipTabSunday').style.background = '#f8f9fa';
            document.getElementById('worshipTabSunday').style.color = '#666';
            document.getElementById('worshipTabWednesday').style.background = '#f8f9fa';
            document.getElementById('worshipTabWednesday').style.color = '#666';
            
            // ì„ íƒëœ íƒ­ í‘œì‹œ
            if (tab === 'time') {
                document.getElementById('worshipTimeTab').style.display = 'block';
                document.getElementById('worshipTabTime').style.background = '#1e3a5f';
                document.getElementById('worshipTabTime').style.color = 'white';
            } else if (tab === 'sunday') {
                document.getElementById('worshipSundayTab').style.display = 'block';
                document.getElementById('worshipTabSunday').style.background = '#1e3a5f';
                document.getElementById('worshipTabSunday').style.color = 'white';
                loadSundayYoutube();
            } else if (tab === 'wednesday') {
                document.getElementById('worshipWednesdayTab').style.display = 'block';
                document.getElementById('worshipTabWednesday').style.background = '#1e3a5f';
                document.getElementById('worshipTabWednesday').style.color = 'white';
                loadWednesdayYoutube();
            }
        }
        
        function extractYoutubeId(url) {
            if (!url) return null;
            // ë‹¤ì–‘í•œ ìœ íŠœë¸Œ URL í˜•ì‹ ì§€ì›
            const patterns = [
                /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\?\/]+)/,
                /^([a-zA-Z0-9_-]{11})$/
            ];
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match) return match[1];
            }
            return null;
        }
        
        function setSundayYoutube() {
            const url = document.getElementById('sundayYoutubeUrl').value.trim();
            const videoId = extractYoutubeId(url);
            
            if (!videoId && url) {
                alert('ì˜¬ë°”ë¥¸ ìœ íŠœë¸Œ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì €ì¥
            const videos = JSON.parse(localStorage.getItem('sundayVideos') || '[]');
            if (videoId) {
                const today = new Date().toISOString().split('T')[0];
                videos.unshift({ id: videoId, url: url, date: today });
                if (videos.length > 20) videos.pop();
                localStorage.setItem('sundayVideos', JSON.stringify(videos));
            }
            
            loadSundayYoutube();
            document.getElementById('sundayYoutubeUrl').value = '';
            if (videoId) alert('ì£¼ì¼ì˜ˆë°° ì˜ìƒì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        function loadSundayYoutube() {
            const videos = JSON.parse(localStorage.getItem('sundayVideos') || '[]');
            const listContainer = document.getElementById('sundayVideoList');
            const isPastor = currentUser && currentUser.role === 'ê´€ë¦¬ì';
            
            if (videos.length > 0) {
                let listHtml = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px;">';
                videos.slice(0, 20).forEach((v, i) => {
                    listHtml += `
                        <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 1px solid ${i === 0 ? '#fbbf24' : '#e2e8f0'};">
                            <a href="https://www.youtube.com/watch?v=${v.id}" target="_blank" style="display: block; text-decoration: none; color: inherit;">
                                <div style="position: relative; width: 100%; padding-top: 56.25%; background: #000;">
                                    <img src="https://img.youtube.com/vi/${v.id}/mqdefault.jpg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;">
                                    ${i === 0 ? '<div style="position: absolute; top: 8px; left: 8px; background: #f59e0b; color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.75em; font-weight: 600;">ìµœì‹ </div>' : ''}
                                    <div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.7); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.7em;">â–¶ ì‹œì²­</div>
                                </div>
                            </a>
                            <div style="padding: 12px; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 600; color: #1e3a5f; font-size: 0.95em;">${v.date} ì£¼ì¼ì˜ˆë°°</div>
                                </div>
                                ${isPastor ? `<button onclick="deleteSundayVideo(${i})" style="background: #fee2e2; color: #dc2626; border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8em;">ì‚­ì œ</button>` : ''}
                            </div>
                        </div>
                    `;
                });
                listHtml += '</div>';
                listContainer.innerHTML = listHtml;
            } else {
                listContainer.innerHTML = '<p style="color: #94a3b8; text-align: center; padding: 30px;">ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤</p>';
            }
            
            // í™ˆ í™”ë©´ ìµœì‹  ì˜ìƒë„ ì—…ë°ì´íŠ¸
            loadHomeLatestVideos();
        }
        
        function playSundayVideo(videoId) {
            window.open('https://www.youtube.com/watch?v=' + videoId, '_blank');
        }
        
        function deleteSundayVideo(index) {
            if (!confirm('ì´ ì˜ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            const videos = JSON.parse(localStorage.getItem('sundayVideos') || '[]');
            videos.splice(index, 1);
            localStorage.setItem('sundayVideos', JSON.stringify(videos));
            loadSundayYoutube();
        }
        
        function setWednesdayYoutube() {
            const url = document.getElementById('wednesdayYoutubeUrl').value.trim();
            const videoId = extractYoutubeId(url);
            
            if (!videoId && url) {
                alert('ì˜¬ë°”ë¥¸ ìœ íŠœë¸Œ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const videos = JSON.parse(localStorage.getItem('wednesdayVideos') || '[]');
            if (videoId) {
                const today = new Date().toISOString().split('T')[0];
                videos.unshift({ id: videoId, url: url, date: today });
                if (videos.length > 20) videos.pop();
                localStorage.setItem('wednesdayVideos', JSON.stringify(videos));
            }
            
            loadWednesdayYoutube();
            document.getElementById('wednesdayYoutubeUrl').value = '';
            if (videoId) alert('ìˆ˜ìš” ê²½ë°°ì™€ ì°¬ì–‘ ì˜ìƒì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        function loadWednesdayYoutube() {
            const videos = JSON.parse(localStorage.getItem('wednesdayVideos') || '[]');
            const listContainer = document.getElementById('wednesdayVideoList');
            const isPastor = currentUser && currentUser.role === 'ê´€ë¦¬ì';
            
            if (videos.length > 0) {
                let listHtml = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px;">';
                videos.slice(0, 20).forEach((v, i) => {
                    listHtml += `
                        <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 1px solid ${i === 0 ? '#60a5fa' : '#e2e8f0'};">
                            <a href="https://www.youtube.com/watch?v=${v.id}" target="_blank" style="display: block; text-decoration: none; color: inherit;">
                                <div style="position: relative; width: 100%; padding-top: 56.25%; background: #000;">
                                    <img src="https://img.youtube.com/vi/${v.id}/mqdefault.jpg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;">
                                    ${i === 0 ? '<div style="position: absolute; top: 8px; left: 8px; background: #3b82f6; color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.75em; font-weight: 600;">ìµœì‹ </div>' : ''}
                                    <div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.7); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.7em;">â–¶ ì‹œì²­</div>
                                </div>
                            </a>
                            <div style="padding: 12px; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 600; color: #2d5a87; font-size: 0.95em;">${v.date} ìˆ˜ìš” ê²½ë°°ì™€ ì°¬ì–‘</div>
                                </div>
                                ${isPastor ? `<button onclick="deleteWednesdayVideo(${i})" style="background: #fee2e2; color: #dc2626; border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8em;">ì‚­ì œ</button>` : ''}
                            </div>
                        </div>
                    `;
                });
                listHtml += '</div>';
                listContainer.innerHTML = listHtml;
            } else {
                listContainer.innerHTML = '<p style="color: #94a3b8; text-align: center; padding: 30px;">ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤</p>';
            }
            
            // í™ˆ í™”ë©´ ìµœì‹  ì˜ìƒë„ ì—…ë°ì´íŠ¸
            loadHomeLatestVideos();
        }
        
        function playWednesdayVideo(videoId) {
            window.open('https://www.youtube.com/watch?v=' + videoId, '_blank');
        }
        
        function deleteWednesdayVideo(index) {
            if (!confirm('ì´ ì˜ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            const videos = JSON.parse(localStorage.getItem('wednesdayVideos') || '[]');
            videos.splice(index, 1);
            localStorage.setItem('wednesdayVideos', JSON.stringify(videos));
            loadWednesdayYoutube();
        }
        
        // í™ˆ í™”ë©´ ìµœì‹  ì˜ˆë°° ì˜ìƒ í‘œì‹œ
        function loadHomeLatestVideos() {
            const sundayVideos = JSON.parse(localStorage.getItem('sundayVideos') || '[]');
            const wednesdayVideos = JSON.parse(localStorage.getItem('wednesdayVideos') || '[]');
            const container = document.getElementById('homeLatestVideos');
            
            if (!container) return;
            
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">';
            
            // ìµœì‹  ì£¼ì¼ì˜ˆë°°
            if (sundayVideos.length > 0) {
                const v = sundayVideos[0];
                html += `
                    <a href="https://www.youtube.com/watch?v=${v.id}" target="_blank" style="display: block; background: white; border-radius: 12px; overflow: hidden; text-decoration: none; color: inherit; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #e2e8f0;">
                        <div style="position: relative; width: 100%; padding-top: 56.25%; background: #000;">
                            <img src="https://img.youtube.com/vi/${v.id}/mqdefault.jpg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;">
                            <div style="position: absolute; top: 8px; left: 8px; background: #1e3a5f; color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.7em; font-weight: 600;">ì£¼ì¼ì˜ˆë°°</div>
                        </div>
                        <div style="padding: 12px;">
                            <div style="font-weight: 600; color: #1e3a5f; font-size: 0.95em;">${v.date} ì£¼ì¼ì˜ˆë°°</div>
                            <div style="font-size: 0.8em; color: #64748b; margin-top: 4px;">í´ë¦­í•˜ì—¬ ì‹œì²­ â–¶</div>
                        </div>
                    </a>
                `;
            }
            
            // ìµœì‹  ìˆ˜ìš” ê²½ë°°ì™€ ì°¬ì–‘
            if (wednesdayVideos.length > 0) {
                const v = wednesdayVideos[0];
                html += `
                    <a href="https://www.youtube.com/watch?v=${v.id}" target="_blank" style="display: block; background: white; border-radius: 12px; overflow: hidden; text-decoration: none; color: inherit; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #e2e8f0;">
                        <div style="position: relative; width: 100%; padding-top: 56.25%; background: #000;">
                            <img src="https://img.youtube.com/vi/${v.id}/mqdefault.jpg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;">
                            <div style="position: absolute; top: 8px; left: 8px; background: #2d5a87; color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.7em; font-weight: 600;">ìˆ˜ìš” ê²½ë°°ì™€ ì°¬ì–‘</div>
                        </div>
                        <div style="padding: 12px;">
                            <div style="font-weight: 600; color: #2d5a87; font-size: 0.95em;">${v.date} ìˆ˜ìš” ê²½ë°°ì™€ ì°¬ì–‘</div>
                            <div style="font-size: 0.8em; color: #64748b; margin-top: 4px;">í´ë¦­í•˜ì—¬ ì‹œì²­ â–¶</div>
                        </div>
                    </a>
                `;
            }
            
            html += '</div>';
            
            if (sundayVideos.length === 0 && wednesdayVideos.length === 0) {
                html = '<p style="color: #94a3b8; text-align: center; padding: 20px 0;">ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤</p>';
            }
            
            container.innerHTML = html;
        }
        
        // ===== êµíšŒì†Œì‹/ì£¼ë³´ ê¸°ëŠ¥ =====
        let bulletinFileData = null;
        
        function handleBulletinFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            if (file.type !== 'application/pdf') {
                alert('PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                input.value = '';
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) {
                alert('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                input.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                bulletinFileData = e.target.result;
                document.getElementById('bulletinFileName').textContent = 'âœ“ ' + file.name;
                document.getElementById('bulletinDropZone').style.borderColor = '#38b2ac';
                document.getElementById('bulletinDropZone').style.background = '#e6fffa';
            };
            reader.readAsDataURL(file);
        }
        
        function uploadBulletin() {
            const date = document.getElementById('bulletinDate').value;
            const title = document.getElementById('bulletinTitle').value.trim();
            
            if (!date) {
                alert('ì£¼ë³´ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!title) {
                alert('ì£¼ë³´ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!bulletinFileData) {
                alert('PDF íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const bulletins = JSON.parse(localStorage.getItem('churchBulletins') || '[]');
            bulletins.unshift({
                date: date,
                title: title,
                file: bulletinFileData,
                uploadedAt: new Date().toISOString()
            });
            
            // ìµœëŒ€ 50ê°œê¹Œì§€ë§Œ ì €ì¥
            if (bulletins.length > 50) bulletins.pop();
            
            try {
                localStorage.setItem('churchBulletins', JSON.stringify(bulletins));
                alert('ì£¼ë³´ê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
                
                // ëª¨ë‹¬ ë‹«ê¸° ë° ì´ˆê¸°í™”
                document.getElementById('bulletinUploadModal').style.display = 'none';
                document.getElementById('bulletinDate').value = '';
                document.getElementById('bulletinTitle').value = '';
                document.getElementById('bulletinFileName').textContent = '';
                document.getElementById('bulletinDropZone').style.borderColor = '#cbd5e0';
                document.getElementById('bulletinDropZone').style.background = '';
                bulletinFileData = null;
                document.getElementById('bulletinFileInput').value = '';
                
                loadBulletinList();
            } catch (e) {
                if (e.name === 'QuotaExceededError') {
                    alert('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì˜¤ë˜ëœ ì£¼ë³´ë¥¼ ì‚­ì œí•´ì£¼ì„¸ìš”.');
                } else {
                    alert('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.message);
                }
            }
        }
        
        function loadBulletinList() {
            const bulletins = JSON.parse(localStorage.getItem('churchBulletins') || '[]');
            const previewContainer = document.getElementById('bulletinPreview');
            const infoContainer = document.getElementById('bulletinInfo');
            const listContainer = document.getElementById('bulletinList');
            
            if (bulletins.length > 0) {
                const latest = bulletins[0];
                
                // ìµœì‹  ì£¼ë³´ ë¯¸ë¦¬ë³´ê¸°
                previewContainer.innerHTML = `
                    <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                        <embed src="${latest.file}" type="application/pdf" width="100%" height="400px" style="border: none;">
                    </div>
                `;
                
                infoContainer.innerHTML = `
                    <h3 style="margin: 0 0 15px 0; color: #2d3748;">${latest.title}</h3>
                    <p style="color: #718096; margin-bottom: 15px;">ğŸ“… ${latest.date}</p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <a href="${latest.file}" download="${latest.title}.pdf" class="btn btn-primary">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</a>
                        <button onclick="window.open('${latest.file}', '_blank')" class="btn btn-secondary">ğŸ” ìƒˆì°½ì—ì„œ ë³´ê¸°</button>
                    </div>
                `;
                
                // ì£¼ë³´ ëª©ë¡
                let listHtml = '';
                bulletins.forEach((b, i) => {
                    listHtml += `
                        <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: ${i === 0 ? '#e6fffa' : '#f8fafc'}; border-radius: 12px; margin-bottom: 10px;">
                            <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #38b2ac, #319795); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5em;">ğŸ“„</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: #2d3748;">${b.title}</div>
                                <div style="font-size: 0.85em; color: #718096;">ğŸ“… ${b.date}</div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <a href="${b.file}" download="${b.title}.pdf" style="background: #38b2ac; color: white; padding: 8px 12px; border-radius: 6px; text-decoration: none; font-size: 0.85em;">ğŸ“¥</a>
                                <button onclick="deleteBulletin(${i})" style="background: #fee2e2; color: #dc2626; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em;">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    `;
                });
                listContainer.innerHTML = listHtml;
            } else {
                previewContainer.innerHTML = `
                    <div style="font-size: 4em; margin-bottom: 10px;">ğŸ“„</div>
                    <p style="color: #718096;">ë“±ë¡ëœ ì£¼ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                `;
                infoContainer.innerHTML = '<p style="color: #718096; text-align: center;">ì£¼ë³´ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</p>';
                listContainer.innerHTML = '<p style="color: #718096; text-align: center; padding: 30px;">ë“±ë¡ëœ ì£¼ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
            }
        }
        
        function deleteBulletin(index) {
            if (!confirm('ì´ ì£¼ë³´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const bulletins = JSON.parse(localStorage.getItem('churchBulletins') || '[]');
            bulletins.splice(index, 1);
            localStorage.setItem('churchBulletins', JSON.stringify(bulletins));
            loadBulletinList();
        }
        
        // ===== ì£¼ì¼í•™êµ ê¸°ëŠ¥ =====
        // ===== Sunday School ê¸°ëŠ¥ =====
        let staffPhotoData = null;
        let ssPhotoFileData = null;
        
        function loadSundaySchoolData() {
            loadSSStaff();
            loadSSPhotos();
        }
        
        // Staff ê´€ë¦¬
        function loadSSStaff() {
            const staff = JSON.parse(localStorage.getItem('ssStaff') || '[]');
            const grid = document.getElementById('ssStaffGrid');
            const isPastor = currentUser && currentUser.role === 'ê´€ë¦¬ì';
            
            if (staff.length === 0) {
                grid.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #94a3b8; grid-column: 1 / -1;">
                        <p>ë“±ë¡ëœ Staffê°€ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            staff.forEach((s, index) => {
                html += `
                    <div style="background: #fff7ed; border-radius: 12px; padding: 20px; text-align: center; border: 1px solid #fed7aa;">
                        <div style="width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 15px; overflow: hidden; border: 3px solid #ed8936;">
                            ${s.photo ? 
                                `<img src="${s.photo}" style="width: 100%; height: 100%; object-fit: cover;">` : 
                                `<div style="width: 100%; height: 100%; background: #fed7aa; display: flex; align-items: center; justify-content: center; font-size: 2.5em;">ğŸ‘¤</div>`
                            }
                        </div>
                        <div style="color: #c2410c; font-size: 0.85em; font-weight: 600; margin-bottom: 5px;">${s.position}</div>
                        <div style="color: #1e3a5f; font-size: 1.1em; font-weight: 600;">${s.name}</div>
                        ${isPastor ? `<button onclick="deleteStaff(${index})" style="margin-top: 10px; background: #fee2e2; color: #dc2626; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8em;">ì‚­ì œ</button>` : ''}
                    </div>
                `;
            });
            
            grid.innerHTML = html;
        }
        
        function showAddStaffModal() {
            document.getElementById('addStaffModal').style.display = 'flex';
            document.getElementById('staffPosition').value = '';
            document.getElementById('staffName').value = '';
            document.getElementById('staffPhotoPreview').innerHTML = `
                <div style="width: 100px; height: 100px; background: #f1f5f9; border-radius: 50%; margin: 0 auto; display: flex; align-items: center; justify-content: center; font-size: 2.5em;">ğŸ‘¤</div>
            `;
            staffPhotoData = null;
        }
        
        function closeAddStaffModal() {
            document.getElementById('addStaffModal').style.display = 'none';
            staffPhotoData = null;
        }
        
        function handleStaffPhoto(input) {
            const file = input.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                input.value = '';
                return;
            }
            
            if (file.size > 3 * 1024 * 1024) {
                alert('íŒŒì¼ í¬ê¸°ëŠ” 3MB ì´í•˜ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                input.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                staffPhotoData = e.target.result;
                document.getElementById('staffPhotoPreview').innerHTML = `
                    <img src="${staffPhotoData}" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid #ed8936;">
                `;
            };
            reader.readAsDataURL(file);
        }
        
        function saveStaff() {
            const position = document.getElementById('staffPosition').value.trim();
            const name = document.getElementById('staffName').value.trim();
            
            if (!position) {
                alert('ì§ìœ„ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!name) {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const staff = JSON.parse(localStorage.getItem('ssStaff') || '[]');
            staff.push({
                position: position,
                name: name,
                photo: staffPhotoData
            });
            
            try {
                localStorage.setItem('ssStaff', JSON.stringify(staff));
                alert('Staffê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                closeAddStaffModal();
                loadSSStaff();
            } catch (e) {
                alert('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
            }
        }
        
        function deleteStaff(index) {
            if (!confirm('ì´ Staffë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const staff = JSON.parse(localStorage.getItem('ssStaff') || '[]');
            staff.splice(index, 1);
            localStorage.setItem('ssStaff', JSON.stringify(staff));
            loadSSStaff();
        }
        
        // Sunday School í–‰ì‚¬ ì‚¬ì§„ ê´€ë¦¬
        function loadSSPhotos() {
            const photos = JSON.parse(localStorage.getItem('ssPhotos') || '[]');
            const grid = document.getElementById('ssPhotoGrid');
            const isPastor = currentUser && currentUser.role === 'ê´€ë¦¬ì';
            
            if (photos.length === 0) {
                grid.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #94a3b8; grid-column: 1 / -1;">
                        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“·</div>
                        <p>ë“±ë¡ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            photos.forEach((photo, index) => {
                html += `
                    <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #fed7aa;">
                        <div style="cursor: pointer;" onclick="viewPhoto('${photo.image}')">
                            <img src="${photo.image}" style="width: 100%; height: 180px; object-fit: cover;">
                        </div>
                        <div style="padding: 15px;">
                            <h4 style="margin: 0 0 8px 0; color: #c2410c; font-size: 1em;">${photo.title}</h4>
                            <p style="margin: 0 0 8px 0; color: #64748b; font-size: 0.85em;">${photo.date}</p>
                            ${photo.description ? `<p style="margin: 0; color: #94a3b8; font-size: 0.85em;">${photo.description}</p>` : ''}
                            ${isPastor ? `<button onclick="deleteSSPhoto(${index})" style="margin-top: 10px; background: #fee2e2; color: #dc2626; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.8em;">ì‚­ì œ</button>` : ''}
                        </div>
                    </div>
                `;
            });
            
            grid.innerHTML = html;
        }
        
        function showAddSSPhotoModal() {
            document.getElementById('addSSPhotoModal').style.display = 'flex';
            document.getElementById('ssPhotoTitle').value = '';
            document.getElementById('ssPhotoDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('ssPhotoDescription').value = '';
            document.getElementById('ssPhotoPreviewContainer').innerHTML = '';
            document.getElementById('ssPhotoDropZone').style.borderColor = '#cbd5e0';
            ssPhotoFileData = null;
        }
        
        function closeAddSSPhotoModal() {
            document.getElementById('addSSPhotoModal').style.display = 'none';
            ssPhotoFileData = null;
        }
        
        function handleSSPhotoFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                input.value = '';
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                alert('íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                input.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                ssPhotoFileData = e.target.result;
                document.getElementById('ssPhotoPreviewContainer').innerHTML = `
                    <img src="${ssPhotoFileData}" style="max-width: 100%; max-height: 150px; border-radius: 8px; margin-top: 10px;">
                `;
                document.getElementById('ssPhotoDropZone').style.borderColor = '#ed8936';
            };
            reader.readAsDataURL(file);
        }
        
        function saveSSPhoto() {
            const title = document.getElementById('ssPhotoTitle').value.trim();
            const date = document.getElementById('ssPhotoDate').value;
            const description = document.getElementById('ssPhotoDescription').value.trim();
            
            if (!title) {
                alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!date) {
                alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!ssPhotoFileData) {
                alert('ì‚¬ì§„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const photos = JSON.parse(localStorage.getItem('ssPhotos') || '[]');
            photos.unshift({
                title: title,
                date: date,
                description: description,
                image: ssPhotoFileData,
                uploadedAt: new Date().toISOString()
            });
            
            if (photos.length > 30) photos.pop();
            
            try {
                localStorage.setItem('ssPhotos', JSON.stringify(photos));
                alert('ì‚¬ì§„ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                closeAddSSPhotoModal();
                loadSSPhotos();
            } catch (e) {
                alert('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì¼ë¶€ ì‚¬ì§„ì„ ì‚­ì œí•´ì£¼ì„¸ìš”.');
            }
        }
        
        function deleteSSPhoto(index) {
            if (!confirm('ì´ ì‚¬ì§„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const photos = JSON.parse(localStorage.getItem('ssPhotos') || '[]');
            photos.splice(index, 1);
            localStorage.setItem('ssPhotos', JSON.stringify(photos));
            loadSSPhotos();
        }
        
        // ===== ê°¤ëŸ¬ë¦¬ ê¸°ëŠ¥ =====
        let photoFileData = null;
        
        function loadGallery() {
            const photos = JSON.parse(localStorage.getItem('churchGallery') || '[]');
            const grid = document.getElementById('galleryGrid');
            
            if (photos.length === 0) {
                grid.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #94a3b8; grid-column: 1 / -1;">
                        <div style="font-size: 4em; margin-bottom: 15px;">ğŸ“·</div>
                        <p>ë“±ë¡ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤</p>
                        <p style="font-size: 0.9em;">ê´€ë¦¬ì ë¡œê·¸ì¸ í›„ ì‚¬ì§„ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</p>
                    </div>
                `;
                return;
            }
            
            const isPastor = currentUser && currentUser.role === 'ê´€ë¦¬ì';
            let html = '';
            
            photos.forEach((photo, index) => {
                // imageUrl ë˜ëŠ” image (base64) ì‚¬ìš©
                const imageSrc = photo.imageUrl || photo.image;
                
                if (!imageSrc) return; // ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ ìŠ¤í‚µ
                
                html += `
                    <div class="gallery-item" data-category="${photo.category}" style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                        <div style="position: relative; cursor: pointer;" onclick="viewPhoto('${imageSrc.replace(/'/g, "\\'")}')">
                            <img src="${imageSrc}" style="width: 100%; height: 180px; object-fit: cover;" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23f1f5f9%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2255%22 text-anchor=%22middle%22 fill=%22%2394a3b8%22 font-size=%2214%22>ì´ë¯¸ì§€ ì—†ìŒ</text></svg>'">
                            <div style="position: absolute; top: 10px; left: 10px; background: ${getCategoryColor(photo.category)}; color: white; padding: 4px 10px; border-radius: 15px; font-size: 0.75em;">${getCategoryName(photo.category)}</div>
                        </div>
                        <div style="padding: 15px;">
                            <h4 style="margin: 0 0 8px 0; color: #1e3a5f; font-size: 1em;">${photo.title}</h4>
                            <p style="margin: 0 0 8px 0; color: #64748b; font-size: 0.85em;">${photo.date}</p>
                            ${photo.description ? `<p style="margin: 0; color: #94a3b8; font-size: 0.85em; line-height: 1.5;">${photo.description}</p>` : ''}
                            ${isPastor ? `<button onclick="deletePhoto(${index})" style="margin-top: 10px; background: #fee2e2; color: #dc2626; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.8em;">ì‚­ì œ</button>` : ''}
                        </div>
                    </div>
                `;
            });
            
            grid.innerHTML = html || '<div style="text-align: center; padding: 60px 20px; color: #94a3b8; grid-column: 1 / -1;"><p>í‘œì‹œí•  ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤</p></div>';
        }
        
        function getCategoryColor(category) {
            const colors = {
                'worship': '#1e3a5f',
                'event': '#ed8936',
                'fellowship': '#38b2ac',
                'sundayschool': '#dd6b20'
            };
            return colors[category] || '#667eea';
        }
        
        function getCategoryName(category) {
            const names = {
                'worship': 'ì˜ˆë°°',
                'event': 'í–‰ì‚¬',
                'fellowship': 'ì¹œêµ',
                'sundayschool': 'Sunday School'
            };
            return names[category] || 'ê¸°íƒ€';
        }
        
        function filterGallery(category) {
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.gallery-filter-btn').forEach(btn => {
                if (btn.dataset.filter === category) {
                    btn.style.background = '#667eea';
                    btn.style.color = 'white';
                } else {
                    btn.style.background = 'white';
                    btn.style.color = '#4a5568';
                }
            });
            
            // ì‚¬ì§„ í•„í„°ë§
            document.querySelectorAll('.gallery-item').forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        function showAddPhotoModal() {
            document.getElementById('addPhotoModal').style.display = 'flex';
            document.getElementById('photoTitle').value = '';
            document.getElementById('photoDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('photoCategory').value = 'worship';
            document.getElementById('photoDescription').value = '';
            document.getElementById('photoPreviewContainer').innerHTML = '';
            document.getElementById('photoDropZone').style.borderColor = '#cbd5e0';
            photoFileData = null;
        }
        
        function closeAddPhotoModal() {
            document.getElementById('addPhotoModal').style.display = 'none';
            photoFileData = null;
            document.getElementById('photoImageUrl').value = '';
            document.getElementById('photoPreviewContainer').innerHTML = '';
        }
        
        function handlePhotoFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                input.value = '';
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                alert('íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                input.value = '';
                return;
            }
            
            // ì´ë¯¸ì§€ ìë™ ë¦¬ì‚¬ì´ì¦ˆ ë° ì••ì¶•
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // ìµœëŒ€ í¬ê¸° ì„¤ì • (ê°€ë¡œ 1200px, ì„¸ë¡œ 900px)
                    const maxWidth = 1200;
                    const maxHeight = 900;
                    let width = img.width;
                    let height = img.height;
                    
                    // ë¹„ìœ¨ ìœ ì§€í•˜ë©´ì„œ ë¦¬ì‚¬ì´ì¦ˆ
                    if (width > maxWidth) {
                        height = Math.round(height * maxWidth / width);
                        width = maxWidth;
                    }
                    if (height > maxHeight) {
                        width = Math.round(width * maxHeight / height);
                        height = maxHeight;
                    }
                    
                    // Canvasë¡œ ë¦¬ì‚¬ì´ì¦ˆ
                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // JPEGë¡œ ì••ì¶• (í’ˆì§ˆ 0.7 = 70%)
                    photoFileData = canvas.toDataURL('image/jpeg', 0.7);
                    
                    // ì••ì¶• ê²°ê³¼ í‘œì‹œ
                    const originalSize = (file.size / 1024).toFixed(1);
                    const compressedSize = (photoFileData.length * 0.75 / 1024).toFixed(1);
                    
                    document.getElementById('photoPreviewContainer').innerHTML = `
                        <img src="${photoFileData}" style="max-width: 100%; max-height: 150px; border-radius: 8px; margin-top: 10px;">
                        <div style="margin-top: 8px; font-size: 0.8em; color: #666;">
                            ğŸ“ ${width} x ${height}px | 
                            ğŸ“¦ ${originalSize}KB â†’ <span style="color: #16a34a; font-weight: 600;">${compressedSize}KB</span>
                            (${Math.round((1 - compressedSize/originalSize) * 100)}% ì••ì¶•)
                        </div>
                    `;
                    document.getElementById('photoDropZone').style.borderColor = '#16a34a';
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // ì‚¬ì§„ URL ë¯¸ë¦¬ë³´ê¸°
        function previewPhotoUrl() {
            const url = document.getElementById('photoImageUrl').value.trim();
            if (!url) {
                alert('ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const container = document.getElementById('photoPreviewContainer');
            container.innerHTML = `
                <img src="${url}" style="max-width: 100%; max-height: 150px; border-radius: 8px; margin-top: 10px;" onerror="this.parentElement.innerHTML='<p style=\\'color: red;\\'>ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>'">
                <p style="margin-top: 8px; font-size: 0.8em; color: #16a34a;">âœ… URL ì´ë¯¸ì§€ê°€ ì ìš©ë©ë‹ˆë‹¤</p>
            `;
        }
        
        function savePhoto() {
            const title = document.getElementById('photoTitle').value.trim();
            const date = document.getElementById('photoDate').value;
            const category = document.getElementById('photoCategory').value;
            const description = document.getElementById('photoDescription').value.trim();
            const imageUrl = document.getElementById('photoImageUrl').value.trim();
            
            if (!title) {
                alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!date) {
                alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!photoFileData && !imageUrl) {
                alert('ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ê±°ë‚˜ ì‚¬ì§„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const photos = JSON.parse(localStorage.getItem('churchGallery') || '[]');
            photos.unshift({
                title: title,
                date: date,
                category: category,
                description: description,
                image: photoFileData || '',
                imageUrl: imageUrl || '',
                uploadedAt: new Date().toISOString()
            });
            
            // ìµœëŒ€ 100ê°œê¹Œì§€ë§Œ ì €ì¥
            if (photos.length > 100) photos.pop();
            
            try {
                localStorage.setItem('churchGallery', JSON.stringify(photos));
                
                // Firebaseì—ë„ ì €ì¥ (base64 ì´ë¯¸ì§€ ì œì™¸)
                saveGalleryToFirebase();
                
                alert('ì‚¬ì§„ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                closeAddPhotoModal();
                loadGallery();
            } catch (e) {
                alert('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì¼ë¶€ ì‚¬ì§„ì„ ì‚­ì œí•´ì£¼ì„¸ìš”.');
            }
        }
        
        // ê°¤ëŸ¬ë¦¬ Firebase ì €ì¥
        function saveGalleryToFirebase() {
            if (!firebaseReady) return;
            
            const photos = JSON.parse(localStorage.getItem('churchGallery') || '[]');
            
            // base64 ì´ë¯¸ì§€ ì œì™¸í•œ ë°ì´í„°ë§Œ ì €ì¥
            const photosForFirebase = photos.map(photo => {
                const cleanPhoto = {...photo};
                if (cleanPhoto.image && cleanPhoto.image.startsWith('data:')) {
                    cleanPhoto.image = ''; // base64 ì œì™¸
                }
                return cleanPhoto;
            });
            
            db.collection('churchGallery').doc('main').set({ list: photosForFirebase })
                .then(() => console.log('ê°¤ëŸ¬ë¦¬ Firebase ì €ì¥ ì™„ë£Œ'))
                .catch(e => console.log('ê°¤ëŸ¬ë¦¬ Firebase ì €ì¥ ì‹¤íŒ¨:', e));
        }
        
        function deletePhoto(index) {
            if (!confirm('ì´ ì‚¬ì§„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const photos = JSON.parse(localStorage.getItem('churchGallery') || '[]');
            photos.splice(index, 1);
            localStorage.setItem('churchGallery', JSON.stringify(photos));
            
            // Firebaseì—ë„ ì €ì¥
            saveGalleryToFirebase();
            
            loadGallery();
        }
        
        function viewPhoto(imageSrc) {
            document.getElementById('photoViewImage').src = imageSrc;
            document.getElementById('photoViewModal').style.display = 'flex';
        }
        
        function closePhotoViewModal() {
            document.getElementById('photoViewModal').style.display = 'none';
        }
        
        function showLogin() {
            document.getElementById('loginModal').classList.add('active');
        }
        
        function closeLogin() {
            document.getElementById('loginModal').classList.remove('active');
        }
        
        function toggleLanguage() {
            const langText = document.getElementById('langText');
            langText.textContent = langText.textContent === 'í•œêµ­ì–´' ? 'English' : 'í•œêµ­ì–´';
        }
        
        function showOnlineOffering() {
            alert('ì˜¨ë¼ì¸ í—Œê¸ˆ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
        }
        
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            // pastor ê³„ì • (ë§ˆìŠ¤í„°)
            if (username === 'gkc8127' && password === '4581') {
                currentUser = { 
                    username: 'gkc8127', 
                    name: 'ì •ì¤€ì—°', 
                    role: 'ê´€ë¦¬ì',
                    permissions: ['dashboard', 'attendance', 'cell', 'department', 'mentor', 'offering', 'members', 'users']
                };
                
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('userDisplay').style.display = 'block';
                document.getElementById('userName').textContent = 'gkc8127';
                document.getElementById('userRole').textContent = 'ê´€ë¦¬ì';
                
                // íšŒì› ë©”ë‰´ í‘œì‹œ
                document.querySelectorAll('.member-only').forEach(el => {
                    el.style.display = 'block';
                });
                
                // ëª©ì‚¬ ì „ìš© ë©”ë‰´ í‘œì‹œ
                document.querySelectorAll('.pastor-only').forEach(el => {
                    el.style.display = 'block';
                });
                
                // ëª¨ë“  ê¶Œí•œ ë©”ë‰´ í‘œì‹œ
                document.querySelectorAll('.perm-dashboard, .perm-attendance, .perm-cell, .perm-department, .perm-mentor, .perm-offering, .perm-members, .perm-users').forEach(el => {
                    el.style.display = 'block';
                });
                
                // ê´€ë¦¬ìë¥¼ registeredUsersì— ì¶”ê°€ (íšŒì›ëª©ë¡ì— í‘œì‹œë˜ë„ë¡)
                let adminUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                const existingAdmin = adminUsers.find(u => u.username === 'gkc8127');
                if (!existingAdmin) {
                    adminUsers.unshift({
                        id: 1,
                        username: 'gkc8127',
                        name: 'ì •ì¤€ì—°',
                        password: '4581',
                        role: 'ê´€ë¦¬ì',
                        permissions: ['dashboard', 'attendance', 'cell', 'department', 'mentor', 'offering', 'members', 'users'],
                        approved: true
                    });
                    localStorage.setItem('registeredUsers', JSON.stringify(adminUsers));
                    saveUsersToFirebase();
                }
                
                closeLogin();
                alert('ë¡œê·¸ì¸ ì„±ê³µ!');
                loadSignupRequests();
                loadRegisteredUsers();
                return;
            }
            
            // ë“±ë¡ëœ ì‚¬ìš©ì í™•ì¸
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = {
                    username: user.username,
                    name: user.name,
                    role: user.role,
                    permissions: user.permissions || [],
                    memberId: user.memberId || null,
                    memberName: user.memberName || null
                };
                
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('userDisplay').style.display = 'block';
                document.getElementById('userName').textContent = user.username;
                document.getElementById('userRole').textContent = user.role;
                
                // íšŒì› ë©”ë‰´ í‘œì‹œ
                document.querySelectorAll('.member-only').forEach(el => {
                    el.style.display = 'block';
                });
                
                // ê¶Œí•œì— ë”°ë¥¸ ë©”ë‰´ í‘œì‹œ
                applyUserPermissions(user.permissions || []);
                
                closeLogin();
                alert('ë¡œê·¸ì¸ ì„±ê³µ!');
            } else {
                alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.\\n\\nê°€ì… ì‹ ì²­ í›„ ìŠ¹ì¸ì„ ë°›ìœ¼ì…”ì•¼ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            }
        });
        
        function logout() {
            currentUser = null;
            document.getElementById('authButtons').style.display = 'flex';
            document.getElementById('userDisplay').style.display = 'none';
            
            // ëª¨ë“  ê¶Œí•œ ë©”ë‰´ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.member-only, .pastor-only, .perm-dashboard, .perm-attendance, .perm-cell, .perm-department, .perm-mentor, .perm-offering, .perm-members, .perm-users').forEach(el => {
                el.style.display = 'none';
            });
            
            showSection('home');
        }
        
        // êµì¸ë²ˆí˜¸ ì¤‘ë³µ ì²´í¬ í•¨ìˆ˜
        function checkDuplicateMemberNumber(number) {
            const statusEl = document.getElementById('memberNumberStatus');
            if (!statusEl) return true;
            
            if (!number || number.trim() === '') {
                statusEl.textContent = '';
                statusEl.style.color = '';
                return true;
            }
            
            // í˜„ì¬ ìˆ˜ì • ì¤‘ì¸ êµì¸ì˜ ì›ë˜ ë²ˆí˜¸ (ìˆ˜ì • ëª¨ë“œì¼ ê²½ìš°)
            const editingMemberId = document.getElementById('memberForm').dataset.editingId;
            
            const duplicate = members.find(m => {
                // ìˆ˜ì • ì¤‘ì¸ êµì¸ ìì‹ ì€ ì œì™¸
                if (editingMemberId && m.id == editingMemberId) return false;
                return m.number === number.trim();
            });
            
            if (duplicate) {
                statusEl.textContent = `âš ï¸ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë²ˆí˜¸ì…ë‹ˆë‹¤ (${duplicate.nameKr})`;
                statusEl.style.color = '#e53e3e';
                return false;
            } else {
                statusEl.textContent = 'âœ“ ì‚¬ìš© ê°€ëŠ¥í•œ ë²ˆí˜¸ì…ë‹ˆë‹¤';
                statusEl.style.color = '#38a169';
                return true;
            }
        }
        
        // êµì¸ ë“±ë¡ í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('memberForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // êµì¸ë²ˆí˜¸ ì¤‘ë³µ ì²´í¬
            const memberNumber = document.getElementById('memberNumber').value;
            if (!checkDuplicateMemberNumber(memberNumber)) {
                alert('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ êµì¸ë²ˆí˜¸ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                document.getElementById('memberNumber').focus();
                return;
            }
            
            // í¼ ë°ì´í„° ìˆ˜ì§‘
            const memberData = {
                id: Date.now(),
                number: document.getElementById('memberNumber').value,
                nameKr: document.getElementById('memberNameKr').value,
                nameEn: document.getElementById('memberNameEn').value,
                gender: document.getElementById('memberGender').value,
                birth: document.getElementById('memberBirth').value,
                phone: document.getElementById('memberPhone').value,
                email: document.getElementById('memberEmail').value,
                position: document.getElementById('memberPosition').value,
                job: document.getElementById('memberJob').value,
                address: document.getElementById('memberAddress').value,
                city: document.getElementById('memberCity').value,
                zip: document.getElementById('memberZip').value,
                cell: document.getElementById('memberCell').value,
                familyRole: document.getElementById('memberFamilyRole').value,
                familyHead: document.getElementById('familyHead').value,
                referrer: document.getElementById('memberReferrer').value,
                regDate: document.getElementById('memberRegDate').value,
                photo: document.getElementById('memberPhotoData').value,
                education: {
                    newFamily: document.getElementById('eduNewFamily').value === 'completed',
                    leadership: document.getElementById('eduLeadership').value === 'completed',
                    coffeeBreak: document.getElementById('eduCoffeeBreak').value === 'completed'
                },
                mentoring: {
                    role: document.getElementById('mentoringRole').value,
                    menteeNames: document.getElementById('menteeNames').value,
                    mentorName: document.getElementById('mentorName').value
                }
            };
            
            // ë°ì´í„° ì €ì¥
            members.push(memberData);
            localStorage.setItem('churchMembers', JSON.stringify(members));
            saveMembersToFirebase(); // Firebase ë™ê¸°í™”
            
            // ì„±ê³µ ë©”ì‹œì§€
            alert(`êµì¸ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\nêµì¸ë²ˆí˜¸: ${memberData.number}\nì´ë¦„: ${memberData.nameKr}`);
            
            // í¼ ì´ˆê¸°í™” ë° ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            resetMemberForm();
            loadMembersList();
            loadMentoringData();
            
            // ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('totalMembers').textContent = members.length;
        });
        
        // êµìœ¡ ì´ìˆ˜ í˜„í™© í† ê¸€ (ê´€ë¦¬ì ì „ìš©)
        function toggleEducation(index, eduType) {
            if (!members[index].education) {
                members[index].education = { newFamily: false, leadership: false, coffeeBreak: false };
            }
            
            const currentValue = members[index].education[eduType];
            const eduNames = {
                newFamily: 'ìƒˆê°€ì¡± ì„±ê²½ê³µë¶€',
                leadership: 'ì œì§í›ˆë ¨',
                coffeeBreak: 'ì»¤í”¼ë¸Œë ˆì´í¬'
            };
            
            const action = currentValue ? 'ì´ìˆ˜ ì·¨ì†Œ' : 'ì´ìˆ˜ ì™„ë£Œ';
            
            if (confirm(`${members[index].nameKr}ë‹˜ì˜ "${eduNames[eduType]}" ì„(ë¥¼) ${action} í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                members[index].education[eduType] = !currentValue;
                localStorage.setItem('churchMembers', JSON.stringify(members));
                saveMembersToFirebase(); // Firebase ë™ê¸°í™”
                loadMembersList();
                
                const status = members[index].education[eduType] ? 'ì´ìˆ˜ ì™„ë£Œ' : 'ë¯¸ì´ìˆ˜';
                alert(`${members[index].nameKr}ë‹˜ - ${eduNames[eduType]}: ${status}`);
            }
        }
        
        // êµì¸ ìˆ˜ì • í•¨ìˆ˜
        function editMember(index) {
            const member = members[index];
            
            // ìˆ˜ì • ëª¨ë“œ ì„¤ì • (ì¤‘ë³µ ì²´í¬ì—ì„œ ìê¸° ìì‹  ì œì™¸ìš©)
            document.getElementById('memberForm').dataset.editingId = member.id;
            
            // êµ¬ì—­ ì„ íƒ ì˜µì…˜ ë¨¼ì € ì—…ë°ì´íŠ¸
            updateCellSelect();
            
            // í¼ì— ë°ì´í„° ì±„ìš°ê¸°
            document.getElementById('memberNumber').value = member.number;
            document.getElementById('memberNameKr').value = member.nameKr;
            document.getElementById('memberNameEn').value = member.nameEn || '';
            document.getElementById('memberGender').value = member.gender || '';
            document.getElementById('memberBirth').value = member.birth || '';
            document.getElementById('memberPhone').value = member.phone || '';
            document.getElementById('memberEmail').value = member.email || '';
            document.getElementById('memberPosition').value = member.position || '';
            document.getElementById('memberJob').value = member.job || '';
            document.getElementById('memberAddress').value = member.address || '';
            document.getElementById('memberCity').value = member.city || '';
            document.getElementById('memberZip').value = member.zip || '';
            document.getElementById('memberCell').value = member.cell || '';
            document.getElementById('memberFamilyRole').value = member.familyRole || '';
            document.getElementById('familyHead').value = member.familyHead || '';
            document.getElementById('memberReferrer').value = member.referrer || '';
            document.getElementById('memberRegDate').value = member.regDate || '';
            
            // êµì¸ë²ˆí˜¸ ìƒíƒœ ì´ˆê¸°í™”
            document.getElementById('memberNumberStatus').textContent = '';
            
            // ì‚¬ì§„ ë¡œë“œ
            if (member.photo) {
                document.getElementById('memberPhotoData').value = member.photo;
                document.getElementById('memberPhotoPreview').innerHTML = `
                    <img src="${member.photo}" style="width: 100%; height: 100%; object-fit: cover;">
                `;
            } else {
                document.getElementById('memberPhotoData').value = '';
                document.getElementById('memberPhotoPreview').innerHTML = `
                    <div style="text-align: center; color: #999;">
                        <div style="font-size: 2em;">ğŸ“·</div>
                        <div style="font-size: 0.8em;">ì‚¬ì§„ ì¶”ê°€</div>
                    </div>
                `;
            }
            
            // êµìœ¡ ì´ìˆ˜ í˜„í™© ë¡œë“œ
            const edu = member.education || {};
            document.getElementById('eduNewFamily').value = edu.newFamily ? 'completed' : '';
            document.getElementById('eduLeadership').value = edu.leadership ? 'completed' : '';
            document.getElementById('eduCoffeeBreak').value = edu.coffeeBreak ? 'completed' : '';
            
            // ë©˜í† ë§ ì •ë³´ ë¡œë“œ
            const mentoring = member.mentoring || {};
            document.getElementById('mentoringRole').value = mentoring.role || '';
            document.getElementById('menteeNames').value = mentoring.menteeNames || '';
            document.getElementById('mentorName').value = mentoring.mentorName || '';
            handleMentoringRoleChange();
            
            // ê¸°ì¡´ ë°ì´í„° ì‚­ì œ (ìˆ˜ì • ëª¨ë“œ)
            members.splice(index, 1);
            localStorage.setItem('churchMembers', JSON.stringify(members));
            saveMembersToFirebase(); // Firebase ë™ê¸°í™”
            loadMembersList();
            
            // êµì¸ë“±ë¡ íƒ­ìœ¼ë¡œ ì´ë™
            showMemberTab('register');
            
            // ìŠ¤í¬ë¡¤ì„ í¼ìœ¼ë¡œ ì´ë™
            setTimeout(() => {
                document.getElementById('memberForm').scrollIntoView({ behavior: 'smooth' });
            }, 100);
            
            alert('ìˆ˜ì •í•  êµì¸ ì •ë³´ê°€ í¼ì— ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.\nìˆ˜ì • í›„ "êµì¸ ë“±ë¡" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.');
        }
        
        // êµì¸ ì‚­ì œ í•¨ìˆ˜
        function deleteMember(index) {
            const member = members[index];
            if (confirm(`ì •ë§ "${member.nameKr}" êµì¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                members.splice(index, 1);
                localStorage.setItem('churchMembers', JSON.stringify(members));
                saveMembersToFirebase(); // Firebase ë™ê¸°í™”
                loadMembersList();
                document.getElementById('totalMembers').textContent = members.length;
                alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // êµì¸ ëª©ë¡ ì¸ì‡„ í•¨ìˆ˜
        function printMembersList() {
            if (members.length === 0) {
                alert('ì¸ì‡„í•  êµì¸ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì£¼ì†Œ ì¡°í•© í•¨ìˆ˜
            const getFullAddress = (member) => {
                let addr = '';
                if (member.address) addr += member.address;
                if (member.city) addr += (addr ? ', ' : '') + member.city;
                if (member.zip) addr += (addr ? ' ' : '') + member.zip;
                return addr || '-';
            };
            
            // ìƒì¼ í¬ë§·
            const formatBirthday = (birth) => {
                if (!birth) return '-';
                const d = new Date(birth);
                return `${d.getMonth() + 1}/${d.getDate()}`;
            };
            
            let html = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>êµì¸ ëª©ë¡ - Sacramento Glory Korean Church</title>
                    <style>
                        body { 
                            font-family: 'Malgun Gothic', Arial, sans-serif; 
                            padding: 20px;
                            font-size: 12px;
                        }
                        h1 { 
                            text-align: center; 
                            margin-bottom: 5px;
                            font-size: 18px;
                        }
                        .subtitle {
                            text-align: center;
                            color: #666;
                            margin-bottom: 20px;
                            font-size: 11px;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse;
                            font-size: 11px;
                        }
                        th, td { 
                            border: 1px solid #ddd; 
                            padding: 8px;
                            text-align: left;
                        }
                        th { 
                            background: #f7fafc; 
                            font-weight: bold;
                        }
                        tr:nth-child(even) {
                            background: #fafafa;
                        }
                        .footer {
                            text-align: center;
                            margin-top: 20px;
                            font-size: 10px;
                            color: #888;
                        }
                        @media print {
                            body { padding: 10px; }
                            @page { margin: 1cm; }
                        }
                    </style>
                </head>
                <body>
                    <h1>Sacramento Glory Korean Church</h1>
                    <p class="subtitle">êµì¸ ëª…ë‹¨ (ì´ ${members.length}ëª…) | ì¶œë ¥ì¼: ${new Date().toLocaleDateString('ko-KR')}</p>
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 10%;">êµì¸ë²ˆí˜¸</th>
                                <th style="width: 12%;">ì´ë¦„</th>
                                <th style="width: 15%;">ì „í™”ë²ˆí˜¸</th>
                                <th style="width: 35%;">ì£¼ì†Œ</th>
                                <th style="width: 18%;">ì´ë©”ì¼</th>
                                <th style="width: 10%;">ìƒì¼</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            members.forEach((member, idx) => {
                html += `
                    <tr>
                        <td>${member.number || '-'}</td>
                        <td>${member.nameKr}${member.nameEn ? '<br><small style="color:#888;">' + member.nameEn + '</small>' : ''}</td>
                        <td>${member.phone || '-'}</td>
                        <td style="font-size: 10px;">${getFullAddress(member)}</td>
                        <td style="font-size: 10px;">${member.email || '-'}</td>
                        <td>${formatBirthday(member.birth)}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                    <p class="footer">Sacramento Glory Korean Church | EIN# 88-1719323</p>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.print();
        }
        
        // ìˆ˜ì…(í—Œê¸ˆ) ì¸ì‡„
        function printOfferingList() {
            if (offerings.length === 0) {
                alert('ì¸ì‡„í•  í—Œê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const period = document.getElementById('offeringPeriod')?.value || 'month';
            const periodNames = { week: 'ì´ë²ˆ ì£¼', month: 'ì´ë²ˆ ë‹¬', quarter: 'ì´ë²ˆ ë¶„ê¸°', year: 'ì˜¬í•´', all: 'ì „ì²´' };
            
            let html = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>í—Œê¸ˆ ë‚´ì—­ - Sacramento Glory Korean Church</title>
                    <style>
                        body { font-family: 'Malgun Gothic', Arial, sans-serif; padding: 20px; font-size: 12px; }
                        h1 { text-align: center; margin-bottom: 5px; font-size: 18px; }
                        .subtitle { text-align: center; color: #666; margin-bottom: 20px; font-size: 11px; }
                        table { width: 100%; border-collapse: collapse; font-size: 11px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background: #f7fafc; font-weight: bold; }
                        tr:nth-child(even) { background: #fafafa; }
                        .total { font-weight: bold; background: #e8f5e9; }
                        .footer { text-align: center; margin-top: 20px; font-size: 10px; color: #888; }
                        @media print { body { padding: 10px; } @page { margin: 1cm; } }
                    </style>
                </head>
                <body>
                    <h1>Sacramento Glory Korean Church</h1>
                    <p class="subtitle">í—Œê¸ˆ ë‚´ì—­ (${periodNames[period]}) | ì¶œë ¥ì¼: ${new Date().toLocaleDateString('ko-KR')}</p>
                    <table>
                        <thead><tr><th>ë‚ ì§œ</th><th>í—Œê¸ˆì</th><th>ì¢…ë¥˜</th><th>ê¸ˆì•¡</th><th>ê²°ì œë°©ë²•</th></tr></thead>
                        <tbody>
            `;
            
            let total = 0;
            offerings.forEach(o => {
                total += o.amount || 0;
                html += `<tr><td>${o.date}</td><td>${o.memberName}</td><td>${o.type}</td><td>$${(o.amount || 0).toFixed(2)}</td><td>${o.payment || 'í˜„ê¸ˆ'}</td></tr>`;
            });
            
            html += `<tr class="total"><td colspan="3">í•©ê³„</td><td colspan="2">$${total.toFixed(2)}</td></tr></tbody></table>
                <p class="footer">Sacramento Glory Korean Church | EIN# 88-1719323</p></body></html>`;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.print();
        }
        
        // ì§€ì¶œ ì¸ì‡„
        function printExpenseList() {
            let expenses = JSON.parse(localStorage.getItem('churchExpenses') || '[]');
            if (expenses.length === 0) {
                alert('ì¸ì‡„í•  ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            let html = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>ì§€ì¶œ ë‚´ì—­ - Sacramento Glory Korean Church</title>
                    <style>
                        body { font-family: 'Malgun Gothic', Arial, sans-serif; padding: 20px; font-size: 12px; }
                        h1 { text-align: center; margin-bottom: 5px; font-size: 18px; }
                        .subtitle { text-align: center; color: #666; margin-bottom: 20px; font-size: 11px; }
                        table { width: 100%; border-collapse: collapse; font-size: 11px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background: #f7fafc; font-weight: bold; }
                        tr:nth-child(even) { background: #fafafa; }
                        .total { font-weight: bold; background: #ffebee; }
                        .footer { text-align: center; margin-top: 20px; font-size: 10px; color: #888; }
                        @media print { body { padding: 10px; } @page { margin: 1cm; } }
                    </style>
                </head>
                <body>
                    <h1>Sacramento Glory Korean Church</h1>
                    <p class="subtitle">ì§€ì¶œ ë‚´ì—­ | ì¶œë ¥ì¼: ${new Date().toLocaleDateString('ko-KR')}</p>
                    <table>
                        <thead><tr><th>ë‚ ì§œ</th><th>ë¶€ì„œ</th><th>ë¶„ë¥˜</th><th>í•­ëª©</th><th>ê¸ˆì•¡</th><th>ê²°ì œë°©ë²•</th></tr></thead>
                        <tbody>
            `;
            
            let total = 0;
            expenses.forEach(e => {
                total += e.amount || 0;
                html += `<tr><td>${e.date}</td><td>${e.department || '-'}</td><td>${e.category}</td><td>${e.item}</td><td>$${(e.amount || 0).toFixed(2)}</td><td>${e.payment || 'í˜„ê¸ˆ'}</td></tr>`;
            });
            
            html += `<tr class="total"><td colspan="4">í•©ê³„</td><td colspan="2">$${total.toFixed(2)}</td></tr></tbody></table>
                <p class="footer">Sacramento Glory Korean Church | EIN# 88-1719323</p></body></html>`;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.print();
        }
        
        // êµì¸ ì‚¬ì§„ ì—…ë¡œë“œ
        function handleMemberPhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('memberPhotoData').value = e.target.result;
                document.getElementById('memberPhotoPreview').innerHTML = `
                    <img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover;">
                `;
            };
            reader.readAsDataURL(file);
        }
        
        // ========== ë©˜í† ë§ ==========
        function loadMentoringData() {
            // ë©˜í†  ëª©ë¡
            const mentors = members.filter(m => m.mentoring?.role === 'mentor');
            // ë©˜í‹° ëª©ë¡
            const mentees = members.filter(m => m.mentoring?.role === 'mentee');
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            const totalMentorsEl = document.getElementById('totalMentors');
            const totalMenteesEl = document.getElementById('totalMentees');
            const totalPairsEl = document.getElementById('totalPairs');
            
            if (totalMentorsEl) totalMentorsEl.textContent = mentors.length;
            if (totalMenteesEl) totalMenteesEl.textContent = mentees.length;
            
            // ë§¤ì¹­ ìˆ˜ ê³„ì‚°
            let pairCount = 0;
            mentors.forEach(m => {
                if (m.mentoring?.menteeNames) {
                    pairCount += m.mentoring.menteeNames.split(',').filter(n => n.trim()).length;
                }
            });
            if (totalPairsEl) totalPairsEl.textContent = pairCount;
            
            // 4ì£¼ í”„ë¡œê·¸ë¨ ëª©ë¡ ë Œë”ë§
            const programListEl = document.getElementById('mentoringProgramList');
            if (!programListEl) return;
            
            if (mentors.length === 0) {
                programListEl.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ë“±ë¡ëœ ë©˜í† ë§ ê´€ê³„ê°€ ì—†ìŠµë‹ˆë‹¤.<br>êµì¸ ë“±ë¡ì—ì„œ ë©˜í† /ë©˜í‹°ë¥¼ ì§€ì •í•˜ì„¸ìš”.</p>';
                return;
            }
            
            // 4ì£¼ í”„ë¡œê·¸ë¨ ë°ì´í„° ë¡œë“œ
            let mentoringProgress = JSON.parse(localStorage.getItem('mentoringProgress') || '{}');
            
            let html = '';
            mentors.forEach((mentor, mIdx) => {
                const menteeNames = mentor.mentoring?.menteeNames || '';
                const menteeList = menteeNames.split(',').filter(n => n.trim());
                
                if (menteeList.length === 0) return;
                
                html += `
                    <div style="background: white; border: 2px solid #e2e8f0; border-radius: 16px; margin-bottom: 20px; overflow: hidden;">
                        <!-- ë©˜í†  í—¤ë” -->
                        <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 20px; color: white;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em;">
                                    ğŸ“
                                </div>
                                <div>
                                    <div style="font-size: 1.3em; font-weight: bold;">${mentor.nameKr}</div>
                                    <div style="opacity: 0.9;">${mentor.position || 'ì„±ë„'} | ${mentor.phone || ''}</div>
                                </div>
                                <div style="margin-left: auto; text-align: right;">
                                    <div style="font-size: 2em; font-weight: bold;">${menteeList.length}</div>
                                    <div style="font-size: 0.9em; opacity: 0.9;">ë‹´ë‹¹ ë©˜í‹°</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ë©˜í‹°ë³„ 4ì£¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
                        <div style="padding: 20px;">
                            ${menteeList.map((menteeName, menteeIdx) => {
                                const progressKey = `${mentor.memberNumber || mIdx}_${menteeName.trim()}`;
                                const progress = mentoringProgress[progressKey] || { week1: false, week2: false, week3: false, week4: false, pastorConfirmed: false };
                                const completedWeeks = [progress.week1, progress.week2, progress.week3, progress.week4].filter(w => w).length;
                                const progressPercent = (completedWeeks / 4) * 100;
                                const allCompleted = completedWeeks === 4 && progress.pastorConfirmed;
                                
                                return `
                                    <div style="border: 1px solid #e2e8f0; border-radius: 12px; padding: 15px; margin-bottom: 15px; ${allCompleted ? 'background: #f0fff4; border-color: #48bb78;' : ''}">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <div style="width: 40px; height: 40px; background: ${allCompleted ? '#48bb78' : '#9f7aea'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                                    ${menteeName.trim().charAt(0)}
                                                </div>
                                                <div>
                                                    <div style="font-weight: 600;">${menteeName.trim()}</div>
                                                    <div style="font-size: 0.85em; color: #888;">ì§„í–‰ë¥ : ${completedWeeks}/4ì£¼ (${progressPercent.toFixed(0)}%)</div>
                                                </div>
                                            </div>
                                            ${allCompleted ? '<span style="background: #48bb78; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.85em;">âœ“ ìˆ˜ë£Œ</span>' : ''}
                                        </div>
                                        
                                        <!-- ì§„í–‰ ë°” -->
                                        <div style="height: 8px; background: #e2e8f0; border-radius: 4px; margin-bottom: 15px;">
                                            <div style="height: 100%; width: ${progressPercent}%; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 4px; transition: width 0.3s;"></div>
                                        </div>
                                        
                                        <!-- 4ì£¼ ì²´í¬ë°•ìŠ¤ + ê´€ë¦¬ì í™•ì¸ -->
                                        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;">
                                            <label style="display: flex; flex-direction: column; align-items: center; padding: 12px 8px; background: ${progress.week1 ? '#667eea' : '#f8f9fa'}; border-radius: 10px; cursor: pointer; transition: all 0.3s;" onclick="toggleMentoringWeek('${progressKey}', 'week1')">
                                                <div style="font-size: 1.3em; margin-bottom: 3px; color: ${progress.week1 ? 'white' : '#667eea'};">${progress.week1 ? 'âœ“' : '1'}</div>
                                                <div style="font-size: 0.75em; font-weight: 600; color: ${progress.week1 ? 'white' : '#333'};">1ì£¼ì°¨</div>
                                                <div style="font-size: 0.65em; color: ${progress.week1 ? 'rgba(255,255,255,0.8)' : '#888'};">ì‹ ì•™ê¸°ì´ˆ</div>
                                            </label>
                                            <label style="display: flex; flex-direction: column; align-items: center; padding: 12px 8px; background: ${progress.week2 ? '#764ba2' : '#f8f9fa'}; border-radius: 10px; cursor: pointer; transition: all 0.3s;" onclick="toggleMentoringWeek('${progressKey}', 'week2')">
                                                <div style="font-size: 1.3em; margin-bottom: 3px; color: ${progress.week2 ? 'white' : '#764ba2'};">${progress.week2 ? 'âœ“' : '2'}</div>
                                                <div style="font-size: 0.75em; font-weight: 600; color: ${progress.week2 ? 'white' : '#333'};">2ì£¼ì°¨</div>
                                                <div style="font-size: 0.65em; color: ${progress.week2 ? 'rgba(255,255,255,0.8)' : '#888'};">ë§ì”€ê¸°ë„</div>
                                            </label>
                                            <label style="display: flex; flex-direction: column; align-items: center; padding: 12px 8px; background: ${progress.week3 ? '#9f7aea' : '#f8f9fa'}; border-radius: 10px; cursor: pointer; transition: all 0.3s;" onclick="toggleMentoringWeek('${progressKey}', 'week3')">
                                                <div style="font-size: 1.3em; margin-bottom: 3px; color: ${progress.week3 ? 'white' : '#9f7aea'};">${progress.week3 ? 'âœ“' : '3'}</div>
                                                <div style="font-size: 0.75em; font-weight: 600; color: ${progress.week3 ? 'white' : '#333'};">3ì£¼ì°¨</div>
                                                <div style="font-size: 0.65em; color: ${progress.week3 ? 'rgba(255,255,255,0.8)' : '#888'};">êµíšŒìƒí™œ</div>
                                            </label>
                                            <label style="display: flex; flex-direction: column; align-items: center; padding: 12px 8px; background: ${progress.week4 ? '#b794f4' : '#f8f9fa'}; border-radius: 10px; cursor: pointer; transition: all 0.3s;" onclick="toggleMentoringWeek('${progressKey}', 'week4')">
                                                <div style="font-size: 1.3em; margin-bottom: 3px; color: ${progress.week4 ? 'white' : '#b794f4'};">${progress.week4 ? 'âœ“' : '4'}</div>
                                                <div style="font-size: 0.75em; font-weight: 600; color: ${progress.week4 ? 'white' : '#333'};">4ì£¼ì°¨</div>
                                                <div style="font-size: 0.65em; color: ${progress.week4 ? 'rgba(255,255,255,0.8)' : '#888'};">ì„¬ê¹€ì „ë„</div>
                                            </label>
                                            <label style="display: flex; flex-direction: column; align-items: center; padding: 12px 8px; background: ${progress.pastorConfirmed ? '#48bb78' : '#fff3cd'}; border: 2px solid ${progress.pastorConfirmed ? '#48bb78' : '#ffc107'}; border-radius: 10px; cursor: pointer; transition: all 0.3s;" onclick="toggleMentoringWeek('${progressKey}', 'pastorConfirmed')">
                                                <div style="font-size: 1.3em; margin-bottom: 3px; color: ${progress.pastorConfirmed ? 'white' : '#856404'};">${progress.pastorConfirmed ? 'âœ“' : 'â›ª'}</div>
                                                <div style="font-size: 0.75em; font-weight: 600; color: ${progress.pastorConfirmed ? 'white' : '#333'};">ê´€ë¦¬ì</div>
                                                <div style="font-size: 0.65em; color: ${progress.pastorConfirmed ? 'rgba(255,255,255,0.8)' : '#856404'};">í™•ì¸</div>
                                            </label>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            });
            
            programListEl.innerHTML = html || '<p style="text-align: center; color: #666; padding: 40px;">ë©˜í† ì—ê²Œ ë©˜í‹°ê°€ ë°°ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
        }
        
        // 4ì£¼ í”„ë¡œê·¸ë¨ ì²´í¬ í† ê¸€
        function toggleMentoringWeek(progressKey, week) {
            // ê´€ë¦¬ì í™•ì¸ì€ ê´€ë¦¬ìë§Œ ê°€ëŠ¥
            if (week === 'pastorConfirmed') {
                if (!currentUser || currentUser.username !== 'pastor') {
                    alert('ê´€ë¦¬ì í™•ì¸ì€ ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    return;
                }
            }
            
            let mentoringProgress = JSON.parse(localStorage.getItem('mentoringProgress') || '{}');
            if (!mentoringProgress[progressKey]) {
                mentoringProgress[progressKey] = { week1: false, week2: false, week3: false, week4: false };
            }
            mentoringProgress[progressKey][week] = !mentoringProgress[progressKey][week];
            localStorage.setItem('mentoringProgress', JSON.stringify(mentoringProgress));
            loadMentoringData();
        }
        
        // ========== ë¶€ì„œê´€ë¦¬ ==========
        let departments = JSON.parse(localStorage.getItem('departments') || '[]');
        
        // ê¸°ë³¸ ë¶€ì„œ ì´ˆê¸°í™”
        function initDefaultDepartments() {
            if (departments.length === 0) {
                departments = [
                    { name: 'ì˜ˆë°°ë¶€', color: '#1a1a2e', leader: '', description: 'ì˜ˆë°° ê¸°íš ë° ì§„í–‰ ì´ê´„', meeting: 'ë§¤ì£¼ í† ìš”ì¼ ì˜¤í›„ 3ì‹œ', budget: 5000, teams: [], expenses: [], eventPlan: [] },
                    { name: 'êµìœ¡ë¶€', color: '#0f3460', leader: '', description: 'ì„±ê²½ê³µë¶€ ë° êµìœ¡ í”„ë¡œê·¸ë¨', meeting: 'ë§¤ì£¼ ì£¼ì¼ ì˜¤ì „ 10ì‹œ', budget: 3000, teams: [], expenses: [], eventPlan: [] },
                    { name: 'ì„ êµë¶€', color: '#533483', leader: '', description: 'êµ­ë‚´ì™¸ ì„ êµ ì‚¬ì—­', meeting: 'ë§¤ì›” ì²«ì§¸ ì£¼ì¼', budget: 8000, teams: [], expenses: [], eventPlan: [] },
                    { name: 'ì¹œêµë¶€', color: '#e94560', leader: '', description: 'ìƒˆê°€ì¡± í™˜ì˜ ë° ì¹œêµ', meeting: 'ë§¤ì£¼ ì£¼ì¼ ì˜ˆë°° í›„', budget: 2000, teams: [], expenses: [], eventPlan: [] }
                ];
                localStorage.setItem('departments', JSON.stringify(departments));
            }
        }
        
        // ë¶€ì„œê´€ë¦¬ ì„¹ì…˜ ë¡œë“œ
        function showDeptMainTab(tabName) {
            // íƒ­ í†µí•©ìœ¼ë¡œ ì¸í•´ ëª¨ë“  ë°ì´í„° ë¡œë“œ
            loadDepartmentList();
            loadYearlyEventCalendar();
        }
        
        // ë¶€ì„œê´€ë¦¬ ì„¹ì…˜ ì´ˆê¸°í™”
        function loadDepartmentSection() {
            loadDepartmentList();
            loadYearlyEventCalendar();
        }
        
        // ë¶€ì„œë³„ ì˜ˆì‚° í˜„í™© ì°¨íŠ¸ - ì¬ì •ê´€ë¦¬ ì˜ˆì‚° ê¸°ì¤€
        function loadDeptBudgetChart() {
            const container = document.getElementById('deptBudgetChart');
            if (!container) return;
            
            // ì¬ì •ê´€ë¦¬ ì˜ˆì‚° ë°ì´í„° ê¸°ì¤€
            const currentYear = new Date().getFullYear();
            const yearBudgets = budgets.filter(b => b.year === currentYear);
            
            if (yearBudgets.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ë“±ë¡ëœ ì˜ˆì‚°ì´ ì—†ìŠµë‹ˆë‹¤. ì¬ì •ê´€ë¦¬ì—ì„œ ì˜ˆì‚°ì„ í¸ì„±í•´ì£¼ì„¸ìš”.</p>';
                return;
            }
            
            // í—¤ë” í†µê³„ ì—…ë°ì´íŠ¸
            const totalDeptEl = document.getElementById('totalDepartments');
            const totalTeamsEl = document.getElementById('totalTeams');
            const totalMembersEl = document.getElementById('totalDeptMembers');
            const totalBudgetEl = document.getElementById('totalDeptBudget');
            
            let totalTeams = 0;
            let totalMembers = 0;
            departments.forEach(d => {
                totalTeams += (d.teams?.length || 0);
                d.teams?.forEach(t => {
                    totalMembers += (t.members?.length || 0);
                });
            });
            
            if (totalDeptEl) totalDeptEl.textContent = yearBudgets.length;
            if (totalTeamsEl) totalTeamsEl.textContent = totalTeams;
            if (totalMembersEl) totalMembersEl.textContent = totalMembers;
            
            // ë¶€ì„œë³„ ìƒ‰ìƒ ë§¤í•‘
            const deptColors = {
                'ì˜ˆë°°ë¶€': '#1a1a2e',
                'êµìœ¡ë¶€': '#0f3460',
                'ì¹œêµë¶€': '#e94560',
                'ê´€ë¦¬ë¶€': '#533483',
                'ì¬ì •ë¶€': '#16213e',
                'ë´‰ì‚¬ë¶€': '#4a5568',
                'ì„ êµë¶€': '#2d3748',
                'ì²­ë…„ë¶€': '#667eea'
            };
            
            let html = '';
            let totalBudget = 0;
            
            yearBudgets.forEach((budgetItem, idx) => {
                // ì¬ì •ê´€ë¦¬ ì§€ì¶œì—ì„œ í•´ë‹¹ ë¶€ì„œ ì§€ì¶œì•¡ ê³„ì‚°
                const deptExpenses = expenses.filter(e => e.department === budgetItem.name);
                const usedBudget = deptExpenses.reduce((sum, e) => sum + e.amount, 0);
                
                const budget = budgetItem.budget || 0;
                totalBudget += budget;
                const percent = budget > 0 ? ((usedBudget / budget) * 100).toFixed(1) : 0;
                const remaining = budget - usedBudget;
                const isOver = usedBudget > budget;
                const color = deptColors[budgetItem.name] || '#667eea';
                
                // ë¶€ì„œê´€ë¦¬ì—ì„œ ë¶€ì„œì¥ ì •ë³´ ì°¾ê¸°
                const deptInfo = departments.find(d => d.name === budgetItem.name);
                const leader = deptInfo?.leader || '';
                
                html += `
                    <div style="background: white; border: 2px solid ${color}20; border-radius: 15px; padding: 20px; position: relative; overflow: hidden;">
                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 5px; background: ${color};"></div>
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                            <div>
                                <h3 style="margin: 0; color: ${color};">${budgetItem.name}</h3>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #888;">${leader || 'ë¶€ì„œì¥ ë¯¸ì •'}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.5em; font-weight: bold; color: ${color};">$${budget.toLocaleString()}</div>
                                <div style="font-size: 0.8em; color: #888;">ì—°ê°„ ì˜ˆì‚°</div>
                            </div>
                        </div>
                        
                        <div style="background: #e2e8f0; border-radius: 10px; height: 12px; margin-bottom: 10px; overflow: hidden;">
                            <div style="height: 100%; width: ${Math.min(percent, 100)}%; background: ${isOver ? '#e53e3e' : percent > 80 ? '#ed8936' : '#48bb78'}; border-radius: 10px; transition: width 0.5s;"></div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; font-size: 0.85em;">
                            <span style="color: ${isOver ? '#e53e3e' : '#666'};">
                                ì§€ì¶œ: $${usedBudget.toLocaleString()} (${percent}%)
                            </span>
                            <span style="color: ${remaining < 0 ? '#e53e3e' : '#48bb78'};">
                                ${remaining >= 0 ? 'ì”ì—¬' : 'ì´ˆê³¼'}: $${Math.abs(remaining).toLocaleString()}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // ì´ ì˜ˆì‚° ì—…ë°ì´íŠ¸
            if (totalBudgetEl) totalBudgetEl.textContent = '$' + totalBudget.toLocaleString();
        }
        
        // ì›”ê°„ í–‰ì‚¬ HTML ìƒì„± (ì´ë²ˆë‹¬ + ë‹¤ìŒë‹¬)
        function getMonthlyEventsHtml(deptName, deptIndex) {
            const now = new Date();
            const thisMonth = now.getMonth() + 1;
            const nextMonth = thisMonth === 12 ? 1 : thisMonth + 1;
            const monthNames = ['', '1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            
            let events = [];
            
            // 1. yearlyEvents (ëŒ€ì‹œë³´ë“œ ì—°ê°„í–‰ì‚¬)ì—ì„œ í•´ë‹¹ ë¶€ì„œ í–‰ì‚¬ ê°€ì ¸ì˜¤ê¸°
            const yearlyEvts = JSON.parse(localStorage.getItem('yearlyEvents') || '[]');
            yearlyEvts.forEach(e => {
                if (e.department === deptName && (parseInt(e.month) === thisMonth || parseInt(e.month) === nextMonth)) {
                    events.push({
                        ...e,
                        source: 'yearly'
                    });
                }
            });
            
            // 2. dept.eventPlan (ë¶€ì„œë³„ í–‰ì‚¬)ì—ì„œë„ ì´ë²ˆë‹¬/ë‹¤ìŒë‹¬ í–‰ì‚¬ ê°€ì ¸ì˜¤ê¸°
            const dept = departments[deptIndex];
            if (dept && dept.eventPlan) {
                dept.eventPlan.forEach(e => {
                    if (parseInt(e.month) === thisMonth || parseInt(e.month) === nextMonth) {
                        events.push({
                            ...e,
                            source: 'dept'
                        });
                    }
                });
            }
            
            // ì¤‘ë³µ ì œê±° (ì´ë¦„ê³¼ ì›”ì´ ê°™ìœ¼ë©´ ì¤‘ë³µ)
            const uniqueEvents = [];
            events.forEach(e => {
                if (!uniqueEvents.find(ue => ue.name === e.name && ue.month === e.month)) {
                    uniqueEvents.push(e);
                }
            });
            
            // ì›”, ë‚ ì§œ ìˆœ ì •ë ¬
            uniqueEvents.sort((a, b) => {
                if (parseInt(a.month) !== parseInt(b.month)) return parseInt(a.month) - parseInt(b.month);
                return (a.date || '').localeCompare(b.date || '');
            });
            
            if (uniqueEvents.length === 0) {
                return '<p style="text-align: center; color: #999; font-size: 0.9em;">ì´ë²ˆë‹¬/ë‹¤ìŒë‹¬ í–‰ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
            }
            
            let html = '';
            uniqueEvents.forEach(event => {
                const isThisMonth = parseInt(event.month) === thisMonth;
                const statusColors = {
                    'ì™„ë£Œ': '#48bb78',
                    'ì§„í–‰ì¤‘': '#ed8936',
                    'ì˜ˆì •': '#e2e8f0'
                };
                const statusColor = statusColors[event.status] || '#e2e8f0';
                const textColor = event.status === 'ì™„ë£Œ' || event.status === 'ì§„í–‰ì¤‘' ? 'white' : '#666';
                
                // ë‚ ì§œ í‘œì‹œ (ì‹œì‘ì¼~ì¢…ë£Œì¼)
                let dateDisplay = '';
                if (event.date) {
                    const startDay = event.date.split('-').slice(1).join('/');
                    if (event.endDate && event.endDate !== event.date) {
                        const endDay = event.endDate.split('-').slice(1).join('/');
                        dateDisplay = `${startDay}~${endDay}`;
                    } else {
                        dateDisplay = startDay;
                    }
                }
                
                // ì‹œê°„ í‘œì‹œ
                let timeDisplay = '';
                if (event.startTime) {
                    timeDisplay = event.startTime;
                    if (event.endTime) {
                        timeDisplay += `~${event.endTime}`;
                    }
                }
                
                html += `
                    <div style="background: white; padding: 8px 10px; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid ${isThisMonth ? '#667eea' : '#a0aec0'};">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 0.85em; font-weight: 500;">${event.name || '(ë¯¸ì •)'}</div>
                                <div style="font-size: 0.75em; color: #888;">
                                    <span style="color: ${isThisMonth ? '#667eea' : '#a0aec0'}; font-weight: 600;">${monthNames[parseInt(event.month)]}</span>
                                    ${dateDisplay}
                                    ${timeDisplay ? ` <span style="color: #e53e3e;">â°${timeDisplay}</span>` : ''}
                                </div>
                            </div>
                            <span style="background: ${statusColor}; color: ${textColor}; padding: 2px 8px; border-radius: 10px; font-size: 0.7em;">${event.status || 'ì˜ˆì •'}</span>
                        </div>
                    </div>
                `;
            });
            
            return html;
        }
        
        // ë¶€ì„œ ëª©ë¡ ë¡œë“œ - í•œëˆˆì— ë³´ê¸°
        function loadDepartmentList() {
            initDefaultDepartments();
            
            const container = document.getElementById('departmentFullList');
            const totalDeptEl = document.getElementById('totalDepartments');
            const totalTeamsEl = document.getElementById('totalTeams');
            const totalMembersEl = document.getElementById('totalDeptMembers');
            const isPastor = currentUser && currentUser.role === 'ê´€ë¦¬ì';
            
            if (totalDeptEl) totalDeptEl.textContent = departments.length;
            
            // ì´ íŒ€ ìˆ˜, ë´‰ì‚¬ì ìˆ˜ ê³„ì‚°
            let totalTeams = 0;
            let totalMembers = 0;
            departments.forEach(d => {
                totalTeams += (d.teams?.length || 0);
                d.teams?.forEach(t => {
                    totalMembers += (t.members?.length || 0);
                });
            });
            if (totalTeamsEl) totalTeamsEl.textContent = totalTeams;
            if (totalMembersEl) totalMembersEl.textContent = totalMembers;
            
            if (!container) return;
            
            if (departments.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ë“±ë¡ëœ ë¶€ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ì´ë²ˆë‹¬/ë‹¤ìŒë‹¬ ê³„ì‚°
            const now = new Date();
            const currentYear = now.getFullYear();
            const thisMonth = now.getMonth() + 1;
            const nextMonth = thisMonth === 12 ? 1 : thisMonth + 1;
            const yearlyEvts = JSON.parse(localStorage.getItem('yearlyEvents') || '[]');
            
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px;">';
            
            departments.forEach((dept, deptIndex) => {
                const teamCount = dept.teams?.length || 0;
                let memberCount = 0;
                dept.teams?.forEach(t => memberCount += (t.members?.length || 0));
                
                // ì¬ì •ê´€ë¦¬ ì˜ˆì‚°ì—ì„œ í•´ë‹¹ ë¶€ì„œ ì˜ˆì‚° ì°¾ê¸°
                const budgetItem = budgets.find(b => b.name === dept.name && b.year === currentYear);
                const deptBudget = budgetItem ? budgetItem.budget : (dept.budget || 0);
                
                // ì§€ì¶œì•¡ ê³„ì‚° (ì¬ì •ê´€ë¦¬ ì§€ì¶œì—ì„œ)
                const deptExpenses = expenses.filter(e => e.department === dept.name);
                const usedBudget = deptExpenses.reduce((sum, e) => sum + e.amount, 0);
                const budgetPercent = deptBudget > 0 ? Math.round((usedBudget / deptBudget) * 100) : 0;
                
                // ì´ë²ˆë‹¬/ë‹¤ìŒë‹¬ í–‰ì‚¬ ìˆ˜
                let eventCount = 0;
                yearlyEvts.forEach(e => {
                    if (e.department === dept.name && (parseInt(e.month) === thisMonth || parseInt(e.month) === nextMonth)) {
                        eventCount++;
                    }
                });
                if (dept.eventPlan) {
                    dept.eventPlan.forEach(e => {
                        if (parseInt(e.month) === thisMonth || parseInt(e.month) === nextMonth) {
                            eventCount++;
                        }
                    });
                }
                
                // ë‹¤ìŒ í–‰ì‚¬ ì°¾ê¸°
                let nextEvent = null;
                const allEvents = [
                    ...yearlyEvts.filter(e => e.department === dept.name),
                    ...(dept.eventPlan || [])
                ].filter(e => parseInt(e.month) >= thisMonth).sort((a, b) => parseInt(a.month) - parseInt(b.month));
                if (allEvents.length > 0) nextEvent = allEvents[0];
                
                html += `
                    <div style="background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.08); border: 1px solid #e2e8f0; transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;" 
                         onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.12)';"
                         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 10px rgba(0,0,0,0.08)';">
                        
                        <!-- ìƒë‹¨ í—¤ë” -->
                        <div style="background: ${dept.color}; padding: 20px; color: white;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <h3 style="margin: 0; font-size: 1.3em;">${dept.name}</h3>
                                    <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9em;">${dept.leader || 'ë¶€ì„œì¥ ë¯¸ì •'}</p>
                                </div>
                                ${isPastor ? `
                                <div style="display: flex; gap: 5px;">
                                    <button onclick="event.stopPropagation(); editDepartment(${deptIndex})" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8em;">í¸ì§‘</button>
                                    <button onclick="event.stopPropagation(); deleteDepartment(${deptIndex})" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8em;">ì‚­ì œ</button>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- í†µê³„ -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); text-align: center; padding: 15px 10px; background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
                            <div>
                                <div style="font-size: 1.4em; font-weight: bold; color: ${dept.color};">${teamCount}</div>
                                <div style="font-size: 0.75em; color: #888;">íŒ€</div>
                            </div>
                            <div>
                                <div style="font-size: 1.4em; font-weight: bold; color: ${dept.color};">${memberCount}</div>
                                <div style="font-size: 0.75em; color: #888;">ë´‰ì‚¬ì</div>
                            </div>
                            <div>
                                <div style="font-size: 1.4em; font-weight: bold; color: ${dept.color};">${eventCount}</div>
                                <div style="font-size: 0.75em; color: #888;">ì˜ˆì •í–‰ì‚¬</div>
                            </div>
                        </div>
                        
                        <!-- ë³¸ë¬¸ -->
                        <div style="padding: 15px;">
                            <!-- ì˜ˆì‚° -->
                            <div style="margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; font-size: 0.85em; margin-bottom: 5px;">
                                    <span style="color: #666;">ì˜ˆì‚° $${deptBudget.toLocaleString()}</span>
                                    <span style="color: ${budgetPercent > 90 ? '#e53e3e' : '#48bb78'};">${budgetPercent}% ì‚¬ìš©</span>
                                </div>
                                <div style="height: 6px; background: #e2e8f0; border-radius: 3px;">
                                    <div style="height: 100%; width: ${Math.min(budgetPercent, 100)}%; background: ${budgetPercent > 90 ? '#e53e3e' : budgetPercent > 70 ? '#ed8936' : '#48bb78'}; border-radius: 3px;"></div>
                                </div>
                            </div>
                            
                            <!-- ë‹¤ìŒ í–‰ì‚¬ -->
                            ${nextEvent ? `
                                <div style="background: #f0f4ff; padding: 10px 12px; border-radius: 8px; margin-bottom: 15px;">
                                    <div style="font-size: 0.75em; color: #667eea; margin-bottom: 3px;">ë‹¤ìŒ í–‰ì‚¬</div>
                                    <div style="font-size: 0.9em; font-weight: 600;">${nextEvent.name}</div>
                                    <div style="font-size: 0.8em; color: #888;">${nextEvent.month}ì›” ${nextEvent.date ? nextEvent.date.split('-').slice(2).join('') + 'ì¼' : ''}</div>
                                </div>
                            ` : `
                                <div style="background: #f8f9fa; padding: 10px 12px; border-radius: 8px; margin-bottom: 15px; text-align: center; color: #999; font-size: 0.85em;">
                                    ì˜ˆì •ëœ í–‰ì‚¬ ì—†ìŒ
                                </div>
                            `}
                            
                            <!-- ë²„íŠ¼ ê·¸ë£¹ -->
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                                <button onclick="event.stopPropagation(); showDeptDetailModal(${deptIndex}, 'team')" style="background: #f8f9fa; border: 1px solid #e2e8f0; padding: 10px 5px; border-radius: 8px; cursor: pointer; font-size: 0.8em;">
                                    íŒ€ê´€ë¦¬
                                </button>
                                <button onclick="event.stopPropagation(); showDeptDetailModal(${deptIndex}, 'expense')" style="background: #fff5f5; border: 1px solid #fed7d7; padding: 10px 5px; border-radius: 8px; cursor: pointer; font-size: 0.8em;">
                                    ì§€ì¶œ
                                </button>
                                <button onclick="event.stopPropagation(); showDeptDetailModal(${deptIndex}, 'event')" style="background: #f0f4ff; border: 1px solid #c3dafe; padding: 10px 5px; border-radius: 8px; cursor: pointer; font-size: 0.8em;">
                                    í–‰ì‚¬
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // ë¶€ì„œ ìƒì„¸ ëª¨ë‹¬
        function showDeptDetailModal(deptIndex, tab = 'team') {
            const dept = departments[deptIndex];
            const currentYear = new Date().getFullYear();
            
            let content = '';
            
            if (tab === 'team') {
                content = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0;">${dept.name} íŒ€ ê´€ë¦¬</h3>
                        <button onclick="showAddTeamModalFor(${deptIndex}); closeDeptDetailModal();" class="btn btn-primary" style="padding: 8px 15px;">+ íŒ€ ì¶”ê°€</button>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${(dept.teams && dept.teams.length > 0) ? dept.teams.map((team, tIdx) => `
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid ${dept.color};">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div>
                                        <div style="font-weight: 600; font-size: 1.1em;">${team.name}</div>
                                        <div style="font-size: 0.9em; color: #888;">íŒ€ì¥: ${team.leader || 'ë¯¸ì •'}</div>
                                    </div>
                                    <button onclick="deleteTeamFrom(${deptIndex}, ${tIdx}); showDeptDetailModal(${deptIndex}, 'team');" class="btn btn-danger" style="padding: 5px 12px; font-size: 0.85em;">ì‚­ì œ</button>
                                </div>
                                ${team.members && team.members.length > 0 ? `
                                    <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                                        ${team.members.map(m => `<span style="background: white; padding: 4px 12px; border-radius: 15px; font-size: 0.85em; border: 1px solid #e2e8f0;">${m.name}</span>`).join('')}
                                    </div>
                                ` : '<p style="color: #999; font-size: 0.9em; margin: 0;">íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤</p>'}
                            </div>
                        `).join('') : '<p style="text-align: center; color: #999; padding: 40px;">ë“±ë¡ëœ íŒ€ì´ ì—†ìŠµë‹ˆë‹¤</p>'}
                    </div>
                `;
            } else if (tab === 'expense') {
                content = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0;">${dept.name} ì§€ì¶œ ê²°ì˜ì„œ</h3>
                        <button onclick="showExpenseModalFor(${deptIndex}); closeDeptDetailModal();" class="btn btn-primary" style="padding: 8px 15px;">+ ê²°ì˜ì„œ ì‘ì„±</button>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${(dept.expenses && dept.expenses.length > 0) ? dept.expenses.slice().reverse().map((exp, eIdx) => {
                            const expIndex = dept.expenses.length - 1 - eIdx;
                            const statusBg = exp.paymentRequested ? (exp.paymentApproved ? '#48bb78' : '#f6ad55') : '#e2e8f0';
                            const statusText = exp.paymentRequested ? (exp.paymentApproved ? 'âœ“ ì§€ê¸‰ì™„ë£Œ' : 'â³ ìš”ì²­ì¤‘') : '';
                            return `
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                    <div>
                                        <div style="font-weight: 600;">${exp.item}</div>
                                        <div style="font-size: 0.85em; color: #888; margin-top: 3px;">${exp.date} | ${exp.category || 'ê¸°íƒ€'}</div>
                                        ${statusText ? `<span style="display: inline-block; margin-top: 5px; background: ${statusBg}; color: ${exp.paymentApproved ? 'white' : '#333'}; padding: 3px 10px; border-radius: 12px; font-size: 0.8em;">${statusText}</span>` : ''}
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 1.2em; font-weight: bold; color: #e53e3e;">$${exp.amount?.toFixed(2) || '0.00'}</div>
                                        <div style="margin-top: 8px; display: flex; gap: 5px;">
                                            ${!exp.paymentRequested ? `<button onclick="requestPayment(${deptIndex}, ${expIndex}); showDeptDetailModal(${deptIndex}, 'expense');" style="background: #4299e1; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8em;">ê²°ì œìš”ì²­</button>` : ''}
                                            <button onclick="deleteDeptExpense(${deptIndex}, ${expIndex}); showDeptDetailModal(${deptIndex}, 'expense');" style="background: #fc8181; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8em;">ì‚­ì œ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;}).join('') : '<p style="text-align: center; color: #999; padding: 40px;">ë“±ë¡ëœ ì§€ì¶œ ê²°ì˜ì„œê°€ ì—†ìŠµë‹ˆë‹¤</p>'}
                    </div>
                `;
            } else if (tab === 'event') {
                content = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0;">ğŸ“… ${dept.name} ì›”ê°„ í–‰ì‚¬</h3>
                        <button onclick="showAddEventModal(null, '${dept.name}'); closeDeptDetailModal();" class="btn btn-primary" style="padding: 8px 15px;">+ í–‰ì‚¬ ì¶”ê°€</button>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${getMonthlyEventsHtml(dept.name, deptIndex) || '<p style="text-align: center; color: #999; padding: 40px;">ì´ë²ˆë‹¬/ë‹¤ìŒë‹¬ í–‰ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤</p>'}
                    </div>
                `;
            }
            
            // ëª¨ë‹¬ ìƒì„±
            let modal = document.getElementById('deptDetailModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'deptDetailModal';
                modal.className = 'modal';
                document.body.appendChild(modal);
            }
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header" style="background: ${dept.color};">
                        <h2>${dept.name}</h2>
                    </div>
                    <div style="display: flex; border-bottom: 2px solid #e2e8f0; margin-bottom: 20px;">
                        <div onclick="showDeptDetailModal(${deptIndex}, 'team')" style="flex: 1; padding: 12px; text-align: center; cursor: pointer; font-weight: 600; ${tab === 'team' ? 'background: #f8f9fa; border-bottom: 3px solid ' + dept.color : 'color: #888;'}">ğŸ‘¥ íŒ€</div>
                        <div onclick="showDeptDetailModal(${deptIndex}, 'expense')" style="flex: 1; padding: 12px; text-align: center; cursor: pointer; font-weight: 600; ${tab === 'expense' ? 'background: #fff5f5; border-bottom: 3px solid #e53e3e' : 'color: #888;'}">ğŸ’° ì§€ì¶œ</div>
                        <div onclick="showDeptDetailModal(${deptIndex}, 'event')" style="flex: 1; padding: 12px; text-align: center; cursor: pointer; font-weight: 600; ${tab === 'event' ? 'background: #f0f4ff; border-bottom: 3px solid #667eea' : 'color: #888;'}">ğŸ“… í–‰ì‚¬</div>
                    </div>
                    ${content}
                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="closeDeptDetailModal()">ë‹«ê¸°</button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }
        
        function closeDeptDetailModal() {
            const modal = document.getElementById('deptDetailModal');
            if (modal) modal.classList.remove('active');
        }
        
        // íŠ¹ì • ë¶€ì„œì— íŒ€ ì¶”ê°€ ëª¨ë‹¬
        function showAddTeamModalFor(deptIndex) {
            document.getElementById('teamDeptIndex').value = deptIndex;
            document.getElementById('teamModalTitle').textContent = `+ ${departments[deptIndex].name} íŒ€ ì¶”ê°€`;
            document.getElementById('teamForm').reset();
            document.getElementById('teamEditIndex').value = -1;
            document.getElementById('teamModal').classList.add('active');
        }
        
        // íŠ¹ì • ë¶€ì„œì—ì„œ íŒ€ ì‚­ì œ
        function deleteTeamFrom(deptIndex, teamIndex) {
            if (confirm('ì´ íŒ€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                departments[deptIndex].teams.splice(teamIndex, 1);
                localStorage.setItem('departments', JSON.stringify(departments));
                loadDepartmentList();
            }
        }
        
        // íŠ¹ì • ë¶€ì„œì— ì§€ì¶œ ê²°ì˜ì„œ ëª¨ë‹¬
        function showExpenseModalFor(deptIndex) {
            document.getElementById('expReqDeptIndex').value = deptIndex;
            document.getElementById('expenseRequestForm').reset();
            document.getElementById('expReqDate').valueAsDate = new Date();
            document.getElementById('receiptPreview').innerHTML = '<p style="color: #666; margin: 0;">í´ë¦­í•˜ì—¬ ì˜ìˆ˜ì¦ ì‚¬ì§„ ì—…ë¡œë“œ</p>';
            document.getElementById('expReqReceiptData').value = '';
            document.getElementById('expenseRequestModal').classList.add('active');
        }
        
        // íŠ¹ì • ë¶€ì„œì— í–‰ì‚¬ ì¶”ê°€
        function addEventPlanFor(deptIndex) {
            if (!departments[deptIndex].eventPlan) departments[deptIndex].eventPlan = [];
            const eventName = prompt('í–‰ì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (eventName) {
                const month = prompt('ëª‡ ì›” í–‰ì‚¬ì…ë‹ˆê¹Œ? (1-12):', (new Date().getMonth() + 1).toString());
                departments[deptIndex].eventPlan.push({
                    month: parseInt(month) || (new Date().getMonth() + 1),
                    name: eventName,
                    date: '',
                    manager: '',
                    budget: 0,
                    note: '',
                    status: 'ì˜ˆì •'
                });
                localStorage.setItem('departments', JSON.stringify(departments));
                loadDepartmentList();
            }
        }
        
        // ë¶€ì„œ ì§€ì¶œ ê²°ì˜ì„œ ì‚­ì œ
        function deleteDeptExpense(deptIndex, expIndex) {
            if (confirm('ì´ ì§€ì¶œ ê²°ì˜ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const expId = departments[deptIndex].expenses[expIndex].id;
                departments[deptIndex].expenses.splice(expIndex, 1);
                localStorage.setItem('departments', JSON.stringify(departments));
                
                // ì¬ì •ê´€ë¦¬ ì§€ì¶œì—ì„œë„ ì‚­ì œ
                let expenses = JSON.parse(localStorage.getItem('churchExpenses') || '[]');
                expenses = expenses.filter(e => e.id !== expId);
                localStorage.setItem('churchExpenses', JSON.stringify(expenses));
                
                // ê²°ì œìš”ì²­ ëª©ë¡ì—ì„œë„ ì‚­ì œ
                let paymentRequests = JSON.parse(localStorage.getItem('paymentRequests') || '[]');
                paymentRequests = paymentRequests.filter(r => r.id !== expId);
                localStorage.setItem('paymentRequests', JSON.stringify(paymentRequests));
                
                loadDepartmentList();
                loadPaymentRequests();
                alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ê²°ì œ ìš”ì²­
        function requestPayment(deptIndex, expIndex) {
            const exp = departments[deptIndex].expenses[expIndex];
            const dept = departments[deptIndex];
            
            if (confirm(`"${exp.item}" ì§€ì¶œì— ëŒ€í•´ ê²°ì œë¥¼ ìš”ì²­í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê¸ˆì•¡: $${exp.amount.toFixed(2)}\në¶€ì„œ: ${dept.name}`)) {
                departments[deptIndex].expenses[expIndex].paymentRequested = true;
                departments[deptIndex].expenses[expIndex].requestDate = new Date().toISOString().split('T')[0];
                departments[deptIndex].expenses[expIndex].requester = dept.leader || 'ë¯¸ì •';
                localStorage.setItem('departments', JSON.stringify(departments));
                
                // ê²°ì œìš”ì²­ ëª©ë¡ì— ì¶”ê°€
                let paymentRequests = JSON.parse(localStorage.getItem('paymentRequests') || '[]');
                paymentRequests.push({
                    id: exp.id,
                    deptIndex: deptIndex,
                    expIndex: expIndex,
                    department: dept.name,
                    deptLeader: dept.leader || 'ë¯¸ì •',
                    item: exp.item,
                    amount: exp.amount,
                    date: exp.date,
                    requestDate: new Date().toISOString().split('T')[0],
                    status: 'pending'
                });
                localStorage.setItem('paymentRequests', JSON.stringify(paymentRequests));
                
                loadDepartmentList();
                alert('ê²°ì œ ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.\nì¬ì •ê´€ë¦¬ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            }
        }
        
        // ë¶€ì„œ ì¶”ê°€ ëª¨ë‹¬
        function showAddDepartmentModal() {
            document.getElementById('deptModalTitle').textContent = 'â¬¢ ìƒˆ ë¶€ì„œ ì¶”ê°€';
            document.getElementById('departmentForm').reset();
            document.getElementById('deptEditIndex').value = -1;
            document.getElementById('departmentModal').classList.add('active');
        }
        
        function closeDepartmentModal() {
            document.getElementById('departmentModal').classList.remove('active');
        }
        
        // ë¶€ì„œ ìˆ˜ì •
        function editDepartment(index) {
            const dept = departments[index];
            document.getElementById('deptModalTitle').textContent = 'â¬¢ ë¶€ì„œ ìˆ˜ì •';
            document.getElementById('deptName').value = dept.name;
            document.getElementById('deptColor').value = dept.color;
            document.getElementById('deptLeader').value = dept.leader || '';
            document.getElementById('deptDescription').value = dept.description || '';
            document.getElementById('deptMeeting').value = dept.meeting || '';
            document.getElementById('deptBudget').value = dept.budget || 0;
            document.getElementById('deptEditIndex').value = index;
            document.getElementById('departmentModal').classList.add('active');
        }
        
        // ë¶€ì„œ ì €ì¥
        document.getElementById('departmentForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const editIndex = parseInt(document.getElementById('deptEditIndex').value);
            const deptData = {
                name: document.getElementById('deptName').value,
                color: document.getElementById('deptColor').value,
                leader: document.getElementById('deptLeader').value,
                description: document.getElementById('deptDescription').value,
                meeting: document.getElementById('deptMeeting').value,
                budget: parseFloat(document.getElementById('deptBudget').value) || 0,
                teams: editIndex >= 0 ? departments[editIndex].teams : [],
                expenses: editIndex >= 0 ? departments[editIndex].expenses : [],
                eventPlan: editIndex >= 0 ? departments[editIndex].eventPlan : []
            };
            
            if (editIndex >= 0) {
                departments[editIndex] = deptData;
                alert('ë¶€ì„œê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                departments.push(deptData);
                alert('ìƒˆ ë¶€ì„œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
            
            localStorage.setItem('departments', JSON.stringify(departments));
            
            // ì¬ì •ê´€ë¦¬ ì˜ˆì‚°ê³¼ ì—°ë™
            syncBudgetWithFinance(deptData.name, deptData.budget);
            
            // ì¬ì •ê´€ë¦¬ ë¶€ì„œ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
            updateDepartmentSelects();
            
            closeDepartmentModal();
            loadDepartmentList();
        });
        
        // ë¶€ì„œ ì˜ˆì‚°ì„ ì¬ì •ê´€ë¦¬ì™€ ì—°ë™
        function syncBudgetWithFinance(deptName, budgetAmount) {
            let budgets = JSON.parse(localStorage.getItem('churchBudgets') || '[]');
            const currentYear = new Date().getFullYear();
            
            // í•´ë‹¹ ë¶€ì„œ ì°¾ê¸°
            const existingIndex = budgets.findIndex(b => b.name === deptName);
            
            if (existingIndex >= 0) {
                // ê¸°ì¡´ ë¶€ì„œ ì˜ˆì‚° ì—…ë°ì´íŠ¸
                budgets[existingIndex].budget = budgetAmount;
            } else {
                // ìƒˆ ë¶€ì„œ ì¶”ê°€
                budgets.push({
                    name: deptName,
                    budget: budgetAmount,
                    categories: ['ì¼ë°˜', 'í–‰ì‚¬', 'ë¬¼í’ˆ', 'ê¸°íƒ€'],
                    year: currentYear
                });
            }
            
            localStorage.setItem('churchBudgets', JSON.stringify(budgets));
        }
        
        // ë¶€ì„œ ì‚­ì œ
        function deleteDepartment(index) {
            if (confirm(`"${departments[index].name}" ë¶€ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                departments.splice(index, 1);
                localStorage.setItem('departments', JSON.stringify(departments));
                loadDepartmentList();
                // ì¬ì •ê´€ë¦¬ ë¶€ì„œ ëª©ë¡ ì—…ë°ì´íŠ¸
                updateDepartmentSelects();
            }
        }
        
        // ===== ë¶€ì„œ ìƒì„¸ =====
        function showDeptDetail(index) {
            const dept = departments[index];
            document.getElementById('deptDetailTitle').textContent = `â¬¢ ${dept.name}`;
            document.getElementById('deptDetailHeader').style.background = dept.color;
            document.getElementById('currentDetailDeptIndex').value = index;
            
            // ì²« ë²ˆì§¸ íƒ­ í™œì„±í™”
            showDeptTab('teams');
            loadTeamsList(index);
            loadDeptExpenseList(index);
            loadEventPlan(index);
            
            document.getElementById('deptDetailModal').classList.add('active');
        }
        
        function closeDeptDetailModal() {
            document.getElementById('deptDetailModal').classList.remove('active');
        }
        
        function showDeptTab(tabName) {
            // íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼
            document.querySelectorAll('.dept-tab').forEach(tab => {
                tab.style.borderBottom = '3px solid transparent';
                tab.style.color = '#666';
            });
            document.getElementById('tab' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).style.borderBottom = '3px solid #e94560';
            document.getElementById('tab' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).style.color = '#333';
            
            // íƒ­ ì½˜í…ì¸ 
            document.querySelectorAll('.dept-tab-content').forEach(content => content.style.display = 'none');
            document.getElementById('deptTab' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).style.display = 'block';
        }
        
        // ===== íŒ€ ê´€ë¦¬ =====
        function loadTeamsList(deptIndex) {
            const dept = departments[deptIndex];
            const container = document.getElementById('teamsList');
            
            if (!dept.teams || dept.teams.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ë“±ë¡ëœ íŒ€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '<div style="display: grid; gap: 15px;">';
            dept.teams.forEach((team, tIdx) => {
                const memberCount = team.members?.length || 0;
                html += `
                    <div style="border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden;">
                        <div style="background: ${dept.color}15; padding: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin: 0; color: ${dept.color};">${team.name}</h4>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #666;">${team.description || ''}</p>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <span style="background: ${dept.color}; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.85em;">${memberCount}ëª…</span>
                                <button onclick="editTeam(${tIdx})" style="background: #f8f9fa; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer;">âœ</button>
                                <button onclick="deleteTeam(${tIdx})" style="background: #fee2e2; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; color: #e94560;">âœ•</button>
                            </div>
                        </div>
                        <div style="padding: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <span style="font-size: 0.9em; color: #666;">íŒ€ì¥: <strong>${team.leader || 'ë¯¸ì •'}</strong></span>
                                <button onclick="showTeamMemberModal(${tIdx})" class="btn btn-info" style="padding: 6px 12px; font-size: 0.85em;">íŒ€ì› ê´€ë¦¬</button>
                            </div>
                            ${memberCount > 0 ? `
                            <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                                ${team.members.map(m => `<span style="background: #f1f5f9; padding: 4px 10px; border-radius: 12px; font-size: 0.8em;">${m.name} <small style="color: #888;">(${m.role})</small></span>`).join('')}
                            </div>` : '<p style="color: #999; font-size: 0.85em;">ë“±ë¡ëœ íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }
        
        function showAddTeamModal() {
            document.getElementById('teamModalTitle').textContent = '+ ìƒˆ íŒ€ ì¶”ê°€';
            document.getElementById('teamForm').reset();
            document.getElementById('teamEditIndex').value = -1;
            document.getElementById('teamModal').classList.add('active');
        }
        
        function closeTeamModal() {
            document.getElementById('teamModal').classList.remove('active');
        }
        
        function editTeam(teamIndex) {
            const deptIndex = parseInt(document.getElementById('currentDetailDeptIndex').value);
            const team = departments[deptIndex].teams[teamIndex];
            document.getElementById('teamModalTitle').textContent = 'íŒ€ ìˆ˜ì •';
            document.getElementById('teamName').value = team.name;
            document.getElementById('teamLeader').value = team.leader || '';
            document.getElementById('teamDescription').value = team.description || '';
            document.getElementById('teamEditIndex').value = teamIndex;
            document.getElementById('teamModal').classList.add('active');
        }
        
        document.getElementById('teamForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            let deptIndex = parseInt(document.getElementById('teamDeptIndex').value);
            if (deptIndex < 0) deptIndex = parseInt(document.getElementById('currentDetailDeptIndex')?.value || '-1');
            const editIndex = parseInt(document.getElementById('teamEditIndex').value);
            
            if (deptIndex < 0) {
                alert('ë¶€ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const teamData = {
                name: document.getElementById('teamName').value,
                leader: document.getElementById('teamLeader').value,
                members: editIndex >= 0 && departments[deptIndex].teams[editIndex] ? departments[deptIndex].teams[editIndex].members : []
            };
            
            if (!departments[deptIndex].teams) departments[deptIndex].teams = [];
            
            if (editIndex >= 0) {
                departments[deptIndex].teams[editIndex] = teamData;
            } else {
                departments[deptIndex].teams.push(teamData);
            }
            
            localStorage.setItem('departments', JSON.stringify(departments));
            closeTeamModal();
            loadDepartmentList();
        });
        
        function deleteTeam(teamIndex) {
            const deptIndex = parseInt(document.getElementById('currentDetailDeptIndex').value);
            if (confirm('ì´ íŒ€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                departments[deptIndex].teams.splice(teamIndex, 1);
                localStorage.setItem('departments', JSON.stringify(departments));
                loadTeamsList(deptIndex);
                loadDepartmentList();
            }
        }
        
        // ===== íŒ€ì› ê´€ë¦¬ =====
        function showTeamMemberModal(teamIndex) {
            const deptIndex = parseInt(document.getElementById('currentDetailDeptIndex').value);
            const team = departments[deptIndex].teams[teamIndex];
            document.getElementById('teamMemberTitle').textContent = `${team.name} íŒ€ì› ê´€ë¦¬`;
            document.getElementById('currentTeamIndex').value = teamIndex;
            document.getElementById('newTeamMemberName').value = '';
            loadTeamMemberList(deptIndex, teamIndex);
            document.getElementById('teamMemberModal').classList.add('active');
        }
        
        function closeTeamMemberModal() {
            document.getElementById('teamMemberModal').classList.remove('active');
        }
        
        function loadTeamMemberList(deptIndex, teamIndex) {
            const team = departments[deptIndex].teams[teamIndex];
            const container = document.getElementById('teamMemberList');
            
            if (!team.members || team.members.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ë“±ë¡ëœ íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '';
            team.members.forEach((member, mIdx) => {
                html += `
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #f8f9fa; border-radius: 10px; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 36px; height: 36px; background: #1a1a2e; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9em;">
                                ${member.name.charAt(0)}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${member.name}</div>
                                <span style="font-size: 0.8em; color: #666;">${member.role}</span>
                            </div>
                        </div>
                        <button onclick="removeTeamMember(${mIdx})" class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8em;">ì‚­ì œ</button>
                    </div>
                `;
            });
            container.innerHTML = html;
        }
        
        function addTeamMember() {
            const deptIndex = parseInt(document.getElementById('currentDetailDeptIndex').value);
            const teamIndex = parseInt(document.getElementById('currentTeamIndex').value);
            const name = document.getElementById('newTeamMemberName').value.trim();
            const role = document.getElementById('newTeamMemberRole').value;
            
            if (!name) { alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
            
            if (!departments[deptIndex].teams[teamIndex].members) {
                departments[deptIndex].teams[teamIndex].members = [];
            }
            
            departments[deptIndex].teams[teamIndex].members.push({ name, role });
            
            if (role === 'íŒ€ì¥') {
                departments[deptIndex].teams[teamIndex].leader = name;
            }
            
            localStorage.setItem('departments', JSON.stringify(departments));
            document.getElementById('newTeamMemberName').value = '';
            loadTeamMemberList(deptIndex, teamIndex);
            loadTeamsList(deptIndex);
            loadDepartmentList();
        }
        
        function removeTeamMember(memberIndex) {
            const deptIndex = parseInt(document.getElementById('currentDetailDeptIndex').value);
            const teamIndex = parseInt(document.getElementById('currentTeamIndex').value);
            
            if (confirm('ì´ íŒ€ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                departments[deptIndex].teams[teamIndex].members.splice(memberIndex, 1);
                localStorage.setItem('departments', JSON.stringify(departments));
                loadTeamMemberList(deptIndex, teamIndex);
                loadTeamsList(deptIndex);
                loadDepartmentList();
            }
        }
        
        // ===== ì§€ì¶œ ê²°ì˜ì„œ =====
        function loadDeptExpenseList(deptIndex) {
            const dept = departments[deptIndex];
            const container = document.getElementById('deptExpenseList');
            
            if (!dept.expenses || dept.expenses.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ì‘ì„±ëœ ì§€ì¶œ ê²°ì˜ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '<div class="table-container"><table><thead><tr><th>ë‚ ì§œ</th><th>í•­ëª©</th><th>ë¶„ë¥˜</th><th>ê¸ˆì•¡</th><th>ê²°ì œë°©ë²•</th><th>ê²°ì¬ì</th><th>ì˜ìˆ˜ì¦</th></tr></thead><tbody>';
            dept.expenses.forEach((exp, idx) => {
                html += `
                    <tr>
                        <td>${exp.date}</td>
                        <td>${exp.item}</td>
                        <td>${exp.category}</td>
                        <td style="font-weight: 600;">$${exp.amount.toFixed(2)}</td>
                        <td>${exp.payment}${exp.checkNumber ? ' #' + exp.checkNumber : ''}</td>
                        <td>${exp.approver || '-'}</td>
                        <td>${exp.receipt ? '<a href="' + exp.receipt + '" target="_blank" style="color: #e94560;">ë³´ê¸°</a>' : '-'}</td>
                    </tr>
                `;
            });
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }
        
        function showAddExpenseModal() {
            document.getElementById('expenseRequestForm').reset();
            document.getElementById('expReqDate').valueAsDate = new Date();
            document.getElementById('receiptPreview').innerHTML = '<p style="color: #666; margin: 0;">ğŸ“· í´ë¦­í•˜ê±°ë‚˜ ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ì„¸ìš”</p><p style="color: #999; font-size: 0.85em; margin: 5px 0 0 0;">JPG, PNG íŒŒì¼ ì§€ì›</p>';
            document.getElementById('expReqReceiptData').value = '';
            document.getElementById('expenseRequestModal').classList.add('active');
        }
        
        function closeExpenseRequestModal() {
            document.getElementById('expenseRequestModal').classList.remove('active');
        }
        
        function handleExpReqPaymentChange() {
            const payment = document.getElementById('expReqPayment').value;
            document.getElementById('expReqCheckNumber').style.display = payment === 'Check' ? 'block' : 'none';
        }
        
        function handleReceiptUpload(event) {
            const file = event.target.files[0];
            if (file) processReceiptFile(file);
        }
        
        function handleReceiptDrop(event) {
            event.preventDefault();
            event.target.style.borderColor = '#e2e8f0';
            event.target.style.background = 'white';
            const file = event.dataTransfer.files[0];
            if (file) processReceiptFile(file);
        }
        
        function processReceiptFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('expReqReceiptData').value = e.target.result;
                document.getElementById('receiptPreview').innerHTML = `
                    <img src="${e.target.result}" style="max-width: 100%; max-height: 150px; border-radius: 8px;">
                    <p style="color: #48bb78; margin: 10px 0 0 0; font-size: 0.9em;">âœ“ ì˜ìˆ˜ì¦ ì²¨ë¶€ë¨</p>
                `;
            };
            reader.readAsDataURL(file);
        }
        
        document.getElementById('expenseRequestForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            let deptIndex = parseInt(document.getElementById('expReqDeptIndex').value);
            if (deptIndex < 0) deptIndex = parseInt(document.getElementById('currentDetailDeptIndex')?.value || '-1');
            
            if (deptIndex < 0) {
                alert('ë¶€ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const dept = departments[deptIndex];
            
            const expenseData = {
                id: Date.now(),
                date: document.getElementById('expReqDate').value,
                amount: parseFloat(document.getElementById('expReqAmount').value),
                item: document.getElementById('expReqItem').value,
                category: document.getElementById('expReqCategory').value,
                payment: document.getElementById('expReqPayment').value,
                checkNumber: document.getElementById('expReqCheckNumber').value,
                receipt: document.getElementById('expReqReceiptData').value,
                department: dept.name,
                paymentRequested: false,
                paymentApproved: false
            };
            
            if (!departments[deptIndex].expenses) departments[deptIndex].expenses = [];
            departments[deptIndex].expenses.push(expenseData);
            localStorage.setItem('departments', JSON.stringify(departments));
            
            // ê²°ì œìš”ì²­ ìŠ¹ì¸ í›„ì— ì¬ì •ê´€ë¦¬ ì§€ì¶œì— ì¶”ê°€ë¨
            
            closeExpenseRequestModal();
            loadDepartmentList();
            alert('ì§€ì¶œ ê²°ì˜ì„œê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.\nê²°ì œìš”ì²­ í›„ ìŠ¹ì¸ë˜ë©´ ì¬ì •ê´€ë¦¬ ì§€ì¶œì— ë°˜ì˜ë©ë‹ˆë‹¤.');
        });
        
        // ===== ì—°ê°„ í–‰ì‚¬ ê³„íš =====
        function loadEventPlan(deptIndex) {
            const dept = departments[deptIndex];
            const tbody = document.getElementById('eventPlanBody');
            
            if (!dept.eventPlan || dept.eventPlan.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px; color: #666;">ë“±ë¡ëœ í–‰ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤. "í–‰ì‚¬ ì¶”ê°€" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</td></tr>';
                return;
            }
            
            let html = '';
            dept.eventPlan.forEach((event, idx) => {
                html += `
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">
                            <select onchange="updateEventPlan(${idx}, 'month', this.value)" style="width: 100%; padding: 6px; border: 1px solid #e2e8f0; border-radius: 4px;">
                                ${[1,2,3,4,5,6,7,8,9,10,11,12].map(m => `<option value="${m}" ${event.month == m ? 'selected' : ''}>${m}ì›”</option>`).join('')}
                            </select>
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">
                            <input type="text" value="${event.name || ''}" onchange="updateEventPlan(${idx}, 'name', this.value)" style="width: 100%; padding: 6px; border: 1px solid #e2e8f0; border-radius: 4px;" placeholder="í–‰ì‚¬ëª…">
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">
                            <input type="date" value="${event.date || ''}" onchange="updateEventPlan(${idx}, 'date', this.value)" style="width: 100%; padding: 6px; border: 1px solid #e2e8f0; border-radius: 4px;">
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">
                            <input type="text" value="${event.manager || ''}" onchange="updateEventPlan(${idx}, 'manager', this.value)" style="width: 100%; padding: 6px; border: 1px solid #e2e8f0; border-radius: 4px;" placeholder="ë‹´ë‹¹ì">
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">
                            <input type="number" value="${event.budget || 0}" onchange="updateEventPlan(${idx}, 'budget', this.value)" style="width: 100%; padding: 6px; border: 1px solid #e2e8f0; border-radius: 4px;" placeholder="0">
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">
                            <input type="text" value="${event.note || ''}" onchange="updateEventPlan(${idx}, 'note', this.value)" style="width: 100%; padding: 6px; border: 1px solid #e2e8f0; border-radius: 4px;" placeholder="ë¹„ê³ ">
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid #e2e8f0; text-align: center;">
                            <select onchange="updateEventPlan(${idx}, 'status', this.value)" style="padding: 4px 8px; border-radius: 4px; border: none; background: ${event.status === 'ì™„ë£Œ' ? '#48bb78' : event.status === 'ì§„í–‰ì¤‘' ? '#4299e1' : '#e2e8f0'}; color: ${event.status === 'ì™„ë£Œ' || event.status === 'ì§„í–‰ì¤‘' ? 'white' : '#666'};">
                                <option value="ì˜ˆì •" ${event.status === 'ì˜ˆì •' ? 'selected' : ''}>ì˜ˆì •</option>
                                <option value="ì§„í–‰ì¤‘" ${event.status === 'ì§„í–‰ì¤‘' ? 'selected' : ''}>ì§„í–‰ì¤‘</option>
                                <option value="ì™„ë£Œ" ${event.status === 'ì™„ë£Œ' ? 'selected' : ''}>ì™„ë£Œ</option>
                            </select>
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid #e2e8f0; text-align: center;">
                            <button onclick="deleteEventPlanRow(${idx})" style="background: #fee2e2; border: none; color: #e94560; padding: 6px 10px; border-radius: 4px; cursor: pointer;">ì‚­ì œ</button>
                        </td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }
        
        function addEventPlanRow() {
            const deptIndex = parseInt(document.getElementById('currentDetailDeptIndex').value);
            if (!departments[deptIndex].eventPlan) departments[deptIndex].eventPlan = [];
            
            departments[deptIndex].eventPlan.push({
                month: new Date().getMonth() + 1,
                name: '',
                date: '',
                manager: '',
                budget: 0,
                note: '',
                status: 'ì˜ˆì •'
            });
            
            localStorage.setItem('departments', JSON.stringify(departments));
            loadEventPlan(deptIndex);
        }
        
        function updateEventPlan(eventIndex, field, value) {
            const deptIndex = parseInt(document.getElementById('currentDetailDeptIndex').value);
            departments[deptIndex].eventPlan[eventIndex][field] = field === 'budget' ? parseFloat(value) || 0 : value;
            localStorage.setItem('departments', JSON.stringify(departments));
            
            // ìƒíƒœ ë³€ê²½ ì‹œ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ë‹¤ì‹œ ë¡œë“œ
            if (field === 'status') loadEventPlan(deptIndex);
        }
        
        function deleteEventPlanRow(eventIndex) {
            const deptIndex = parseInt(document.getElementById('currentDetailDeptIndex').value);
            if (confirm('ì´ í–‰ì‚¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                departments[deptIndex].eventPlan.splice(eventIndex, 1);
                localStorage.setItem('departments', JSON.stringify(departments));
                loadEventPlan(deptIndex);
            }
        }
        
        function saveEventPlan() {
            alert('ì—°ê°„ í–‰ì‚¬ ê³„íšì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        function printEventPlan() {
            const deptIndex = parseInt(document.getElementById('currentDetailDeptIndex').value);
            const dept = departments[deptIndex];
            
            let html = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${dept.name} ì—°ê°„ í–‰ì‚¬ ê³„íšì„œ</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { text-align: center; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
                        th { background: #1a1a2e; color: white; }
                    </style>
                </head>
                <body>
                    <h1>${dept.name} ì—°ê°„ í–‰ì‚¬ ê³„íšì„œ</h1>
                    <p style="text-align: center;">Sacramento Glory Korean Church | ${new Date().getFullYear()}ë…„</p>
                    <table>
                        <thead><tr><th>ì›”</th><th>í–‰ì‚¬ëª…</th><th>ë‚ ì§œ</th><th>ë‹´ë‹¹ì</th><th>ì˜ˆì‚°</th><th>ë¹„ê³ </th><th>ìƒíƒœ</th></tr></thead>
                        <tbody>
            `;
            
            (dept.eventPlan || []).forEach(e => {
                html += `<tr><td>${e.month}ì›”</td><td>${e.name}</td><td>${e.date}</td><td>${e.manager}</td><td>$${e.budget}</td><td>${e.note}</td><td>${e.status}</td></tr>`;
            });
            
            html += '</tbody></table></body></html>';
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.print();
        }
        
        // ========== ì¬ì •ê´€ë¦¬ ==========
        let offerings = JSON.parse(localStorage.getItem('churchOfferings') || '[]');
        
        // í—Œê¸ˆ í¼ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            const offeringDateField = document.getElementById('offeringDate');
            if (offeringDateField) {
                offeringDateField.valueAsDate = new Date();
            }
            loadOfferingList();
            updateOfferingStats();
        });
        
        // í—Œê¸ˆ ê²°ì œë°©ë²• ë³€ê²½ ì‹œ Check # í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
        function handleOfferingPaymentChange() {
            const paymentSelect = document.getElementById('offeringPayment');
            const checkNumberInput = document.getElementById('offeringCheckNumber');
            
            if (paymentSelect?.value === 'Check') {
                checkNumberInput.style.display = 'block';
            } else {
                checkNumberInput.style.display = 'none';
                checkNumberInput.value = '';
            }
        }
        
        // í—Œê¸ˆ ë“±ë¡ í¼ ì œì¶œ
        const offeringForm = document.getElementById('offeringForm');
        if (offeringForm) {
            offeringForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const payment = document.getElementById('offeringPayment').value;
                const checkNumber = document.getElementById('offeringCheckNumber').value.trim();
                
                const offeringData = {
                    id: Date.now(),
                    date: document.getElementById('offeringDate').value,
                    name: document.getElementById('offeringName').value,
                    type: document.getElementById('offeringType').value,
                    amount: parseFloat(document.getElementById('offeringAmount').value),
                    payment: payment,
                    checkNumber: payment === 'Check' ? checkNumber : '',
                    memo: document.getElementById('offeringMemo').value
                };
                
                offerings.push(offeringData);
                localStorage.setItem('churchOfferings', JSON.stringify(offerings));
                
                let alertMsg = `í—Œê¸ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\ní—Œê¸ˆì: ${offeringData.name}\nì¢…ë¥˜: ${offeringData.type}\nê²°ì œë°©ë²•: ${offeringData.payment}`;
                if (offeringData.checkNumber) alertMsg += ` (#${offeringData.checkNumber})`;
                alertMsg += `\nê¸ˆì•¡: $${offeringData.amount.toFixed(2)}`;
                alert(alertMsg);
                
                this.reset();
                document.getElementById('offeringDate').valueAsDate = new Date();
                document.getElementById('offeringCheckNumber').style.display = 'none';
                loadOfferingList();
                updateOfferingStats();
            });
        }
        
        // í—Œê¸ˆ ëª©ë¡ ë¡œë“œ
        function loadOfferingList() {
            const container = document.getElementById('offeringList');
            if (!container) return;
            
            const period = document.getElementById('offeringPeriod')?.value || 'month';
            const filterType = document.getElementById('offeringFilterType')?.value || 'all';
            
            let filteredOfferings = [...offerings];
            
            // ê¸°ê°„ í•„í„°
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth();
            
            if (period === 'week') {
                // ì´ë²ˆ ì£¼ (ì¼ìš”ì¼ ì‹œì‘)
                const dayOfWeek = now.getDay();
                const startOfWeek = new Date(now);
                startOfWeek.setDate(now.getDate() - dayOfWeek);
                startOfWeek.setHours(0, 0, 0, 0);
                const endOfWeek = new Date(startOfWeek);
                endOfWeek.setDate(startOfWeek.getDate() + 6);
                endOfWeek.setHours(23, 59, 59, 999);
                
                filteredOfferings = filteredOfferings.filter(o => {
                    const d = new Date(o.date);
                    return d >= startOfWeek && d <= endOfWeek;
                });
            } else if (period === 'month') {
                filteredOfferings = filteredOfferings.filter(o => {
                    const d = new Date(o.date);
                    return d.getFullYear() === currentYear && d.getMonth() === currentMonth;
                });
            } else if (period === 'quarter') {
                const currentQuarter = Math.floor(currentMonth / 3);
                filteredOfferings = filteredOfferings.filter(o => {
                    const d = new Date(o.date);
                    return d.getFullYear() === currentYear && Math.floor(d.getMonth() / 3) === currentQuarter;
                });
            } else if (period === 'year') {
                filteredOfferings = filteredOfferings.filter(o => {
                    const d = new Date(o.date);
                    return d.getFullYear() === currentYear;
                });
            }
            
            // ì¢…ë¥˜ í•„í„°
            if (filterType !== 'all') {
                filteredOfferings = filteredOfferings.filter(o => o.type === filterType);
            }
            
            // ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
            filteredOfferings.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredOfferings.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ë“±ë¡ëœ í—Œê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let total = filteredOfferings.reduce((sum, o) => sum + o.amount, 0);
            
            let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ë‚ ì§œ</th>
                                <th>í—Œê¸ˆì</th>
                                <th>ì¢…ë¥˜</th>
                                <th>ê¸ˆì•¡</th>
                                <th>ê²°ì œë°©ë²•</th>
                                <th>ë©”ëª¨</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            filteredOfferings.forEach((offering, idx) => {
                const originalIndex = offerings.findIndex(o => o.id === offering.id);
                let paymentDisplay = offering.payment || 'í˜„ê¸ˆ';
                if (offering.payment === 'Check' && offering.checkNumber) {
                    paymentDisplay = `Check #${offering.checkNumber}`;
                }
                html += `
                    <tr>
                        <td>${offering.date}</td>
                        <td>${offering.name}</td>
                        <td><span class="badge badge-info">${offering.type}</span></td>
                        <td>$${offering.amount.toFixed(2)}</td>
                        <td>${paymentDisplay}</td>
                        <td>${offering.memo || '-'}</td>
                        <td>
                            <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.85em;" onclick="deleteOffering(${originalIndex})">ì‚­ì œ</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                        <tfoot>
                            <tr style="background: #f7fafc; font-weight: bold;">
                                <td colspan="3">í•©ê³„</td>
                                <td>$${total.toFixed(2)}</td>
                                <td colspan="3"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // í—Œê¸ˆ ì‚­ì œ
        function deleteOffering(index) {
            if (confirm('ì •ë§ ì´ í—Œê¸ˆ ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                offerings.splice(index, 1);
                localStorage.setItem('churchOfferings', JSON.stringify(offerings));
                loadOfferingList();
                updateOfferingStats();
                alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // í—Œê¸ˆ í†µê³„ ì—…ë°ì´íŠ¸
        function updateOfferingStats() {
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth();
            
            // ì´ë²ˆ ì£¼ ê³„ì‚° (ì¼ìš”ì¼ ì‹œì‘)
            const dayOfWeek = now.getDay();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - dayOfWeek);
            startOfWeek.setHours(0, 0, 0, 0);
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            endOfWeek.setHours(23, 59, 59, 999);
            
            // ì§€ë‚œ ì£¼ ê³„ì‚°
            const startOfLastWeek = new Date(startOfWeek);
            startOfLastWeek.setDate(startOfWeek.getDate() - 7);
            const endOfLastWeek = new Date(startOfWeek);
            endOfLastWeek.setDate(startOfWeek.getDate() - 1);
            endOfLastWeek.setHours(23, 59, 59, 999);
            
            // ì§€ë‚œ ë‹¬ ê³„ì‚°
            const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            
            // ì§€ë‚œì£¼ í—Œê¸ˆ
            const lastWeekOfferings = offerings.filter(o => {
                const d = new Date(o.date);
                return d >= startOfLastWeek && d <= endOfLastWeek;
            });
            
            // ì´ë²ˆì£¼ í—Œê¸ˆ
            const weeklyOfferings = offerings.filter(o => {
                const d = new Date(o.date);
                return d >= startOfWeek && d <= endOfWeek;
            });
            
            // ì§€ë‚œë‹¬ í—Œê¸ˆ
            const lastMonthOfferings = offerings.filter(o => {
                const d = new Date(o.date);
                return d.getFullYear() === lastMonthYear && d.getMonth() === lastMonth;
            });
            
            // ì´ë²ˆë‹¬ í—Œê¸ˆ
            const monthlyOfferings = offerings.filter(o => {
                const d = new Date(o.date);
                return d.getFullYear() === currentYear && d.getMonth() === currentMonth;
            });
            
            const totalLastWeek = lastWeekOfferings.reduce((sum, o) => sum + o.amount, 0);
            const totalWeek = weeklyOfferings.reduce((sum, o) => sum + o.amount, 0);
            const totalLastMonth = lastMonthOfferings.reduce((sum, o) => sum + o.amount, 0);
            const totalMonth = monthlyOfferings.reduce((sum, o) => sum + o.amount, 0);
            
            const totalOfferingLastWeekEl = document.getElementById('totalOfferingLastWeek');
            const totalOfferingWeekEl = document.getElementById('totalOfferingWeek');
            const totalOfferingLastMonthEl = document.getElementById('totalOfferingLastMonth');
            const totalOfferingMonthEl = document.getElementById('totalOfferingMonth');
            const monthlyOfferingEl = document.getElementById('monthlyOffering');
            
            if (totalOfferingLastWeekEl) totalOfferingLastWeekEl.textContent = '$' + totalLastWeek.toFixed(0);
            if (totalOfferingWeekEl) totalOfferingWeekEl.textContent = '$' + totalWeek.toFixed(0);
            if (totalOfferingLastMonthEl) totalOfferingLastMonthEl.textContent = '$' + totalLastMonth.toFixed(0);
            if (totalOfferingMonthEl) totalOfferingMonthEl.textContent = '$' + totalMonth.toFixed(0);
            if (monthlyOfferingEl) monthlyOfferingEl.textContent = '$' + totalMonth.toFixed(0);
            
            // í—Œê¸ˆ ìˆœìœ„ë„ ì—…ë°ì´íŠ¸
            loadOfferingRanking();
        }
        
        // í—Œê¸ˆ ìˆœìœ„ ë¡œë“œ (êµì ê´€ë¦¬ ì—°ë™)
        function loadOfferingRanking() {
            const container = document.getElementById('offeringRankingList');
            if (!container) return;
            
            const period = document.getElementById('rankingPeriod')?.value || 'month';
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth();
            
            // ê¸°ê°„ë³„ í—Œê¸ˆ í•„í„°ë§
            let filteredOfferings = [...offerings];
            
            if (period === 'month') {
                filteredOfferings = filteredOfferings.filter(o => {
                    const d = new Date(o.date);
                    return d.getFullYear() === currentYear && d.getMonth() === currentMonth;
                });
            } else if (period === 'year') {
                filteredOfferings = filteredOfferings.filter(o => {
                    const d = new Date(o.date);
                    return d.getFullYear() === currentYear;
                });
            }
            
            if (filteredOfferings.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">í—Œê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // í—Œê¸ˆ ì¢…ë¥˜ ëª©ë¡
            const offeringTypes = ['ì‹­ì¼ì¡°', 'ê°ì‚¬í—Œê¸ˆ', 'ì£¼ì¼í—Œê¸ˆ', 'ê±´ì¶•í—Œê¸ˆ', 'ì„ êµí—Œê¸ˆ', 'êµ¬ì œí—Œê¸ˆ', 'íŠ¹ë³„í—Œê¸ˆ', 'ê¸°íƒ€'];
            
            // êµì¸ë³„ í—Œê¸ˆ ì§‘ê³„ (êµì ê´€ë¦¬ ì—°ë™)
            const memberOfferingMap = {};
            
            filteredOfferings.forEach(o => {
                const name = o.name;
                if (!memberOfferingMap[name]) {
                    // êµì ê´€ë¦¬ì—ì„œ êµì¸ ì •ë³´ ì°¾ê¸°
                    const member = members.find(m => m.nameKr === name);
                    memberOfferingMap[name] = {
                        memberNumber: member ? member.number : '-',
                        name: name,
                        gender: member ? member.gender : '-',
                        offerings: {},
                        total: 0
                    };
                    offeringTypes.forEach(type => {
                        memberOfferingMap[name].offerings[type] = 0;
                    });
                }
                memberOfferingMap[name].offerings[o.type] = (memberOfferingMap[name].offerings[o.type] || 0) + o.amount;
                memberOfferingMap[name].total += o.amount;
            });
            
            // ì´ í—Œê¸ˆì•¡ ê¸°ì¤€ ì •ë ¬ (ë‚´ë¦¼ì°¨ìˆœ)
            const sortedMembers = Object.values(memberOfferingMap).sort((a, b) => b.total - a.total);
            
            // í…Œì´ë¸” ìƒì„±
            let html = `
                <div class="table-container">
                    <table style="font-size: 0.85em;">
                        <thead>
                            <tr>
                                <th>ìˆœìœ„</th>
                                <th>êµì¸ë²ˆí˜¸</th>
                                <th>ì„±ëª…</th>
                                <th>ì„±ë³„</th>
                                ${offeringTypes.map(type => `<th>${type}</th>`).join('')}
                                <th style="background: linear-gradient(135deg, #667eea, #9f7aea); color: white;">ì´ í—Œê¸ˆ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            sortedMembers.forEach((member, index) => {
                html += `
                    <tr>
                        <td style="font-weight: bold; text-align: center;">${index + 1}</td>
                        <td>${member.memberNumber}</td>
                        <td>${member.name}</td>
                        <td>${member.gender}</td>
                        ${offeringTypes.map(type => `<td>$${(member.offerings[type] || 0).toFixed(0)}</td>`).join('')}
                        <td style="font-weight: bold; color: #667eea;">$${member.total.toFixed(0)}</td>
                    </tr>
                `;
            });
            
            // ì „ì²´ í•©ê³„
            const grandTotal = sortedMembers.reduce((sum, m) => sum + m.total, 0);
            const typeGrandTotals = offeringTypes.map(type => 
                sortedMembers.reduce((sum, m) => sum + (m.offerings[type] || 0), 0)
            );
            
            html += `
                        </tbody>
                        <tfoot>
                            <tr style="background: linear-gradient(135deg, #f7fafc, #edf2f7); font-weight: bold;">
                                <td colspan="4">í•©ê³„</td>
                                ${typeGrandTotals.map(total => `<td>$${total.toFixed(0)}</td>`).join('')}
                                <td style="color: #e53e3e;">$${grandTotal.toFixed(0)}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // ========== ì¬ì •ê´€ë¦¬ íƒ­ ì „í™˜ ==========
        function showFinanceTab(tabName) {
            // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.finance-tab').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // ì„ íƒí•œ íƒ­ ë³´ì´ê¸°
            const selectedTab = document.getElementById('financeTab' + tabName.charAt(0).toUpperCase() + tabName.slice(1));
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }
            
            // ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('[id^="financeNav"]').forEach(nav => {
                nav.style.background = 'white';
                nav.style.color = '#333';
                nav.style.border = '1px solid #e2e8f0';
            });
            
            const activeNav = document.getElementById('financeNav' + tabName.charAt(0).toUpperCase() + tabName.slice(1));
            if (activeNav) {
                activeNav.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                activeNav.style.color = 'white';
                activeNav.style.border = 'none';
            }
            
            // ê° íƒ­ë³„ ë°ì´í„° ë¡œë“œ
            if (tabName === 'dashboard') {
                updateFinanceDashboard();
            } else if (tabName === 'income') {
                loadOfferingList();
                updateOfferingStats();
            } else if (tabName === 'expense') {
                updateDepartmentSelects(); // ë¶€ì„œê´€ë¦¬ì—ì„œ ë“±ë¡ëœ ë¶€ì„œ ë¡œë“œ
                loadExpenseList();
                updateExpenseStats();
                loadPaymentRequests();
            }
        }
        
        // ========== ì§€ì¶œ ê´€ë¦¬ ==========
        let expenses = JSON.parse(localStorage.getItem('churchExpenses') || '[]');
        
        // ì˜ˆì‚° ë°ì´í„° (ë¶€ì„œë³„ ì—°ê°„ ì˜ˆì‚°)
        let budgets = JSON.parse(localStorage.getItem('churchBudgets') || '[]');
        
        // ì˜ˆì‚° ì´ˆê¸°í™” - ë¶€ì„œê´€ë¦¬ì—ì„œ ë“±ë¡ëœ ë¶€ì„œ ê¸°ì¤€
        function initBudgets() {
            // ë¶€ì„œê´€ë¦¬ì—ì„œ ë“±ë¡ëœ ë¶€ì„œ ê°€ì ¸ì˜¤ê¸°
            const deptData = JSON.parse(localStorage.getItem('departments') || '[]');
            
            if (deptData.length > 0) {
                // ë¶€ì„œê´€ë¦¬ì— ìˆëŠ” ë¶€ì„œë“¤ë¡œ budgets ë™ê¸°í™”
                deptData.forEach(dept => {
                    const existingBudget = budgets.find(b => b.name === dept.name);
                    if (!existingBudget) {
                        // ìƒˆ ë¶€ì„œ ì¶”ê°€
                        budgets.push({
                            name: dept.name,
                            budget: dept.budget || 0,
                            categories: ['ìš´ì˜ë¹„', 'í–‰ì‚¬ë¹„', 'ë¬¼í’ˆêµ¬ì…', 'ê¸°íƒ€'],
                            year: new Date().getFullYear()
                        });
                    }
                });
                
                // ë¶€ì„œê´€ë¦¬ì—ì„œ ì‚­ì œëœ ë¶€ì„œëŠ” budgetsì—ì„œë„ ì œê±°
                budgets = budgets.filter(b => deptData.some(d => d.name === b.name));
                
                localStorage.setItem('churchBudgets', JSON.stringify(budgets));
            }
            
            updateDepartmentSelects();
            updateBudgetVisualization();
        }
        
        // ì§€ì¶œ í¼ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            const expenseDateField = document.getElementById('expenseDate');
            if (expenseDateField) {
                expenseDateField.valueAsDate = new Date();
            }
            initBudgets();
            loadExpenseList();
            updateExpenseStats();
            updateFinanceDashboard();
            loadPaymentRequests();
            
            // êµ¬ì—­ ì´ˆê¸°í™”
            initDefaultCells();
            updateCellSelect();
        });
        
        // ë¶€ì„œ ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸ (ë¶€ì„œê´€ë¦¬ì—ì„œ ë“±ë¡ëœ ë¶€ì„œ ì‚¬ìš©)
        function updateDepartmentSelects() {
            // ë¶€ì„œê´€ë¦¬ì—ì„œ ë“±ë¡ëœ ë¶€ì„œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const deptData = JSON.parse(localStorage.getItem('departments') || '[]');
            
            const deptSelect = document.getElementById('expenseDepartment');
            const filterDeptSelect = document.getElementById('expenseFilterDepartment');
            const categoryDeptSelect = document.getElementById('categoryDeptSelect');
            
            if (deptSelect) {
                deptSelect.innerHTML = '<option value="">ì„ íƒ</option>';
                deptData.forEach(dept => {
                    deptSelect.innerHTML += `<option value="${dept.name}">${dept.name}</option>`;
                });
            }
            
            if (filterDeptSelect) {
                filterDeptSelect.innerHTML = '<option value="all">ì „ì²´</option>';
                deptData.forEach(dept => {
                    filterDeptSelect.innerHTML += `<option value="${dept.name}">${dept.name}</option>`;
                });
            }
            
            if (categoryDeptSelect) {
                categoryDeptSelect.innerHTML = '<option value="">ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                deptData.forEach(dept => {
                    categoryDeptSelect.innerHTML += `<option value="${dept.name}">${dept.name}</option>`;
                });
            }
        }
        
        // ë¶€ì„œ ì„ íƒ ì‹œ í•´ë‹¹ ë¶€ì„œì˜ ë¶„ë¥˜ ë¡œë“œ (ë¶€ì„œê´€ë¦¬ ê¸°ì¤€)
        function updateExpenseCategories() {
            const deptSelect = document.getElementById('expenseDepartment');
            const catSelect = document.getElementById('expenseCategory');
            const itemSelect = document.getElementById('expenseItemSelect');
            const itemCustom = document.getElementById('expenseItemCustom');
            const deptName = deptSelect?.value;
            
            if (!catSelect) return;
            
            if (!deptName) {
                catSelect.innerHTML = '<option value="">ë¶€ì„œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>';
                if (itemSelect) itemSelect.innerHTML = '<option value="">ë¶„ë¥˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>';
                if (itemCustom) itemCustom.style.display = 'none';
                return;
            }
            
            // budgetsì—ì„œ í•´ë‹¹ ë¶€ì„œì˜ ë¶„ë¥˜ ì°¾ê¸°
            const dept = budgets.find(d => d.name === deptName);
            if (dept && dept.categories && dept.categories.length > 0) {
                catSelect.innerHTML = '<option value="">ì„ íƒ</option>';
                dept.categories.forEach(cat => {
                    catSelect.innerHTML += `<option value="${cat}">${cat}</option>`;
                });
            } else {
                // budgetsì— ì—†ìœ¼ë©´ ê¸°ë³¸ ë¶„ë¥˜ ì œê³µ
                catSelect.innerHTML = `
                    <option value="">ì„ íƒ</option>
                    <option value="ìš´ì˜ë¹„">ìš´ì˜ë¹„</option>
                    <option value="í–‰ì‚¬ë¹„">í–‰ì‚¬ë¹„</option>
                    <option value="ë¬¼í’ˆêµ¬ì…">ë¬¼í’ˆêµ¬ì…</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                `;
            }
            
            // í•­ëª© ì„ íƒ ì´ˆê¸°í™”
            if (itemSelect) itemSelect.innerHTML = '<option value="">ë¶„ë¥˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>';
            if (itemCustom) itemCustom.style.display = 'none';
        }
        
        // ì˜ˆì‚° ì‹œê°í™” ì—…ë°ì´íŠ¸
        function updateBudgetVisualization() {
            const container = document.getElementById('budgetVisualization');
            if (!container) return;
            
            const currentYear = new Date().getFullYear();
            const yearBudgets = budgets.filter(b => b.year === currentYear);
            
            if (yearBudgets.length === 0 || yearBudgets.every(b => b.budget === 0)) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ì˜ˆì‚°ì´ í¸ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. [ì˜ˆì‚° í¸ì„±] ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>';
                return;
            }
            
            // ì˜¬í•´ ì§€ì¶œ ì§‘ê³„
            const yearExpenses = expenses.filter(e => {
                const d = new Date(e.date);
                return d.getFullYear() === currentYear;
            });
            
            let html = '<div style="display: flex; flex-direction: column; gap: 15px;">';
            
            yearBudgets.forEach(dept => {
                if (dept.budget > 0) {
                    const spent = yearExpenses
                        .filter(e => e.department === dept.name)
                        .reduce((sum, e) => sum + e.amount, 0);
                    const remaining = dept.budget - spent;
                    const percent = (spent / dept.budget) * 100;
                    const isOver = percent > 100;
                    
                    html += `
                        <div style="background: #f7fafc; padding: 15px; border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-weight: 600;">${dept.name}</span>
                                <span style="color: ${isOver ? '#e53e3e' : '#4a5568'};">
                                    $${spent.toLocaleString()} / $${dept.budget.toLocaleString()} 
                                    (${percent.toFixed(1)}%)
                                </span>
                            </div>
                            <div style="background: #e2e8f0; border-radius: 10px; height: 30px; overflow: hidden; position: relative;">
                                <div style="
                                    background: ${isOver ? 'linear-gradient(90deg, #f56565, #e53e3e)' : 'linear-gradient(90deg, #48bb78, #38a169)'};
                                    height: 100%;
                                    width: ${Math.min(percent, 100)}%;
                                    border-radius: 10px;
                                    transition: width 0.5s;
                                "></div>
                                ${isOver ? `<div style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #e53e3e; font-weight: 600;">âš ï¸ ì´ˆê³¼</div>` : ''}
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.85em; color: #718096;">
                                <span>ì§€ì¶œ: $${spent.toLocaleString()}</span>
                                <span style="color: ${remaining < 0 ? '#e53e3e' : '#48bb78'};">
                                    ì”ì—¬: ${remaining < 0 ? '-' : ''}$${Math.abs(remaining).toLocaleString()}
                                </span>
                            </div>
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            container.innerHTML = html;
            
            // ìƒë‹¨ í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
            const totalBudget = yearBudgets.reduce((sum, b) => sum + b.budget, 0);
            const totalExpense = yearExpenses.reduce((sum, e) => sum + e.amount, 0);
            const remainingBudget = totalBudget - totalExpense;
            const executionRate = totalBudget > 0 ? (totalExpense / totalBudget * 100) : 0;
            
            const totalBudgetEl = document.getElementById('totalBudgetYear');
            const totalExpenseEl = document.getElementById('totalExpenseYear');
            const remainingBudgetEl = document.getElementById('remainingBudgetYear');
            const executionRateEl = document.getElementById('budgetExecutionRate');
            
            if (totalBudgetEl) totalBudgetEl.textContent = '$' + totalBudget.toLocaleString();
            if (totalExpenseEl) totalExpenseEl.textContent = '$' + totalExpense.toLocaleString();
            if (remainingBudgetEl) {
                remainingBudgetEl.textContent = (remainingBudget < 0 ? '-$' : '$') + Math.abs(remainingBudget).toLocaleString();
                remainingBudgetEl.style.color = remainingBudget < 0 ? '#fbd38d' : 'white';
            }
            if (executionRateEl) executionRateEl.textContent = executionRate.toFixed(1) + '%';
        }
        
        // ì˜ˆì‚° í¸ì„± ëª¨ë‹¬ í‘œì‹œ
        function showBudgetModal() {
            document.getElementById('budgetModal').classList.add('active');
            loadBudgetForm();
        }
        
        function closeBudgetModal() {
            document.getElementById('budgetModal').classList.remove('active');
        }
        
        // ì˜ˆì‚° í¸ì„± í¼ ë¡œë“œ
        function loadBudgetForm() {
            const container = document.getElementById('budgetFormContainer');
            const currentYear = new Date().getFullYear();
            
            let html = '';
            budgets.filter(b => b.year === currentYear).forEach((dept, index) => {
                html += `
                    <div class="budget-item" style="background: #f7fafc; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <input type="text" class="form-control" value="${dept.name}" 
                                   onchange="updateBudgetDeptName(${index}, this.value)"
                                   style="width: 200px; font-weight: 600;">
                            <button class="btn btn-danger" style="padding: 5px 10px;" onclick="removeBudgetDepartment(${index})">ì‚­ì œ</button>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">ì—°ê°„ ì˜ˆì‚° ($)</label>
                            <input type="number" class="form-control" value="${dept.budget}" 
                                   onchange="updateBudgetAmount(${index}, this.value)"
                                   placeholder="0" min="0" step="100">
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html || '<p style="text-align: center; color: #666;">ë¶€ì„œê°€ ì—†ìŠµë‹ˆë‹¤. [+ ë¶€ì„œ ì¶”ê°€] ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>';
        }
        
        // ë¶€ì„œ ì˜ˆì‚° ê¸ˆì•¡ ì—…ë°ì´íŠ¸
        function updateBudgetAmount(index, value) {
            const currentYear = new Date().getFullYear();
            const yearBudgets = budgets.filter(b => b.year === currentYear);
            if (yearBudgets[index]) {
                const deptName = yearBudgets[index].name;
                const newBudget = parseFloat(value) || 0;
                yearBudgets[index].budget = newBudget;
                localStorage.setItem('churchBudgets', JSON.stringify(budgets));
                
                // ë¶€ì„œê´€ë¦¬ì—ë„ ì—°ë™
                syncBudgetToDepartment(deptName, newBudget);
            }
        }
        
        // ë¶€ì„œ ì´ë¦„ ì—…ë°ì´íŠ¸
        function updateBudgetDeptName(index, value) {
            const currentYear = new Date().getFullYear();
            const yearBudgets = budgets.filter(b => b.year === currentYear);
            if (yearBudgets[index]) {
                const oldName = yearBudgets[index].name;
                yearBudgets[index].name = value;
                localStorage.setItem('churchBudgets', JSON.stringify(budgets));
                
                // ë¶€ì„œê´€ë¦¬ì—ë„ ì´ë¦„ ë³€ê²½ ì—°ë™
                const deptIndex = departments.findIndex(d => d.name === oldName);
                if (deptIndex >= 0) {
                    departments[deptIndex].name = value;
                    localStorage.setItem('departments', JSON.stringify(departments));
                }
            }
        }
        
        // ë¶€ì„œ ì¶”ê°€
        function addBudgetDepartment() {
            const currentYear = new Date().getFullYear();
            const newDeptName = 'ìƒˆ ë¶€ì„œ ' + (budgets.length + 1);
            budgets.push({
                name: newDeptName,
                budget: 0,
                categories: ['ê¸°íƒ€'],
                year: currentYear
            });
            localStorage.setItem('churchBudgets', JSON.stringify(budgets));
            
            // ë¶€ì„œê´€ë¦¬ì—ë„ ì¶”ê°€
            departments.push({
                name: newDeptName,
                color: '#667eea',
                leader: '',
                description: '',
                meeting: '',
                budget: 0,
                teams: [],
                expenses: [],
                eventPlan: []
            });
            localStorage.setItem('departments', JSON.stringify(departments));
            
            loadBudgetForm();
        }
        
        // ë¶€ì„œ ì‚­ì œ
        function removeBudgetDepartment(index) {
            const currentYear = new Date().getFullYear();
            const yearBudgets = budgets.filter(b => b.year === currentYear);
            const deptToRemove = yearBudgets[index];
            
            if (confirm(`"${deptToRemove.name}" ë¶€ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                const globalIndex = budgets.findIndex(b => b.name === deptToRemove.name && b.year === currentYear);
                if (globalIndex > -1) {
                    budgets.splice(globalIndex, 1);
                    localStorage.setItem('churchBudgets', JSON.stringify(budgets));
                    
                    // ë¶€ì„œê´€ë¦¬ì—ì„œë„ ì‚­ì œ
                    const deptIndex = departments.findIndex(d => d.name === deptToRemove.name);
                    if (deptIndex >= 0) {
                        departments.splice(deptIndex, 1);
                        localStorage.setItem('departments', JSON.stringify(departments));
                    }
                    
                    loadBudgetForm();
                }
            }
        }
        
        // ì¬ì •ê´€ë¦¬ â†’ ë¶€ì„œê´€ë¦¬ ì˜ˆì‚° ì—°ë™
        function syncBudgetToDepartment(deptName, budgetAmount) {
            const deptIndex = departments.findIndex(d => d.name === deptName);
            if (deptIndex >= 0) {
                departments[deptIndex].budget = budgetAmount;
                localStorage.setItem('departments', JSON.stringify(departments));
            }
        }
        
        // ì˜ˆì‚° ì €ì¥
        function saveBudget() {
            localStorage.setItem('churchBudgets', JSON.stringify(budgets));
            
            // ë¶€ì„œê´€ë¦¬ì—ë„ ì „ì²´ ì—°ë™
            budgets.forEach(b => {
                syncBudgetToDepartment(b.name, b.budget);
            });
            
            updateDepartmentSelects();
            updateBudgetVisualization();
            closeBudgetModal();
            alert('ì˜ˆì‚°ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\në¶€ì„œê´€ë¦¬ì—ë„ ì—°ë™ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ë¶„ë¥˜ ê´€ë¦¬ ëª¨ë‹¬ í‘œì‹œ
        function showCategoryModal() {
            document.getElementById('categoryModal').classList.add('active');
            updateDepartmentSelects();
        }
        
        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.remove('active');
        }
        
        // ë¶€ì„œë³„ ë¶„ë¥˜ ë¡œë“œ
        function loadDepartmentCategories() {
            const deptSelect = document.getElementById('categoryDeptSelect');
            const container = document.getElementById('categoryList');
            const deptName = deptSelect?.value;
            
            if (!deptName) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>';
                return;
            }
            
            const dept = budgets.find(d => d.name === deptName);
            if (!dept) return;
            
            let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';
            dept.categories.forEach((cat, index) => {
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; background: #f7fafc; padding: 10px 15px; border-radius: 8px;">
                        <span>${cat}</span>
                        <button class="btn btn-danger" style="padding: 3px 10px; font-size: 0.85em;" onclick="removeCategory('${deptName}', ${index})">ì‚­ì œ</button>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }
        
        // ë¶„ë¥˜ ì¶”ê°€
        function addCategory() {
            const deptSelect = document.getElementById('categoryDeptSelect');
            const newCatInput = document.getElementById('newCategoryName');
            const deptName = deptSelect?.value;
            const catName = newCatInput?.value.trim();
            
            if (!deptName) {
                alert('ë¶€ì„œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            if (!catName) {
                alert('ë¶„ë¥˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const dept = budgets.find(d => d.name === deptName);
            if (dept) {
                if (dept.categories.includes(catName)) {
                    alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë¶„ë¥˜ì…ë‹ˆë‹¤.');
                    return;
                }
                dept.categories.push(catName);
                localStorage.setItem('churchBudgets', JSON.stringify(budgets));
                newCatInput.value = '';
                loadDepartmentCategories();
                alert(`"${catName}" ë¶„ë¥˜ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        }
        
        // ë¶„ë¥˜ ì‚­ì œ
        function removeCategory(deptName, index) {
            const dept = budgets.find(d => d.name === deptName);
            if (dept && confirm(`"${dept.categories[index]}" ë¶„ë¥˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                dept.categories.splice(index, 1);
                localStorage.setItem('churchBudgets', JSON.stringify(budgets));
                loadDepartmentCategories();
            }
        }
        
        // ========== í•­ëª© ê´€ë¦¬ ==========
        // íƒ­ ì „í™˜
        function showCatTab(tabName) {
            document.getElementById('catTabContentCategory').style.display = tabName === 'category' ? 'block' : 'none';
            document.getElementById('catTabContentItem').style.display = tabName === 'item' ? 'block' : 'none';
            
            const catTab = document.getElementById('catTabCategory');
            const itemTab = document.getElementById('catTabItem');
            
            if (tabName === 'category') {
                catTab.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                catTab.style.color = 'white';
                catTab.style.border = 'none';
                itemTab.style.background = 'white';
                itemTab.style.color = '#333';
                itemTab.style.border = '1px solid #e2e8f0';
            } else {
                itemTab.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                itemTab.style.color = 'white';
                itemTab.style.border = 'none';
                catTab.style.background = 'white';
                catTab.style.color = '#333';
                catTab.style.border = '1px solid #e2e8f0';
            }
            
            if (tabName === 'item') {
                // í•­ëª© íƒ­ ë¶€ì„œ ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
                const itemDeptSelect = document.getElementById('itemDeptSelect');
                if (itemDeptSelect) {
                    itemDeptSelect.innerHTML = '<option value="">ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                    budgets.forEach(dept => {
                        itemDeptSelect.innerHTML += `<option value="${dept.name}">${dept.name}</option>`;
                    });
                }
            }
        }
        
        // í•­ëª© íƒ­ì—ì„œ ë¶€ì„œ ì„ íƒ ì‹œ ë¶„ë¥˜ ë¡œë“œ
        function loadDepartmentCategoriesForItem() {
            const deptSelect = document.getElementById('itemDeptSelect');
            const catSelect = document.getElementById('itemCategorySelect');
            const deptName = deptSelect?.value;
            
            if (!catSelect) return;
            
            if (!deptName) {
                catSelect.innerHTML = '<option value="">ë¶€ì„œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>';
                document.getElementById('itemList').innerHTML = '<p style="text-align: center; color: #666;">ë¶€ì„œì™€ ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>';
                return;
            }
            
            const dept = budgets.find(d => d.name === deptName);
            if (dept) {
                catSelect.innerHTML = '<option value="">ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                dept.categories.forEach(cat => {
                    catSelect.innerHTML += `<option value="${cat}">${cat}</option>`;
                });
            }
            document.getElementById('itemList').innerHTML = '<p style="text-align: center; color: #666;">ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>';
        }
        
        // ë¶„ë¥˜ ì„ íƒ ì‹œ í•­ëª© ë¡œë“œ
        function loadCategoryItems() {
            const deptSelect = document.getElementById('itemDeptSelect');
            const catSelect = document.getElementById('itemCategorySelect');
            const container = document.getElementById('itemList');
            const deptName = deptSelect?.value;
            const catName = catSelect?.value;
            
            if (!deptName || !catName) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ë¶€ì„œì™€ ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>';
                return;
            }
            
            const dept = budgets.find(d => d.name === deptName);
            if (!dept) return;
            
            // í•­ëª© ì €ì¥ì†Œ ì´ˆê¸°í™” (ì—†ìœ¼ë©´)
            if (!dept.items) dept.items = {};
            if (!dept.items[catName]) dept.items[catName] = [];
            
            const items = dept.items[catName];
            
            if (items.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ë“±ë¡ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ìƒˆ í•­ëª©ì„ ì¶”ê°€í•˜ì„¸ìš”.</p>';
                return;
            }
            
            let html = '<div style="display: flex; flex-direction: column; gap: 8px;">';
            items.forEach((item, index) => {
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; background: #f7fafc; padding: 8px 15px; border-radius: 8px;">
                        <span>${item}</span>
                        <button class="btn btn-danger" style="padding: 3px 10px; font-size: 0.85em;" onclick="removeItem('${deptName}', '${catName}', ${index})">ì‚­ì œ</button>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }
        
        // í•­ëª© ì¶”ê°€
        function addItem() {
            const deptSelect = document.getElementById('itemDeptSelect');
            const catSelect = document.getElementById('itemCategorySelect');
            const newItemInput = document.getElementById('newItemName');
            const deptName = deptSelect?.value;
            const catName = catSelect?.value;
            const itemName = newItemInput?.value.trim();
            
            if (!deptName) {
                alert('ë¶€ì„œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            if (!catName) {
                alert('ë¶„ë¥˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            if (!itemName) {
                alert('í•­ëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const dept = budgets.find(d => d.name === deptName);
            if (dept) {
                if (!dept.items) dept.items = {};
                if (!dept.items[catName]) dept.items[catName] = [];
                
                if (dept.items[catName].includes(itemName)) {
                    alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í•­ëª©ì…ë‹ˆë‹¤.');
                    return;
                }
                
                dept.items[catName].push(itemName);
                localStorage.setItem('churchBudgets', JSON.stringify(budgets));
                newItemInput.value = '';
                loadCategoryItems();
                alert(`"${itemName}" í•­ëª©ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        }
        
        // í•­ëª© ì‚­ì œ
        function removeItem(deptName, catName, index) {
            const dept = budgets.find(d => d.name === deptName);
            if (dept && dept.items && dept.items[catName]) {
                const itemName = dept.items[catName][index];
                if (confirm(`"${itemName}" í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    dept.items[catName].splice(index, 1);
                    localStorage.setItem('churchBudgets', JSON.stringify(budgets));
                    loadCategoryItems();
                }
            }
        }
        
        // ì§€ì¶œ ì…ë ¥ í¼ì—ì„œ ë¶„ë¥˜ ì„ íƒ ì‹œ í•­ëª© ë¡œë“œ
        function updateExpenseItems() {
            const deptSelect = document.getElementById('expenseDepartment');
            const catSelect = document.getElementById('expenseCategory');
            const itemSelect = document.getElementById('expenseItemSelect');
            const itemCustom = document.getElementById('expenseItemCustom');
            const deptName = deptSelect?.value;
            const catName = catSelect?.value;
            
            if (!itemSelect) return;
            
            if (!deptName || !catName) {
                itemSelect.innerHTML = '<option value="">ë¶„ë¥˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>';
                itemCustom.style.display = 'none';
                return;
            }
            
            const dept = budgets.find(d => d.name === deptName);
            if (!dept) return;
            
            const items = (dept.items && dept.items[catName]) ? dept.items[catName] : [];
            
            itemSelect.innerHTML = '<option value="">ì„ íƒ</option>';
            items.forEach(item => {
                itemSelect.innerHTML += `<option value="${item}">${item}</option>`;
            });
            itemSelect.innerHTML += '<option value="__custom__">âœï¸ ì§ì ‘ ì…ë ¥</option>';
            
            itemCustom.style.display = 'none';
            itemCustom.value = '';
        }
        
        // í•­ëª© ì„ íƒ ì‹œ "ì§ì ‘ ì…ë ¥" ì²˜ë¦¬
        function handleExpenseItemChange() {
            const itemSelect = document.getElementById('expenseItemSelect');
            const itemCustom = document.getElementById('expenseItemCustom');
            
            if (itemSelect?.value === '__custom__') {
                itemCustom.style.display = 'block';
                itemCustom.focus();
            } else {
                itemCustom.style.display = 'none';
                itemCustom.value = '';
            }
        }
        
        // ì§€ì¶œ ê²°ì œë°©ë²• ë³€ê²½ ì‹œ Check # í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
        function handleExpensePaymentChange() {
            const paymentSelect = document.getElementById('expensePayment');
            const checkNumberInput = document.getElementById('expenseCheckNumber');
            
            if (paymentSelect?.value === 'Check') {
                checkNumberInput.style.display = 'block';
            } else {
                checkNumberInput.style.display = 'none';
                checkNumberInput.value = '';
            }
        }
        
        // ì§€ì¶œ ë“±ë¡ í¼ ì œì¶œ
        const expenseForm = document.getElementById('expenseForm');
        if (expenseForm) {
            expenseForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // í•­ëª© ê°’ ê²°ì •
                const itemSelect = document.getElementById('expenseItemSelect');
                const itemCustom = document.getElementById('expenseItemCustom');
                let itemValue = itemSelect?.value;
                
                if (itemValue === '__custom__') {
                    itemValue = itemCustom?.value.trim();
                    if (!itemValue) {
                        alert('í•­ëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.');
                        return;
                    }
                }
                
                if (!itemValue) {
                    alert('ì§€ì¶œ í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.');
                    return;
                }
                
                const payment = document.getElementById('expensePayment').value;
                const checkNumber = document.getElementById('expenseCheckNumber').value.trim();
                
                const expenseData = {
                    id: Date.now(),
                    date: document.getElementById('expenseDate').value,
                    department: document.getElementById('expenseDepartment').value,
                    category: document.getElementById('expenseCategory').value,
                    item: itemValue,
                    amount: parseFloat(document.getElementById('expenseAmount').value),
                    payment: payment,
                    checkNumber: payment === 'Check' ? checkNumber : '',
                    memo: document.getElementById('expenseMemo').value
                };
                
                expenses.push(expenseData);
                localStorage.setItem('churchExpenses', JSON.stringify(expenses));
                
                let alertMsg = `ì§€ì¶œì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\në¶€ì„œ: ${expenseData.department}\në¶„ë¥˜: ${expenseData.category}\ní•­ëª©: ${expenseData.item}\nê²°ì œë°©ë²•: ${expenseData.payment}`;
                if (expenseData.checkNumber) alertMsg += ` (#${expenseData.checkNumber})`;
                alertMsg += `\nê¸ˆì•¡: $${expenseData.amount.toFixed(2)}`;
                alert(alertMsg);
                
                this.reset();
                document.getElementById('expenseDate').valueAsDate = new Date();
                document.getElementById('expenseCategory').innerHTML = '<option value="">ë¶€ì„œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>';
                document.getElementById('expenseItemSelect').innerHTML = '<option value="">ë¶„ë¥˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>';
                document.getElementById('expenseItemCustom').style.display = 'none';
                document.getElementById('expenseCheckNumber').style.display = 'none';
                loadExpenseList();
                updateExpenseStats();
                updateBudgetVisualization();
                updateFinanceDashboard();
            });
        }
        
        // ê²°ì œìš”ì²­ ëª©ë¡ ë¡œë“œ
        function loadPaymentRequests() {
            const container = document.getElementById('paymentRequestList');
            const countEl = document.getElementById('pendingPaymentCount');
            const alertBanner = document.getElementById('paymentAlertBanner');
            const dashCountEl = document.getElementById('dashPaymentCount');
            
            let paymentRequests = JSON.parse(localStorage.getItem('paymentRequests') || '[]');
            const pendingRequests = paymentRequests.filter(r => r.status === 'pending');
            
            // ëŒ€ì‹œë³´ë“œ ì•Œë¦¼ ë°°ë„ˆ ì—…ë°ì´íŠ¸
            if (alertBanner && dashCountEl) {
                if (pendingRequests.length > 0) {
                    alertBanner.style.display = 'block';
                    dashCountEl.textContent = pendingRequests.length + 'ê±´';
                } else {
                    alertBanner.style.display = 'none';
                }
            }
            
            if (!container) return;
            
            if (countEl) countEl.textContent = pendingRequests.length + 'ê±´';
            
            if (pendingRequests.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">ëŒ€ê¸° ì¤‘ì¸ ê²°ì œìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '<div style="overflow-x: auto;"><table style="width: 100%; border-collapse: collapse;">';
            html += '<thead><tr style="background: #f6ad55; color: white;"><th style="padding: 10px;">ìš”ì²­ì¼</th><th style="padding: 10px;">ë¶€ì„œ</th><th style="padding: 10px;">ë¶€ì„œì¥</th><th style="padding: 10px;">ì§€ì¶œí•­ëª©</th><th style="padding: 10px;">ì§€ì¶œì¼</th><th style="padding: 10px;">ê¸ˆì•¡</th><th style="padding: 10px;">ì²˜ë¦¬</th></tr></thead>';
            html += '<tbody>';
            
            pendingRequests.forEach((req, idx) => {
                html += `
                    <tr style="border-bottom: 1px solid #e2e8f0;">
                        <td style="padding: 10px; text-align: center;">${req.requestDate}</td>
                        <td style="padding: 10px; text-align: center; font-weight: 600;">${req.department}</td>
                        <td style="padding: 10px; text-align: center;">${req.deptLeader}</td>
                        <td style="padding: 10px;">${req.item}</td>
                        <td style="padding: 10px; text-align: center;">${req.date}</td>
                        <td style="padding: 10px; text-align: right; font-weight: 600; color: #e94560;">$${req.amount.toFixed(2)}</td>
                        <td style="padding: 10px; text-align: center;">
                            <button onclick="approvePayment(${idx})" class="btn btn-success" style="padding: 5px 10px; font-size: 0.85em;">ìŠ¹ì¸</button>
                            <button onclick="rejectPayment(${idx})" class="btn btn-danger" style="padding: 5px 10px; font-size: 0.85em;">ê±°ì ˆ</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }
        
        // ê²°ì œ ìŠ¹ì¸
        function approvePayment(reqIndex) {
            let paymentRequests = JSON.parse(localStorage.getItem('paymentRequests') || '[]');
            const pendingRequests = paymentRequests.filter(r => r.status === 'pending');
            const req = pendingRequests[reqIndex];
            
            if (confirm(`"${req.item}" ê²°ì œë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê¸ˆì•¡: $${req.amount.toFixed(2)}\në¶€ì„œ: ${req.department}`)) {
                // ìš”ì²­ ìƒíƒœ ì—…ë°ì´íŠ¸
                const fullIndex = paymentRequests.findIndex(r => r.id === req.id && r.status === 'pending');
                if (fullIndex >= 0) {
                    paymentRequests[fullIndex].status = 'approved';
                    paymentRequests[fullIndex].approvedDate = new Date().toISOString().split('T')[0];
                }
                localStorage.setItem('paymentRequests', JSON.stringify(paymentRequests));
                
                // ë¶€ì„œ ì§€ì¶œ ê²°ì˜ì„œ ìƒíƒœ ì—…ë°ì´íŠ¸
                let expData = null;
                if (req.deptIndex !== undefined && req.expIndex !== undefined) {
                    departments[req.deptIndex].expenses[req.expIndex].paymentApproved = true;
                    expData = departments[req.deptIndex].expenses[req.expIndex];
                    localStorage.setItem('departments', JSON.stringify(departments));
                }
                
                // ì¬ì •ê´€ë¦¬ ì§€ì¶œ ë‚´ì—­ì— ì¶”ê°€
                if (expData) {
                    expenses.push({
                        id: expData.id,
                        date: expData.date,
                        department: req.department,
                        category: expData.category || 'ê¸°íƒ€',
                        item: expData.item,
                        amount: expData.amount,
                        payment: expData.payment || 'í˜„ê¸ˆ',
                        checkNumber: expData.checkNumber || '',
                        memo: `ê²°ì œìŠ¹ì¸: ${new Date().toISOString().split('T')[0]}`
                    });
                    localStorage.setItem('churchExpenses', JSON.stringify(expenses));
                }
                
                loadPaymentRequests();
                loadDepartmentList();
                loadExpenseList();
                updateExpenseStats();
                updateFinanceDashboard();
                alert('ê²°ì œê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.\nì¬ì •ê´€ë¦¬ ì§€ì¶œ ë‚´ì—­ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ê²°ì œ ê±°ì ˆ
        function rejectPayment(reqIndex) {
            let paymentRequests = JSON.parse(localStorage.getItem('paymentRequests') || '[]');
            const pendingRequests = paymentRequests.filter(r => r.status === 'pending');
            const req = pendingRequests[reqIndex];
            
            if (confirm(`"${req.item}" ê²°ì œë¥¼ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                // ìš”ì²­ ìƒíƒœ ì—…ë°ì´íŠ¸
                const fullIndex = paymentRequests.findIndex(r => r.id === req.id && r.status === 'pending');
                if (fullIndex >= 0) {
                    paymentRequests[fullIndex].status = 'rejected';
                }
                localStorage.setItem('paymentRequests', JSON.stringify(paymentRequests));
                
                // ë¶€ì„œ ì§€ì¶œ ê²°ì˜ì„œ ìƒíƒœ ì—…ë°ì´íŠ¸
                if (req.deptIndex !== undefined && req.expIndex !== undefined) {
                    departments[req.deptIndex].expenses[req.expIndex].paymentRequested = false;
                    localStorage.setItem('departments', JSON.stringify(departments));
                }
                
                loadPaymentRequests();
                loadDepartmentList();
                alert('ê²°ì œê°€ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì§€ì¶œ ëª©ë¡ ë¡œë“œ
        function loadExpenseList() {
            const container = document.getElementById('expenseList');
            if (!container) return;
            
            const period = document.getElementById('expensePeriod')?.value || 'month';
            const filterDept = document.getElementById('expenseFilterDepartment')?.value || 'all';
            
            let filteredExpenses = [...expenses];
            
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth();
            
            // ê¸°ê°„ í•„í„°
            if (period === 'week') {
                const dayOfWeek = now.getDay();
                const startOfWeek = new Date(now);
                startOfWeek.setDate(now.getDate() - dayOfWeek);
                startOfWeek.setHours(0, 0, 0, 0);
                const endOfWeek = new Date(startOfWeek);
                endOfWeek.setDate(startOfWeek.getDate() + 6);
                endOfWeek.setHours(23, 59, 59, 999);
                
                filteredExpenses = filteredExpenses.filter(e => {
                    const d = new Date(e.date);
                    return d >= startOfWeek && d <= endOfWeek;
                });
            } else if (period === 'month') {
                filteredExpenses = filteredExpenses.filter(e => {
                    const d = new Date(e.date);
                    return d.getFullYear() === currentYear && d.getMonth() === currentMonth;
                });
            } else if (period === 'quarter') {
                const currentQuarter = Math.floor(currentMonth / 3);
                filteredExpenses = filteredExpenses.filter(e => {
                    const d = new Date(e.date);
                    return d.getFullYear() === currentYear && Math.floor(d.getMonth() / 3) === currentQuarter;
                });
            } else if (period === 'year') {
                filteredExpenses = filteredExpenses.filter(e => {
                    const d = new Date(e.date);
                    return d.getFullYear() === currentYear;
                });
            }
            
            // ë¶€ì„œ í•„í„°
            if (filterDept !== 'all') {
                filteredExpenses = filteredExpenses.filter(e => e.department === filterDept);
            }
            
            // ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
            filteredExpenses.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredExpenses.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ë“±ë¡ëœ ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let total = filteredExpenses.reduce((sum, e) => sum + e.amount, 0);
            
            let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ë‚ ì§œ</th>
                                <th>ë¶€ì„œ</th>
                                <th>ë¶„ë¥˜</th>
                                <th>í•­ëª©</th>
                                <th>ê¸ˆì•¡</th>
                                <th>ê²°ì œë°©ë²•</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            filteredExpenses.forEach((expense) => {
                const originalIndex = expenses.findIndex(e => e.id === expense.id);
                let paymentDisplay = expense.payment || 'í˜„ê¸ˆ';
                if (expense.payment === 'Check' && expense.checkNumber) {
                    paymentDisplay = `Check #${expense.checkNumber}`;
                }
                html += `
                    <tr>
                        <td>${expense.date}</td>
                        <td><span class="badge badge-info">${expense.department || '-'}</span></td>
                        <td>${expense.category}</td>
                        <td>${expense.item}</td>
                        <td style="color: #e53e3e;">$${expense.amount.toFixed(2)}</td>
                        <td>${paymentDisplay}</td>
                        <td>
                            <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.85em;" onclick="deleteExpense(${originalIndex})">ì‚­ì œ</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                        <tfoot>
                            <tr style="background: #f7fafc; font-weight: bold;">
                                <td colspan="4">í•©ê³„</td>
                                <td style="color: #e53e3e;">$${total.toFixed(2)}</td>
                                <td colspan="2"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // ì§€ì¶œ ì‚­ì œ
        function deleteExpense(index) {
            if (confirm('ì •ë§ ì´ ì§€ì¶œ ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                expenses.splice(index, 1);
                localStorage.setItem('churchExpenses', JSON.stringify(expenses));
                loadExpenseList();
                updateExpenseStats();
                updateBudgetVisualization();
                updateFinanceDashboard();
                alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì§€ì¶œ í†µê³„ ì—…ë°ì´íŠ¸
        function updateExpenseStats() {
            updateBudgetVisualization();
            loadExpenseBreakdown();
        }
        
        // ì§€ì¶œ ë¶€ì„œë³„ í˜„í™©
        function loadExpenseBreakdown() {
            const container = document.getElementById('expenseBreakdownList');
            if (!container) return;
            
            const period = document.getElementById('expenseBreakdownPeriod')?.value || 'month';
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth();
            
            let filteredExpenses = [...expenses];
            
            if (period === 'month') {
                filteredExpenses = filteredExpenses.filter(e => {
                    const d = new Date(e.date);
                    return d.getFullYear() === currentYear && d.getMonth() === currentMonth;
                });
            } else if (period === 'year') {
                filteredExpenses = filteredExpenses.filter(e => {
                    const d = new Date(e.date);
                    return d.getFullYear() === currentYear;
                });
            }
            
            if (filteredExpenses.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ë¶€ì„œë³„ ì§‘ê³„
            const deptTotals = {};
            budgets.forEach(b => deptTotals[b.name] = 0);
            
            filteredExpenses.forEach(e => {
                if (e.department) {
                    deptTotals[e.department] = (deptTotals[e.department] || 0) + e.amount;
                }
            });
            
            const grandTotal = filteredExpenses.reduce((sum, e) => sum + e.amount, 0);
            
            let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ë¶€ì„œ</th>
                                <th>ì§€ì¶œì•¡</th>
                                <th>ì˜ˆì‚°</th>
                                <th>ì§‘í–‰ë¥ </th>
                                <th>ì”ì—¬</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            budgets.filter(b => b.year === currentYear).forEach(dept => {
                const spent = deptTotals[dept.name] || 0;
                const budget = dept.budget || 0;
                const percent = budget > 0 ? (spent / budget * 100) : 0;
                const remaining = budget - spent;
                
                if (spent > 0 || budget > 0) {
                    html += `
                        <tr>
                            <td>${dept.name}</td>
                            <td style="color: #e53e3e;">$${spent.toLocaleString()}</td>
                            <td>$${budget.toLocaleString()}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="flex: 1; background: #e2e8f0; border-radius: 5px; height: 15px; overflow: hidden;">
                                        <div style="background: ${percent > 100 ? '#e53e3e' : '#48bb78'}; height: 100%; width: ${Math.min(percent, 100)}%;"></div>
                                    </div>
                                    <span style="color: ${percent > 100 ? '#e53e3e' : '#4a5568'};">${percent.toFixed(1)}%</span>
                                </div>
                            </td>
                            <td style="color: ${remaining < 0 ? '#e53e3e' : '#48bb78'};">
                                ${remaining < 0 ? '-' : ''}$${Math.abs(remaining).toLocaleString()}
                            </td>
                        </tr>
                    `;
                }
            });
            
            html += `
                        </tbody>
                        <tfoot>
                            <tr style="background: #f7fafc; font-weight: bold;">
                                <td>ì´ê³„</td>
                                <td style="color: #e53e3e;">$${grandTotal.toLocaleString()}</td>
                                <td colspan="3"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // ========== ì¬ì • ëŒ€ì‹œë³´ë“œ ==========
        function updateFinanceDashboard() {
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth();
            
            // ì´ë²ˆë‹¬ ìˆ˜ì…/ì§€ì¶œ
            const monthlyIncome = offerings.filter(o => {
                const d = new Date(o.date);
                return d.getFullYear() === currentYear && d.getMonth() === currentMonth;
            }).reduce((sum, o) => sum + o.amount, 0);
            
            const monthlyExpense = expenses.filter(e => {
                const d = new Date(e.date);
                return d.getFullYear() === currentYear && d.getMonth() === currentMonth;
            }).reduce((sum, e) => sum + e.amount, 0);
            
            // ì˜¬í•´ ëˆ„ì 
            const yearlyIncome = offerings.filter(o => {
                const d = new Date(o.date);
                return d.getFullYear() === currentYear;
            }).reduce((sum, o) => sum + o.amount, 0);
            
            const yearlyExpense = expenses.filter(e => {
                const d = new Date(e.date);
                return d.getFullYear() === currentYear;
            }).reduce((sum, e) => sum + e.amount, 0);
            
            // í—¤ë” ì¹´ë“œ ì—…ë°ì´íŠ¸
            const headerIncomeEl = document.getElementById('headerTotalIncome');
            const headerExpenseEl = document.getElementById('headerTotalExpense');
            const headerBalanceEl = document.getElementById('headerBalance');
            
            if (headerIncomeEl) headerIncomeEl.textContent = '$' + monthlyIncome.toLocaleString();
            if (headerExpenseEl) headerExpenseEl.textContent = '$' + monthlyExpense.toLocaleString();
            if (headerBalanceEl) {
                const balance = monthlyIncome - monthlyExpense;
                headerBalanceEl.textContent = (balance >= 0 ? '+$' : '-$') + Math.abs(balance).toLocaleString();
            }
            
            // ëŒ€ì‹œë³´ë“œ ì¹´ë“œ ì—…ë°ì´íŠ¸
            const dashTotalIncomeEl = document.getElementById('dashTotalIncome');
            const dashTotalExpenseEl = document.getElementById('dashTotalExpense');
            const dashBalanceEl = document.getElementById('dashBalance');
            const dashYearBalanceEl = document.getElementById('dashYearBalance');
            
            if (dashTotalIncomeEl) dashTotalIncomeEl.textContent = '$' + monthlyIncome.toFixed(0);
            if (dashTotalExpenseEl) dashTotalExpenseEl.textContent = '$' + monthlyExpense.toFixed(0);
            if (dashBalanceEl) {
                const balance = monthlyIncome - monthlyExpense;
                dashBalanceEl.textContent = (balance >= 0 ? '+$' : '-$') + Math.abs(balance).toFixed(0);
                dashBalanceEl.style.color = balance >= 0 ? 'white' : '#fbd38d';
            }
            if (dashYearBalanceEl) {
                const yearBalance = yearlyIncome - yearlyExpense;
                dashYearBalanceEl.textContent = (yearBalance >= 0 ? '+$' : '-$') + Math.abs(yearBalance).toFixed(0);
            }
            
            // ì›”ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateMonthlyChart();
            
            // ìˆ˜ì… êµ¬ì„± ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateIncomeBreakdown();
            
            // ì§€ì¶œ êµ¬ì„± ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateExpenseBreakdownDashboard();
            
            // ìµœê·¼ ê±°ë˜ ë‚´ì—­ ì—…ë°ì´íŠ¸
            updateRecentTransactions();
        }
        
        // ========== ì¶œì„ê´€ë¦¬ ==========
        let mainAttendance = JSON.parse(localStorage.getItem('mainAttendance') || '{}');
        let visitorData = JSON.parse(localStorage.getItem('visitorData') || '{}');
        
        // ì¶œì„ê´€ë¦¬ ì„¹ì…˜ ë¡œë“œ
        function loadAttendanceSection() {
            loadYearlyAttendanceSheet();
        }
        
        // í•´ë‹¹ ì—°ë„ì˜ ëª¨ë“  ì£¼ì¼ ë‚ ì§œ ê³„ì‚°
        function getSundaysOfYear(year) {
            const sundays = {};
            for (let month = 0; month < 12; month++) {
                sundays[month + 1] = [];
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                
                for (let d = 1; d <= lastDay.getDate(); d++) {
                    const date = new Date(year, month, d);
                    if (date.getDay() === 0) { // ì¼ìš”ì¼
                        sundays[month + 1].push(d);
                    }
                }
            }
            return sundays;
        }
        
        // ì¶œì„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (êµ¬ì—­ ì¶œì„ + ë©”ì¸ ì¶œì„ í†µí•©)
        function getAttendanceForDate(dateStr) {
            // ë§¤ë²ˆ ìµœì‹  ë°ì´í„°ë¥¼ localStorageì—ì„œ ì½ì–´ì˜´
            const cellAtt = JSON.parse(localStorage.getItem('cellAttendance') || '{}');
            const mainAtt = JSON.parse(localStorage.getItem('mainAttendance') || '{}');
            let attendees = new Set();
            
            // êµ¬ì—­ ì¶œì„ ë°ì´í„° - ëª¨ë“  êµ¬ì—­ì—ì„œ í•´ë‹¹ ë‚ ì§œ ì¶œì„ì ìˆ˜ì§‘
            Object.keys(cellAtt).forEach(key => {
                if (key.endsWith('_' + dateStr)) {
                    const names = cellAtt[key];
                    if (Array.isArray(names)) {
                        names.forEach(name => attendees.add(name));
                    }
                }
            });
            
            // ë©”ì¸ ì¶œì„ ë°ì´í„°
            if (mainAtt[dateStr] && Array.isArray(mainAtt[dateStr])) {
                mainAtt[dateStr].forEach(name => attendees.add(name));
            }
            
            return Array.from(attendees);
        }
        
        // ì—°ê°„ ì¶œì„í‘œ ë¡œë“œ
        function loadYearlyAttendanceSheet() {
            const container = document.getElementById('yearlyAttendanceSheet');
            const year = parseInt(document.getElementById('attendanceYear')?.value || new Date().getFullYear());
            
            if (!container) return;
            
            // ìµœì‹  ë°ì´í„° ë¡œë“œ (ì¤‘ìš”!)
            cellAttendance = JSON.parse(localStorage.getItem('cellAttendance') || '{}');
            mainAttendance = JSON.parse(localStorage.getItem('mainAttendance') || '{}');
            
            // ë””ë²„ê·¸: ì½˜ì†”ì— ì¶œì„ ë°ì´í„° ì¶œë ¥
            console.log('=== ì¶œì„ ë°ì´í„° í™•ì¸ ===');
            console.log('cellAttendance:', cellAttendance);
            console.log('mainAttendance:', mainAttendance);
            
            const sundays = getSundaysOfYear(year);
            const cellsData = JSON.parse(localStorage.getItem('churchCells') || '[]');
            
            // í—¤ë” í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('totalMemberCount').textContent = members.length;
            
            // ì „ì²´ ì£¼ì¼ ìˆ˜ ê³„ì‚°
            let totalSundayCount = 0;
            for (let m = 1; m <= 12; m++) {
                totalSundayCount += sundays[m].length;
            }
            
            // ê¸ˆì£¼ ì¶œì„ë¥  ê³„ì‚° (ì´ë²ˆ ì£¼ì¼ ê¸°ì¤€)
            const thisSunday = getThisSunday();
            const thisSundayAttendees = getAttendanceForDate(thisSunday);
            const avgRate = members.length > 0 ? Math.round((thisSundayAttendees.length / members.length) * 100) : 0;
            document.getElementById('yearlyAttendanceRate').textContent = avgRate + '%';
            
            // ë…„ì¤‘ ì¶œì„ë¥  ê³„ì‚° (í•´ë‹¹ ì—°ë„ ì „ì²´ ì£¼ì¼ í‰ê· )
            let totalAttendanceCount = 0;
            let totalPossibleCount = 0;
            const today = new Date();
            
            for (let m = 1; m <= 12; m++) {
                sundays[m].forEach(day => {
                    const dateStr = `${year}-${String(m).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
                    const checkDate = new Date(dateStr);
                    // ì˜¤ëŠ˜ ì´ì „ì˜ ì£¼ì¼ë§Œ ê³„ì‚°
                    if (checkDate <= today) {
                        const attendees = getAttendanceForDate(dateStr);
                        totalAttendanceCount += attendees.length;
                        totalPossibleCount += members.length;
                    }
                });
            }
            
            const yearTotalRate = totalPossibleCount > 0 ? Math.round((totalAttendanceCount / totalPossibleCount) * 100) : 0;
            const yearTotalEl = document.getElementById('yearTotalAttendanceRate');
            if (yearTotalEl) yearTotalEl.textContent = yearTotalRate + '%';
            
            if (members.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ë“±ë¡ëœ êµì¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // êµ¬ì—­ë³„ êµì¸ ë¶„ë¥˜
            const membersByCell = {};
            const noCell = [];
            
            members.forEach(m => {
                const cellName = m.cell ? m.cell.replace('êµ¬ì—­', '') : null;
                if (cellName && cellsData.find(c => c.name === cellName)) {
                    if (!membersByCell[cellName]) membersByCell[cellName] = [];
                    membersByCell[cellName].push(m);
                } else {
                    noCell.push(m);
                }
            });
            
            // í…Œì´ë¸” ìƒì„±
            let html = `
                <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                    <thead>
                        <tr style="background: #38a169;">
                            <th rowspan="2" style="padding: 5px 2px; color: white; border: 1px solid #2d8a5e; width: 26px; position: sticky; left: 0; background: #38a169; z-index: 2; font-size: 10px;">No</th>
                            <th rowspan="2" style="padding: 5px 3px; color: white; border: 1px solid #2d8a5e; min-width: 50px; position: sticky; left: 26px; background: #38a169; z-index: 2; font-size: 10px;">ì´ë¦„</th>
            `;
            
            // ì›”ë³„ í—¤ë”
            for (let m = 1; m <= 12; m++) {
                const colspan = sundays[m].length || 1;
                html += `<th colspan="${colspan}" style="padding: 4px 1px; color: white; border: 1px solid #2d8a5e; background: ${m % 2 === 0 ? '#2d8a5e' : '#38a169'}; font-size: 9px; text-align: center;">${m}ì›”</th>`;
            }
            
            // ì´ì¶œì„/ê²°ì„ í—¤ë”
            html += `<th rowspan="2" style="padding: 4px 1px; color: white; border: 1px solid #2d8a5e; background: #1e6f50; width: 24px; font-size: 8px;">ì¶œì„</th>`;
            html += `<th rowspan="2" style="padding: 4px 1px; color: white; border: 1px solid #2d8a5e; background: #dc2626; width: 24px; font-size: 8px;">ê²°ì„</th>`;
            
            html += '</tr><tr style="background: #e8f5e9;">';
            
            // ì£¼ì¼ ë‚ ì§œ í—¤ë”
            for (let m = 1; m <= 12; m++) {
                if (sundays[m].length === 0) {
                    html += `<th style="padding: 3px 1px; border: 1px solid #c8e6c9; font-size: 8px; color: #999; text-align: center;">-</th>`;
                } else {
                    sundays[m].forEach(day => {
                        html += `<th style="padding: 3px 1px; border: 1px solid #c8e6c9; font-size: 8px; color: #333; min-width: 20px; text-align: center;">${day}</th>`;
                    });
                }
            }
            
            html += '</tr></thead><tbody>';
            
            let rowNum = 1;
            
            // êµ¬ì—­ë³„ë¡œ ì¶œë ¥
            cellsData.forEach(cell => {
                const cellMembers = membersByCell[cell.name] || [];
                if (cellMembers.length > 0) {
                    // êµ¬ì—­ í—¤ë” í–‰
                    html += `<tr style="background: ${cell.color}15;">
                        <td colspan="${totalSundayCount + 4}" style="padding: 5px 6px; font-weight: bold; color: ${cell.color}; border: 1px solid #e2e8f0; font-size: 10px;">
                            ğŸ˜ï¸ ${cell.name}êµ¬ì—­ (${cellMembers.length}ëª…)
                        </td>
                    </tr>`;
                    
                    cellMembers.forEach((member) => {
                        html += renderMemberRow(member, rowNum++, year, sundays);
                    });
                }
            });
            
            // ë¯¸ë°°ì • êµì¸
            if (noCell.length > 0) {
                html += `<tr style="background: #f1f5f9;">
                    <td colspan="${totalSundayCount + 4}" style="padding: 5px 6px; font-weight: bold; color: #64748b; border: 1px solid #e2e8f0; font-size: 10px;">
                        ğŸ“‹ ë¯¸ë°°ì • (${noCell.length}ëª…)
                    </td>
                </tr>`;
                
                noCell.forEach((member) => {
                    html += renderMemberRow(member, rowNum++, year, sundays);
                });
            }
            
            // í•˜ë‹¨ í†µê³„ í–‰ë“¤
            html += renderStatRows(year, sundays, totalSundayCount);
            
            html += '</tbody></table>';
            container.innerHTML = html;
            
            // ê¸ˆì£¼ ê²°ì„ì ëª…ë‹¨ ë¡œë“œ
            loadWeeklyAbsentList(year, sundays);
        }
        
        // êµì¸ í–‰ ë Œë”ë§
        function renderMemberRow(member, rowNum, year, sundays) {
            let totalPresent = 0;
            let totalAbsent = 0;
            
            let html = `<tr style="background: ${rowNum % 2 === 0 ? '#fff' : '#fafafa'};">
                <td style="padding: 3px 2px; border: 1px solid #e2e8f0; text-align: center; font-weight: 600; color: #38a169; position: sticky; left: 0; background: ${rowNum % 2 === 0 ? '#fff' : '#fafafa'}; z-index: 1; font-size: 9px;">${rowNum}</td>
                <td style="padding: 3px; border: 1px solid #e2e8f0; font-weight: 500; position: sticky; left: 26px; background: ${rowNum % 2 === 0 ? '#fff' : '#fafafa'}; z-index: 1; font-size: 10px; white-space: nowrap;">${member.nameKr}</td>`;
            
            for (let m = 1; m <= 12; m++) {
                if (sundays[m].length === 0) {
                    html += `<td style="padding: 2px; border: 1px solid #e2e8f0; text-align: center; background: #f5f5f5; font-size: 8px;">-</td>`;
                } else {
                    sundays[m].forEach(day => {
                        const dateStr = `${year}-${String(m).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const attendees = getAttendanceForDate(dateStr);
                        const isPresent = attendees.includes(member.nameKr);
                        const isPast = new Date(dateStr) <= new Date();
                        
                        if (isPast) {
                            if (isPresent) totalPresent++;
                            else totalAbsent++;
                        }
                        
                        html += `<td style="padding: 2px; border: 1px solid #e2e8f0; text-align: center; cursor: pointer; background: ${isPresent ? '#dcfce7' : isPast ? '#fee2e2' : '#fff'};"
                                onclick="toggleYearlyAttendance('${member.nameKr}', '${dateStr}')" title="${dateStr}">
                            ${isPresent ? '<span style="color: #16a34a; font-size: 9px;">âœ“</span>' : (isPast ? '<span style="color: #fca5a5; font-size: 7px;">Â·</span>' : '')}
                        </td>`;
                    });
                }
            }
            
            html += `<td style="padding: 3px 2px; border: 1px solid #e2e8f0; text-align: center; font-weight: 600; color: #16a34a; background: #f0fdf4; font-size: 9px;">${totalPresent}</td>`;
            html += `<td style="padding: 3px 2px; border: 1px solid #e2e8f0; text-align: center; font-weight: 600; color: #dc2626; background: #fef2f2; font-size: 9px;">${totalAbsent}</td>`;
            
            html += '</tr>';
            return html;
        }
        
        // í•˜ë‹¨ í†µê³„ í–‰ ë Œë”ë§
        function renderStatRows(year, sundays, totalSundayCount) {
            let html = '';
            
            // ì¶œì„ì¸ì› í–‰
            html += `<tr style="background: #dcfce7; font-weight: 600;">
                <td colspan="2" style="padding: 4px 3px; border: 1px solid #86efac; text-align: center; position: sticky; left: 0; background: #dcfce7; z-index: 1; font-size: 9px;">âœ… ì¶œì„</td>`;
            for (let m = 1; m <= 12; m++) {
                if (sundays[m].length === 0) {
                    html += `<td style="padding: 3px 1px; border: 1px solid #86efac; text-align: center; font-size: 9px;">-</td>`;
                } else {
                    sundays[m].forEach(day => {
                        const dateStr = `${year}-${String(m).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const attendees = getAttendanceForDate(dateStr);
                        html += `<td style="padding: 3px 1px; border: 1px solid #86efac; text-align: center; color: #16a34a; font-size: 9px;">${attendees.length}</td>`;
                    });
                }
            }
            html += `<td colspan="2" style="padding: 3px; border: 1px solid #86efac; text-align: center; font-size: 8px;">-</td></tr>`;
            
            // ê²°ì„ì¸ì› í–‰
            html += `<tr style="background: #fee2e2; font-weight: 600;">
                <td colspan="2" style="padding: 4px 3px; border: 1px solid #fca5a5; text-align: center; position: sticky; left: 0; background: #fee2e2; z-index: 1; font-size: 9px;">âŒ ê²°ì„</td>`;
            for (let m = 1; m <= 12; m++) {
                if (sundays[m].length === 0) {
                    html += `<td style="padding: 3px 1px; border: 1px solid #fca5a5; text-align: center; font-size: 9px;">-</td>`;
                } else {
                    sundays[m].forEach(day => {
                        const dateStr = `${year}-${String(m).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const isPast = new Date(dateStr) <= new Date();
                        if (isPast) {
                            const attendees = getAttendanceForDate(dateStr);
                            html += `<td style="padding: 3px 1px; border: 1px solid #fca5a5; text-align: center; color: #dc2626; font-size: 9px;">${members.length - attendees.length}</td>`;
                        } else {
                            html += `<td style="padding: 3px 1px; border: 1px solid #fca5a5; text-align: center; color: #ccc; font-size: 9px;">-</td>`;
                        }
                    });
                }
            }
            html += `<td colspan="2" style="padding: 3px; border: 1px solid #fca5a5; text-align: center; font-size: 8px;">-</td></tr>`;
            
            // ë°©ë¬¸ì í–‰
            html += `<tr style="background: #fef3c7; font-weight: 600;">
                <td colspan="2" style="padding: 4px 3px; border: 1px solid #fcd34d; text-align: center; position: sticky; left: 0; background: #fef3c7; z-index: 1; font-size: 9px;">ğŸ‘‹ ë°©ë¬¸</td>`;
            for (let m = 1; m <= 12; m++) {
                if (sundays[m].length === 0) {
                    html += `<td style="padding: 3px 1px; border: 1px solid #fcd34d; text-align: center; font-size: 9px;">-</td>`;
                } else {
                    sundays[m].forEach(day => {
                        const dateStr = `${year}-${String(m).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const visitorCount = visitorData[dateStr] || 0;
                        html += `<td style="padding: 1px; border: 1px solid #fcd34d; text-align: center;">
                            <input type="number" value="${visitorCount}" min="0" max="99" 
                                   style="width: 20px; padding: 1px; border: 1px solid #e5e7eb; border-radius: 2px; text-align: center; font-size: 8px; font-weight: 600; color: #92400e;"
                                   onchange="updateVisitor('${dateStr}', this.value)">
                        </td>`;
                    });
                }
            }
            html += `<td colspan="2" style="padding: 3px; border: 1px solid #fcd34d; text-align: center; font-size: 8px;">-</td></tr>`;
            
            // ì´ ì°¸ì„ í–‰
            html += `<tr style="background: #38a169; font-weight: 700;">
                <td colspan="2" style="padding: 4px 3px; border: 1px solid #2d8a5e; text-align: center; color: white; position: sticky; left: 0; background: #38a169; z-index: 1; font-size: 9px;">ğŸ“Š ì´ì°¸ì„</td>`;
            for (let m = 1; m <= 12; m++) {
                if (sundays[m].length === 0) {
                    html += `<td style="padding: 3px 1px; border: 1px solid #2d8a5e; text-align: center; color: white; font-size: 9px;">-</td>`;
                } else {
                    sundays[m].forEach(day => {
                        const dateStr = `${year}-${String(m).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const attendees = getAttendanceForDate(dateStr);
                        const visitors = visitorData[dateStr] || 0;
                        html += `<td style="padding: 3px 1px; border: 1px solid #2d8a5e; text-align: center; color: white; font-size: 9px;">${attendees.length + parseInt(visitors)}</td>`;
                    });
                }
            }
            html += `<td colspan="2" style="padding: 3px; border: 1px solid #2d8a5e; text-align: center; color: white; font-size: 8px;">-</td></tr>`;
            
            return html;
        }
        
        // ê¸ˆì£¼ ê²°ì„ì ëª…ë‹¨ ë¡œë“œ
        function loadWeeklyAbsentList(year, sundays) {
            const container = document.getElementById('weeklyAbsentList');
            const dateLabel = document.getElementById('absentDateLabel');
            if (!container) return;
            
            const today = new Date();
            let latestSunday = null;
            
            for (let m = 12; m >= 1; m--) {
                for (let i = sundays[m].length - 1; i >= 0; i--) {
                    const dateStr = `${year}-${String(m).padStart(2, '0')}-${String(sundays[m][i]).padStart(2, '0')}`;
                    if (new Date(dateStr) <= today) {
                        latestSunday = dateStr;
                        break;
                    }
                }
                if (latestSunday) break;
            }
            
            if (!latestSunday) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">ì•„ì§ ì£¼ì¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            if (dateLabel) dateLabel.textContent = latestSunday;
            
            const attendees = getAttendanceForDate(latestSunday);
            const absentMembers = members.filter(m => !attendees.includes(m.nameKr));
            
            if (absentMembers.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 30px; color: #16a34a;"><div style="font-size: 2em; margin-bottom: 10px;">ğŸ‰</div><strong>ì „ì› ì¶œì„!</strong></div>';
                return;
            }
            
            const cellsData = JSON.parse(localStorage.getItem('churchCells') || '[]');
            const absentReasons = JSON.parse(localStorage.getItem('absentReasons') || '{}');
            
            let html = `
                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead>
                        <tr style="background: #fee2e2;">
                            <th style="padding: 8px; border: 1px solid #fca5a5; text-align: left; width: 70px;">ì´ë¦„</th>
                            <th style="padding: 8px; border: 1px solid #fca5a5; text-align: left; width: 70px;">êµ¬ì—­</th>
                            <th style="padding: 8px; border: 1px solid #fca5a5; text-align: left; width: 110px;">ì—°ë½ì²˜</th>
                            <th style="padding: 8px; border: 1px solid #fca5a5; text-align: left;">ê²°ì„ ì‚¬ìœ </th>
                            <th style="padding: 8px; border: 1px solid #fca5a5; text-align: center; width: 50px;">ì—°ë½</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            absentMembers.forEach(m => {
                const cellName = m.cell ? m.cell.replace('êµ¬ì—­', '') : 'ë¯¸ë°°ì •';
                const cell = cellsData.find(c => c.name === cellName);
                const reasonKey = `${latestSunday}_${m.nameKr}`;
                const reason = absentReasons[reasonKey] || '';
                
                html += `
                    <tr style="background: #fff;">
                        <td style="padding: 6px 8px; border: 1px solid #fecaca; font-weight: 500;">${m.nameKr}</td>
                        <td style="padding: 6px 8px; border: 1px solid #fecaca;">
                            ${cell ? `<span style="background: ${cell.color}20; color: ${cell.color}; padding: 2px 6px; border-radius: 8px; font-size: 10px;">${cellName}</span>` : '<span style="color: #999; font-size: 10px;">ë¯¸ë°°ì •</span>'}
                        </td>
                        <td style="padding: 6px 8px; border: 1px solid #fecaca; color: #666; font-size: 11px;">${m.phone || '-'}</td>
                        <td style="padding: 3px; border: 1px solid #fecaca;">
                            <input type="text" value="${reason}" placeholder="ê²°ì„ ì‚¬ìœ  ì…ë ¥..." 
                                   style="width: 100%; padding: 5px 6px; border: 1px solid #e5e7eb; border-radius: 4px; font-size: 11px;"
                                   onchange="saveAbsentReason('${latestSunday}', '${m.nameKr}', this.value)">
                        </td>
                        <td style="padding: 6px; border: 1px solid #fecaca; text-align: center;">
                            ${m.phone ? `<a href="tel:${m.phone}" style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; text-decoration: none; font-size: 10px;">ğŸ“</a>` : '-'}
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            html += `<div style="margin-top: 8px; text-align: right; color: #dc2626; font-weight: 600; font-size: 12px;">ì´ ${absentMembers.length}ëª… ê²°ì„</div>`;
            
            container.innerHTML = html;
        }
        
        // ê²°ì„ ì‚¬ìœ  ì €ì¥
        function saveAbsentReason(date, memberName, reason) {
            let absentReasons = JSON.parse(localStorage.getItem('absentReasons') || '{}');
            absentReasons[`${date}_${memberName}`] = reason;
            localStorage.setItem('absentReasons', JSON.stringify(absentReasons));
        }
        
        // ì¶œì„ í† ê¸€
        function toggleYearlyAttendance(memberName, dateStr) {
            if (!mainAttendance[dateStr]) mainAttendance[dateStr] = [];
            
            const idx = mainAttendance[dateStr].indexOf(memberName);
            if (idx >= 0) mainAttendance[dateStr].splice(idx, 1);
            else mainAttendance[dateStr].push(memberName);
            
            localStorage.setItem('mainAttendance', JSON.stringify(mainAttendance));
            loadYearlyAttendanceSheet();
        }
        
        // ë°©ë¬¸ì ìˆ˜ ì—…ë°ì´íŠ¸
        function updateVisitor(dateStr, count) {
            visitorData[dateStr] = parseInt(count) || 0;
            localStorage.setItem('visitorData', JSON.stringify(visitorData));
            loadYearlyAttendanceSheet();
        }
        
        // ì—°ê°„ ì¶œì„í‘œ ì¸ì‡„
        function printYearlyAttendance() {
            const year = document.getElementById('attendanceYear')?.value || new Date().getFullYear();
            const sundays = getSundaysOfYear(year);
            const cellsData = JSON.parse(localStorage.getItem('churchCells') || '[]');
            
            const membersByCell = {};
            const noCell = [];
            members.forEach(m => {
                const cellName = m.cell ? m.cell.replace('êµ¬ì—­', '') : null;
                if (cellName && cellsData.find(c => c.name === cellName)) {
                    if (!membersByCell[cellName]) membersByCell[cellName] = [];
                    membersByCell[cellName].push(m);
                } else {
                    noCell.push(m);
                }
            });
            
            let totalSundayCount = 0;
            for (let m = 1; m <= 12; m++) totalSundayCount += sundays[m].length;
            
            let printContent = `<html><head><title>${year}ë…„ ì¶œì„í‘œ</title>
                <style>
                    body { font-family: 'Malgun Gothic', sans-serif; padding: 5px; font-size: 7px; }
                    h1 { text-align: center; margin: 3px 0; font-size: 12px; }
                    table { width: 100%; border-collapse: collapse; }
                    th, td { border: 1px solid #ccc; padding: 1px 2px; text-align: center; }
                    th { background: #48bb78; color: white; font-size: 6px; }
                    .cell-header { background: #e8f5e9; font-weight: bold; text-align: left; padding-left: 3px; font-size: 7px; }
                    .present { color: #16a34a; }
                    .total { background: #e8f5e9; }
                    .absent { background: #fee2e2; }
                    @media print { @page { size: landscape; margin: 2mm; } }
                </style></head><body>
                <h1>Sacramento Glory Church - ${year}ë…„ ì¶œì„í‘œ (${members.length}ëª…)</h1>
                <table><tr><th rowspan="2">No</th><th rowspan="2">ì´ë¦„</th>`;
            
            for (let m = 1; m <= 12; m++) printContent += `<th colspan="${sundays[m].length || 1}">${m}ì›”</th>`;
            printContent += '<th rowspan="2">ì¶œ</th><th rowspan="2">ê²°</th></tr><tr>';
            for (let m = 1; m <= 12; m++) {
                if (sundays[m].length === 0) printContent += '<th>-</th>';
                else sundays[m].forEach(d => printContent += `<th>${d}</th>`);
            }
            printContent += '</tr>';
            
            let rowNum = 1;
            cellsData.forEach(cell => {
                const cm = membersByCell[cell.name] || [];
                if (cm.length > 0) {
                    printContent += `<tr class="cell-header"><td colspan="${totalSundayCount + 4}">${cell.name}êµ¬ì—­ (${cm.length}ëª…)</td></tr>`;
                    cm.forEach(member => {
                        let tp = 0, ta = 0;
                        printContent += `<tr><td>${rowNum++}</td><td style="text-align:left;">${member.nameKr}</td>`;
                        for (let m = 1; m <= 12; m++) {
                            if (sundays[m].length === 0) printContent += '<td>-</td>';
                            else sundays[m].forEach(d => {
                                const ds = `${year}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                                const att = getAttendanceForDate(ds);
                                const ip = att.includes(member.nameKr);
                                const past = new Date(ds) <= new Date();
                                if (past) { if (ip) tp++; else ta++; }
                                printContent += `<td class="${ip ? 'present' : ''}">${ip ? 'âœ“' : ''}</td>`;
                            });
                        }
                        printContent += `<td class="total">${tp}</td><td class="absent">${ta}</td></tr>`;
                    });
                }
            });
            
            if (noCell.length > 0) {
                printContent += `<tr class="cell-header"><td colspan="${totalSundayCount + 4}">ë¯¸ë°°ì • (${noCell.length}ëª…)</td></tr>`;
                noCell.forEach(member => {
                    let tp = 0, ta = 0;
                    printContent += `<tr><td>${rowNum++}</td><td style="text-align:left;">${member.nameKr}</td>`;
                    for (let m = 1; m <= 12; m++) {
                        if (sundays[m].length === 0) printContent += '<td>-</td>';
                        else sundays[m].forEach(d => {
                            const ds = `${year}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                            const att = getAttendanceForDate(ds);
                            const ip = att.includes(member.nameKr);
                            const past = new Date(ds) <= new Date();
                            if (past) { if (ip) tp++; else ta++; }
                            printContent += `<td class="${ip ? 'present' : ''}">${ip ? 'âœ“' : ''}</td>`;
                        });
                    }
                    printContent += `<td class="total">${tp}</td><td class="absent">${ta}</td></tr>`;
                });
            }
            
            printContent += '</table></body></html>';
            const pw = window.open('', '_blank');
            pw.document.write(printContent);
            pw.document.close();
            pw.print();
        }
        
        // ========== êµ¬ì—­ê´€ë¦¬ ==========
        let cells = JSON.parse(localStorage.getItem('churchCells') || '[]');
        
        // ê¸°ë³¸ êµ¬ì—­ ì´ˆê¸°í™”
        function initDefaultCells() {
            if (cells.length === 0) {
                cells = [
                    { name: 'ì„±ë ¹', leader: '', leaderName: '', color: '#d69e2e', meeting: 'ë§¤ì£¼ ê¸ˆìš”ì¼ ì €ë… 7ì‹œ', location: '' },
                    { name: 'ì€í˜œ', leader: '', leaderName: '', color: '#38a169', meeting: 'ë§¤ì£¼ ê¸ˆìš”ì¼ ì €ë… 7ì‹œ', location: '' },
                    { name: 'í™”í‰', leader: '', leaderName: '', color: '#3182ce', meeting: 'ë§¤ì£¼ ê¸ˆìš”ì¼ ì €ë… 7ì‹œ', location: '' },
                    { name: 'ì‚¬ë‘', leader: '', leaderName: '', color: '#e53e3e', meeting: 'ë§¤ì£¼ ê¸ˆìš”ì¼ ì €ë… 7ì‹œ', location: '' }
                ];
                localStorage.setItem('churchCells', JSON.stringify(cells));
            }
        }
        
        // ì£¼ì¼ ì¶œì„ ë°ì´í„° (êµ¬ì—­ë³„)
        let cellAttendance = JSON.parse(localStorage.getItem('cellAttendance') || '{}');
        // ê²°ì„ ì‚¬ìœ  ë°ì´í„°
        let absentReasons = JSON.parse(localStorage.getItem('absentReasons') || '{}');
        
        // ì´ë²ˆ ì£¼ì¼ ë‚ ì§œ ê³„ì‚° (ê°€ì¥ ìµœê·¼ ì¼ìš”ì¼) - ë¡œì»¬ ì‹œê°„ ê¸°ì¤€
        function getThisSunday() {
            const today = new Date();
            const day = today.getDay();
            const diff = day === 0 ? 0 : -day; // ì¼ìš”ì¼ì´ë©´ ì˜¤ëŠ˜, ì•„ë‹ˆë©´ ì§€ë‚œ ì¼ìš”ì¼
            const sunday = new Date(today);
            sunday.setDate(today.getDate() + diff);
            // ë¡œì»¬ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œ ë¬¸ìì—´ ìƒì„±
            const year = sunday.getFullYear();
            const month = String(sunday.getMonth() + 1).padStart(2, '0');
            const date = String(sunday.getDate()).padStart(2, '0');
            return `${year}-${month}-${date}`;
        }
        
        // êµ¬ì—­ ëª©ë¡ ë¡œë“œ
        function loadCellList() {
            initDefaultCells();
            
            const container = document.getElementById('cellList');
            const totalCellsEl = document.getElementById('totalCells');
            const totalMembersEl = document.getElementById('totalCellMembers');
            
            if (totalCellsEl) totalCellsEl.textContent = cells.length;
            
            const thisSunday = getThisSunday();
            
            // êµ¬ì—­ë³„ êµì¸ ìˆ˜ ê³„ì‚°
            let totalCellMembers = 0;
            cells.forEach(cell => {
                const cellMembers = members.filter(m => m.cell === cell.name || m.cell === cell.name + 'êµ¬ì—­');
                // êµ¬ì—­ì¥ë„ í¬í•¨
                if (cell.leaderName && !cellMembers.find(m => m.nameKr === cell.leaderName)) {
                    const leader = members.find(m => m.nameKr === cell.leaderName);
                    if (leader) totalCellMembers++;
                }
                totalCellMembers += cellMembers.length;
            });
            if (totalMembersEl) totalMembersEl.textContent = totalCellMembers;
            
            if (!container) return;
            
            if (cells.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ë“±ë¡ëœ êµ¬ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '';
            cells.forEach((cell, idx) => {
                // ì´ êµ¬ì—­ì— ì†í•œ êµì¸ë“¤ (êµ¬ì—­ì¥ í¬í•¨)
                let cellMembers = members.filter(m => m.cell === cell.name || m.cell === cell.name + 'êµ¬ì—­');
                
                // êµ¬ì—­ì¥ì´ ìˆê³  êµ¬ì—­ì› ëª©ë¡ì— ì—†ìœ¼ë©´ ì¶”ê°€
                let leaderMember = null;
                if (cell.leaderName) {
                    leaderMember = members.find(m => m.nameKr === cell.leaderName);
                    if (leaderMember && !cellMembers.find(m => m.nameKr === cell.leaderName)) {
                        cellMembers = [leaderMember, ...cellMembers];
                    } else if (leaderMember) {
                        // êµ¬ì—­ì¥ì„ ë§¨ ì•ìœ¼ë¡œ ì´ë™
                        cellMembers = cellMembers.filter(m => m.nameKr !== cell.leaderName);
                        cellMembers = [leaderMember, ...cellMembers];
                    }
                }
                
                const totalCount = cellMembers.length;
                
                // ì´ë²ˆ ì£¼ì¼ ì¶œì„ ë°ì´í„°
                const attendanceKey = `${cell.name}_${thisSunday}`;
                const todayAttendance = cellAttendance[attendanceKey] || [];
                
                // ì¶œì„/ê²°ì„ ê³„ì‚°
                const presentCount = todayAttendance.length;
                const absentCount = totalCount - presentCount;
                const attendanceRate = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
                
                // ê²°ì„ì ëª©ë¡
                const absentMembers = cellMembers.filter(m => !todayAttendance.includes(m.nameKr));
                
                html += `
                    <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 1px solid #e2e8f0;">
                        <!-- í—¤ë” -->
                        <div style="background: ${cell.color}; padding: 18px; color: white;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <h3 style="margin: 0; font-size: 1.3em;">${cell.name}êµ¬ì—­</h3>
                                    <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.85em;">${cell.meeting || 'ëª¨ì„ ë¯¸ì •'}</p>
                                </div>
                                <div class="pastor-only" style="display: none; gap: 5px;">
                                    <button onclick="editCell(${idx})" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8em;">í¸ì§‘</button>
                                    <button onclick="deleteCell(${idx})" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8em;">ì‚­ì œ</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì¶œì„ í†µê³„ -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); text-align: center; padding: 15px 10px; background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
                            <div>
                                <div style="font-size: 1.4em; font-weight: bold; color: ${cell.color};">${totalCount}</div>
                                <div style="font-size: 0.75em; color: #64748b;">ì´ì›</div>
                            </div>
                            <div>
                                <div style="font-size: 1.4em; font-weight: bold; color: #16a34a;">${presentCount}</div>
                                <div style="font-size: 0.75em; color: #64748b;">ì¶œì„</div>
                            </div>
                            <div>
                                <div style="font-size: 1.4em; font-weight: bold; color: ${absentCount > 0 ? '#dc2626' : '#16a34a'};">${attendanceRate}%</div>
                                <div style="font-size: 0.75em; color: #64748b;">ì¶œì„ë¥ </div>
                            </div>
                        </div>
                        
                        <!-- ì£¼ì¼ ì¶œì„ ë‚ ì§œ -->
                        <div style="padding: 10px 15px; background: #fefce8; border-bottom: 1px solid #e2e8f0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 0.85em; color: #854d0e;">ì£¼ì¼ ì¶œì„ (${thisSunday})</span>
                                <button onclick="resetCellAttendance('${cell.name}', '${thisSunday}')" style="background: #fef9c3; border: 1px solid #facc15; color: #854d0e; padding: 3px 8px; border-radius: 5px; cursor: pointer; font-size: 0.7em;">ì´ˆê¸°í™”</button>
                            </div>
                        </div>
                        
                        <!-- êµ¬ì—­ì¥ + êµ¬ì—­ì› ëª©ë¡ (ì¶œì„ì²´í¬ í¬í•¨) -->
                        <div style="padding: 15px;">
                            ${cellMembers.length > 0 ? cellMembers.map((m, mIdx) => {
                                const isLeader = m.nameKr === cell.leaderName;
                                const isPresent = todayAttendance.includes(m.nameKr);
                                return `
                                <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px; margin-bottom: 6px; background: ${isPresent ? '#f0fdf4' : '#fef2f2'}; border-radius: 8px; border: 1px solid ${isPresent ? '#bbf7d0' : '#fecaca'};">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" 
                                               id="att_${cell.name}_${mIdx}" 
                                               ${isPresent ? 'checked' : ''} 
                                               onchange="toggleCellAttendance('${cell.name}', '${m.nameKr}', '${thisSunday}')"
                                               style="width: 18px; height: 18px; cursor: pointer;">
                                        <div>
                                            <div style="font-weight: ${isLeader ? '600' : 'normal'}; color: ${isLeader ? cell.color : '#334155'}; font-size: 0.95em;">
                                                ${m.nameKr}
                                                ${isLeader ? '<span style="font-size: 0.7em; background: ' + cell.color + '; color: white; padding: 2px 6px; border-radius: 6px; margin-left: 5px;">êµ¬ì—­ì¥</span>' : ''}
                                            </div>
                                            <div style="font-size: 0.75em; color: #64748b;">${m.phone || ''}</div>
                                        </div>
                                    </div>
                                    <div style="font-size: 0.8em; font-weight: 500; color: ${isPresent ? '#16a34a' : '#dc2626'};">
                                        ${isPresent ? 'ì¶œì„' : 'ê²°ì„'}
                                    </div>
                                </div>
                                `;
                            }).join('') : '<p style="color: #94a3b8; font-size: 0.85em; text-align: center; padding: 20px;">êµ¬ì—­ì›ì´ ì—†ìŠµë‹ˆë‹¤</p>'}
                        </div>
                        
                        <!-- ê²°ì„ì ëª…ë‹¨ -->
                        ${absentCount > 0 ? `
                        <div style="padding: 12px 15px; background: #fef2f2; border-top: 1px solid #fecaca;">
                            <div style="font-size: 0.85em; font-weight: 600; color: #dc2626; margin-bottom: 10px;">
                                ê²°ì„ì ${absentCount}ëª…
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 6px;">
                                ${absentMembers.map(m => {
                                    const reasonKey = `${thisSunday}_${m.nameKr}`;
                                    const savedReason = absentReasons[reasonKey] || '';
                                    return `
                                    <div style="background: white; padding: 10px 12px; border-radius: 6px; border: 1px solid #fecaca;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                                            <span style="font-weight: 500; font-size: 0.9em;">${m.nameKr}</span>
                                            <a href="tel:${m.phone}" style="color: #3182ce; text-decoration: none; font-size: 0.8em;">
                                                ${m.phone || ''}
                                            </a>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span style="font-size: 0.75em; color: #64748b; white-space: nowrap;">ì‚¬ìœ :</span>
                                            <input type="text" placeholder="ì‚¬ìœ  ì…ë ¥" 
                                                   value="${savedReason}"
                                                   onchange="saveCellAbsentReason('${thisSunday}', '${m.nameKr}', this.value)"
                                                   style="flex: 1; padding: 5px 8px; border: 1px solid #e2e8f0; border-radius: 5px; font-size: 0.8em;">
                                        </div>
                                    </div>
                                `}).join('')}
                            </div>
                        </div>
                        ` : `
                        <div style="padding: 12px 15px; background: #f0fdf4; border-top: 1px solid #bbf7d0; text-align: center;">
                            <span style="color: #16a34a; font-weight: 500; font-size: 0.9em;">ì „ì› ì¶œì„</span>
                        </div>
                        `}
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // êµì¸ ë“±ë¡ í¼ì˜ êµ¬ì—­ ì„ íƒ ì—…ë°ì´íŠ¸
            updateCellSelect();
        }
        
        // ì¶œì„ ì²´í¬ í† ê¸€
        function toggleCellAttendance(cellName, memberName, date) {
            const key = `${cellName}_${date}`;
            if (!cellAttendance[key]) {
                cellAttendance[key] = [];
            }
            
            const idx = cellAttendance[key].indexOf(memberName);
            if (idx >= 0) {
                cellAttendance[key].splice(idx, 1);
                console.log(`[êµ¬ì—­ê´€ë¦¬] ${memberName} ì¶œì„ í•´ì œ - í‚¤: ${key}`);
            } else {
                cellAttendance[key].push(memberName);
                console.log(`[êµ¬ì—­ê´€ë¦¬] ${memberName} ì¶œì„ ì²´í¬ - í‚¤: ${key}`);
            }
            
            localStorage.setItem('cellAttendance', JSON.stringify(cellAttendance));
            saveCellAttendanceToFirebase(); // Firebase ë™ê¸°í™”
            console.log('[êµ¬ì—­ê´€ë¦¬] ì €ì¥ëœ cellAttendance:', JSON.stringify(cellAttendance));
            loadCellList();
        }
        
        // ì¶œì„ ì´ˆê¸°í™”
        function resetCellAttendance(cellName, date) {
            if (confirm(`${cellName}êµ¬ì—­ì˜ ${date} ì¶œì„ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                const key = `${cellName}_${date}`;
                delete cellAttendance[key];
                localStorage.setItem('cellAttendance', JSON.stringify(cellAttendance));
                saveCellAttendanceToFirebase(); // Firebase ë™ê¸°í™”
                loadCellList();
            }
        }
        
        // êµ¬ì—­ê´€ë¦¬ì—ì„œ ê²°ì„ ì‚¬ìœ  ì €ì¥
        function saveCellAbsentReason(date, memberName, reason) {
            absentReasons[`${date}_${memberName}`] = reason;
            localStorage.setItem('absentReasons', JSON.stringify(absentReasons));
        }
        
        // êµ¬ì—­ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        function updateCellSelect() {
            const cellSelect = document.getElementById('memberCell');
            if (cellSelect) {
                cellSelect.innerHTML = '<option value="">ì„ íƒ</option>';
                cells.forEach(cell => {
                    cellSelect.innerHTML += `<option value="${cell.name}">${cell.name}êµ¬ì—­</option>`;
                });
            }
            
            // êµ¬ì—­ì¥ ì„ íƒë„ ì—…ë°ì´íŠ¸
            const leaderSelect = document.getElementById('cellLeader');
            if (leaderSelect) {
                leaderSelect.innerHTML = '<option value="">ì„ íƒ</option>';
                members.forEach(m => {
                    leaderSelect.innerHTML += `<option value="${m.nameKr}">${m.nameKr}</option>`;
                });
            }
        }
        
        // êµ¬ì—­ ì¶”ê°€ ëª¨ë‹¬ í‘œì‹œ
        function showAddCellModal() {
            document.getElementById('cellForm').reset();
            document.getElementById('cellEditIndex').value = -1;
            document.getElementById('cellModalTitle').textContent = 'ğŸ˜ï¸ ìƒˆ êµ¬ì—­ ì¶”ê°€';
            updateCellSelect();
            document.getElementById('cellModal').classList.add('active');
        }
        
        // êµ¬ì—­ ìˆ˜ì •
        function editCell(index) {
            const cell = cells[index];
            document.getElementById('cellName').value = cell.name;
            document.getElementById('cellColor').value = cell.color;
            document.getElementById('cellMeeting').value = cell.meeting || '';
            document.getElementById('cellLocation').value = cell.location || '';
            document.getElementById('cellEditIndex').value = index;
            document.getElementById('cellModalTitle').textContent = 'ğŸ˜ï¸ êµ¬ì—­ ìˆ˜ì •';
            
            updateCellSelect();
            document.getElementById('cellLeader').value = cell.leaderName || '';
            
            document.getElementById('cellModal').classList.add('active');
        }
        
        // êµ¬ì—­ ì‚­ì œ
        function deleteCell(index) {
            if (confirm(`"${cells[index].name}êµ¬ì—­"ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                cells.splice(index, 1);
                localStorage.setItem('churchCells', JSON.stringify(cells));
                saveChurchCellsToFirebase(); // Firebase ë™ê¸°í™”
                loadCellList();
            }
        }
        
        // êµ¬ì—­ ëª¨ë‹¬ ë‹«ê¸°
        function closeCellModal() {
            document.getElementById('cellModal').classList.remove('active');
        }
        
        // êµ¬ì—­ ì €ì¥
        document.getElementById('cellForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const cellData = {
                name: document.getElementById('cellName').value,
                leaderName: document.getElementById('cellLeader').value,
                color: document.getElementById('cellColor').value,
                meeting: document.getElementById('cellMeeting').value,
                location: document.getElementById('cellLocation').value
            };
            
            const editIndex = parseInt(document.getElementById('cellEditIndex').value);
            
            if (editIndex >= 0) {
                cells[editIndex] = cellData;
            } else {
                cells.push(cellData);
            }
            
            localStorage.setItem('churchCells', JSON.stringify(cells));
            saveChurchCellsToFirebase(); // Firebase ë™ê¸°í™”
            closeCellModal();
            loadCellList();
            alert('êµ¬ì—­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });
        
        // ========== ì—°ê°„ í–‰ì‚¬ ê´€ë¦¬ ==========
        let yearlyEvents = JSON.parse(localStorage.getItem('yearlyEvents') || '[]');
        
        // ë…„ë„ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        function initEventYearSelect() {
            const select = document.getElementById('eventYearSelect');
            if (!select) return;
            
            // ì´ë¯¸ ì˜µì…˜ì´ ìˆìœ¼ë©´ ìŠ¤í‚µ
            if (select.options.length > 1) return;
            
            const currentYear = new Date().getFullYear();
            select.innerHTML = '';
            
            for (let year = currentYear - 2; year <= currentYear + 3; year++) {
                const selected = year === currentYear ? 'selected' : '';
                select.innerHTML += `<option value="${year}" ${selected}>${year}ë…„</option>`;
            }
        }
        
        // ì„ íƒëœ ë…„ë„ ê°€ì ¸ì˜¤ê¸°
        function getSelectedEventYear() {
            const select = document.getElementById('eventYearSelect');
            return select ? parseInt(select.value) : new Date().getFullYear();
        }
        
        // ì—°ê°„ í–‰ì‚¬ ìº˜ë¦°ë” ë¡œë“œ
        function loadYearlyEventCalendar() {
            const container = document.getElementById('yearlyEventCalendar');
            if (!container) return;
            
            // ë…„ë„ ì„ íƒ ì´ˆê¸°í™”
            initEventYearSelect();
            
            const selectedYear = getSelectedEventYear();
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth() + 1;
            
            // ìµœì‹  ë°ì´í„° ë¡œë“œ (ì „ì—­ ë³€ìˆ˜ë„ ì—…ë°ì´íŠ¸)
            departments = JSON.parse(localStorage.getItem('departments') || '[]');
            yearlyEvents = JSON.parse(localStorage.getItem('yearlyEvents') || '[]');
            
            const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            const monthColors = [
                '#e3f2fd', '#fce4ec', '#f3e5f5', '#e8f5e9', 
                '#fff3e0', '#e0f7fa', '#fff8e1', '#ffebee',
                '#e8eaf6', '#fbe9e7', '#efebe9', '#eceff1'
            ];
            
            // ë¶€ì„œë³„ í–‰ì‚¬ë„ ê°€ì ¸ì˜¤ê¸° (ì„ íƒëœ ë…„ë„ í•„í„°)
            let allEvents = yearlyEvents.filter(e => !e.year || parseInt(e.year) === selectedYear);
            departments.forEach(dept => {
                if (dept.eventPlan) {
                    dept.eventPlan.forEach(event => {
                        if (!event.year || parseInt(event.year) === selectedYear) {
                            allEvents.push({
                                ...event,
                                department: dept.name,
                                fromDept: true
                            });
                        }
                    });
                }
            });
            
            let html = '';
            
            for (let month = 1; month <= 12; month++) {
                let monthEvents = allEvents.filter(e => parseInt(e.month) === month);
                // ë‚ ì§œìˆœ ì •ë ¬
                monthEvents.sort((a, b) => {
                    const dayA = a.date ? parseInt(a.date.split('-')[2]) : 99;
                    const dayB = b.date ? parseInt(b.date.split('-')[2]) : 99;
                    return dayA - dayB;
                });
                const isCurrentMonth = selectedYear === currentYear && currentMonth === month;
                
                html += `
                    <div class="event-month-card" style="background: ${monthColors[month-1]}; border-radius: 12px; padding: 15px; min-height: 180px; ${isCurrentMonth ? 'border: 3px solid #667eea; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);' : ''}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h4 style="margin: 0; color: #333; font-size: 1.1em;">${monthNames[month-1]} ${isCurrentMonth ? 'ğŸ“' : ''}</h4>
                            <button class="no-print" onclick="showAddEventModal(${month})" style="background: none; border: none; cursor: pointer; font-size: 1.2em; color: #667eea;" title="í–‰ì‚¬ ì¶”ê°€">â•</button>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                `;
                
                if (monthEvents.length === 0) {
                    html += `<p style="color: #999; font-size: 0.85em; text-align: center; margin: 20px 0;">í–‰ì‚¬ ì—†ìŒ</p>`;
                } else {
                    monthEvents.forEach((event, idx) => {
                        const statusColors = {
                            'ì˜ˆì •': '#4299e1',
                            'ì§„í–‰ì¤‘': '#ed8936',
                            'ì™„ë£Œ': '#48bb78'
                        };
                        const statusColor = statusColors[event.status] || '#718096';
                        const eventIndex = event.fromDept ? -1 : yearlyEvents.findIndex(e => e.name === event.name && e.month === event.month);
                        
                        // ë‚ ì§œ í‘œì‹œ (ì‹œì‘ì¼~ì¢…ë£Œì¼)
                        let dateDisplay = '';
                        if (event.date) {
                            const startDay = event.date.split('-').slice(1).join('/');
                            if (event.endDate && event.endDate !== event.date) {
                                const endDay = event.endDate.split('-').slice(1).join('/');
                                dateDisplay = `${startDay}~${endDay}`;
                            } else {
                                dateDisplay = startDay;
                            }
                        }
                        
                        // ì‹œê°„ í‘œì‹œ
                        let timeDisplay = '';
                        if (event.startTime) {
                            timeDisplay = event.startTime;
                            if (event.endTime) {
                                timeDisplay += `~${event.endTime}`;
                            }
                        }
                        
                        html += `
                            <div style="background: white; padding: 6px 8px; border-radius: 6px; border-left: 3px solid ${statusColor}; font-size: 0.75em;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: #333; font-size: 0.95em; line-height: 1.3;">
                                            ${dateDisplay ? `<span style="color: #667eea; margin-right: 5px;">${dateDisplay}</span>` : ''}${event.name}
                                        </div>
                                        <div style="color: #888; font-size: 0.85em;">
                                            ${timeDisplay ? `<span style="color: #e53e3e;">â°${timeDisplay}</span> ` : ''}${event.department || ''}
                                        </div>
                                    </div>
                                    ${!event.fromDept ? `<button class="no-print" onclick="deleteYearlyEvent(${eventIndex})" style="background: none; border: none; cursor: pointer; color: #e53e3e; font-size: 0.85em;" title="ì‚­ì œ">âœ•</button>` : ''}
                                </div>
                            </div>
                        `;
                    });
                }
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        // ì—°ê°„ í–‰ì‚¬ ê³„íš ì¸ì‡„
        function printYearlyEventCalendar() {
            const selectedYear = getSelectedEventYear();
            const container = document.getElementById('yearlyEventCalendar');
            if (!container) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>ìƒˆí¬ë¼ë©˜í†  ì˜ê´‘êµíšŒ ${selectedYear}ë…„ ì—°ê°„ í–‰ì‚¬ ê³„íš</title>
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { 
                            font-family: 'Malgun Gothic', sans-serif; 
                            padding: 20px;
                            -webkit-print-color-adjust: exact !important;
                            print-color-adjust: exact !important;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 25px;
                            padding-bottom: 15px;
                            border-bottom: 2px solid #1e3a5f;
                        }
                        .header h1 {
                            color: #1e3a5f;
                            font-size: 24px;
                            margin-bottom: 5px;
                        }
                        .header p {
                            color: #666;
                            font-size: 14px;
                        }
                        .calendar-grid {
                            display: grid;
                            grid-template-columns: repeat(4, 1fr);
                            gap: 12px;
                        }
                        .month-card {
                            border: 1px solid #ddd;
                            border-radius: 8px;
                            padding: 12px;
                            min-height: 150px;
                            background: #f9fafb;
                        }
                        .month-title {
                            font-weight: bold;
                            font-size: 14px;
                            color: #333;
                            margin-bottom: 10px;
                            padding-bottom: 5px;
                            border-bottom: 1px solid #ddd;
                        }
                        .event-item {
                            background: white;
                            padding: 5px 8px;
                            margin-bottom: 5px;
                            border-radius: 4px;
                            border-left: 3px solid #4299e1;
                            font-size: 11px;
                        }
                        .event-name {
                            font-weight: 600;
                            color: #333;
                        }
                        .event-detail {
                            color: #888;
                            font-size: 10px;
                        }
                        .no-event {
                            color: #999;
                            font-size: 11px;
                            text-align: center;
                            padding: 20px 0;
                        }
                        .footer {
                            margin-top: 20px;
                            text-align: center;
                            font-size: 11px;
                            color: #888;
                        }
                        @media print {
                            body { padding: 10px; }
                            .calendar-grid { gap: 8px; }
                            .month-card { min-height: 120px; padding: 8px; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ğŸ“… ìƒˆí¬ë¼ë©˜í†  ì˜ê´‘êµíšŒ ${selectedYear}ë…„ ì—°ê°„ í–‰ì‚¬ ê³„íš</h1>
                        <p>Sacramento Glory Church Annual Event Plan</p>
                    </div>
                    <div class="calendar-grid">
            `);
            
            const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            
            // ëª¨ë“  í–‰ì‚¬ ê°€ì ¸ì˜¤ê¸°
            let allEvents = yearlyEvents.filter(e => !e.year || parseInt(e.year) === selectedYear);
            departments.forEach(dept => {
                if (dept.eventPlan) {
                    dept.eventPlan.forEach(event => {
                        if (!event.year || parseInt(event.year) === selectedYear) {
                            allEvents.push({
                                ...event,
                                department: dept.name,
                                fromDept: true
                            });
                        }
                    });
                }
            });
            
            for (let month = 1; month <= 12; month++) {
                const monthEvents = allEvents.filter(e => parseInt(e.month) === month);
                
                printWindow.document.write(`
                    <div class="month-card">
                        <div class="month-title">${monthNames[month-1]}</div>
                `);
                
                if (monthEvents.length === 0) {
                    printWindow.document.write(`<div class="no-event">í–‰ì‚¬ ì—†ìŒ</div>`);
                } else {
                    monthEvents.forEach(event => {
                        const dateStr = event.date ? event.date.split('-').slice(1).join('/') : '';
                        const deptStr = event.department ? ' Â· ' + event.department : '';
                        printWindow.document.write(`
                            <div class="event-item">
                                <div class="event-name">${event.name}</div>
                                <div class="event-detail">${dateStr}${deptStr}</div>
                            </div>
                        `);
                    });
                }
                
                printWindow.document.write(`</div>`);
            }
            
            printWindow.document.write(`
                    </div>
                    <div class="footer">
                        ì¶œë ¥ì¼: ${new Date().toLocaleDateString('ko-KR')} | ìƒˆí¬ë¼ë©˜í†  ì˜ê´‘êµíšŒ
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
            }, 300);
        }
        
        // í–‰ì‚¬ ì¶”ê°€ ëª¨ë‹¬ í‘œì‹œ
        function showAddEventModal(month = null, deptName = null) {
            document.getElementById('yearEventForm').reset();
            document.getElementById('yearEventEditIndex').value = -1;
            
            const selectedYear = getSelectedEventYear();
            let selectedMonth;
            
            if (month) {
                selectedMonth = month;
                document.getElementById('yearEventMonth').value = month;
            } else {
                selectedMonth = new Date().getMonth() + 1;
                document.getElementById('yearEventMonth').value = selectedMonth;
            }
            
            // ì‹œì‘ì¼/ì¢…ë£Œì¼ ê¸°ë³¸ê°’ì„ ì„ íƒëœ ì›”ì˜ 1ì¼ë¡œ ì„¤ì •
            const monthStr = selectedMonth.toString().padStart(2, '0');
            const defaultDate = `${selectedYear}-${monthStr}-01`;
            document.getElementById('yearEventDate').value = defaultDate;
            document.getElementById('yearEventEndDate').value = defaultDate;
            
            // ë¶€ì„œ ëª©ë¡ ë¡œë“œ
            const deptSelect = document.getElementById('yearEventDept');
            deptSelect.innerHTML = '<option value="">ì„ íƒ</option>';
            
            // ì¬ì •ê´€ë¦¬ ì˜ˆì‚°ì— ìˆëŠ” ë¶€ì„œ ëª©ë¡ ì‚¬ìš©
            const currentYear = new Date().getFullYear();
            const yearBudgets = budgets.filter(b => b.year === currentYear);
            yearBudgets.forEach(b => {
                deptSelect.innerHTML += `<option value="${b.name}" ${deptName === b.name ? 'selected' : ''}>${b.name}</option>`;
            });
            
            // ë¶€ì„œê´€ë¦¬ì—ë§Œ ìˆëŠ” ë¶€ì„œë„ ì¶”ê°€
            departments.forEach(dept => {
                if (!yearBudgets.find(b => b.name === dept.name)) {
                    deptSelect.innerHTML += `<option value="${dept.name}" ${deptName === dept.name ? 'selected' : ''}>${dept.name}</option>`;
                }
            });
            
            document.getElementById('yearEventModal').classList.add('active');
        }
        
        function closeYearEventModal() {
            document.getElementById('yearEventModal').classList.remove('active');
        }
        
        // ì›” ì„ íƒ ë³€ê²½ ì‹œ ì‹œì‘ì¼/ì¢…ë£Œì¼ ìë™ ë™ê¸°í™”
        function syncDateFromMonth(month) {
            const selectedYear = getSelectedEventYear();
            const monthStr = month.toString().padStart(2, '0');
            const defaultDate = `${selectedYear}-${monthStr}-01`;
            document.getElementById('yearEventDate').value = defaultDate;
            document.getElementById('yearEventEndDate').value = defaultDate;
        }
        
        // ë‚ ì§œ ì„ íƒ ì‹œ ì›” ìë™ ë™ê¸°í™”
        function syncEventMonthFromDate(dateValue) {
            if (dateValue) {
                const dateParts = dateValue.split('-');
                const month = parseInt(dateParts[1]);
                document.getElementById('yearEventMonth').value = month;
                
                // ì¢…ë£Œì¼ì´ ë¹„ì–´ìˆê±°ë‚˜ ì‹œì‘ì¼ë³´ë‹¤ ì´ì „ì´ë©´ ì‹œì‘ì¼ê³¼ ê°™ê²Œ ì„¤ì •
                const endDateEl = document.getElementById('yearEventEndDate');
                if (!endDateEl.value || endDateEl.value < dateValue) {
                    endDateEl.value = dateValue;
                }
            }
        }
        
        // í–‰ì‚¬ ì €ì¥
        document.getElementById('yearEventForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // ë‚ ì§œê°€ ìˆìœ¼ë©´ ë‚ ì§œì—ì„œ ì›”ê³¼ ë…„ë„ ìë™ ì¶”ì¶œ
            const dateValue = document.getElementById('yearEventDate').value;
            const endDateValue = document.getElementById('yearEventEndDate').value;
            const startTime = document.getElementById('yearEventStartTime').value;
            const endTime = document.getElementById('yearEventEndTime').value;
            let eventMonth = document.getElementById('yearEventMonth').value;
            let eventYear = getSelectedEventYear();
            
            if (dateValue) {
                const dateParts = dateValue.split('-');
                eventYear = parseInt(dateParts[0]);
                eventMonth = parseInt(dateParts[1]).toString();
            }
            
            const eventData = {
                month: eventMonth,
                date: dateValue,
                endDate: endDateValue,
                startTime: startTime,
                endTime: endTime,
                name: document.getElementById('yearEventName').value,
                department: document.getElementById('yearEventDept').value,
                manager: document.getElementById('yearEventManager').value,
                budget: parseFloat(document.getElementById('yearEventBudget').value) || 0,
                status: document.getElementById('yearEventStatus').value,
                memo: document.getElementById('yearEventMemo').value,
                year: eventYear
            };
            
            const editIndex = parseInt(document.getElementById('yearEventEditIndex').value);
            
            if (editIndex >= 0) {
                yearlyEvents[editIndex] = eventData;
            } else {
                yearlyEvents.push(eventData);
            }
            
            localStorage.setItem('yearlyEvents', JSON.stringify(yearlyEvents));
            
            closeYearEventModal();
            loadYearlyEventCalendar();
            loadDepartmentList(); // ë¶€ì„œ ëª©ë¡ì˜ ì›”ê°„ í–‰ì‚¬ë„ ì—…ë°ì´íŠ¸
            alert('í–‰ì‚¬ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });
        
        // í–‰ì‚¬ ì‚­ì œ
        function deleteYearlyEvent(index) {
            if (index >= 0 && confirm('ì´ í–‰ì‚¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                yearlyEvents.splice(index, 1);
                localStorage.setItem('yearlyEvents', JSON.stringify(yearlyEvents));
                loadYearlyEventCalendar();
                loadDepartmentList(); // ë¶€ì„œ ëª©ë¡ì˜ ì›”ê°„ í–‰ì‚¬ë„ ì—…ë°ì´íŠ¸
            }
        }
        
        // ì›”ë³„ ìˆ˜ì…/ì§€ì¶œ ì°¨íŠ¸
        function updateMonthlyChart() {
            const container = document.getElementById('monthlyChart');
            if (!container) return;
            
            const currentYear = new Date().getFullYear();
            
            // í˜„ì¬ ì—°ë„ 1ì›”~12ì›” ë°ì´í„°
            const months = [];
            for (let i = 0; i < 12; i++) {
                months.push({
                    year: currentYear,
                    month: i,
                    label: (i + 1) + 'ì›”'
                });
            }
            
            const monthlyData = months.map(m => {
                const income = offerings.filter(o => {
                    const d = new Date(o.date);
                    return d.getFullYear() === m.year && d.getMonth() === m.month;
                }).reduce((sum, o) => sum + o.amount, 0);
                
                const expense = expenses.filter(e => {
                    const d = new Date(e.date);
                    return d.getFullYear() === m.year && d.getMonth() === m.month;
                }).reduce((sum, e) => sum + e.amount, 0);
                
                return { ...m, income, expense };
            });
            
            const maxValue = Math.max(...monthlyData.map(d => Math.max(d.income, d.expense)), 1);
            
            let html = `
                <div style="display: flex; align-items: flex-end; justify-content: space-between; height: 250px; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; gap: 5px;">
            `;
            
            monthlyData.forEach(d => {
                const incomeHeight = (d.income / maxValue) * 200;
                const expenseHeight = (d.expense / maxValue) * 200;
                
                html += `
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 5px; flex: 1;">
                        <div style="display: flex; align-items: flex-end; gap: 2px; height: 200px;">
                            <div style="width: 15px; height: ${incomeHeight}px; background: linear-gradient(180deg, #48bb78, #38a169); border-radius: 3px 3px 0 0;" title="ìˆ˜ì…: $${d.income.toFixed(0)}"></div>
                            <div style="width: 15px; height: ${expenseHeight}px; background: linear-gradient(180deg, #f56565, #e53e3e); border-radius: 3px 3px 0 0;" title="ì§€ì¶œ: $${d.expense.toFixed(0)}"></div>
                        </div>
                        <span style="font-size: 0.75em; color: #4a5568;">${d.label}</span>
                    </div>
                `;
            });
            
            html += `
                </div>
                <div style="display: flex; justify-content: center; gap: 30px; margin-top: 15px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #48bb78, #38a169); border-radius: 4px;"></div>
                        <span>ìˆ˜ì…</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #f56565, #e53e3e); border-radius: 4px;"></div>
                        <span>ì§€ì¶œ</span>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // ìˆ˜ì… êµ¬ì„± ì°¨íŠ¸
        function updateIncomeBreakdown() {
            const container = document.getElementById('incomeBreakdown');
            if (!container) return;
            
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth();
            
            const monthlyOfferings = offerings.filter(o => {
                const d = new Date(o.date);
                return d.getFullYear() === currentYear && d.getMonth() === currentMonth;
            });
            
            if (monthlyOfferings.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 50px;">ì´ë²ˆë‹¬ ìˆ˜ì… ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ì¢…ë¥˜ë³„ ì§‘ê³„
            const types = ['ì‹­ì¼ì¡°', 'ê°ì‚¬í—Œê¸ˆ', 'ì£¼ì¼í—Œê¸ˆ', 'ê±´ì¶•í—Œê¸ˆ', 'ì„ êµí—Œê¸ˆ', 'êµ¬ì œí—Œê¸ˆ', 'íŠ¹ë³„í—Œê¸ˆ', 'ê¸°íƒ€'];
            const colors = ['#48bb78', '#4299e1', '#ed8936', '#9f7aea', '#f56565', '#38b2ac', '#d69e2e', '#718096'];
            const typeTotals = {};
            types.forEach(t => typeTotals[t] = 0);
            
            monthlyOfferings.forEach(o => {
                typeTotals[o.type] = (typeTotals[o.type] || 0) + o.amount;
            });
            
            const grandTotal = monthlyOfferings.reduce((sum, o) => sum + o.amount, 0);
            
            let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';
            
            types.forEach((type, idx) => {
                const amount = typeTotals[type] || 0;
                if (amount > 0) {
                    const percent = (amount / grandTotal * 100);
                    html += `
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 80px; font-size: 0.9em;">${type}</div>
                            <div style="flex: 1; background: #e2e8f0; border-radius: 10px; height: 25px; overflow: hidden;">
                                <div style="background: ${colors[idx]}; height: 100%; width: ${percent}%; border-radius: 10px; display: flex; align-items: center; justify-content: flex-end; padding-right: 8px; color: white; font-size: 0.8em; font-weight: 600;">
                                    ${percent > 10 ? '$' + amount.toFixed(0) : ''}
                                </div>
                            </div>
                            <div style="width: 60px; text-align: right; font-size: 0.85em;">${percent.toFixed(1)}%</div>
                        </div>
                    `;
                }
            });
            
            html += `
                <div style="border-top: 2px solid #e2e8f0; padding-top: 10px; margin-top: 10px; display: flex; justify-content: space-between; font-weight: 600;">
                    <span>ì´ ìˆ˜ì…</span>
                    <span style="color: #48bb78;">$${grandTotal.toFixed(0)}</span>
                </div>
            </div>`;
            
            container.innerHTML = html;
        }
        
        // ì§€ì¶œ êµ¬ì„± ì°¨íŠ¸ (ëŒ€ì‹œë³´ë“œìš© - ë¶€ì„œë³„)
        function updateExpenseBreakdownDashboard() {
            const container = document.getElementById('expenseBreakdown');
            if (!container) return;
            
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth();
            
            const monthlyExpenses = expenses.filter(e => {
                const d = new Date(e.date);
                return d.getFullYear() === currentYear && d.getMonth() === currentMonth;
            });
            
            if (monthlyExpenses.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 50px;">ì´ë²ˆë‹¬ ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ë¶€ì„œë³„ ì§‘ê³„
            const deptTotals = {};
            monthlyExpenses.forEach(e => {
                deptTotals[e.department] = (deptTotals[e.department] || 0) + e.amount;
            });
            
            // ì •ë ¬ (ê¸ˆì•¡ ë‚´ë¦¼ì°¨ìˆœ)
            const sortedDepts = Object.entries(deptTotals).sort((a, b) => b[1] - a[1]);
            
            const grandTotal = monthlyExpenses.reduce((sum, e) => sum + e.amount, 0);
            
            // ìƒ‰ìƒ íŒ”ë ˆíŠ¸
            const colors = ['#f56565', '#ed8936', '#ecc94b', '#48bb78', '#38b2ac', '#4299e1', '#9f7aea', '#ed64a6'];
            
            let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';
            
            sortedDepts.forEach(([dept, amount], idx) => {
                const percent = (amount / grandTotal * 100);
                html += `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 70px; font-size: 0.9em;">${dept}</div>
                        <div style="flex: 1; background: #e2e8f0; border-radius: 10px; height: 25px; overflow: hidden;">
                            <div style="background: ${colors[idx % colors.length]}; height: 100%; width: ${percent}%; border-radius: 10px; display: flex; align-items: center; justify-content: flex-end; padding-right: 8px; color: white; font-size: 0.8em; font-weight: 600;">
                                ${percent > 10 ? '$' + amount.toFixed(0) : ''}
                            </div>
                        </div>
                        <div style="width: 55px; text-align: right; font-size: 0.85em;">${percent.toFixed(1)}%</div>
                    </div>
                `;
            });
            
            html += `
                <div style="border-top: 2px solid #e2e8f0; padding-top: 10px; margin-top: 10px; display: flex; justify-content: space-between; font-weight: 600;">
                    <span>ì´ ì§€ì¶œ</span>
                    <span style="color: #f56565;">$${grandTotal.toFixed(0)}</span>
                </div>
            </div>`;
            
            container.innerHTML = html;
        }
        
        // ìµœê·¼ ê±°ë˜ ë‚´ì—­
        function updateRecentTransactions() {
            const container = document.getElementById('recentTransactions');
            if (!container) return;
            
            // ìˆ˜ì…ê³¼ ì§€ì¶œ í•©ì³ì„œ ì •ë ¬
            const allTransactions = [
                ...offerings.map(o => ({ ...o, transactionType: 'income', displayName: o.name, displayCategory: o.type })),
                ...expenses.map(e => ({ ...e, transactionType: 'expense', displayName: e.item, displayCategory: e.category }))
            ];
            
            // ìµœì‹ ìˆœ ì •ë ¬
            allTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // ìµœê·¼ 10ê±´ë§Œ í‘œì‹œ
            const recentTrans = allTransactions.slice(0, 10);
            
            if (recentTrans.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ë‚ ì§œ</th>
                                <th>êµ¬ë¶„</th>
                                <th>ë‚´ìš©</th>
                                <th>ë¶„ë¥˜</th>
                                <th>ê¸ˆì•¡</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            recentTrans.forEach(t => {
                const isIncome = t.transactionType === 'income';
                html += `
                    <tr>
                        <td>${t.date}</td>
                        <td><span class="badge ${isIncome ? 'badge-success' : 'badge-danger'}">${isIncome ? 'ìˆ˜ì…' : 'ì§€ì¶œ'}</span></td>
                        <td>${t.displayName}</td>
                        <td>${t.displayCategory}</td>
                        <td style="color: ${isIncome ? '#48bb78' : '#e53e3e'}; font-weight: 600;">
                            ${isIncome ? '+' : '-'}$${t.amount.toFixed(0)}
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }
        
        // ========== ë³´ê³ ì„œ ê¸°ëŠ¥ ==========
        
        // ë³´ê³ ì„œ ëª¨ë‹¬ í‘œì‹œ
        function showReportModal(type) {
            document.getElementById('reportModal').classList.add('active');
            document.getElementById('reportIRS').style.display = 'none';
            document.getElementById('reportCouncil').style.display = 'none';
            
            if (type === 'irs') {
                document.getElementById('reportModalTitle').textContent = 'ğŸ“„ IRS ì„¸ê¸ˆê³µì œ ì„œë¥˜';
                document.getElementById('reportIRS').style.display = 'block';
                loadIRSMemberList();
            } else if (type === 'council') {
                document.getElementById('reportModalTitle').textContent = 'ğŸ“‹ ì œì§íšŒ/ê³µë™ì˜íšŒ ë³´ê³ ì„œ';
                document.getElementById('reportCouncil').style.display = 'block';
                // ê¸°ë³¸ ë‚ ì§œ ì„¤ì • (ì´ë²ˆ ë‹¬)
                const now = new Date();
                const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
                const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                document.getElementById('councilStartDate').value = firstDay.toISOString().split('T')[0];
                document.getElementById('councilEndDate').value = lastDay.toISOString().split('T')[0];
            }
        }
        
        function closeReportModal() {
            document.getElementById('reportModal').classList.remove('active');
        }
        
        // IRS êµì¸ ëª©ë¡ ë¡œë“œ
        function loadIRSMemberList() {
            const select = document.getElementById('irsMember');
            select.innerHTML = '<option value="all">All Members</option>';
            
            // í—Œê¸ˆí•œ êµì¸ ëª©ë¡ ì¶”ì¶œ
            const uniqueNames = [...new Set(offerings.map(o => o.name))];
            uniqueNames.sort().forEach(name => {
                select.innerHTML += `<option value="${name}">${name}</option>`;
            });
        }
        
        // IRS ë³´ê³ ì„œ ë¯¸ë¦¬ë³´ê¸°
        function generateIRSReport() {
            const year = parseInt(document.getElementById('irsYear').value);
            const memberName = document.getElementById('irsMember').value;
            const container = document.getElementById('irsPreview');
            
            // í•´ë‹¹ ì—°ë„ í—Œê¸ˆ í•„í„°
            let filtered = offerings.filter(o => {
                const d = new Date(o.date);
                return d.getFullYear() === year;
            });
            
            if (memberName !== 'all') {
                filtered = filtered.filter(o => o.name === memberName);
            }
            
            if (filtered.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">No donation records found for the selected criteria.</p>';
                return;
            }
            
            // í•œê¸€ ì´ë¦„ â†’ ì˜ë¬¸ ì´ë¦„ ë³€í™˜ í•¨ìˆ˜
            function getEnglishName(koreanName) {
                const member = members.find(m => m.nameKr === koreanName);
                if (member && member.nameEn) {
                    return member.nameEn;
                }
                // ì˜ë¬¸ ì´ë¦„ ì—†ìœ¼ë©´ í•œê¸€ ì´ë¦„ ê·¸ëŒ€ë¡œ ë°˜í™˜
                return koreanName;
            }
            
            // êµì¸ë³„ ì§‘ê³„
            const memberTotals = {};
            filtered.forEach(o => {
                if (!memberTotals[o.name]) {
                    memberTotals[o.name] = { name: o.name, nameEn: getEnglishName(o.name), total: 0, details: {} };
                }
                memberTotals[o.name].total += o.amount;
                memberTotals[o.name].details[o.type] = (memberTotals[o.name].details[o.type] || 0) + o.amount;
            });
            
            // ì˜ì–´ ì»¬ëŸ¼ëª… ë§¤í•‘
            const types = ['ì‹­ì¼ì¡°', 'ê°ì‚¬í—Œê¸ˆ', 'ì£¼ì¼í—Œê¸ˆ', 'ê±´ì¶•í—Œê¸ˆ', 'ì„ êµí—Œê¸ˆ', 'êµ¬ì œí—Œê¸ˆ', 'íŠ¹ë³„í—Œê¸ˆ', 'ê¸°íƒ€'];
            const typesEn = ['Tithe', 'Thanksgiving', 'Sunday', 'Building', 'Mission', 'Benevolence', 'Special', 'Other'];
            
            let html = `
                <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 15px;">
                    <h2 style="margin: 0; font-size: 1.5em;">Sacramento Glory Korean Church</h2>
                    <p style="margin: 5px 0; color: #666;">EIN# 88-1719323</p>
                    <h3 style="margin: 15px 0 5px 0; color: #333;">${year} Contribution Statement</h3>
                    <p style="margin: 0; color: #666; font-size: 0.9em;">For IRS Tax Deduction Purposes</p>
                </div>
                <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                    <thead>
                        <tr style="background: #f7fafc;">
                            <th style="border: 1px solid #ddd; padding: 10px;">Donor Name</th>
                            ${typesEn.map(t => `<th style="border: 1px solid #ddd; padding: 10px;">${t}</th>`).join('')}
                            <th style="border: 1px solid #ddd; padding: 10px; background: #667eea; color: white;">Total</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            Object.values(memberTotals).sort((a, b) => b.total - a.total).forEach(member => {
                html += `
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 10px; font-weight: bold;">${member.nameEn}</td>
                        ${types.map(t => `<td style="border: 1px solid #ddd; padding: 10px; text-align: right;">$${(member.details[t] || 0).toFixed(2)}</td>`).join('')}
                        <td style="border: 1px solid #ddd; padding: 10px; text-align: right; font-weight: bold; color: #667eea;">$${member.total.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            const grandTotal = Object.values(memberTotals).reduce((sum, m) => sum + m.total, 0);
            
            html += `
                    </tbody>
                    <tfoot>
                        <tr style="background: #edf2f7; font-weight: bold;">
                            <td style="border: 1px solid #ddd; padding: 10px;">Total</td>
                            ${types.map(t => {
                                const typeTotal = Object.values(memberTotals).reduce((sum, m) => sum + (m.details[t] || 0), 0);
                                return `<td style="border: 1px solid #ddd; padding: 10px; text-align: right;">$${typeTotal.toFixed(2)}</td>`;
                            }).join('')}
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right; color: #e53e3e;">$${grandTotal.toFixed(2)}</td>
                        </tr>
                    </tfoot>
                </table>
                
                <div style="margin-top: 30px; padding: 20px; background: #f7fafc; border-radius: 8px;">
                    <p style="margin: 0 0 20px 0; font-size: 0.85em; color: #666;">
                        * This statement is provided for tax deduction purposes.<br>
                        * No goods or services were provided in exchange for these contributions.<br>
                        * Please keep this statement for your tax records.
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 30px;">
                        <div>
                            <p style="margin: 0 0 5px 0; font-weight: bold;">Church Officer Signature:</p>
                            <div style="border-bottom: 1px solid #333; height: 40px; margin-bottom: 5px;"></div>
                            <p style="margin: 0; font-size: 0.85em; color: #666;">Name: _______________________</p>
                            <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #666;">Title: _______________________</p>
                        </div>
                        <div>
                            <p style="margin: 0 0 5px 0; font-weight: bold;">Date:</p>
                            <div style="border-bottom: 1px solid #333; height: 40px; margin-bottom: 5px;"></div>
                            <p style="margin: 0; font-size: 0.85em; color: #666;">Issue Date: ${new Date().toLocaleDateString('en-US')}</p>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                    <p style="margin: 0; font-size: 0.8em; color: #888;">
                        Sacramento Glory Korean Church | EIN# 88-1719323
                    </p>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // êµ¬ê¸€ ì‹œíŠ¸ë¡œ IRS ë³´ê³ ì„œ ë‚´ë³´ë‚´ê¸°
        function exportIRSToGoogleSheet() {
            const year = parseInt(document.getElementById('irsYear').value);
            const memberName = document.getElementById('irsMember').value;
            
            let filtered = offerings.filter(o => {
                const d = new Date(o.date);
                return d.getFullYear() === year;
            });
            
            if (memberName !== 'all') {
                filtered = filtered.filter(o => o.name === memberName);
            }
            
            if (filtered.length === 0) {
                alert('No data to export.');
                return;
            }
            
            // êµì¸ë³„ ì§‘ê³„
            const memberTotals = {};
            filtered.forEach(o => {
                if (!memberTotals[o.name]) {
                    memberTotals[o.name] = { name: o.name, total: 0, details: {} };
                }
                memberTotals[o.name].total += o.amount;
                memberTotals[o.name].details[o.type] = (memberTotals[o.name].details[o.type] || 0) + o.amount;
            });
            
            const types = ['ì‹­ì¼ì¡°', 'ê°ì‚¬í—Œê¸ˆ', 'ì£¼ì¼í—Œê¸ˆ', 'ê±´ì¶•í—Œê¸ˆ', 'ì„ êµí—Œê¸ˆ', 'êµ¬ì œí—Œê¸ˆ', 'íŠ¹ë³„í—Œê¸ˆ', 'ê¸°íƒ€'];
            const typesEn = ['Tithe', 'Thanksgiving', 'Sunday', 'Building', 'Mission', 'Benevolence', 'Special', 'Other'];
            
            // CSV ìƒì„±
            let csv = 'Sacramento Glory Korean Church\n';
            csv += 'EIN# 88-1719323\n';
            csv += year + ' Contribution Statement (For IRS Tax Deduction Purposes)\n\n';
            csv += 'Donor Name,' + typesEn.join(',') + ',Total\n';
            
            Object.values(memberTotals).sort((a, b) => b.total - a.total).forEach(member => {
                csv += member.name + ',' + types.map(t => (member.details[t] || 0).toFixed(2)).join(',') + ',' + member.total.toFixed(2) + '\n';
            });
            
            // í•©ê³„ ì¶”ê°€
            const grandTotal = Object.values(memberTotals).reduce((sum, m) => sum + m.total, 0);
            csv += 'Total,' + types.map(t => {
                const typeTotal = Object.values(memberTotals).reduce((sum, m) => sum + (m.details[t] || 0), 0);
                return typeTotal.toFixed(2);
            }).join(',') + ',' + grandTotal.toFixed(2) + '\n';
            
            // ì„œëª…ë€ ì¶”ê°€
            csv += '\n\n';
            csv += '"* This statement is provided for tax deduction purposes."\n';
            csv += '"* No goods or services were provided in exchange for these contributions."\n';
            csv += '"* Please keep this statement for your tax records."\n';
            csv += '\n\n';
            csv += 'Church Officer Signature:,_______________________\n';
            csv += 'Name:,_______________________\n';
            csv += 'Title:,_______________________\n';
            csv += 'Date:,' + new Date().toLocaleDateString('en-US') + '\n';
            csv += '\n';
            csv += 'Sacramento Glory Korean Church | EIN# 88-1719323\n';
            
            // ë‹¤ìš´ë¡œë“œ
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `IRS_Contribution_Statement_${year}.csv`;
            link.click();
            
            alert('CSV file downloaded.\nOpen in Google Sheets: File > Import');
        }
        
        // IRS ë³´ê³ ì„œ ì¸ì‡„
        function printIRSReport() {
            const content = document.getElementById('irsPreview').innerHTML;
            if (content.includes('Select year')) {
                alert('Please generate a preview first.');
                return;
            }
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>IRS Contribution Statement - Sacramento Glory Korean Church</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; }
                        @media print {
                            body { padding: 0; }
                        }
                    </style>
                </head>
                <body>
                    ${content}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // ì œì§íšŒ/ê³µë™ì˜íšŒ ë³´ê³ ì„œ ë¯¸ë¦¬ë³´ê¸°
        function generateCouncilReport() {
            const startDate = document.getElementById('councilStartDate').value;
            const endDate = document.getElementById('councilEndDate').value;
            const reportType = document.getElementById('councilReportType').value;
            const container = document.getElementById('councilPreview');
            
            if (!startDate || !endDate) {
                alert('ì‹œì‘ ë‚ ì§œì™€ ì¢…ë£Œ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            end.setHours(23, 59, 59, 999);
            
            let html = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">Sacramento Glory Church</h2>
                    <h3 style="margin: 10px 0; color: #666;">ì¬ì • ë³´ê³ ì„œ</h3>
                    <p style="color: #888;">ê¸°ê°„: ${startDate} ~ ${endDate}</p>
                </div>
            `;
            
            // ìˆ˜ì… ë³´ê³ ì„œ
            if (reportType === 'both' || reportType === 'income') {
                const filteredIncome = offerings.filter(o => {
                    const d = new Date(o.date);
                    return d >= start && d <= end;
                });
                
                // í—Œê¸ˆ ì¢…ë¥˜ë³„ ì§‘ê³„ (ì´ë¦„ ì œì™¸)
                const typeTotals = {};
                filteredIncome.forEach(o => {
                    typeTotals[o.type] = (typeTotals[o.type] || 0) + o.amount;
                });
                
                const incomeTotal = filteredIncome.reduce((sum, o) => sum + o.amount, 0);
                
                html += `
                    <h3 style="color: #48bb78; border-bottom: 2px solid #48bb78; padding-bottom: 10px;">ğŸ’° ìˆ˜ì… ë‚´ì—­</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <thead>
                            <tr style="background: #f7fafc;">
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">í—Œê¸ˆ ì¢…ë¥˜</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: right;">ê±´ìˆ˜</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: right;">ê¸ˆì•¡</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                const types = ['ì‹­ì¼ì¡°', 'ê°ì‚¬í—Œê¸ˆ', 'ì£¼ì¼í—Œê¸ˆ', 'ê±´ì¶•í—Œê¸ˆ', 'ì„ êµí—Œê¸ˆ', 'êµ¬ì œí—Œê¸ˆ', 'íŠ¹ë³„í—Œê¸ˆ', 'ê¸°íƒ€'];
                types.forEach(type => {
                    const count = filteredIncome.filter(o => o.type === type).length;
                    const amount = typeTotals[type] || 0;
                    if (count > 0) {
                        html += `
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 10px;">${type}</td>
                                <td style="border: 1px solid #ddd; padding: 10px; text-align: right;">${count}ê±´</td>
                                <td style="border: 1px solid #ddd; padding: 10px; text-align: right;">$${amount.toFixed(2)}</td>
                            </tr>
                        `;
                    }
                });
                
                html += `
                        </tbody>
                        <tfoot>
                            <tr style="background: #e6fffa; font-weight: bold;">
                                <td style="border: 1px solid #ddd; padding: 10px;">ìˆ˜ì… í•©ê³„</td>
                                <td style="border: 1px solid #ddd; padding: 10px; text-align: right;">${filteredIncome.length}ê±´</td>
                                <td style="border: 1px solid #ddd; padding: 10px; text-align: right; color: #48bb78;">$${incomeTotal.toFixed(2)}</td>
                            </tr>
                        </tfoot>
                    </table>
                `;
            }
            
            // ì§€ì¶œ ë³´ê³ ì„œ
            if (reportType === 'both' || reportType === 'expense') {
                const filteredExpense = expenses.filter(e => {
                    const d = new Date(e.date);
                    return d >= start && d <= end;
                });
                
                const expenseTotal = filteredExpense.reduce((sum, e) => sum + e.amount, 0);
                
                html += `
                    <h3 style="color: #f56565; border-bottom: 2px solid #f56565; padding-bottom: 10px;">ğŸ’¸ ì§€ì¶œ ë‚´ì—­</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <thead>
                            <tr style="background: #f7fafc;">
                                <th style="border: 1px solid #ddd; padding: 10px;">ë‚ ì§œ</th>
                                <th style="border: 1px solid #ddd; padding: 10px;">ë¶€ì„œ</th>
                                <th style="border: 1px solid #ddd; padding: 10px;">ë¶„ë¥˜</th>
                                <th style="border: 1px solid #ddd; padding: 10px;">í•­ëª©</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: right;">ê¸ˆì•¡</th>
                                <th style="border: 1px solid #ddd; padding: 10px;">ê²°ì œë°©ë²•</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                filteredExpense.sort((a, b) => new Date(a.date) - new Date(b.date)).forEach(e => {
                    let paymentDisplay = e.payment || 'í˜„ê¸ˆ';
                    if (e.payment === 'Check' && e.checkNumber) {
                        paymentDisplay = `Check #${e.checkNumber}`;
                    }
                    html += `
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 10px;">${e.date}</td>
                            <td style="border: 1px solid #ddd; padding: 10px;">${e.department}</td>
                            <td style="border: 1px solid #ddd; padding: 10px;">${e.category}</td>
                            <td style="border: 1px solid #ddd; padding: 10px;">${e.item}</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right;">$${e.amount.toFixed(2)}</td>
                            <td style="border: 1px solid #ddd; padding: 10px;">${paymentDisplay}</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                        <tfoot>
                            <tr style="background: #fed7d7; font-weight: bold;">
                                <td colspan="4" style="border: 1px solid #ddd; padding: 10px;">ì§€ì¶œ í•©ê³„</td>
                                <td style="border: 1px solid #ddd; padding: 10px; text-align: right; color: #e53e3e;">$${expenseTotal.toFixed(2)}</td>
                                <td style="border: 1px solid #ddd; padding: 10px;"></td>
                            </tr>
                        </tfoot>
                    </table>
                `;
            }
            
            // ìˆ˜ì…/ì§€ì¶œ ìš”ì•½ (ë‘˜ ë‹¤ í‘œì‹œí•  ë•Œ)
            if (reportType === 'both') {
                const filteredIncome = offerings.filter(o => {
                    const d = new Date(o.date);
                    return d >= start && d <= end;
                });
                const filteredExpense = expenses.filter(e => {
                    const d = new Date(e.date);
                    return d >= start && d <= end;
                });
                
                const incomeTotal = filteredIncome.reduce((sum, o) => sum + o.amount, 0);
                const expenseTotal = filteredExpense.reduce((sum, e) => sum + e.amount, 0);
                const balance = incomeTotal - expenseTotal;
                
                html += `
                    <div style="background: linear-gradient(135deg, #667eea, #9f7aea); color: white; padding: 20px; border-radius: 10px; margin-top: 20px;">
                        <h3 style="margin: 0 0 15px 0; color: white;">ğŸ“Š ì¬ì • ìš”ì•½</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; text-align: center;">
                            <div>
                                <div style="font-size: 0.9em; opacity: 0.9;">ì´ ìˆ˜ì…</div>
                                <div style="font-size: 1.5em; font-weight: bold;">$${incomeTotal.toFixed(2)}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9em; opacity: 0.9;">ì´ ì§€ì¶œ</div>
                                <div style="font-size: 1.5em; font-weight: bold;">$${expenseTotal.toFixed(2)}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9em; opacity: 0.9;">ì”ì•¡</div>
                                <div style="font-size: 1.5em; font-weight: bold;">${balance >= 0 ? '+' : ''}$${balance.toFixed(2)}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        // ì œì§íšŒ/ê³µë™ì˜íšŒ ë³´ê³ ì„œ ì¸ì‡„
        function printCouncilReport() {
            const content = document.getElementById('councilPreview').innerHTML;
            if (!content || content.includes('ê¸°ê°„ì„ ì„ íƒí•˜ê³ ')) {
                alert('ë¨¼ì € ë¯¸ë¦¬ë³´ê¸°ë¥¼ í´ë¦­í•˜ì—¬ ë³´ê³ ì„œë¥¼ ìƒì„±í•˜ì„¸ìš”.');
                return;
            }
            
            const startDate = document.getElementById('councilStartDate').value;
            const endDate = document.getElementById('councilEndDate').value;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>ì¬ì • ë³´ê³ ì„œ - Sacramento Glory Church</title>
                    <style>
                        @page { size: A4; margin: 1cm; }
                        body { 
                            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; 
                            padding: 20px;
                            font-size: 12px;
                            line-height: 1.4;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 2px solid #333;
                            padding-bottom: 15px;
                            margin-bottom: 20px;
                        }
                        .header h1 { margin: 0; font-size: 20px; }
                        .header h2 { margin: 10px 0 5px 0; font-size: 16px; color: #333; }
                        .header p { margin: 5px 0; color: #666; }
                        table { 
                            width: 100%; 
                            border-collapse: collapse;
                            margin-bottom: 20px;
                        }
                        th, td { 
                            border: 1px solid #333; 
                            padding: 8px; 
                            text-align: left;
                        }
                        th { 
                            background: #f0f0f0; 
                            font-weight: bold;
                        }
                        tr:nth-child(even) { background: #fafafa; }
                        .total-row { 
                            background: #e8f5e9 !important; 
                            font-weight: bold;
                        }
                        .expense-total { 
                            background: #ffebee !important; 
                            font-weight: bold;
                        }
                        .footer {
                            margin-top: 30px;
                            text-align: center;
                            color: #666;
                            font-size: 10px;
                        }
                        @media print {
                            body { padding: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Sacramento Glory Korean Church</h1>
                        <h2>ì¬ì • ë³´ê³ ì„œ (ì œì§íšŒ/ê³µë™ì˜íšŒ)</h2>
                        <p>ë³´ê³  ê¸°ê°„: ${startDate} ~ ${endDate}</p>
                        <p>ì¶œë ¥ì¼: ${new Date().toLocaleDateString('ko-KR')}</p>
                    </div>
                    ${content}
                    <div class="footer">
                        <p>Sacramento Glory Korean Church | EIN# 88-1719323</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            setTimeout(() => printWindow.print(), 300);
        }
        
        // êµ¬ê¸€ ì‹œíŠ¸ë¡œ ì œì§íšŒ/ê³µë™ì˜íšŒ ë³´ê³ ì„œ ë‚´ë³´ë‚´ê¸°
        function exportCouncilToGoogleSheet() {
            const startDate = document.getElementById('councilStartDate').value;
            const endDate = document.getElementById('councilEndDate').value;
            const reportType = document.getElementById('councilReportType').value;
            
            if (!startDate || !endDate) {
                alert('ì‹œì‘ ë‚ ì§œì™€ ì¢…ë£Œ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            end.setHours(23, 59, 59, 999);
            
            let csv = 'Sacramento Glory Church ì¬ì • ë³´ê³ ì„œ\n';
            csv += `ê¸°ê°„: ${startDate} ~ ${endDate}\n\n`;
            
            // ìˆ˜ì… ë°ì´í„°
            if (reportType === 'both' || reportType === 'income') {
                const filteredIncome = offerings.filter(o => {
                    const d = new Date(o.date);
                    return d >= start && d <= end;
                });
                
                csv += '=== ìˆ˜ì… ë‚´ì—­ (ì¢…ë¥˜ë³„ í•©ê³„) ===\n';
                csv += 'í—Œê¸ˆ ì¢…ë¥˜,ê±´ìˆ˜,ê¸ˆì•¡\n';
                
                const types = ['ì‹­ì¼ì¡°', 'ê°ì‚¬í—Œê¸ˆ', 'ì£¼ì¼í—Œê¸ˆ', 'ê±´ì¶•í—Œê¸ˆ', 'ì„ êµí—Œê¸ˆ', 'êµ¬ì œí—Œê¸ˆ', 'íŠ¹ë³„í—Œê¸ˆ', 'ê¸°íƒ€'];
                types.forEach(type => {
                    const items = filteredIncome.filter(o => o.type === type);
                    if (items.length > 0) {
                        const total = items.reduce((sum, o) => sum + o.amount, 0);
                        csv += `${type},${items.length},${total.toFixed(2)}\n`;
                    }
                });
                
                const incomeTotal = filteredIncome.reduce((sum, o) => sum + o.amount, 0);
                csv += `ìˆ˜ì… í•©ê³„,${filteredIncome.length},${incomeTotal.toFixed(2)}\n\n`;
            }
            
            // ì§€ì¶œ ë°ì´í„°
            if (reportType === 'both' || reportType === 'expense') {
                const filteredExpense = expenses.filter(e => {
                    const d = new Date(e.date);
                    return d >= start && d <= end;
                });
                
                csv += '=== ì§€ì¶œ ë‚´ì—­ ===\n';
                csv += 'ë‚ ì§œ,ë¶€ì„œ,ë¶„ë¥˜,í•­ëª©,ê¸ˆì•¡,ê²°ì œë°©ë²•\n';
                
                filteredExpense.sort((a, b) => new Date(a.date) - new Date(b.date)).forEach(e => {
                    let payment = e.payment || 'í˜„ê¸ˆ';
                    if (e.payment === 'Check' && e.checkNumber) {
                        payment = `Check #${e.checkNumber}`;
                    }
                    csv += `${e.date},${e.department},${e.category},${e.item},${e.amount.toFixed(2)},${payment}\n`;
                });
                
                const expenseTotal = filteredExpense.reduce((sum, e) => sum + e.amount, 0);
                csv += `ì§€ì¶œ í•©ê³„,,,, ${expenseTotal.toFixed(2)},\n`;
            }
                                
            // ë‹¤ìš´ë¡œë“œ
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ì¬ì •ë³´ê³ ì„œ_${startDate}_${endDate}.csv`;
            link.click();
            closeFinanceReportModal();
        }
        
        // ========== ëª¨ë°”ì¼ ë©”ë‰´ í•¨ìˆ˜ ==========
        function toggleMobileMenu() {
            document.getElementById('mobileNavOverlay').classList.add('active');
            document.getElementById('mobileNavMenu').classList.add('active');
            document.body.style.overflow = 'hidden'; // ìŠ¤í¬ë¡¤ ë°©ì§€
        }
        
        function closeMobileMenu() {
            document.getElementById('mobileNavOverlay').classList.remove('active');
            document.getElementById('mobileNavMenu').classList.remove('active');
            document.body.style.overflow = ''; // ìŠ¤í¬ë¡¤ ë³µì›
        }
        
        function showSectionMobile(section) {
            showSection(section);
            closeMobileMenu();
            
            // ëª¨ë°”ì¼ ë©”ë‰´ active ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        // ëª¨ë°”ì¼ ë©”ë‰´ ê¶Œí•œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateMobileMenuPermissions() {
            // ê¸°ì¡´ navì™€ ë™ì¼í•œ ê¶Œí•œ ì ìš©
            const navItems = document.querySelectorAll('.nav-item');
            const mobileItems = document.querySelectorAll('.mobile-nav-item');
            
            mobileItems.forEach((mobileItem, index) => {
                // ê°™ì€ í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ë©”ë‰´ ì•„ì´í…œ ì°¾ê¸°
                const classes = mobileItem.className.split(' ').filter(c => c.startsWith('perm-') || c === 'member-only' || c === 'pastor-also');
                classes.forEach(cls => {
                    const correspondingNavItem = document.querySelector(`.nav-item.${cls}`);
                    if (correspondingNavItem) {
                        mobileItem.style.display = correspondingNavItem.style.display;
                    }
                });
            });
        }
        
        // ê¸°ì¡´ applyUserPermissions í•¨ìˆ˜ ìˆ˜ì • - ëª¨ë°”ì¼ ë©”ë‰´ë„ ì—…ë°ì´íŠ¸
        const originalApplyUserPermissions = typeof applyUserPermissions === 'function' ? applyUserPermissions : null;
        
        // PWA Service Worker ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then((registration) => {
                        console.log('GKC ServiceWorker ë“±ë¡ ì„±ê³µ:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('GKC ServiceWorker ë“±ë¡ ì‹¤íŒ¨:', error);
                    });
            });
        }
    </script>
</body>
</html>
